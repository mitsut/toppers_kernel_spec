<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>TOPPERS第3世代カーネル（ITRON系）統合仕様書</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>TOPPERS第3世代カーネル（ITRON系）統合仕様書</h1>
<div class="details">
<span id="revnumber"> Release 3.4.0,</span>
<span id="revdate">2019年10月5日</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目次</div>
<ul class="sectlevel1">
<li><a href="#_仕様書で用いる記述項目と記号">○ 仕様書で用いる記述項目と記号</a></li>
<li><a href="#_タグの付与方法">○ タグの付与方法</a></li>
<li><a href="#_第１章_toppers第3世代カーネルitron系の概要">第１章 TOPPERS第3世代カーネル（ITRON系）の概要</a>
<ul class="sectlevel2">
<li><a href="#_1_1_toppers第3世代カーネルitron系仕様の位置付け">1.1 TOPPERS第3世代カーネル（ITRON系）仕様の位置付け</a></li>
<li><a href="#_1_2_toppers第3世代カーネルitron系仕様の設計方針">1.2 TOPPERS第3世代カーネル（ITRON系）仕様の設計方針</a></li>
<li><a href="#_1_3_toppersasp3カーネルの適用対象領域と仕様設計方針">1.3 TOPPERS/ASP3カーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_1_4_toppersfmp3カーネルの適用対象領域と仕様設計方針">1.4 TOPPERS/FMP3カーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_1_5_toppershrp3カーネルの適用対象領域と仕様設計方針">1.5 TOPPERS/HRP3カーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_1_6_toppershrmp3カーネルの適用対象領域と仕様設計方針">1.6 TOPPERS/HRMP3カーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_1_7_toppersssp3カーネルの適用対象領域と仕様設計方針">1.7 TOPPERS/SSP3カーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_1_8_その他のカーネル">1.8 その他のカーネル</a></li>
</ul>
</li>
<li><a href="#_第２章_主要な概念と共通定義">第２章 主要な概念と共通定義</a>
<ul class="sectlevel2">
<li><a href="#_2_1_仕様の位置付け">2.1 仕様の位置付け</a>
<ul class="sectlevel3">
<li><a href="#_2_1_1_カーネルの機能セット">2.1.1 カーネルの機能セット</a></li>
<li><a href="#_2_1_2_ターゲット非依存の規定とターゲット定義の規定">2.1.2 ターゲット非依存の規定とターゲット定義の規定</a></li>
<li><a href="#_2_1_3_想定するソフトウェア構成">2.1.3 想定するソフトウェア構成</a></li>
<li><a href="#_2_1_4_想定するハードウェア構成">2.1.4 想定するハードウェア構成</a></li>
<li><a href="#_2_1_5_想定するプログラミング言語">2.1.5 想定するプログラミング言語</a></li>
</ul>
</li>
<li><a href="#_2_2_apiの構成要素とコンベンション">2.2 APIの構成要素とコンベンション</a>
<ul class="sectlevel3">
<li><a href="#_2_2_1_apiの構成要素">2.2.1 APIの構成要素</a></li>
<li><a href="#_2_2_2_パラメータとリターンパラメータ">2.2.2 パラメータとリターンパラメータ</a></li>
<li><a href="#_2_2_3_返値とエラーコード">2.2.3 返値とエラーコード</a></li>
<li><a href="#_2_2_4_機能コード">2.2.4 機能コード</a></li>
<li><a href="#_2_2_5_ヘッダファイル">2.2.5 ヘッダファイル</a></li>
</ul>
</li>
<li><a href="#_2_3_主な概念">2.3 主な概念</a>
<ul class="sectlevel3">
<li><a href="#_2_3_1_オブジェクトと処理単位">2.3.1 オブジェクトと処理単位</a></li>
<li><a href="#_2_3_2_サービスコールとパラメータ">2.3.2 サービスコールとパラメータ</a></li>
<li><a href="#_2_3_3_保護機能">2.3.3 保護機能</a></li>
<li><a href="#_2_3_4_時間パーティショニング">2.3.4 時間パーティショニング</a></li>
<li><a href="#_2_3_5_マルチプロセッサ対応">2.3.5 マルチプロセッサ対応</a></li>
<li><a href="#_2_3_6_その他">2.3.6 その他</a></li>
</ul>
</li>
<li><a href="#_2_4_処理単位の種類と実行順序">2.4 処理単位の種類と実行順序</a>
<ul class="sectlevel3">
<li><a href="#_2_4_1_処理単位の種類">2.4.1 処理単位の種類</a></li>
<li><a href="#_2_4_2_処理単位の実行順序">2.4.2 処理単位の実行順序</a></li>
<li><a href="#_2_4_3_カーネル処理の不可分性">2.4.3 カーネル処理の不可分性</a></li>
<li><a href="#_2_4_4_処理単位を実行するプロセッサ">2.4.4 処理単位を実行するプロセッサ</a></li>
</ul>
</li>
<li><a href="#_2_5_システム状態とコンテキスト">2.5 システム状態とコンテキスト</a>
<ul class="sectlevel3">
<li><a href="#_2_5_1_カーネル動作状態と非動作状態">2.5.1 カーネル動作状態と非動作状態</a></li>
<li><a href="#_2_5_2_タスクコンテキストと非タスクコンテキスト">2.5.2 タスクコンテキストと非タスクコンテキスト</a></li>
<li><a href="#_2_5_3_カーネルの振舞いに影響を与える状態">2.5.3 カーネルの振舞いに影響を与える状態</a></li>
<li><a href="#_2_5_4_全割込みロック状態と全割込みロック解除状態">2.5.4 全割込みロック状態と全割込みロック解除状態</a></li>
<li><a href="#_2_5_5_cpuロック状態とcpuロック解除状態">2.5.5 CPUロック状態とCPUロック解除状態</a></li>
<li><a href="#_2_5_6_割込み優先度マスク">2.5.6 割込み優先度マスク</a></li>
<li><a href="#_2_5_7_ディスパッチ禁止状態とディスパッチ許可状態">2.5.7 ディスパッチ禁止状態とディスパッチ許可状態</a></li>
<li><a href="#_2_5_8_ディスパッチ保留状態">2.5.8 ディスパッチ保留状態</a></li>
<li><a href="#_2_5_9_カーネル管理外の状態">2.5.9 カーネル管理外の状態</a></li>
<li><a href="#_2_5_10_処理単位の開始終了とシステム状態">2.5.10 処理単位の開始・終了とシステム状態</a></li>
</ul>
</li>
<li><a href="#_2_6_タスクの状態遷移とスケジューリング規則">2.6 タスクの状態遷移とスケジューリング規則</a>
<ul class="sectlevel3">
<li><a href="#_2_6_1_基本的なタスク状態">2.6.1 基本的なタスク状態</a></li>
<li><a href="#_2_6_2_タスクの状態遷移">2.6.2 タスクの状態遷移</a></li>
<li><a href="#_2_6_3_タスクのスケジューリング規則">2.6.3 タスクのスケジューリング規則</a></li>
<li><a href="#_2_6_4_待ち行列と待ち解除の順序">2.6.4 待ち行列と待ち解除の順序</a></li>
<li><a href="#_2_6_5_ディスパッチ保留状態で実行中のタスクに対する強制待ち">2.6.5 ディスパッチ保留状態で実行中のタスクに対する強制待ち</a></li>
<li><a href="#_2_6_6_制約タスク">2.6.6 制約タスク</a></li>
<li><a href="#_2_6_7_時間パーティショニング使用時のスケジューリング規則">2.6.7 時間パーティショニング使用時のスケジューリング規則</a></li>
<li><a href="#_2_6_8_スケジューリング単位">2.6.8 スケジューリング単位</a></li>
</ul>
</li>
<li><a href="#_2_7_割込み処理モデル">2.7 割込み処理モデル</a>
<ul class="sectlevel3">
<li><a href="#_2_7_1_割込み処理の流れ">2.7.1 割込み処理の流れ</a></li>
<li><a href="#_2_7_2_割込み優先度">2.7.2 割込み優先度</a></li>
<li><a href="#_2_7_3_割込み要求ラインの属性">2.7.3 割込み要求ラインの属性</a></li>
<li><a href="#_2_7_4_割込みを受け付ける条件">2.7.4 割込みを受け付ける条件</a></li>
<li><a href="#_2_7_5_割込み番号と割込みハンドラ番号">2.7.5 割込み番号と割込みハンドラ番号</a></li>
<li><a href="#_2_7_6_マルチプロセッサにおける割込み処理">2.7.6 マルチプロセッサにおける割込み処理</a></li>
<li><a href="#_2_7_7_カーネル管理外の割込み">2.7.7 カーネル管理外の割込み</a></li>
<li><a href="#_2_7_8_カーネル管理外の割込みの設定方法">2.7.8 カーネル管理外の割込みの設定方法</a></li>
</ul>
</li>
<li><a href="#_2_8_cpu例外処理モデル">2.8 CPU例外処理モデル</a>
<ul class="sectlevel3">
<li><a href="#_2_8_1_cpu例外処理の流れ">2.8.1 CPU例外処理の流れ</a></li>
<li><a href="#_2_8_2_cpu例外ハンドラから呼び出せるサービスコール">2.8.2 CPU例外ハンドラから呼び出せるサービスコール</a></li>
<li><a href="#_2_8_3_エミュレートされたcpu例外ハンドラ">2.8.3 エミュレートされたCPU例外ハンドラ</a></li>
<li><a href="#_2_8_4_カーネル管理外のcpu例外">2.8.4 カーネル管理外のCPU例外</a></li>
</ul>
</li>
<li><a href="#_2_9_システムの初期化と終了">2.9 システムの初期化と終了</a>
<ul class="sectlevel3">
<li><a href="#_2_9_1_システム初期化手順">2.9.1 システム初期化手順</a></li>
<li><a href="#_2_9_2_システム終了手順">2.9.2 システム終了手順</a></li>
</ul>
</li>
<li><a href="#_2_10_オブジェクトの登録とその解除">2.10 オブジェクトの登録とその解除</a>
<ul class="sectlevel3">
<li><a href="#_2_10_1_id番号で識別するオブジェクト">2.10.1 ID番号で識別するオブジェクト</a></li>
<li><a href="#_2_10_2_オブジェクト番号で識別するオブジェクト">2.10.2 オブジェクト番号で識別するオブジェクト</a></li>
<li><a href="#_2_10_3_識別番号を持たないオブジェクト">2.10.3 識別番号を持たないオブジェクト</a></li>
<li><a href="#_2_10_4_オブジェクト生成に必要なメモリ領域">2.10.4 オブジェクト生成に必要なメモリ領域</a></li>
<li><a href="#_2_10_5_オブジェクトが属する保護ドメインの設定">2.10.5 オブジェクトが属する保護ドメインの設定</a></li>
<li><a href="#_2_10_6_オブジェクトが属するクラスの設定">2.10.6 オブジェクトが属するクラスの設定</a></li>
<li><a href="#_2_10_7_オブジェクトの状態参照">2.10.7 オブジェクトの状態参照</a></li>
</ul>
</li>
<li><a href="#_2_11_オブジェクトのアクセス保護">2.11 オブジェクトのアクセス保護</a>
<ul class="sectlevel3">
<li><a href="#_2_11_1_オブジェクトのアクセス保護とアクセス違反の通知">2.11.1 オブジェクトのアクセス保護とアクセス違反の通知</a></li>
<li><a href="#_2_11_2_メモリオブジェクトに対するアクセス許可ベクタの制限">2.11.2 メモリオブジェクトに対するアクセス許可ベクタの制限</a></li>
<li><a href="#_2_11_3_デフォルトのアクセス許可ベクタ">2.11.3 デフォルトのアクセス許可ベクタ</a></li>
<li><a href="#_2_11_4_アクセス許可ベクタの設定">2.11.4 アクセス許可ベクタの設定</a></li>
<li><a href="#_2_11_5_カーネルの管理領域のアクセス保護">2.11.5 カーネルの管理領域のアクセス保護</a></li>
<li><a href="#_2_11_6_ユーザタスクのユーザスタック領域">2.11.6 ユーザタスクのユーザスタック領域</a></li>
</ul>
</li>
<li><a href="#_2_12_システムコンフィギュレーション手順">2.12 システムコンフィギュレーション手順</a>
<ul class="sectlevel3">
<li><a href="#_2_12_1_システムコンフィギュレーションファイル">2.12.1 システムコンフィギュレーションファイル</a></li>
<li><a href="#_2_12_2_静的apiの文法とパラメータ">2.12.2 静的APIの文法とパラメータ</a></li>
<li><a href="#_2_12_3_保護ドメインの指定">2.12.3 保護ドメインの指定</a></li>
<li><a href="#_2_12_4_クラスの指定">2.12.4 クラスの指定</a></li>
<li><a href="#_2_12_5_コンフィギュレータの処理モデル">2.12.5 コンフィギュレータの処理モデル</a></li>
<li><a href="#_2_12_6_静的apiのパラメータに関するエラー検出">2.12.6 静的APIのパラメータに関するエラー検出</a></li>
<li><a href="#_2_12_7_オブジェクトのid番号の指定">2.12.7 オブジェクトのID番号の指定</a></li>
</ul>
</li>
<li><a href="#_2_13_toppersネーミングコンベンション">2.13 TOPPERSネーミングコンベンション</a>
<ul class="sectlevel3">
<li><a href="#_2_13_1_モジュール識別名">2.13.1 モジュール識別名</a></li>
<li><a href="#_2_13_2_データ型名">2.13.2 データ型名</a></li>
<li><a href="#_2_13_3_関数名">2.13.3 関数名</a></li>
<li><a href="#_2_13_4_変数名">2.13.4 変数名</a></li>
<li><a href="#_2_13_5_定数名">2.13.5 定数名</a></li>
<li><a href="#_2_13_6_マクロ名">2.13.6 マクロ名</a></li>
<li><a href="#_2_13_7_静的api名">2.13.7 静的API名</a></li>
<li><a href="#_2_13_8_ファイル名">2.13.8 ファイル名</a></li>
<li><a href="#_2_13_9_モジュール内部の名称の衝突回避">2.13.9 モジュール内部の名称の衝突回避</a></li>
</ul>
</li>
<li><a href="#_2_14_toppers共通定義">2.14 TOPPERS共通定義</a>
<ul class="sectlevel3">
<li><a href="#_2_14_1_toppers共通ヘッダファイル">2.14.1 TOPPERS共通ヘッダファイル</a></li>
<li><a href="#_2_14_2_toppers共通データ型">2.14.2 TOPPERS共通データ型</a></li>
<li><a href="#_2_14_3_toppers共通定数">2.14.3 TOPPERS共通定数</a></li>
<li><a href="#_2_14_4_toppers共通エラーコード">2.14.4 TOPPERS共通エラーコード</a></li>
<li><a href="#_2_14_5_toppers共通マクロ">2.14.5 TOPPERS共通マクロ</a></li>
<li><a href="#_2_14_6_toppers共通構成マクロ">2.14.6 TOPPERS共通構成マクロ</a></li>
</ul>
</li>
<li><a href="#_2_15_カーネル共通定義">2.15 カーネル共通定義</a>
<ul class="sectlevel3">
<li><a href="#_2_15_1_カーネルヘッダファイル">2.15.1 カーネルヘッダファイル</a></li>
<li><a href="#_2_15_2_カーネル共通定数">2.15.2 カーネル共通定数</a></li>
<li><a href="#_2_15_3_カーネル共通マクロ">2.15.3 カーネル共通マクロ</a></li>
<li><a href="#_2_15_4_カーネル共通構成マクロ">2.15.4 カーネル共通構成マクロ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_第３章_システムインタフェースレイヤapi仕様">第３章 システムインタフェースレイヤAPI仕様</a>
<ul class="sectlevel2">
<li><a href="#_3_1_システムインタフェースレイヤの概要">3.1 システムインタフェースレイヤの概要</a></li>
<li><a href="#_3_2_silヘッダファイル">3.2 SILヘッダファイル</a></li>
<li><a href="#_3_3_全割込みロック状態の制御">3.3 全割込みロック状態の制御</a></li>
<li><a href="#_3_4_silスピンロック">3.4 SILスピンロック</a></li>
<li><a href="#_3_5_微少時間待ち">3.5 微少時間待ち</a></li>
<li><a href="#_3_6_エンディアンの取得">3.6 エンディアンの取得</a></li>
<li><a href="#_3_7_メモリ空間アクセス関数">3.7 メモリ空間アクセス関数</a></li>
<li><a href="#_3_8_io空間アクセス関数">3.8 I/O空間アクセス関数</a></li>
<li><a href="#_3_9_プロセッサidの参照">3.9 プロセッサIDの参照</a></li>
</ul>
</li>
<li><a href="#_第４章_カーネルapi仕様">第４章 カーネルAPI仕様</a>
<ul class="sectlevel2">
<li><a href="#_4_1_タスク管理機能">4.1 タスク管理機能</a></li>
<li><a href="#_4_2_タスク付属同期機能">4.2 タスク付属同期機能</a></li>
<li><a href="#_4_3_タスク終了機能">4.3 タスク終了機能</a></li>
<li><a href="#_4_4_同期通信機能">4.4 同期・通信機能</a>
<ul class="sectlevel3">
<li><a href="#_4_4_1_セマフォ">4.4.1 セマフォ</a></li>
<li><a href="#_4_4_2_イベントフラグ">4.4.2 イベントフラグ</a></li>
<li><a href="#_4_4_3_データキュー">4.4.3 データキュー</a></li>
<li><a href="#_4_4_4_優先度データキュー">4.4.4 優先度データキュー</a></li>
<li><a href="#_4_4_5_ミューテックス">4.4.5 ミューテックス</a></li>
<li><a href="#_4_4_6_メッセージバッファ">4.4.6 メッセージバッファ</a></li>
<li><a href="#_4_4_7_スピンロック">4.4.7 スピンロック</a></li>
</ul>
</li>
<li><a href="#_4_5_メモリプール管理機能">4.5 メモリプール管理機能</a>
<ul class="sectlevel3">
<li><a href="#_4_5_1_固定長メモリプール">4.5.1 固定長メモリプール</a></li>
</ul>
</li>
<li><a href="#_4_6_時間管理機能">4.6 時間管理機能</a>
<ul class="sectlevel3">
<li><a href="#_4_6_1_システム時刻管理">4.6.1 システム時刻管理</a></li>
<li><a href="#_4_6_2_周期通知">4.6.2 周期通知</a></li>
<li><a href="#_4_6_3_アラーム通知">4.6.3 アラーム通知</a></li>
<li><a href="#_4_6_4_オーバランハンドラ">4.6.4 オーバランハンドラ</a></li>
</ul>
</li>
<li><a href="#_4_7_システム状態管理機能">4.7 システム状態管理機能</a></li>
<li><a href="#_4_8_メモリオブジェクト管理機能">4.8 メモリオブジェクト管理機能</a></li>
<li><a href="#_4_9_割込み管理機能">4.9 割込み管理機能</a></li>
<li><a href="#_4_10_cpu例外管理機能">4.10 CPU例外管理機能</a></li>
<li><a href="#_4_11_拡張サービスコール管理機能">4.11 拡張サービスコール管理機能</a></li>
<li><a href="#_4_12_保護ドメイン管理機能">4.12 保護ドメイン管理機能</a></li>
<li><a href="#_4_13_システム構成管理機能">4.13 システム構成管理機能</a></li>
</ul>
</li>
<li><a href="#_第５章_リファレンス">第５章 リファレンス</a>
<ul class="sectlevel2">
<li><a href="#_5_1_サービスコール一覧">5.1 サービスコール一覧</a></li>
<li><a href="#_5_2_静的api一覧">5.2 静的API一覧</a></li>
<li><a href="#_5_3_データ型">5.3 データ型</a>
<ul class="sectlevel3">
<li><a href="#_5_3_1_toppers共通データ型">5.3.1 TOPPERS共通データ型</a></li>
<li><a href="#_5_3_2_カーネルの使用するデータ型">5.3.2 カーネルの使用するデータ型</a></li>
<li><a href="#_5_3_3_カーネルの使用するパケット形式">5.3.3 カーネルの使用するパケット形式</a></li>
</ul>
</li>
<li><a href="#_5_4_定数とマクロ">5.4 定数とマクロ</a>
<ul class="sectlevel3">
<li><a href="#_5_4_1_toppers共通定数">5.4.1 TOPPERS共通定数</a></li>
<li><a href="#_5_4_2_toppers共通マクロ">5.4.2 TOPPERS共通マクロ</a></li>
<li><a href="#_5_4_3_カーネル共通定数">5.4.3 カーネル共通定数</a></li>
<li><a href="#_5_4_4_カーネル共通マクロ">5.4.4 カーネル共通マクロ</a></li>
<li><a href="#_5_4_5_カーネルの機能毎の定数">5.4.5 カーネルの機能毎の定数</a></li>
<li><a href="#_5_4_6_カーネルの機能毎のマクロ">5.4.6 カーネルの機能毎のマクロ</a></li>
</ul>
</li>
<li><a href="#_5_5_構成マクロ">5.5 構成マクロ</a>
<ul class="sectlevel3">
<li><a href="#_5_5_1_toppers共通構成マクロ">5.5.1 TOPPERS共通構成マクロ</a></li>
<li><a href="#_5_5_2_カーネル共通構成マクロ">5.5.2 カーネル共通構成マクロ</a></li>
<li><a href="#_5_5_3_カーネルの機能毎の構成マクロ">5.5.3 カーネルの機能毎の構成マクロ</a></li>
</ul>
</li>
<li><a href="#_5_6_エラーコード一覧">5.6 エラーコード一覧</a></li>
<li><a href="#_5_7_機能コード一覧ngki4040">5.7 機能コード一覧【NGKI4040】</a></li>
<li><a href="#_5_8_カーネルオブジェクトに対するアクセスの種別">5.8 カーネルオブジェクトに対するアクセスの種別</a></li>
<li><a href="#_5_9_ターゲット定義事項一覧">5.9 ターゲット定義事項一覧</a></li>
<li><a href="#_5_10_省略名の元になった英語">5.10 省略名の元になった英語</a>
<ul class="sectlevel3">
<li><a href="#_5_10_1_サービスコールと静的apiの名称の中のxxxの元になった英語">5.10.1 サービスコールと静的APIの名称の中のxxxの元になった英語</a></li>
<li><a href="#_5_10_2_サービスコールと静的apiの名称の中のyyyの元になった英語">5.10.2 サービスコールと静的APIの名称の中のyyyの元になった英語</a></li>
<li><a href="#_5_10_3_サービスコールの名称の中のzの元になった英語">5.10.3 サービスコールの名称の中のzの元になった英語</a></li>
</ul>
</li>
<li><a href="#_5_11_バージョン履歴">5.11 バージョン履歴</a></li>
</ul>
</li>
<li><a href="#_付録Ａ_バージョン間の差分">付録Ａ バージョン間の差分</a>
<ul class="sectlevel2">
<li><a href="#_a_1_release_3_2_0とrelease_3_2_1の差分">A.1 Release 3.2.0とRelease 3.2.1の差分</a></li>
<li><a href="#_a_2_release_3_2_1とrelease_3_3_0の差分">A.2 Release 3.2.1とRelease 3.3.0の差分</a>
<ul class="sectlevel3">
<li><a href="#_a_2_1_マルチプロセッサ対応に関する仕様変更">A.2.1 マルチプロセッサ対応に関する仕様変更</a></li>
<li><a href="#_a_2_2_保護機能対応に関する仕様変更">A.2.2 保護機能対応に関する仕様変更</a></li>
<li><a href="#_a_2_3_保護機能とマルチプロセッサの両方に対応するための仕様の追加と変更">A.2.3 保護機能とマルチプロセッサの両方に対応するための仕様の追加と変更</a></li>
<li><a href="#_a_2_4_その他の仕様変更">A.2.4 その他の仕様変更</a></li>
<li><a href="#_a_2_5_個別のカーネル仕様の変更">A.2.5 個別のカーネル仕様の変更</a></li>
<li><a href="#_a_2_6_仕様の明確化と整理">A.2.6 仕様の明確化と整理</a></li>
<li><a href="#_a_2_7_用語の変更">A.2.7 用語の変更</a></li>
<li><a href="#_a_2_8_タグの付与に関する変更">A.2.8 タグの付与に関する変更</a></li>
</ul>
</li>
<li><a href="#_a_3_release_3_3_0とrelease_3_4_0の差分">A.3 Release 3.3.0とRelease 3.4.0の差分</a></li>
</ul>
</li>
<li><a href="#_api索引">API索引</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このドキュメントは，TOPPERS第3世代カーネル（ITRON系）に属する一連のリアルタイムカーネルの仕様を，統合的に記述したものである．</p>
</div>
<div class="paragraph">
<p>現時点で，基本仕様（ASP3カーネルの仕様），保護機能対応（HRP3カーネルの仕様），マルチプロセッサ対応（FMP3カーネルの仕様），保護機能とマルチプロセッサの両方に対応する場合（HRMP3カーネルの仕様）に関しては記述が完成している．それに対して，メニーコアプロセッサ対応や動的生成対応については，十分な検討ができておらず，今後変更が加わる可能性がある．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  TOPPERS Third Generation Kernel (ITRON-based) Specification

  Copyright (C) 2006-2019 by Embedded and Real-Time Systems Laboratory
              Graduate School of Information Science, Nagoya Univ., JAPAN
  Copyright (C) 2006-2019 by TOPPERS Project, Inc., JAPAN

 上記著作権者は，以下の (1)〜(3) の条件を満たす場合に限り，本ドキュメ
 ント（本ドキュメントを改変したものを含む．以下同じ）を使用・複製・改
 変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
 (1) 本ドキュメントを利用する場合には，上記の著作権表示，この利用条件
     および下記の無保証規定が，そのままの形でドキュメント中に含まれて
     いること．
 (2) 本ドキュメントを改変する場合には，ドキュメントを改変した旨の記述
     を，改変後のドキュメント中に含めること．ただし，改変後のドキュメ
     ントが，TOPPERSプロジェクト指定の開発成果物である場合には，この限
     りではない．
 (3) 本ドキュメントの利用により直接的または間接的に生じるいかなる損害
     からも，上記著作権者およびTOPPERSプロジェクトを免責すること．また，
     本ドキュメントのユーザまたはエンドユーザからのいかなる理由に基づ
     く請求からも，上記著作権者およびTOPPERSプロジェクトを免責すること．

 本ドキュメントは，無保証で提供されているものである．上記著作権者およ
 びTOPPERSプロジェクトは，本ドキュメントに関して，特定の使用目的に対す
 る適合性も含めて，いかなる保証も行わない．また，本ドキュメントの利用
 により直接的または間接的に生じたいかなる損害に関しても，その責任を負
 わない．</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_仕様書で用いる記述項目と記号"><a class="anchor" href="#_仕様書で用いる記述項目と記号"></a><a class="link" href="#_仕様書で用いる記述項目と記号">○ 仕様書で用いる記述項目と記号</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>この仕様書では，以下の記述項目を用いる．</p>
</div>
<div class="paragraph">
<p>【補足説明】の項では，仕様本体の記述に対する補足事項を説明する．</p>
</div>
<div class="paragraph">
<p>【〜〜カーネルにおける規定】の項では，TOPPERS第3世代カーネル（ITRON系）に属する特定のカーネルにおける追加仕様を規定する．</p>
</div>
<div class="paragraph">
<p>【〜〜仕様との関係】の項では，この仕様と，μITRON4.0仕様，μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との違いについて説明する．</p>
</div>
<div class="paragraph">
<p>【未決定事項】の項では，この仕様書の現時点のバージョンでは，決定されずに残っている事項について記述する．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】の項では，仕様を決定するにあたって考慮した事項について説明する．</p>
</div>
<div class="paragraph">
<p>「<a href="#_第４章_カーネルapi仕様">第４章 カーネルAPI仕様</a>」の章の各サービスコールおよび静的APIの仕様記述においては，以下の記述項目を用いる．</p>
</div>
<div class="paragraph">
<p>【静的API】の項では，システムコンフィギュレーションファイル中で静的APIを記述する形式を規定する．また，【C言語API】の項では，C言語からサービスコールを呼び出す形式を規定する．</p>
</div>
<div class="paragraph">
<p>【パラメータ】の項では，サービスコールおよび静的APIに渡すパラメータの名称とデータ型を規定し，簡単な説明を行う．また，【リターンパラメータ】の項では，サービスコールが返すリターンパラメータの名称とデータ型を規定し，簡単な説明を行う．【エラーコード】の項では，サービスコールおよび静的APIが返す可能性のあるメインエラーコードと，その検出条件を規定する．</p>
</div>
<div class="paragraph">
<p>【機能】の項では，サービスコールおよび静的APIの機能を規定する．</p>
</div>
<div class="paragraph">
<p>TOPPERS第3世代カーネルに属する特定のカーネルにおいてのみサポートするAPIについては，【サポートするカーネル】の項で，そのことを記述する．</p>
</div>
<div class="paragraph">
<p>また，「<a href="#_第４章_カーネルapi仕様">第４章 カーネルAPI仕様</a>」の章では，カーネルのAPIの種別とAPIをサポートするカーネルの種類を表すために，次の記号を用いる．</p>
</div>
<div class="paragraph">
<p>〔T〕はタスクコンテキスト専用のサービスコールを示す．非タスクコンテキストから呼び出すと，E_CTXエラーとなる．</p>
</div>
<div class="paragraph">
<p>〔I〕は非タスクコンテキスト専用のサービスコールを示す．タスクコンテキストから呼び出すと，E_CTXエラーとなる．</p>
</div>
<div class="paragraph">
<p>〔TI〕はタスクコンテキストからも非タスクコンテキストからも呼び出すことのできるサービスコールを示す．</p>
</div>
<div class="paragraph">
<p>〔S〕は静的APIを示す．</p>
</div>
<div class="paragraph">
<p>〔P〕は保護機能対応カーネルのみでサポートされているAPIを示す．保護機能対応でないカーネルでは，このAPIはサポートされない．</p>
</div>
<div class="paragraph">
<p>〔M〕はマルチプロセッサ対応カーネルのみでサポートされているAPIを示す．マルチプロセッサ対応でないカーネルでは，このAPIはサポートされない．</p>
</div>
<div class="paragraph">
<p>〔D〕は動的生成対応カーネルのみでサポートされているAPIを示す．動的生成対応でないカーネルでは，このAPIはサポートされない．</p>
</div>
<div class="paragraph">
<p>〔x｜y〕は，xまたはyに該当するAPIを示す．例えば，〔TP｜TM〕は，保護機能対応カーネルまたはマルチプロセッサ対応カーネルでサポートされているタスクコンテキスト専用のサービスコールを示す．</p>
</div>
<div class="paragraph">
<p>また，エラーが発生する条件を表すために，次の記号を用いる．</p>
</div>
<div class="paragraph">
<p>〔s〕は，サービスコールのみで発生するエラーを示す．静的APIでは，このエラーは発生しない．</p>
</div>
<div class="paragraph">
<p>〔S〕は静的APIのみで発生するエラーを示す．サービスコールでは，このエラーは発生しない．</p>
</div>
<div class="paragraph">
<p>〔P〕は保護機能対応カーネルのみで発生するエラーを示す．保護機能対応でないカーネルでは，このエラーは発生しない．</p>
</div>
<div class="paragraph">
<p>〔D〕は動的生成対応カーネルのみで発生するエラーを示す．動的生成対応でないカーネルでは，このエラーは発生しない．</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_タグの付与方法"><a class="anchor" href="#_タグの付与方法"></a><a class="link" href="#_タグの付与方法">○ タグの付与方法</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>この仕様書では，トレーサビリティの確保のために，記述事項に対してタグを付与する．具体的には，以下に該当する記述事項を，タグを付与する対象とする．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>対象ソフトウェアの実装に対する要求事項や制限事項</p>
</li>
<li>
<p>対象ソフトウェアの仕様に対する一般要求事項</p>
</li>
<li>
<p>対象ソフトウェアの動作環境に対する要求事項</p>
</li>
<li>
<p>ターゲット定義の規定</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>それに対して，用語の定義や補足説明，対象ソフトウェアを使用する上での推奨事項や注意事項，仕様決定の理由，他の仕様との関係に対しては，タグを付与しない．</p>
</div>
<div class="paragraph">
<p>タグの形式と意味は次の通りである（xxxxは4桁の数字を表す）．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKIxxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS第3世代カーネル（ITRON系）全体を対象とした記述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPSxxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/ASP3カーネルを対象とした記述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMPSxxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/FMP3カーネルを対象とした記述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPSxxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/HRP3カーネルを対象とした記述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPSxxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/HRMP3カーネルを対象とした記述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSPSxxxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/SSP3カーネルを対象とした記述</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>仕様書中では，ある記述事項にタグYYYYxxxx（YYYYは4〜5文字の英文字，xxxxは4桁の数字を表す）が付与されていることを，【YYYYxxxx】で表現する．それに対して，タグYYYYxxxxを参照する場合には，［YYYYxxxx］と表記する．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_第１章_toppers第3世代カーネルitron系の概要"><a class="anchor" href="#_第１章_toppers第3世代カーネルitron系の概要"></a><a class="link" href="#_第１章_toppers第3世代カーネルitron系の概要">第１章 TOPPERS第3世代カーネル（ITRON系）の概要</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>TOPPERS第3世代カーネル（ITRON系）とは，TOPPERSプロジェクトにおいて，ITRON仕様をベースとして開発している一連のリアルタイムカーネルの総称である．この章では，TOPPERS第3世代カーネル仕様（ITRON系）の位置付けと設計方針，それに属する各カーネルの適用対象領域と設計方針について述べる．</p>
</div>
<div class="sect2">
<h3 id="_1_1_toppers第3世代カーネルitron系仕様の位置付け"><a class="anchor" href="#_1_1_toppers第3世代カーネルitron系仕様の位置付け"></a><a class="link" href="#_1_1_toppers第3世代カーネルitron系仕様の位置付け">1.1 TOPPERS第3世代カーネル（ITRON系）仕様の位置付け</a></h3>
<div class="paragraph">
<p>TOPPERSプロジェクトでは，プロジェクトの第1フェーズにおいて，2000年に公開したTOPPERS/JSPカーネルを始めとして，μITRON4.0仕様およびその保護機能拡張（μITRON4.0/PX仕様）に準拠したリアルタイムカーネルを開発してきた．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様は1999年に，μITRON4.0/PX仕様は2002年に公表されたが，それ以降，大きな仕様改訂は実施されていない．その間に，組込みシステムおよびソフトウェアのますますの大規模化・複雑化，これまで以上に高い信頼性・安全性に対する要求，小さい消費エネルギー下での高い性能要求など，組込みシステム開発を取り巻く状況は刻々変化してきた．リアルタイムカーネルに対しても，マルチプロセッサへの対応，発展的な保護機能のサポート，機能安全対応，省エネルギー制御機能のサポートなど，新しい要求が生じた．</p>
</div>
<div class="paragraph">
<p>TOPPERSプロジェクトでは，リアルタイムカーネルに対するこのような新しい要求に対応するために，μITRON4.0仕様を発展させる形で，TOPPERS新世代カーネル仕様を策定することになった．それをさらに拡張・改良したのが，TOPPERS第3世代カーネル（ITRON系）仕様である。</p>
</div>
<div class="paragraph">
<p>ただし，ITRON仕様が，各社が開発するリアルタイムカーネルを標準化することを目的に，リアルタイムカーネルの「標準仕様」を規定することを目指しているのに対して，TOPPERS第3世代カーネル（ITRON系）仕様は，TOPPERSプロジェクトにおいて開発している一連のリアルタイムカーネルの「実装仕様」を記述するものであり，ITRON仕様とは異なる目的・位置付けを持つものである．</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_toppers第3世代カーネルitron系仕様の設計方針"><a class="anchor" href="#_1_2_toppers第3世代カーネルitron系仕様の設計方針"></a><a class="link" href="#_1_2_toppers第3世代カーネルitron系仕様の設計方針">1.2 TOPPERS第3世代カーネル（ITRON系）仕様の設計方針</a></h3>
<div class="paragraph">
<p>TOPPERS第3世代カーネル（ITRON系）仕様を設計するにあたり，次の方針を設定する．</p>
</div>
<div class="paragraph">
<div class="title">(1) μITRON4.0仕様をベースに拡張・改良を加える</div>
<p>TOPPERS第3世代カーネル（ITRON系）仕様は，多くの技術者の尽力により作成され，多くの実装・使用実績があるμITRON4.0仕様，およびそれを拡張・改良したTOPPERS新世代カーネル仕様をベースとする．ただし，μITRON4.0仕様およびTOPPERS新世代カーネル仕様の策定時以降の状況の変化を考慮し，それらで不十分と考えられる点については積極的に拡張・改良する．μITRON4.0仕様への準拠性やTOPPERS新世代カーネル仕様との互換性にはこだわらない．</p>
</div>
<div class="paragraph">
<div class="title">(2) ソフトウェアの再利用性を重視する</div>
<p>μITRON4.0仕様およびTOPPERS新世代カーネル仕様の策定時点と比べると，組込みソフトウェアの大規模化が進展している一方で，ハードウェアの性能向上も著しい．そのため，ソフトウェアの再利用性を向上させるためには，少々のオーバヘッドは許容される状況にある．</p>
</div>
<div class="paragraph">
<p>そこで，TOPPERS第3世代カーネル（ITRON系）仕様では，μITRON4.0仕様においてオーバヘッド削減のために実装定義または実装依存としていたような項目についても，ターゲットシステムに依存する項目とするのではなく，強く規定する方針とする．</p>
</div>
<div class="paragraph">
<div class="title">(3) 高信頼・安全なシステム構築を支援する</div>
<p>TOPPERS第3世代カーネル（ITRON系）仕様は，高信頼・安全な組込みシステム構築を支援するものとする．</p>
</div>
<div class="paragraph">
<p>安全性の面では，保護機能対応において，機能安全規格の要求を満たすことができるパーティショニング機能を実現する．また，アプリケーションプログラムに問題がある場合でも，リーゾナブルなオーバヘッドでそれを救済できるなら，救済するような仕様とする．</p>
</div>
<div class="paragraph">
<div class="title">(4) アプリケーションシステム構築に必要な機能は積極的に取り込む</div>
<p>上記の方針を満たした上で，多くのアプリケーションシステムに共通に必要となる機能については，積極的にカーネルに取り込む．</p>
</div>
<div class="paragraph">
<p>カーネル単体の信頼性を向上させるためには，カーネルの機能は少なくした方が楽である．しかし，アプリケーションシステム構築に必要となる機能は，カーネルがサポートしていなければアプリケーションプログラムで実現しなければならず，システム全体の信頼性を考えると，多くのアプリケーションシステムに共通に必要となる機能については，カーネルに取り込んだ方が有利である．</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_toppersasp3カーネルの適用対象領域と仕様設計方針"><a class="anchor" href="#_1_3_toppersasp3カーネルの適用対象領域と仕様設計方針"></a><a class="link" href="#_1_3_toppersasp3カーネルの適用対象領域と仕様設計方針">1.3 TOPPERS/ASP3カーネルの適用対象領域と仕様設計方針</a></h3>
<div class="paragraph">
<p>TOPPERS/ASP3カーネル（ASPは，Advanced Standard Profileの略．3はバージョン番号を示す．以下，ASP3カーネル）は，TOPPERS第3世代カーネル（ITRON系）の出発点となるリアルタイムカーネルである．保護機能を持ったカーネルやマルチプロセッサ対応のカーネルは，ASP3カーネルを拡張する形で開発する．</p>
</div>
<div class="paragraph">
<p>ASP3カーネルは，20年以上に渡るITRON仕様の技術開発成果をベースとして，完成度の高いリアルタイムカーネルを実現するものである．完成度を高めるという観点から，カーネル本体の仕様については，枯れた技術で実装できる範囲に留める．</p>
</div>
<div class="paragraph">
<p>ASP3カーネルの主な適用対象は，高い信頼性・安全性・リアルタイム性を要求される組込みシステムとする．ソフトウェア規模の面では，プログラムサイズ（バイナリコード）が数十KB〜1MB程度のシステムを主な適用対象とする．それより大規模なシステムには，保護機能を持ったリアルタイムカーネルを適用すべきと考えられる．</p>
</div>
<div class="paragraph">
<p>ASP3カーネルの機能は，カーネル内で動的なメモリ管理が不要な範囲に留める．これは，高い信頼性・安全性・リアルタイム性を要求される組込みシステムでは，システム稼働中に発生するメモリ不足への対処が難しいためである．この方針から，カーネルオブジェクトは静的に生成することとし，動的なオブジェクト生成機能は設けない．ただし，アプリケーションプログラムが動的なメモリ管理をするためのカーネル機能である固定長メモリプール機能はサポートする．</p>
</div>
<div class="paragraph">
<p>ASP3カーネルがサポートしていない機能の中で，ASP3カーネルに対して小規模な修正を行うことで対応できるものに関しては，拡張パッケージによりサポートしている．現時点で，ASP3カーネルがサポートしている拡張パッケージは次の通りである．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ドリフト調整機能拡張パッケージ</p>
</li>
<li>
<p>メッセージバッファ機能拡張パッケージ</p>
</li>
<li>
<p>オーバランハンドラ機能拡張パッケージ</p>
</li>
<li>
<p>タスク優先度拡張パッケージ</p>
</li>
<li>
<p>制約タスク拡張パッケージ</p>
</li>
<li>
<p>サブ優先度機能拡張パッケージ</p>
</li>
<li>
<p>動的生成機能拡張パッケージ</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_1_4_toppersfmp3カーネルの適用対象領域と仕様設計方針"><a class="anchor" href="#_1_4_toppersfmp3カーネルの適用対象領域と仕様設計方針"></a><a class="link" href="#_1_4_toppersfmp3カーネルの適用対象領域と仕様設計方針">1.4 TOPPERS/FMP3カーネルの適用対象領域と仕様設計方針</a></h3>
<div class="paragraph">
<p>TOPPERS/FMP3カーネル（FMPは，Flexible Multiprocessor Profileの略．3はバージョン番号を示す．以下，FMP3カーネル）は，ASP3カーネルを，マルチプロセッサ向けに拡張したリアルタイムカーネルである．</p>
</div>
<div class="paragraph">
<p>FMP3カーネルの適用対象となるターゲットハードウェアは，ホモジニアスなマルチプロセッサシステムで，プロセッサ数が4〜8個程度以下のものである．各プロセッサが全く同一のものである必要はないが，すべてのプロセッサでバイナリコードを共有することから，同じバイナリコードを実行できることが必要である．プロセッサ間の排他制御をジャイアントロックによって実現しているため，プロセッサ数が多くなると性能が劣化する．</p>
</div>
<div class="paragraph">
<p>FMP3カーネルでは，タスクを実行するプロセッサを静的に決定するのが基本であり，カーネルは自動的に負荷分散する機能を持たないが，タスクをマイグレーションさせるサービスコールを備えている．これを用いて，アプリケーションまたはシステムサービスで動的な負荷分散を実現することが可能である．</p>
</div>
<div class="paragraph">
<p>FMP3カーネルの機能は，ASP3カーネルと同様に，カーネル内で動的なメモリ管理が不要な範囲に留める．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS新世代カーネル統合仕様に基づくTOPPERS/FMPカーネルは，ジャイアントロックと細粒度ロックの両方に対応しており，プロセッサ数が多いマルチ/メニーコアプロセッサにも適用可能であった．しかし，細粒度ロックに対応するためにコードが複雑になり，ジャイアントロックの場合に不要なオーバヘッドが生じるため，FMP3カーネルでは，ジャイアントロックのみに対応することとした．細粒度ロックに対応するカーネルは，別に開発する計画である．</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_5_toppershrp3カーネルの適用対象領域と仕様設計方針"><a class="anchor" href="#_1_5_toppershrp3カーネルの適用対象領域と仕様設計方針"></a><a class="link" href="#_1_5_toppershrp3カーネルの適用対象領域と仕様設計方針">1.5 TOPPERS/HRP3カーネルの適用対象領域と仕様設計方針</a></h3>
<div class="paragraph">
<p>TOPPERS/HRP3カーネル（HRPは，High Reliable system Profileの略．3はバージョン番号を示す．以下，HRP3カーネル）は，さらに高い信頼性・安全性を要求される組込みシステムや，より大規模な組込みシステム向けに適用できるように，ASP3カーネルを拡張したリアルタイムカーネルである．</p>
</div>
<div class="paragraph">
<p>HRP3カーネルの適用対象となるターゲットハードウェアは，特権モードと非特権モードを備え，メモリ保護のためにMMU（Memory Management Unit）またはMPU（Memory Protection Unit）を持つプロセッサを用いたシステムである．HRP3カーネルの主な適用対象は，ソフトウェア規模の面では，プログラムサイズ（バイナリコード）が数百KB以上のシステムである．</p>
</div>
<div class="paragraph">
<p>HRP3カーネルの機能は，ASP3カーネルと同様に，カーネル内で動的なメモリ管理が不要な範囲に留める．具体的には，ASP3カーネルに対して，メモリ保護機能，時間パーティショニング機能，オブジェクトアクセス保護機能，拡張サービスコール機能，メッセージバッファ機能（ASP3カーネルでは拡張パッケージでサポート）を追加している．</p>
</div>
<div class="paragraph">
<p>HRP3カーネルがサポートしていない機能の中で，HRP3カーネルに対して小規模な修正を行うことで対応できるものに関しては，拡張パッケージによりサポートを予定している．現時点で，HRP3カーネルがサポートしている拡張パッケージは次の通りである．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>動的生成機能拡張パッケージ</p>
</li>
<li>
<p>オーバランハンドラ機能拡張パッケージ</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_1_6_toppershrmp3カーネルの適用対象領域と仕様設計方針"><a class="anchor" href="#_1_6_toppershrmp3カーネルの適用対象領域と仕様設計方針"></a><a class="link" href="#_1_6_toppershrmp3カーネルの適用対象領域と仕様設計方針">1.6 TOPPERS/HRMP3カーネルの適用対象領域と仕様設計方針</a></h3>
<div class="paragraph">
<p>TOPPERS/HRMP3カーネル（HRMPは，High Reliable Multiprocessor Profileの略．3はバージョン番号を示す．以下，HRMP3カーネル）は，ASP3カーネルを，マルチプロセッサ向けかつ保護機能対応に拡張したリアルタイムカーネルである．</p>
</div>
<div class="paragraph">
<p>HRMP3カーネルの適用対象となるターゲットハードウェアは，FMPカーネルの適用対象とHRP3の適用対象の両方の特徴を兼ね備えたシステムである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS新世代カーネル統合仕様に基づき，マルチプロセッサと保護機能の両方に対応したカーネルは，開発しなかった．</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_7_toppersssp3カーネルの適用対象領域と仕様設計方針"><a class="anchor" href="#_1_7_toppersssp3カーネルの適用対象領域と仕様設計方針"></a><a class="link" href="#_1_7_toppersssp3カーネルの適用対象領域と仕様設計方針">1.7 TOPPERS/SSP3カーネルの適用対象領域と仕様設計方針</a></h3>
<div class="paragraph">
<p>TOPPERS/SSP3カーネル（SSPは，Smallest Set Profileの略．3はバージョン番号を示す．以下，SSP3カーネル）は，小規模な組込みシステムに用いるために，ASP3カーネルをベースに機能を絞り込んだリアルタイムカーネルである．</p>
</div>
<div class="paragraph">
<p>SSP3カーネルの機能は，μITRON4.0仕様の「仕様準拠の最低条件」の考え方を踏襲し，メモリ使用量を最小化するように定めている．具体的には，SSP3カーネルにおいては，タスクは待ち状態を持たない（言い換えると，制約タスクのみをサポートする）のが最大の特徴である．また，複数のタスクに同じ初期優先度を設定することができない．ASP3カーネルに対して下位互換性を持つように配慮しているが，システム全体のメモリ使用量を最小化するために有用な機能は，ASP3カーネルに対して追加している．</p>
</div>
<div class="paragraph">
<p>TOPPERS/SSP3カーネルの主な適用対象は，プログラムサイズ（バイナリコード）が数KB〜数十KB程度の極めて小規模な組込みシステムである．</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_8_その他のカーネル"><a class="anchor" href="#_1_8_その他のカーネル"></a><a class="link" href="#_1_8_その他のカーネル">1.8 その他のカーネル</a></h3>
<div class="paragraph">
<p>以上で紹介したカーネルに加えて，メニーコアプロセッサに対応するカーネルを開発することを計画している．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_第２章_主要な概念と共通定義"><a class="anchor" href="#_第２章_主要な概念と共通定義"></a><a class="link" href="#_第２章_主要な概念と共通定義">第２章 主要な概念と共通定義</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_2_1_仕様の位置付け"><a class="anchor" href="#_2_1_仕様の位置付け"></a><a class="link" href="#_2_1_仕様の位置付け">2.1 仕様の位置付け</a></h3>
<div class="paragraph">
<p>この仕様は，TOPPERS第3世代カーネル（ITRON系）に属する各カーネルの仕様を，統合的に記述することを目標としている．また，TOPPERS第3世代カーネル（ITRON系）上で動作する各種のシステムサービスに共通に適用される事項についても規定する．</p>
</div>
<div class="sect3">
<h4 id="_2_1_1_カーネルの機能セット"><a class="anchor" href="#_2_1_1_カーネルの機能セット"></a><a class="link" href="#_2_1_1_カーネルの機能セット">2.1.1 カーネルの機能セット</a></h4>
<div class="paragraph">
<p>TOPPERS第3世代カーネル（ITRON系）は，TOPPERS/ASP3カーネルをベースとして，保護機能，マルチプロセッサ，カーネルオブジェクトの動的生成などに対応した一連のカーネルで構成される．</p>
</div>
<div class="paragraph">
<p>この仕様では，TOPPERS第3世代カーネル（ITRON系）を構成する一連のカーネルの仕様を統合的に記述するが，言うまでもなく，カーネルの種類によってサポートする機能は異なる．サポートする機能をカーネルの種類毎に記述する方法もあるが，カーネルの種類はユーザ要求に対応して増える可能性もあり，その度に仕様書を修正するのは得策ではない．</p>
</div>
<div class="paragraph">
<p>そこでこの仕様では，サポートする機能を，カーネルの種類毎ではなく，カーネルの対応する機能セット毎に記述する．具体的には，保護機能を持ったカーネルを保護機能対応カーネル，マルチプロセッサに対応したカーネルをマルチプロセッサ対応カーネル，カーネルオブジェクトの動的生成機能を持ったカーネルを動的生成対応カーネルと呼ぶことにする．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルは，保護機能対応カーネル，マルチプロセッサ対応カーネル，動的生成対応カーネルのいずれでもない【ASPS0001】．ただし，動的生成機能拡張パッケージを用いると，動的生成対応カーネルの機能の一部がサポートされる【ASPS0002】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルは，マルチプロセッサ対応カーネルであり，保護機能対応カーネル，動的生成対応カーネルではない【FMPS0001】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルは，保護機能対応カーネルであり，マルチプロセッサ対応カーネル，動的生成対応カーネルではない【HRPS0001】．ただし，動的生成機能拡張パッケージを用いると，動的生成対応カーネルの機能の一部がサポートされる【HRPS0009】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルは，保護機能とマルチプロセッサの両方に対応するカーネルであり，動的生成対応カーネルではない【HRMPS0001】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルは，保護機能対応カーネル，マルチプロセッサ対応カーネル，動的生成対応カーネルのいずれでもない【SSPS0001】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0仕様は，カーネルオブジェクトの動的生成機能を持っているが，保護機能を持っておらず，マルチプロセッサにも対応していない．μITRON4.0/PX仕様は，μITRON4.0仕様に対して保護機能を追加するための仕様であり，カーネルオブジェクトの動的生成機能と保護機能を持っているが，マルチプロセッサには対応していない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_1_2_ターゲット非依存の規定とターゲット定義の規定"><a class="anchor" href="#_2_1_2_ターゲット非依存の規定とターゲット定義の規定"></a><a class="link" href="#_2_1_2_ターゲット非依存の規定とターゲット定義の規定">2.1.2 ターゲット非依存の規定とターゲット定義の規定</a></h4>
<div class="paragraph">
<p>TOPPERS第3世代カーネル（ITRON系）は，アプリケーションプログラムの再利用性を向上させるために，ターゲットハードウェアや開発環境の違いをできる限り隠蔽することを目指している．ただし，ターゲットハードウェアや開発環境の制限によって実現できない機能が生じたり，逆にターゲットハードウェアの特徴を活かすためには機能拡張が不可欠になる場合がある．また，同一のターゲットハードウェアであっても，アプリケーションシステムによって使用方法が異なる場合があり，ターゲットシステム毎に仕様の細部に違いが生じることは避けられない．</p>
</div>
<div class="paragraph">
<p>そこで，TOPPERS第3世代カーネル（ITRON系）の仕様は，ターゲットシステムによらずに定めるターゲット非依存（target-independent）の規定と，ターゲットシステム毎に定めるターゲット定義（target-defined）の規定に分けて記述する．この仕様書は，ターゲット非依存の規定について記述するものであり，この仕様書で「ターゲット定義」とした事項は，ターゲットシステム毎に用意するドキュメントにおいて規定する．</p>
</div>
<div class="paragraph">
<p>また，この仕様書でターゲット非依存に規定した事項であっても，ターゲットハードウェアや開発環境の制限によって実現できない場合や，実現するためのオーバヘッドが大きくなる場合には，この仕様書の規定を逸脱する場合がある．このような場合には，ターゲットシステム毎に用意するドキュメントでその旨を明記する．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_1_3_想定するソフトウェア構成"><a class="anchor" href="#_2_1_3_想定するソフトウェア構成"></a><a class="link" href="#_2_1_3_想定するソフトウェア構成">2.1.3 想定するソフトウェア構成</a></h4>
<div class="paragraph">
<p>この仕様では，アプリケーションシステムを構成するソフトウェアを，アプリケーションプログラム（以下，単にアプリケーションと呼ぶ），システムサービス，カーネルの3階層に分けて考える（図2-1）．カーネルとシステムサービスをあわせて，ソフトウェアプラットフォームと呼ぶ．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-1.png" alt="figure2 1">
</div>
</div>
<div class="paragraph">
<p>カーネルは，コンピュータの持つ最も基本的なハードウェア資源であるプロセッサ，メモリ，タイマを抽象化し，上位階層のソフトウェア（アプリケーションおよびシステムサービス）に論理的なプログラム実行環境を提供するソフトウェアである．</p>
</div>
<div class="paragraph">
<p>システムサービスは，各種の周辺デバイスを抽象化するソフトウェアで，ファイルシステムやネットワークプロトコルスタック，各種のデバイスドライバなどが含まれる．</p>
</div>
<div class="paragraph">
<p>また，この仕様では，プロセッサと各種の周辺デバイスの接続方法を隠蔽するためのソフトウェア階層として，システムインタフェースレイヤ（SIL）を規定する．</p>
</div>
<div class="paragraph">
<p>システムインタフェースレイヤ，カーネル，各種のシステムサービスを，上位階層のソフトウェアから使うためのインタフェースを，API（Application Programming Interface）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>この仕様書では，第3章においてシステムインタフェースレイヤのAPI仕様を，第4章においてカーネルのAPI仕様を規定する．システムサービスのAPI仕様は，システムサービス毎の仕様書で規定される．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，カーネルとアプリケーションの中間にあるソフトウェアをソフトウェア部品と呼んでいたが，TOPPERS組込みコンポーネントシステム（TECS）においてはカーネルもソフトウェア部品の1つと捉えることから，この仕様ではシステムサービスと呼ぶことにした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_1_4_想定するハードウェア構成"><a class="anchor" href="#_2_1_4_想定するハードウェア構成"></a><a class="link" href="#_2_1_4_想定するハードウェア構成">2.1.4 想定するハードウェア構成</a></h4>
<div class="paragraph">
<p>この仕様では，カーネルがサポートするハードウェア構成として，以下のことを想定している．</p>
</div>
<div class="paragraph">
<p>(a) メモリ番地は，常に同一のメモリを指すこと（オーバレイのように，異なるメモリを同一のメモリ番地でアクセスすることがないこと）【NGKI0001】．マルチプロセッサ対応カーネルにおいては，同一のメモリに対しては，各プロセッサから同一の番地でアクセスできること【NGKI0002】．</p>
</div>
<div class="paragraph">
<p>(b) 一定時間毎にカウントアップしながら，指定した回数カウントアップしたら割込みを発生させる機能を備えた高分解能タイマを持つこと【NGKI0556】．マルチプロセッサ対応カーネルにおいては，高分解能タイマはすべてのプロセッサから読み出すことができ，指定した回数カウントアップしたら割込みを発生させる機能は，タイムイベントを処理するプロセッサ（少なくとも1つは必要）毎に持つこと【NGKI0621】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，指定した回数カウントアップしたら割込みを発生させる機能は，すべてのプロセッサに対して持つこと【HRMPS0013】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>高分解能タイマは，一定時間毎にカウントアップするタイマと，指定した回数カウントアップしたら割込みを発生させるタイマの2つのタイマで実現することもできる．この場合，マルチプロセッサ対応カーネルにおいては，一定時間毎にカウントアップするタイマは各プロセッサで共有し，指定した回数カウントアップしたら割込みを発生させるタイマは，タイムイベントを処理するプロセッサ毎に持つことが必要である．</p>
</div>
<div class="paragraph">
<p>(c) 保護機能対応カーネルにおいては，時間パーティショニングをサポートしない場合を除き，指定した回数カウントアップしたら割込みを発生させる機能を備えたタイムウィンドウタイマを持つこと【NGKI0575】．マルチプロセッサ対応カーネルにおいては，タイムウィンドウタイマはプロセッサ毎に持つこと【NGKI0576】．</p>
</div>
<div class="paragraph">
<p>(d) オーバランハンドラ機能をサポートする場合には，指定した回数カウントアップしたら割込みを発生させる機能を備えたオーバランタイマを持つこと【NGKI0564】．マルチプロセッサ対応カーネルにおいては，オーバランタイマはプロセッサ毎に持つこと【NGKI0565】．</p>
</div>
<div class="paragraph">
<p>(e) 保護機能対応カーネルにおいては，プロセッサが特権モードと非特権モードを備えていること【NGKI0646】．また，メモリ保護のために，MMU（Memory Management Unit）またはMPU（Memory Protection Unit）を持つこと【NGKI0647】．</p>
</div>
<div class="paragraph">
<p>(f) マルチプロセッサ対応カーネルにおいては，各プロセッサが同一の機械語命令を実行できること【NGKI0003】．</p>
</div>
<div class="paragraph">
<p>(g) マルチプロセッサ対応カーネルにおいては，プロセッサ間の排他制御（スピンロック）を実現するための機構を持つこと【NGKI0639】．システムインタフェースレイヤ用とカーネル内部用に，少なくとも2つのスピンロックを実現できることが望ましい【NGKI0640】．</p>
</div>
<div class="paragraph">
<p>以上に挙げたのは，この仕様を策定するにあたっての想定であり，これらをすべて満たせばカーネルを動作させることができるという網羅的な要件リストではない．逆に，これらに合致しないターゲットハードウェアであっても，ターゲット依存の仕様や制約を追加することで，カーネルを動作させることが可能な場合もある．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_1_5_想定するプログラミング言語"><a class="anchor" href="#_2_1_5_想定するプログラミング言語"></a><a class="link" href="#_2_1_5_想定するプログラミング言語">2.1.5 想定するプログラミング言語</a></h4>
<div class="paragraph">
<p>この仕様におけるAPI仕様は，ISO/IEC 9899:1990（以下，C90と呼ぶ）またはISO/IEC 9899:1999（以下，C99と呼ぶ）に準拠したC言語を，フリースタンディング環境で用いることを想定して規定している【NGKI0004】．</p>
</div>
<div class="paragraph">
<p>ただし，C90の規定に加えて，以下のことを仮定している．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>16ビットおよび32ビットの整数型があること【NGKI0005】</p>
</li>
<li>
<p>ポインタが格納できるサイズの整数型があること【NGKI0006】</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_apiの構成要素とコンベンション"><a class="anchor" href="#_2_2_apiの構成要素とコンベンション"></a><a class="link" href="#_2_2_apiの構成要素とコンベンション">2.2 APIの構成要素とコンベンション</a></h3>
<div class="sect3">
<h4 id="_2_2_1_apiの構成要素"><a class="anchor" href="#_2_2_1_apiの構成要素"></a><a class="link" href="#_2_2_1_apiの構成要素">2.2.1 APIの構成要素</a></h4>
<div class="paragraph">
<div class="title">(1) サービスコール</div>
<p>上位階層のソフトウェアから，下位階層のソフトウェアを呼び出すインタフェースをサービスコール（service call）と呼ぶ．カーネルのサービスコールを，システムコール（system call）と呼ぶ場合もある．</p>
</div>
<div class="paragraph">
<div class="title">(2) コールバック</div>
<p>下位階層のソフトウェアから，上位階層のソフトウェアを呼び出すインタフェースをコールバック（callback）と呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">(3) 静的API</div>
<p>オブジェクトの生成情報や初期状態などを定義するために，システムコンフィギュレーションファイル中に記述するインタフェースを，静的API（static API）と呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">(4) 構成マクロ</div>
<p>下位階層のソフトウェアに関する各種の情報を取り出すために，上位階層のソフトウェアが用いるマクロを，構成マクロ（configuration macro）と呼ぶ．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_2_2_パラメータとリターンパラメータ"><a class="anchor" href="#_2_2_2_パラメータとリターンパラメータ"></a><a class="link" href="#_2_2_2_パラメータとリターンパラメータ">2.2.2 パラメータとリターンパラメータ</a></h4>
<div class="paragraph">
<p>サービスコールやコールバックに渡すデータをパラメータ（parameter），それらが返すデータをリターンパラメータ（return parameter）と呼ぶ．また，静的APIに渡すデータもパラメータと呼ぶ．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成するサービスコールなど，パラメータの数が多い場合やオプションのパラメータがある場合，ターゲット定義のパラメータを追加する可能性がある場合には，複数のパラメータを1つの構造体に入れ，その領域へのポインタをパラメータとして渡す【NGKI0007】．また，パラメータのサイズが大きい場合にも，パラメータを入れた領域へのポインタをパラメータとして渡す場合がある【NGKI0008】．</p>
</div>
<div class="paragraph">
<p>C言語APIでは，リターンパラメータは，関数の返値とするか，リターンパラメータを入れる領域へのポインタをパラメータとして渡すことで実現する【NGKI0009】．オブジェクトの状態を参照するサービスコールなど，リターンパラメータの数が多い場合やターゲット定義のリターンパラメータを追加する可能性がある場合には，複数のリターンパラメータを1つの構造体に入れて返すこととし，その領域へのポインタをパラメータとして渡す【NGKI0010】．</p>
</div>
<div class="paragraph">
<p>複数のパラメータまたはリターンパラメータを入れるための構造体を，パケット（packet）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>サービスコールやコールバックに，パケットを置く領域へのポインタやリターンパラメータを入れる領域へのポインタを渡す場合，別に規定がない限りは，サービスコールやコールバックの処理が完了した後は，それらの領域が参照されることはなく，別の目的に使用できる【NGKI0011】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_2_3_返値とエラーコード"><a class="anchor" href="#_2_2_3_返値とエラーコード"></a><a class="link" href="#_2_2_3_返値とエラーコード">2.2.3 返値とエラーコード</a></h4>
<div class="paragraph">
<p>一部の例外を除いて，サービスコールおよびコールバックの返値は，処理が正常終了したかを表す符号付き整数とする．処理が正常終了した場合には，E_OK（＝0）または正の値が返るものとし，値の意味はサービスコールまたはコールバック毎に定める【NGKI0012】．処理が正常終了しなかった場合には，その原因を表す負の値が返る【NGKI0013】．処理が正常終了しなかった原因を表す値を，エラーコード（error code）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>エラーコードは，いずれも負の値のメインエラーコードとサブエラーコードで構成される【NGKI0014】．メインエラーコードとサブエラーコードからエラーコードを構成するマクロ（ERCD）と，エラーコードからメインエラーコードを取り出すマクロ（MERCD），サブエラーコードを取り出すマクロ（SERCD）が用意されている【NGKI0015】．</p>
</div>
<div class="paragraph">
<p>メインエラーコードの名称・意味・値は，カーネルとシステムサービスで共通に定める（「<a href="#_2_14_4_toppers共通エラーコード">2.14.4 TOPPERS共通エラーコード</a>」の節を参照）【NGKI0016】．サービスコールおよびコールバックの機能説明中の「E_XXXXXエラーとなる」または「E_XXXXXエラーが返る」という記述は，メインエラーコードとしてE_XXXXXが返ることを意味する．</p>
</div>
<div class="paragraph">
<p>サブエラーコードは，エラーの原因をより詳細に表すために用いる．カーネルはサブエラーコードを使用せず，サブエラーコードとして常に-1が返る【NGKI0017】．サブエラーコードの名称・意味・値は，サブエラーコードを使用するシステムサービスのAPI仕様において規定する【NGKI0018】．</p>
</div>
<div class="paragraph">
<p>サービスコールが負の値のエラーコード（警告と通信エラーを表すものを除く）を返した場合には，サービスコールによる副作用がないのが原則である【NGKI0019】．ただし，そのような実装ができない場合にはこの原則の例外とし，サービスコールの機能説明にその旨を記述する【NGKI0020】．</p>
</div>
<div class="paragraph">
<p>サービスコールが複数のエラーを検出するべき状況では，その内のいずれか1つのエラーを示すエラーコードが返る【NGKI0021】．</p>
</div>
<div class="paragraph">
<p>コールバックが複数のエラーを検出するべき状況では，その内のいずれか1つのエラーを示すエラーコードを返せばよい【NGKI0022】．</p>
</div>
<div class="paragraph">
<p>なお，静的APIは返値を持たない．静的APIの処理でエラーが検出された場合の扱いについては，「<a href="#_2_12_5_コンフィギュレータの処理モデル">2.12.5 コンフィギュレータの処理モデル</a>」の節および「<a href="#_2_12_6_静的apiのパラメータに関するエラー検出">2.12.6 静的APIのパラメータに関するエラー検出</a>」の節を参照すること．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_2_4_機能コード"><a class="anchor" href="#_2_2_4_機能コード"></a><a class="link" href="#_2_2_4_機能コード">2.2.4 機能コード</a></h4>
<div class="paragraph">
<p>ソフトウェア割込みによりサービスコールを呼び出す場合などに用いるためのサービスコールを識別するための番号を，機能コード（function code）と呼ぶ．機能コードは符号付きの整数値とし，カーネルのサービスコールには負の値を割り付け，拡張サービスコールには正の値を用いる【NGKI0023】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_2_5_ヘッダファイル"><a class="anchor" href="#_2_2_5_ヘッダファイル"></a><a class="link" href="#_2_2_5_ヘッダファイル">2.2.5 ヘッダファイル</a></h4>
<div class="paragraph">
<p>カーネルやシステムサービスを用いるために必要な定義を含むファイル．</p>
</div>
<div class="paragraph">
<p>ヘッダファイルは，原則として，複数回インクルードしてもエラーにならないように対処されている．具体的には，ヘッダファイルの先頭で特定の識別子（例えば，kernel.hなら"TOPPERS_KERNEL_H"）がマクロ定義され，ヘッダファイルの内容全体をその識別子が定義されていない場合のみ有効とする条件ディレクティブが付加されている【NGKI0024】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_3_主な概念"><a class="anchor" href="#_2_3_主な概念"></a><a class="link" href="#_2_3_主な概念">2.3 主な概念</a></h3>
<div class="sect3">
<h4 id="_2_3_1_オブジェクトと処理単位"><a class="anchor" href="#_2_3_1_オブジェクトと処理単位"></a><a class="link" href="#_2_3_1_オブジェクトと処理単位">2.3.1 オブジェクトと処理単位</a></h4>
<div class="paragraph">
<div class="title">(1) オブジェクト</div>
<p>カーネルまたはシステムサービスが管理対象とするソフトウェア資源を，オブジェクト（object）と呼ぶ．特に，カーネルが管理対象とするソフトウェア資源を，カーネルオブジェクト（kernel object）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>オブジェクトは，種類毎に，番号によって識別する【NGKI0025】．カーネルまたはシステムサービスで，オブジェクトに対して任意に識別番号を付与できる場合には，1から連続する正の整数値でオブジェクトを識別するのを原則とする【NGKI0026】．この場合に，オブジェクトの識別番号を，オブジェクトのID番号（ID number）と呼ぶ．そうでない場合，すなわちカーネルまたはシステムサービスの内部または外部からの条件によって識別番号が決まる場合には，オブジェクトの識別番号を，オブジェクト番号（object number）と呼ぶ．識別する必要のないオブジェクトには，識別番号を付与しない場合がある【NGKI0027】．</p>
</div>
<div class="paragraph">
<p>オブジェクト属性（object attribute）は，オブジェクトの動作モードや初期状態を定めるもので，オブジェクトの登録時に指定する【NGKI0028】．オブジェクト属性にTA_XXXXが指定されている場合，そのオブジェクトを，TA_XXXX属性のオブジェクトと呼ぶ．複数の属性を指定する場合には，オブジェクト属性を渡すパラメータに，指定する属性値のビット毎論理和（C言語の"|"）を渡す【NGKI0029】．また，指定すべきオブジェクト属性がない場合には，TA_NULLを指定する【NGKI0030】．</p>
</div>
<div class="paragraph">
<div class="title">(2) 処理単位</div>
<p>オブジェクトの中には，プログラムが対応付けられるものがある．プログラムが対応付けられるオブジェクト（または，対応付けられるプログラム）を，処理単位（processing unit）と呼ぶ．処理単位に対応付けられるプログラムは，アプリケーションまたはシステムサービスで用意し，カーネルが実行制御する．</p>
</div>
<div class="paragraph">
<p>処理単位の実行を要求することを起動（activate），処理単位の実行を開始することを実行開始（start）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>拡張情報（extended information）は，処理単位が呼び出される時にパラメータとして渡される情報で，処理単位の登録時に指定する【NGKI0031】．拡張情報は，カーネルやシステムサービスの動作には影響しない【NGKI0032】．</p>
</div>
<div class="paragraph">
<div class="title">(3) タスク</div>
<p>カーネルが実行順序を制御するプログラムの並行実行の単位をタスク（task）と呼ぶ．タスクは，処理単位の1つである．</p>
</div>
<div class="paragraph">
<p>サービスコールの機能説明において，サービスコールを呼び出したタスクを，自タスク（invoking task）と呼ぶ．拡張サービスコールからサービスコールを呼び出した場合には，拡張サービスコールを呼び出したタスクが自タスクである．</p>
</div>
<div class="paragraph">
<p>カーネルには，静的APIにより，少なくとも1つのタスクを登録しなければならない．タスクが登録されていない場合には，コンフィギュレータがエラーを報告する【NGKI0033】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>タスクが呼び出した拡張サービスコールが実行されている間は，「サービスコールを呼び出した処理単位」は拡張サービスコールであり，「自タスク」とは一致しない．そのため，保護機能対応カーネルにおいて，「サービスコールを呼び出した処理単位の属する保護ドメイン」と「自タスクの属する保護ドメイン」は，異なるものを指す．</p>
</div>
<div class="paragraph">
<div class="title">(4) ディスパッチとスケジューリング</div>
<p>プロセッサが実行するタスクを切り換えることを，タスクディスパッチまたは単にディスパッチ（dispatching）と呼ぶ．それに対して，次に実行すべきタスクを決定する処理を，タスクスケジューリングまたは単にスケジューリング（scheduling）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>ディスパッチが起こるべき状態（すなわち，スケジューリングによって，現在実行しているタスクとは異なるタスクが，実行すべきタスクに決定されている状態）となっても，何らかの理由でディスパッチを行わないことを，ディスパッチの保留（pend dispatching）という．ディスパッチを行わない理由が解除された時点で，ディスパッチが起こる【NGKI0034】．</p>
</div>
<div class="paragraph">
<div class="title">(5) 割込みとCPU例外</div>
<p>プロセッサが実行中の処理とは独立に発生するイベントによって起動される例外処理のことを，外部割込みまたは単に割込み（interrupt）と呼ぶ．それに対して，プロセッサが実行中の処理に依存して起動される例外処理を，CPU例外（CPU exception）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>周辺デバイスからの割込み要求をプロセッサに伝える経路を遮断し，割込み要求が受け付けられるのを抑止することを，割込みのマスク（mask interrupt）または割込みの禁止（disable interrupt）という．マスクが解除された時点で，まだ割込み要求が保持されていれば，その時点で割込み要求を受け付ける【NGKI0035】．</p>
</div>
<div class="paragraph">
<p>マスクすることができない割込みを，NMI（non-maskable interrupt）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>例外処理を起こすための命令（ソフトウェア割込み命令）によって発生する例外処理を，ソフトウェア割込みと呼ぶ．ソフトウェア割込みは，特権モードで実行すべきサービスコールを呼び出すなどの目的で使用される．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様において，未定義のまま使われていた割込みとCPU例外という用語を定義した．</p>
</div>
<div class="paragraph">
<div class="title">(6) タイムイベント通知とタイムイベントハンドラ</div>
<p>時間の経過をきっかけに発生するイベントをタイムイベント（time event）と呼ぶ．タイムイベントをアプリケーションに通知する機能を，タイムイベント通知（time event notification），タイムイベントにより起動され，カーネルが実行制御する処理単位を，タイムイベントハンドラ（time event handler）と呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>タイムイベント通知の概念を追加した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_3_2_サービスコールとパラメータ"><a class="anchor" href="#_2_3_2_サービスコールとパラメータ"></a><a class="link" href="#_2_3_2_サービスコールとパラメータ">2.3.2 サービスコールとパラメータ</a></h4>
<div class="paragraph">
<div class="title">(1) 優先順位と優先度</div>
<p>優先順位（precedence）とは，処理単位の実行順序を説明するための仕様上の概念である．複数の処理単位が実行できる場合には，その中で最も優先順位の高い処理単位が実行される【NGKI0036】．</p>
</div>
<div class="paragraph">
<p>優先度（priority）は，タスクなどの処理単位の優先順位や，データなどの配送順序を決定するために，アプリケーションが処理単位やデータなどに与える値である．優先度は，符号付きの整数型であるPRI型で表し，1から連続した正の値を用いるのを原則とする【NGKI0037】．優先度は，値が小さいほど優先度が高い（すなわち，先に実行または配送される）ものとする【NGKI0038】．</p>
</div>
<div class="paragraph">
<p>サブ優先度（sub-priority）は，優先度が同一のタスクの間の優先順位を決定するために，アプリケーションがタスクに与える値である．サブ優先度機能をサポートするカーネルにおいては，サブ優先度を使用して優先順位を決定するか否かを，優先度毎に設定することができる【NGKI0558】．サブ優先度はuint_t型で表し，値が小さいほど優先度が高い【NGKI0559】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルは，サブ優先度機能をサポートしない【ASPS0016】．ただし，サブ優先度機能拡張パッケージを用いると，サブ優先度機能を追加することができる【ASPS0017】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルは，サブ優先度機能をサポートする【FMPS0010】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルは，サブ優先度機能をサポートしない【HRPS0012】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルは，サブ優先度機能をサポートしない【HRMPS0002】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルは，サブ優先度機能をサポートしない【SSPS0011】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>サブ優先度の概念を追加した．</p>
</div>
<div class="paragraph">
<div class="title">(2) システム時刻と相対時間</div>
<p>カーネルが管理する時刻を，システム時刻（system time）と呼ぶ．システム時刻は，64ビット（ただし，64ビットの整数型がサポートされていないターゲットでは，32ビット）の符号無しの整数型であるSYSTIM型で表し，単位はマイクロ秒とする【NGKI0548】．</p>
</div>
<div class="paragraph">
<p>タイムイベントを発生させる時刻を指定する場合には，基準時刻（base time）からの相対時間（relative time）によって指定する【NGKI0041】．基準時刻は，別に規定がない限りは，相対時間を指定するサービスコールを呼び出した時刻となる【NGKI0042】．</p>
</div>
<div class="paragraph">
<p>相対時間は，32ビットの符号無しの整数型であるRELTIM型で表し，単位はシステム時刻と同一，すなわちマイクロ秒とする【NGKI0549】．相対時間に指定できる最大値は，4,000,000,000（66分40秒を表す）である【NGKI0550】．この値は，構成マクロTMAX_RELTIMに定義されている【NGKI0551】．</p>
</div>
<div class="paragraph">
<p>タイムイベントを発生させる時刻を相対時間で指定した場合，タイムイベントが処理されるのは，基準時刻から相対時間によって指定した以上の時間が経過した後となる【NGKI0046】．</p>
</div>
<div class="paragraph">
<p>タイムイベントが発生するまでの時間を参照する場合には，基準時刻からの相対時間として返される【NGKI0048】．基準時刻は，相対時間を返すサービスコールを呼び出した時刻となる【NGKI0049】．</p>
</div>
<div class="paragraph">
<p>タイムイベントが発生する時刻が相対時間で返された場合，タイムイベントが処理されるのは，基準時刻から相対時間として返された以上の時間が経過した後となる【NGKI0050】．何らかの理由でタイムイベントの処理が遅れ，タイムイベントが発生する時刻をすでに過ぎている場合には，相対時間として0が返される【NGKI0552】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>サービスコールで相対時間に0を指定した場合には，高分解能タイマが基準時刻後に最初にカウントアップするのをきっかけに，タイムイベントが処理される．また，1を指定した場合には，基準時刻後に2回目にカウントアップするのをきっかけに，タイムイベントが処理される．これは，基準時刻後の最初のカウントアップは，基準時刻の直後に発生する可能性があるため，ここでタイムイベントを処理すると，基準時刻からの経過時間が1以上という仕様を満たせないためである．</p>
</div>
<div class="paragraph">
<p>同様に，相対時間として0が返された場合には，それ以降の可能な限り早いタイミングでタイムイベントが処理される．1が返された場合には，基準時刻後の2回目のカウントアップをきっかけにタイムイベントが処理される．</p>
</div>
<div class="paragraph">
<p>ただし，保護機能対応カーネルで時間パーティショニングを使用する場合には，ユーザドメインに属するタイムイベントの処理は，そのユーザドメインが実行されるタイムウィンドウに切り換わるまで実行されない．詳しくは，「<a href="#_2_6_7_時間パーティショニング使用時のスケジューリング規則">2.6.7 時間パーティショニング使用時のスケジューリング規則</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>システム時刻（SYSTIM型）と相対時間（RELTIM型）の時間単位は，μITRON4.0仕様では実装定義としていたが，この仕様ではマイクロ秒と規定した．また，システム時刻と相対時間のビット長を定め，相対時間の解釈についてより厳密に規定した．TMAX_RELTIMは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>システム時刻（SYSTIM型）と相対時間（RELTIM型）の時間単位は，TOPPERS新世代カーネル統合仕様ではミリ秒としていたが，この仕様ではマイクロ秒に変更した．また，システム時刻と相対時間のビット長を定め，相対時間に指定できる最大値を規定した．相対時間の解釈について，タイムティックを使わない実装を想定した規定に変更した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>相対時間に指定できる最大値を4,000,000,000に制限したのは，タイムイベントを発生させる時刻を，カーネル内部では32ビットの整数型で扱えるようにするためである．</p>
</div>
<div class="paragraph">
<div class="title">(3) タイムアウトとポーリング</div>
<p>サービスコールの中で待ち状態が指定した時間以上継続した場合に，サービスコールの処理を取りやめて，サービスコールからリターンすることを，タイムアウト（timeout）という．タイムアウトしたサービスコールからは，E_TMOUTエラーが返る【NGKI0052】．</p>
</div>
<div class="paragraph">
<p>タイムアウトを起こすまでの時間（タイムアウト時間）は，32ビットの符号無しの整数型であるTMO型で表し，単位はシステム時刻と同一，すなわちマイクロ秒とする【NGKI0553】．タイムアウト時間に，0より大きく，TMAX_RELTIM以下の値を指定した場合には，タイムアウトを起こすまでの相対時間を表す【NGKI0554】．すなわち，タイムアウトの処理が行われるのは，サービスコールを呼び出してから指定した以上の時間が経過した後となる．</p>
</div>
<div class="paragraph">
<p>ポーリング（polling）を行うサービスコールとは，サービスコールの中で待ち状態に遷移すべき状況になった場合に，サービスコールの処理を取りやめてリターンするサービスコールのことをいう．ここで，サービスコールの処理を取りやめてリターンすることを，ポーリングに失敗したという．ポーリングに失敗したサービスコールからは，E_TMOUTエラーが返る【NGKI0055】．</p>
</div>
<div class="paragraph">
<p>ポーリングを行うサービスコールでは，待ち状態に遷移することはないのが原則である【NGKI0056】．そのため，ポーリングを行うサービスコールは，ディスパッチ保留状態であっても呼び出せる【NGKI0057】．ただし，サービスコールの中で待ち状態に遷移する状況が複数ある場合，ある状況でポーリング動作をしても，他の状況では待ち状態に遷移する場合がある．このような場合の振舞いは，該当するサービスコール毎に規定する【NGKI0058】．</p>
</div>
<div class="paragraph">
<p>タイムアウト付きのサービスコールは，別に規定がない限りは，タイムアウト時間にTMO_POL（＝0）を指定した場合にはポーリングを行い，TMO_FEVR（＝UINT32_MAX）を指定した場合にはタイムアウトを起こさないものとする【NGKI0059】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>相対時間の0（基準時刻後の最初のカウントアップをきっかけにタイムイベントを処理）とタイムアウト時間のTMO_POL（＝0，ポーリング）は意味が異なる．具体的な例として，dly_tsk(0U)を呼び出したタスクは待ち状態に遷移するのに対して，tslp_tsk(TMO_POL)を呼び出したタスクは待ち状態には遷移しない．</p>
</div>
<div class="paragraph">
<p>［NGKI0019］の原則より，サービスコールがタイムアウトした場合やポーリングに失敗した場合には，サービスコールによる副作用がないのが原則である．ただし，そのような実装ができない場合にはこの原則の例外とし，どのような副作用があるかをサービスコール毎に規定する．</p>
</div>
<div class="paragraph">
<p>タイムアウト付きのサービスコールを，タイムアウト時間をTMO_POLとして呼び出した場合には，ディスパッチ保留状態で呼び出すとE_CTXエラーとなることを除いては，ポーリングを行うサービスコールと同じ振舞いをする．また，タイムアウト時間をTMO_FEVRとして呼び出した場合には，タイムアウトなしのサービスコールと全く同じ振舞いをする．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>タイムアウト時間（TMO型）の時間単位は，μITRON4.0仕様では実装定義としていたが，この仕様ではマイクロ秒と規定した．また，TMO型を符号無し整数に変更するとともに，ビット長を定め，指定できる最大値を規定した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>タイムアウト時間（TMO型）の時間単位は，TOPPERS新世代カーネル統合仕様ではミリ秒単位としていたが，この仕様ではマイクロ秒に変更した．また，TMO型を符号無し整数に変更するとともに，ビット長を定め，指定できる最大値を規定した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>ディスパッチ保留状態において，ポーリングを行うサービスコールを呼び出せる場合があるのに対して，タイムアウト付きのサービスコールをタイムアウト時間をTMO_POLとして呼び出すとエラーになるのは，割込み優先度マスクが全解除でない状態やディスパッチ禁止状態では，自タスクを広義の待ち状態に遷移させる可能性のあるサービスコール（タイムアウト付きのサービスコールはこれに該当）を呼び出すことはできないという原則［NGKI0175］と［NGKI0179］があるためである．</p>
</div>
<div class="paragraph">
<div class="title">(4) ノンブロッキング</div>
<p>サービスコールの中で待ち状態に遷移すべき状況になった時，サービスコールの処理を継続したままサービスコールからリターンする場合，そのサービスコールをノンブロッキング（non-blocking）という．処理を継続したままリターンする場合，サービスコールからはE_WBLKエラーが返る【NGKI0060】．E_WBLKは警告を表すエラーコードであり，サービスコールによる副作用がないという原則は適用されない【NGKI0061】．</p>
</div>
<div class="paragraph">
<p>サービスコールからE_WBLKエラーが返った場合には，サービスコールの処理は継続しているため，サービスコールに渡したパラメータまたはリターンパラメータを入れる領域はまだアクセスされる可能性があり，別の目的に使用することはできない【NGKI0062】．継続している処理が完了した場合や，何らかの理由で処理が取りやめられた場合には，コールバックを呼び出すなどの方法で，サービスコールを呼び出したソフトウェアに通知するものとする【NGKI0063】．</p>
</div>
<div class="paragraph">
<p>ノンブロッキングの指定は，タイムアウト時間にTMO_NBLK（＝UINT32_MAX-1）を指定することによって行う【NGKI0064】．ノンブロッキングの指定を行えるサービスコールは，指定した場合の振舞いをサービスコール毎に規定する【NGKI0065】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>ノンブロッキングは，システムサービスでサポートすることを想定した機能である．カーネルは，ノンブロッキングの指定を行えるサービスコールをサポートしていない．</p>
</div>
<div class="paragraph">
<div class="title">(5) プロセッサ時間</div>
<p>プロセッサが処理単位の実行に要した時間をプロセッサ時間（processor time）と呼ぶ．プロセッサ時間は，32ビットの符号無しの整数型であるPRCTIM型で表し，単位はマイクロ秒とする【NGKI0573】．プロセッサ時間の計測精度は，ターゲットに依存する【NGKI0574】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>プロセッサ時間は，処理単位の実行に要した時間であり，システム時刻の経過とは独立である．そのため，システム時刻の調整やドリフトの調整によって，プロセッサ時間の進み方が変わることはない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様では，プロセッサ時間の概念はオーバランハンドラ機能のみで使用され，データ型の名称もOVRTIMであったが，この仕様では，時間パーティショニング機能でも使用するため，概念を一般化し，PRCTIM型に改名した．また，PRCTIM型のビット長を定めた．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_3_3_保護機能"><a class="anchor" href="#_2_3_3_保護機能"></a><a class="link" href="#_2_3_3_保護機能">2.3.3 保護機能</a></h4>
<div class="paragraph">
<p>この節では，保護機能に関連する主な概念について説明する．この節の内容は，保護機能対応カーネルにのみ適用される．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ユーザドメインに属する処理単位がタスクの優先度を変更する際に，指定できるタスク優先度を制限することができる機能を廃止した．</p>
</div>
<div class="paragraph">
<div class="title">(1) アクセス保護</div>
<p>保護機能対応カーネルは，処理単位が，許可されたカーネルオブジェクトに対して，許可された種別のアクセスを行うことのみを許し，それ以外のアクセスを防ぐアクセス保護機能を提供する【NGKI0066】．</p>
</div>
<div class="paragraph">
<p>アクセス制御の用語では，処理単位が主体（subject），カーネルオブジェクトが対象（object）ということになる．</p>
</div>
<div class="paragraph">
<div class="title">(2) メモリオブジェクト</div>
<p>保護機能対応カーネルにおいては，メモリ領域をカーネルオブジェクトとして扱い，アクセス保護の対象とする【NGKI0067】．カーネルがアクセス保護の対象とする連続したメモリ領域を，メモリオブジェクト（memory object）と呼ぶ．メモリオブジェクトは，互いに重なりあうことはない【NGKI0068】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトは，その先頭番地によって識別する【NGKI0069】．言い換えると，先頭番地がオブジェクト番号となる．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトの先頭番地とサイズには，ターゲットハードウェアでメモリ保護が実現できるように，ターゲット定義の制約が課せられる【NGKI0070】．</p>
</div>
<div class="paragraph">
<div class="title">(3) 保護ドメイン</div>
<p>保護機能を提供するために用いるカーネルオブジェクトの集合を，保護ドメイン（protection domain）と呼ぶ．保護ドメインは，保護ドメインIDと呼ぶID番号によって識別する【NGKI0071】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトは，たかだか1つの保護ドメインに属する．処理単位は，いずれか1つの保護ドメインに属さなければならないのに対して，それ以外のカーネルオブジェクトは，いずれの保護ドメインにも属さないことができる【NGKI0072】．いずれの保護ドメインにも属さないカーネルオブジェクトを，無所属のカーネルオブジェクト（independent kernel object）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>処理単位がカーネルオブジェクトにアクセスできるかどうかは，処理単位が属する保護ドメインにより決まるのが原則である【NGKI0073】．すなわち，カーネルオブジェクトに対するアクセス権は，処理単位ではなく，保護ドメイン単位で管理される．このことから，ある保護ドメインに属する処理単位がアクセスできることを，単に，その保護ドメインからアクセスできるという．</p>
</div>
<div class="paragraph">
<p>ただし，タスクのユーザスタック領域は，ターゲット定義での変更がない限りは，そのタスク（とカーネルドメインに属する処理単位）のみがアクセスできる（「<a href="#_2_11_6_ユーザタスクのユーザスタック領域">2.11.6 ユーザタスクのユーザスタック領域</a>」の節を参照）．これは，［NGKI0073］の原則の例外となっている．</p>
</div>
<div class="paragraph">
<p>デフォルトでは，保護ドメインに属するカーネルオブジェクトは，同じ保護ドメイン（とカーネルドメイン）のみからアクセスできる【NGKI0075】．また，無所属のカーネルオブジェクトは，すべての保護ドメインからアクセスできる【NGKI0076】．詳しくは，「<a href="#_2_11_3_デフォルトのアクセス許可ベクタ">2.11.3 デフォルトのアクセス許可ベクタ</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">(4) カーネルドメインとユーザドメイン</div>
<p>システムには，カーネルドメイン（kernel domain）と呼ばれる保護ドメインが1つ存在する【NGKI0077】．カーネルドメインに属する処理単位は，プロセッサの特権モードで実行される【NGKI0078】．また，すべてのカーネルオブジェクトに対して，すべての種別のアクセスを行うことが許可される【NGKI0079】．この仕様で，「ある保護ドメイン（またはタスク）のみからアクセスできる」といった場合でも，カーネルドメインからはアクセスすることができる．</p>
</div>
<div class="paragraph">
<p>カーネルドメイン以外の保護ドメインを，ユーザドメイン（user domain）と呼ぶ．ユーザドメインに属する処理単位は，プロセッサの非特権モードで実行される【NGKI0080】．また，どのカーネルオブジェクトに対してどの種別のアクセスを行えるかを制限することができる【NGKI0081】．</p>
</div>
<div class="paragraph">
<p>ユーザドメインには，1から連続する正の整数値の保護ドメインIDが付与される【NGKI0082】．カーネルドメインの保護ドメインIDは，TDOM_KERNEL（＝-1）である【NGKI0083】．</p>
</div>
<div class="paragraph">
<p>この仕様では，システムに登録できるユーザドメインの数は，32個以下に制限する【NGKI0084】．これを超える数のユーザドメインを登録した場合には，コンフィギュレータがエラーを報告する【NGKI0085】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>ユーザドメインは，システムコンフィギュレーションファイル中にユーザドメインの囲みを記述することで，カーネルに登録する（「<a href="#_2_12_3_保護ドメインの指定">2.12.3 保護ドメインの指定</a>」の節を参照）．ユーザドメインを動的に生成する機能は，現時点では用意していない．</p>
</div>
<div class="paragraph">
<p>保護機能対応でないカーネルは，カーネルドメインのみをサポートしているとみなすことができる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様のシステムドメイン（system domain）は，現時点ではサポートしない．システムドメインは，それに属する処理単位が，プロセッサの特権モードで実行され，カーネルオブジェクトに対するアクセスを制限することができる保護ドメインである．</p>
</div>
<div class="paragraph">
<div class="title">(5) システムタスクとユーザタスク</div>
<p>カーネルドメインに属するタスクをシステムタスク（system task），ユーザドメインに属するタスクをユーザタスク（user task）と呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>特権モードで実行されるタスクをシステムタスク，非特権モードで実行されるタスクをユーザタスクと定義する方法もあるが，ユーザタスクであっても，サービスコールの実行中は特権モードで実行されるため，曖昧性を避けるために上記の定義とした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様のシステムドメインに属するタスクは，システムタスクと呼ぶことになる．</p>
</div>
<div class="paragraph">
<div class="title">(6) アクセス許可パターン</div>
<p>あるカーネルオブジェクトに対するある種別のアクセスが，どの保護ドメインに属する処理単位に許可されているかを表現するビットパターンを，アクセス許可パターン（access permission pattern）と呼ぶ．アクセス許可パターンの各ビットは，1つのユーザドメインに対応する【NGKI0086】．カーネルドメインには，すべてのアクセスが許可されているため，カーネルドメインに対応するビットは用意されていない．</p>
</div>
<div class="paragraph">
<p>アクセス許可パターンは，符号無し32ビット整数に定義されるデータ型（ACPTN）で保持し，値が1のビットに対応するユーザドメインにアクセスが許可されていることを表す【NGKI0087】．そのため，2つのアクセス許可パターンのビット毎論理和（C言語の"|"）を求めることで，アクセスを許可されているユーザドメインの和集合（union）を得ることができる．また，2つのアクセス許可パターンのビット毎論理積（C言語の"&amp;"）を求めることで，アクセスを許可されているユーザドメインの積集合（intersection）を得ることができる．</p>
</div>
<div class="paragraph">
<p>アクセス許可パターンの指定に用いるために，指定したユーザドメインのみにアクセスを許可することを示すアクセス許可パターンを構成するマクロ（TACP）が用意されている【NGKI0088】．また，カーネルドメインのみにアクセスを許可することを示すアクセス許可パターンを表す定数（TACP_KERNEL）と，すべての保護ドメインにアクセスを許可することを示すアクセス許可パターンを表す定数（TACP_SHARED）が用意されている【NGKI0089】．</p>
</div>
<div class="paragraph">
<div class="title">(7) アクセス許可ベクタ</div>
<p>カーネルオブジェクトに対するアクセスは，カーネルオブジェクトの種類毎に，通常操作1，通常操作2，管理操作，参照操作の4つの種別に分類されている【NGKI0090】．あるカーネルオブジェクトに対する4つの種別のアクセスに関するアクセス許可パターンをひとまとめにしたものを，アクセス許可ベクタ（access permission vector）と呼び，次のように定義されるデータ型（ACVCT）で保持する【NGKI0091】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct acvct {
		ACPTN	acptn1;		/* 通常操作1のアクセス許可パターン */
		ACPTN	acptn2;		/* 通常操作2のアクセス許可パターン */
		ACPTN	acptn3;		/* 管理操作のアクセス許可パターン */
		ACPTN	acptn4;		/* 参照操作のアクセス許可パターン */
	} ACVCT;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>カーネルオブジェクトの種類毎のアクセスの種別の分類については，「<a href="#_5_8_カーネルオブジェクトに対するアクセスの種別">5.8 カーネルオブジェクトに対するアクセスの種別</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様では，アクセス許可ベクタを，1つまたは2つのアクセス許可パターンで構成することも許しているが，この仕様では4つで構成するものと決めている．</p>
</div>
<div class="paragraph">
<div class="title">(8) サービスコールの呼出し方法</div>
<p>保護機能対応カーネルでは，サービスコールは，ソフトウェア割込みによって呼び出すのが基本である．サービスコール呼出しを通常の方法で記述した場合，サービスコールはソフトウェア割込みによって呼び出される【NGKI0092】．</p>
</div>
<div class="paragraph">
<p>一般に，ソフトウェア割込みによるサービスコール呼出しはオーバヘッドが大きい．そのため，カーネルドメインに属する処理単位からは，関数呼出しによってサービスコールを呼び出すことで，オーバヘッドを削減することができる．そこで，カーネルドメインに属する処理単位から関数呼出しによってサービスコールを呼び出せるように，以下の機能が用意されている．</p>
</div>
<div class="paragraph">
<p>カーネルドメインに属する処理単位が実行する関数のみを含んだソースファイルでは，カーネルヘッダファイル（kernel.h）をインクルードする前に，TOPPERS_SVC_CALLをマクロ定義することで，サービスコール呼出しを通常の方法で記述した場合に，サービスコールは関数呼出しによって呼び出される【NGKI0093】．</p>
</div>
<div class="paragraph">
<p>また，カーネルドメインに属する処理単位が実行する関数と，ユーザドメインに属する処理単位が実行する関数の両方を含んだソースファイルでは，関数呼出しによってサービスコールを呼び出すための名称を作るマクロ（SVC_CALL）を用いることで，サービスコールは関数呼出しによって呼び出される【NGKI0094】．例えば，act_tskを関数呼出しによって呼び出す場合には，次のように記述すればよい．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ercd = SVC_CALL(act_tsk)(tskid);</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>拡張サービスコールを，関数呼出しによって呼び出す方法は用意されていない．カーネルドメインに属する処理単位が，関数呼出しによって拡張サービスコールとして登録した関数を呼び出すことはできるが，その場合，呼び出したのは単なる関数であるとみなされ，拡張サービスコールであるとは扱われない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_3_4_時間パーティショニング"><a class="anchor" href="#_2_3_4_時間パーティショニング"></a><a class="link" href="#_2_3_4_時間パーティショニング">2.3.4 時間パーティショニング</a></h4>
<div class="paragraph">
<p>この節では，保護機能対応カーネルにおける時間パーティショニングに関連する主な概念について説明する．この節の内容は，保護機能対応カーネルにのみ適用される．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>時間パーティショニングの機能を新たに導入した．</p>
</div>
<div class="paragraph">
<div class="title">(1) システム周期</div>
<p>保護ドメインを繰り返し実行する基本的な周期を，システム周期（system cycle）と呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">(2) システム動作モード</div>
<p>保護ドメインをどのように繰り返し実行するかは，システム動作モード（system operating mode）毎に設定することができる．システム動作モードは，システム動作モードIDと呼ぶID番号によって識別する【NGKI0577】．</p>
</div>
<div class="paragraph">
<p>保護ドメインを繰り返し実行するのを停止するシステム動作モードとして，システム周期停止モードが用意されている【NGKI0578】．システム周期停止モードのID番号は，TSOM_STP（＝-1）である【NGKI0579】．</p>
</div>
<div class="paragraph">
<div class="title">(3) タイムウィンドウとアイドルウィンドウ</div>
<p>システム周期内の連続した時間区間をタイムウィンドウ（time window）と呼ぶ．タイムウィンドウは，システム動作モード毎に登録することができる【NGKI0580】．</p>
</div>
<div class="paragraph">
<p>システム周期内で，タイムウィンドウに含まれない時間区間を，アイドルウィンドウ（idle window）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>タイムウィンドウは，1つのユーザドメインに割り当てる【NGKI0581】．1つのユーザドメインに，任意の数のタイムウィンドウを割り当てることができる【NGKI0582】．すなわち，1つのユーザドメインに複数のタイムウィンドウを割り当てることができるし，タイムウィンドウを割り当てないユーザドメインがあっても良い．</p>
</div>
<div class="paragraph">
<p>どのシステム動作モードにおいてもタイムウィンドウを割り当てられていないユーザドメインが1つ以上ある場合，スケジューリング上は，それらのユーザドメインをまとめて1つのユーザドメインであるかのように扱う【NGKI0583】．タイムウィンドウを割り当てられていないユーザドメインを1つにまとめたものを，アイドルドメイン（idle domain）と呼ぶ．あるオブジェクトが「アイドルドメインに属する」といった場合には，タイムウィンドウを割り当てられていないユーザドメインのいずれかに属することを意味する．</p>
</div>
<div class="paragraph">
<p>カーネルドメインにタイムウィンドウを割り当てることはできない．カーネルドメインに属する処理単位（ユーザタスクから呼び出された拡張サービスコールを除く）は，常に（すなわち，すべてのタイムウィンドウおよびアイドルウィンドウ内で）実行することができる【NGKI0623】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，タイムウィンドウは，プロセッサ毎に割り当てることができる【NGKI0624】．アイドルドメインにまとめられるのは，すべてのシステム動作モードにおいて，どのプロセッサに対してもタイムウィンドウを割り当てられていないユーザドメインである【NGKI0627】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>あるユーザドメインに対して，システム動作モードAにおいてはタイムウィンドウが割り当てられており，システム動作モードBにおいては割り当てられていない場合を考える．この場合，そのユーザドメインは，システム動作モードAにおいてタイムウィンドウを割り当てられているため，アイドルドメインにはまとめられない．そのため，システム動作モードBでは，そのユーザドメインは全く実行されない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_3_5_マルチプロセッサ対応"><a class="anchor" href="#_2_3_5_マルチプロセッサ対応"></a><a class="link" href="#_2_3_5_マルチプロセッサ対応">2.3.5 マルチプロセッサ対応</a></h4>
<div class="paragraph">
<p>この節では，マルチプロセッサ対応に関連する主な概念について説明する．この節の内容は，マルチプロセッサ対応カーネルにのみ適用される．</p>
</div>
<div class="paragraph">
<div class="title">(1) クラス</div>
<p>マルチプロセッサに対応するために用いるカーネルオブジェクトの集合を，クラス（class）と呼ぶ．クラスは，クラスIDと呼ぶID番号によって識別する【NGKI0095】．</p>
</div>
<div class="paragraph">
<p>カーネルがどのようなクラスをサポートするかと，それらのID番号は，ターゲット定義である【NGKI0644】．カーネルヘッダファイル（kernel.h）のターゲット依存部において，各クラスIDが，クラスの識別名にマクロ定義される【NGKI0645】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトは，いずれか1つのクラスに属するのが原則である【NGKI0096】．カーネルオブジェクトが属するクラスは，オブジェクトの登録時に決定し，登録後に変更することはできない【NGKI0097】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>処理単位を実行するプロセッサを静的に決定する機能分散型のマルチプロセッサシステムでは，プロセッサ毎にクラスを設ける方法が典型的である．それに対して，対称型のマルチプロセッサシステムで，処理単位のマイグレーションを許す場合には，プロセッサ毎のクラスに加えて，どのプロセッサでも実行できるクラスを（システム中に1つまたは初期割付けプロセッサ毎に）設ける方法が典型的である．</p>
</div>
<div class="paragraph">
<p>［NGKI0096］の原則に関わらず，以下のオブジェクトはいずれのクラスにも属さない．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>オーバランハンドラ</p>
</li>
<li>
<p>拡張サービスコール</p>
</li>
<li>
<p>グローバル初期化ルーチン</p>
</li>
<li>
<p>グローバル終了処理ルーチン</p>
</li>
<li>
<p>保護ドメイン</p>
</li>
<li>
<p>システム動作モード</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応でないカーネルは，カーネルによって規定された1つのクラスのみをサポートしているとみなすこともできる．</p>
</div>
<div class="paragraph">
<div class="title">(2) プロセッサ</div>
<p>たかだか1つの処理単位のみを同時に実行できるハードウェアの単位を，プロセッサ（processor）と呼ぶ．プロセッサは，プロセッサIDと呼ぶID番号によって識別する【NGKI0098】．</p>
</div>
<div class="paragraph">
<p>複数のプロセッサを持つシステム構成をマルチプロセッサ（multiprocessor）と呼び，同時に複数の処理単位を実行することができる【NGKI0099】．</p>
</div>
<div class="paragraph">
<p>カーネルがサポートするプロセッサの数と各プロセッサの識別名は，ターゲット定義である【NGKI0642】．カーネルヘッダファイル（kernel.h）のターゲット依存部において，サポートしているプロセッサ数がTNUM_PRCIDに，各プロセッサIDがプロセッサの識別名に，それぞれマクロ定義される【NGKI0643】．</p>
</div>
<div class="paragraph">
<p>システムの初期化時と終了時に特別な役割を果たすプロセッサを，マスタプロセッサ（master processor）と呼び，システムに1つ存在する【NGKI0100】．どのプロセッサをマスタプロセッサとするかは，ターゲット定義である【NGKI0101】．マスタプロセッサ以外のプロセッサを，スレーブプロセッサ（slave processor）と呼ぶ．なお，カーネル動作状態では，マスタプロセッサとスレーブプロセッサの振舞いに違いはない【NGKI0102】．</p>
</div>
<div class="paragraph">
<div class="title">(3) 処理単位の割付けとマイグレーション</div>
<p>処理単位は，後述のマイグレーションが発生しない限りは，いずれか1つのプロセッサに割り付けられて実行される【NGKI0103】．処理単位を実行するプロセッサを，割付けプロセッサと呼ぶ．また，処理単位が登録時に割り付けられるプロセッサを，初期割付けプロセッサと呼ぶ．</p>
</div>
<div class="paragraph">
<p>処理単位によっては，処理単位の登録後に，割付けプロセッサを変更することが可能である【NGKI0104】．処理単位の登録後に割付けプロセッサを変更することを，処理単位のマイグレーション（migration）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>割付けプロセッサを変更できる処理単位に対しては，処理単位を割り付けることができるプロセッサ（これを，割付け可能プロセッサと呼ぶ）を制限することができる【NGKI0105】．</p>
</div>
<div class="paragraph">
<div class="title">(4) クラスの持つ属性とカーネルオブジェクト</div>
<p>タスクの初期割付けプロセッサや割付け可能プロセッサなど，カーネルオブジェクトをマルチプロセッサ上で実現する際に設定すべき属性は，そのカーネルオブジェクトが属するクラスによって定まる．</p>
</div>
<div class="paragraph">
<p>各クラスが持ち，それに属するカーネルオブジェクトに適用される属性は，次の通りである【NGKI0106】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>初期割付けプロセッサ</p>
</li>
<li>
<p>割付け可能プロセッサ（複数のプロセッサを指定可能，初期割付けプロセッサを含む）</p>
</li>
<li>
<p>コンフィギュレータが確保するオブジェクト生成に必要なメモリ領域（オブジェクトの管理ブロック，タスクのスタック領域，データキューのデータキュー管理領域など）の配置場所（保護機能対応でないカーネルの場合）</p>
</li>
<li>
<p>その他の管理情報（ロック単位など）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これらの属性は，ターゲット定義で設定される【NGKI0107】．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>クラスを導入することで，カーネルオブジェクト毎に上記の属性を設定できるようにしなかったのは，これらの属性をアプリケーション設計者が個別に設定するよりも，ターゲット依存部の実装者が有益な組み合わせをあらかじめ用意しておく方が良いと考えたためである．</p>
</div>
<div class="paragraph">
<div class="title">(5) タイムイベント処理プロセッサ</div>
<p>タイムイベントの処理は，ターゲット定義の1つまたは複数のプロセッサで行う【NGKI0622】．タイムイベントを処理するプロセッサを，タイムイベント処理プロセッサと呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，すべてのプロセッサがタイムイベント処理プロセッサである【HRMPS0011】．すなわち，すべてのプロセッサがタイムイベントの処理を行う．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS新世代カーネル統合仕様では，プロセッサ毎にシステム時刻を持つローカルタイマ方式と，システム全体で1つのシステム時刻を持つグローバルタイマ方式のどちらかを用いることとしていたが，この仕様では，システム全体で1つのシステム時刻を持つものと決めた．ただし，タイムイベント処理プロセッサを複数設けられることから，TOPPERS新世代カーネル統合仕様のグローバルタイマ方式とも異なる．これに伴い，ローカルタイマ方式とグローバルタイマ方式という用語を廃止した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_3_6_その他"><a class="anchor" href="#_2_3_6_その他"></a><a class="link" href="#_2_3_6_その他">2.3.6 その他</a></h4>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>保護ドメイン毎の標準セクションを廃止した．</p>
</div>
<div class="paragraph">
<div class="title">(1) オブジェクトモジュール</div>
<p>プログラムのオブジェクトコードとデータを含むファイルを，オブジェクトモジュール（object module）と呼ぶ．オブジェクトファイルとライブラリは，オブジェクトモジュールである．</p>
</div>
<div class="paragraph">
<div class="title">(2) メモリリージョン</div>
<p>オブジェクトモジュールに含まれるセクションの配置対象となる同じ性質を持った連続したメモリ領域をメモリリージョン（memory region）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>メモリリージョンは，文字列によって識別する【NGKI0112】．メモリリージョンを識別する文字列を，メモリリージョン名と呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>この仕様では，メモリ領域（memory area）という用語は，連続したメモリの範囲という一般的な意味で使っている．</p>
</div>
<div class="paragraph">
<div class="title">(3) 標準のセクション</div>
<p>コンパイラに特別な指定をしない場合に出力するセクションを，標準のセクション（standard sections）と呼ぶ．コンパイラが出力しないセクションの中で，ターゲット定義のものを，標準のセクションと扱う場合もある【NGKI0113】．</p>
</div>
<div class="paragraph">
<div class="title">(4) 自動メモリ配置と手動メモリ配置</div>
<p>保護機能対応カーネルにおいては，カーネルに登録されたオブジェクトモジュールやセクションをどの番地に配置するかはコンフィギュレータにより決定され，リンカスクリプトもコンフィギュレータにより生成されるのが標準である．これを，自動メモリ配置と呼ぶ．</p>
</div>
<div class="paragraph">
<p>それに対して，オブジェクトモジュールやセクションをどの番地に配置するかを，アプリケーションで用意するリンカスクリプトで決定する方法を，手動メモリ配置と呼ぶ．手動メモリ配置をサポートするかどうかは，ターゲット定義である【NGKI0608】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>手動メモリ配置の機能を新たに導入した．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_4_処理単位の種類と実行順序"><a class="anchor" href="#_2_4_処理単位の種類と実行順序"></a><a class="link" href="#_2_4_処理単位の種類と実行順序">2.4 処理単位の種類と実行順序</a></h3>
<div class="sect3">
<h4 id="_2_4_1_処理単位の種類"><a class="anchor" href="#_2_4_1_処理単位の種類"></a><a class="link" href="#_2_4_1_処理単位の種類">2.4.1 処理単位の種類</a></h4>
<div class="paragraph">
<p>カーネルが実行を制御する処理単位の種類は次の通りである【NGKI0533】．</p>
</div>
<div class="paragraph">
<p>(a) タスク<br>
(b) 割込みハンドラ<br>
　(b.1) 割込みサービスルーチン<br>
　(b.2) タイムイベントハンドラ<br>
(c) CPU例外ハンドラ<br>
(d) 拡張サービスコール<br>
(e) 初期化ルーチン<br>
(f) 終了処理ルーチン</p>
</div>
<div class="paragraph">
<p>ここで，タイムイベントハンドラとは，時間の経過をきっかけに起動される処理単位である周期ハンドラ，アラームハンドラ，オーバランハンドラの総称である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，オーバランハンドラと拡張サービスコールをサポートしていない【ASPS0003】．ただし，オーバランハンドラ機能拡張パッケージを用いると，オーバランハンドラ機能を追加することができる【ASPS0004】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，オーバランハンドラと拡張サービスコールをサポートしていない【FMPS0002】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，オーバランハンドラをサポートしていない【HRPS0013】．ただし，オーバランハンドラ機能拡張パッケージを用いると，オーバランハンドラ機能を追加することができる【HRPS0014】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，オーバランハンドラをサポートしていない【HRMPS0003】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，タイムイベントハンドラと拡張サービスコールをサポートしていない【SSPS0002】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>タスク例外処理ルーチンを廃止した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_4_2_処理単位の実行順序"><a class="anchor" href="#_2_4_2_処理単位の実行順序"></a><a class="link" href="#_2_4_2_処理単位の実行順序">2.4.2 処理単位の実行順序</a></h4>
<div class="paragraph">
<p>処理単位の実行順序を規定するために，ここでは，処理単位の優先順位を規定する．また，ディスパッチが起こるタイミングを規定するために，ディスパッチを行うカーネル内の処理であるディスパッチャの優先順位についても規定する．</p>
</div>
<div class="paragraph">
<p>タスクの優先順位は，ディスパッチャの優先順位よりも低い【NGKI0118】．タスク間では，高い優先度を持つ方が優先順位が高く，同じ優先度を持つタスク間では，別に規定がない限りは，先に実行できる状態となった方が優先順位が高い【NGKI0119】．詳しくは，「<a href="#_2_6_3_タスクのスケジューリング規則">2.6.3 タスクのスケジューリング規則</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>割込みハンドラの優先順位は，ディスパッチャの優先順位よりも高い【NGKI0121】．割込みハンドラ間では，高い割込み優先度を持つ方が優先順位が高く，同じ割込み優先度を持つ割込みハンドラ間では，先に実行開始された方が優先順位が高い【NGKI0122】．同じ割込み優先度を持つ割込みハンドラ間での実行開始順序は，この仕様では規定しない．詳しくは，「<a href="#_2_7_2_割込み優先度">2.7.2 割込み優先度</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンとタイムイベントハンドラの優先順位は，それを呼び出す割込みハンドラと同じである【NGKI0123】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの優先順位は，CPU例外がタスクで発生した場合には，ディスパッチャの優先順位と同じであるが，ディスパッチャよりも先に実行される【NGKI0124】．CPU例外がその他の処理単位で発生した場合には，その処理単位の優先順位と同じであるが，その処理単位よりも先に実行される【NGKI0125】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールの優先順位は，それを呼び出した処理単位と同じであるが，それを呼び出した処理単位よりも先に実行される【NGKI0126】．</p>
</div>
<div class="paragraph">
<p>初期化ルーチンは，カーネルの動作開始前に，システムコンフィギュレーションファイル中に初期化ルーチンを登録する静的APIを記述したのと同じ順序で実行される【NGKI0127】．終了処理ルーチンは，カーネルの動作終了後に，終了処理ルーチンを登録する静的APIを記述したのと逆の順序で実行される【NGKI0128】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，初期化ルーチンには，クラスに属さないグローバル初期化ルーチンと，クラスに属するローカル初期化ルーチンがある【NGKI0129】．グローバル初期化ルーチンがマスタプロセッサで実行された後に，各プロセッサでローカル初期化ルーチンが実行される【NGKI0130】．また，終了処理ルーチンには，クラスに属さないグローバル終了処理ルーチンと，クラスに属するローカル終了処理ルーチンがある【NGKI0131】．ローカル終了処理ルーチンが各プロセッサで実行された後に，マスタプロセッサでグローバル終了処理ルーチンが実行される【NGKI0132】．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>終了処理ルーチンを，登録する静的APIを記述したのと逆順で実行するのは，終了処理は初期化の逆の順序で行うのがよいためである（システムコンフィギュレーションファイルを分割すると，終了処理ルーチンを登録する静的APIだけ逆順に記述するのは難しい）．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_4_3_カーネル処理の不可分性"><a class="anchor" href="#_2_4_3_カーネル処理の不可分性"></a><a class="link" href="#_2_4_3_カーネル処理の不可分性">2.4.3 カーネル処理の不可分性</a></h4>
<div class="paragraph">
<p>カーネルのサービスコール処理やディスパッチャ，割込みハンドラとCPU例外ハンドラの入口処理と出口処理などのカーネル処理は不可分に実行されるのが基本である．実際には，カーネル処理の途中でアプリケーションが実行される場合はあるが，アプリケーションがサービスコールを用いて観測できる範囲で，カーネル処理が不可分に実行された場合と同様に振る舞うのが原則である【NGKI0133】．これを，カーネル処理の不可分性という．</p>
</div>
<div class="paragraph">
<p>ただし，マルチプロセッサ対応カーネルにおいては，カーネル処理が実行されているプロセッサ以外のプロセッサから，カーネル処理の途中の状態が観測できる場合がある．具体的には，1つのサービスコールにより複数のオブジェクトの状態が変化する場合に，一部のオブジェクトの状態のみが変化し，残りのオブジェクトの状態が変化していない過渡的な状態が観測できる場合がある【NGKI0134】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応でないカーネルでは，1つのサービスコールにより複数のタスクが実行できる状態になる場合，新しく実行状態となるべきタスクへのディスパッチは，すべてのタスクの状態遷移が完了した後に行われる．例えば，低優先度のタスクAが発行したサービスコールにより，中優先度のタスクBと高優先度のタスクCがこの順で待ち解除される場合，タスクBとタスクCが待ち解除された後に，タスクCへのディスパッチが行われる．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，上のことは，1つのプロセッサ内では成り立つが，他のプロセッサに割り付けられたタスクに対しては成り立たない．例えば，プロセッサ1で低優先度のタスクAが実行されている時に，他のプロセッサ2で実行されているタスクが発行したサービスコールにより，プロセッサ1に割り付けられた中優先度のタスクBと高優先度のタスクCがこの順で待ち解除される場合，タスクCが待ち解除される前に，タスクBへディスパッチされる場合がある．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_4_4_処理単位を実行するプロセッサ"><a class="anchor" href="#_2_4_4_処理単位を実行するプロセッサ"></a><a class="link" href="#_2_4_4_処理単位を実行するプロセッサ">2.4.4 処理単位を実行するプロセッサ</a></h4>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，処理単位を実行するプロセッサ（割付けプロセッサ）は，その処理単位が属するクラスの初期割付けプロセッサと割付け可能プロセッサから，次のように決まる．</p>
</div>
<div class="paragraph">
<p>タスク，周期ハンドラ，アラームハンドラは，登録時に，属するクラスの初期割付けプロセッサに割り付けられる【NGKI0135】．また，割付けプロセッサを変更するサービスコール（mact_tsk，mig_tsk，msta_cyc，msta_alm）によって，割付けプロセッサを，クラスの割付け可能プロセッサのいずれかに変更することができる【NGKI0136】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラ，CPU例外ハンドラ，ローカル初期化ルーチン，ローカル終了処理ルーチンは，属するクラスの初期割付けプロセッサで実行される【NGKI0137】．クラスの割付け可能プロセッサの情報は用いられない．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンは，属するクラスの割付け可能プロセッサのいずれか（オプション設定によりすべて）で実行される【NGKI0138】．クラスの初期割付けプロセッサの情報は用いられない．</p>
</div>
<div class="paragraph">
<p>以上を整理すると，次の表の通りとなる．この表の中で，「○」はその情報が使用されることを，「−」はその情報が使用されないことを示す．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 37.5%;">
<col style="width: 31.25%;">
<col style="width: 31.25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期割付けプロセッサ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能プロセッサ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">−</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">−</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期ハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラームハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">−</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローカル初期化ルーチン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">−</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローカル終了処理ルーチン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">−</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>オーバランハンドラ，拡張サービスコール，グローバル初期化ルーチン，グローバル終了処理ルーチンは，いずれのクラスにも属さない【NGKI0139】．オーバランハンドラは，オーバランを起こしたタスクの割付けプロセッサによって実行される【NGKI0140】．拡張サービスコールは，それを呼び出した処理単位の割付けプロセッサによって実行される【NGKI0141】．グローバル初期化ルーチンとグローバル終了処理ルーチンは，マスタプロセッサによって実行される【NGKI0142】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_5_システム状態とコンテキスト"><a class="anchor" href="#_2_5_システム状態とコンテキスト"></a><a class="link" href="#_2_5_システム状態とコンテキスト">2.5 システム状態とコンテキスト</a></h3>
<div class="sect3">
<h4 id="_2_5_1_カーネル動作状態と非動作状態"><a class="anchor" href="#_2_5_1_カーネル動作状態と非動作状態"></a><a class="link" href="#_2_5_1_カーネル動作状態と非動作状態">2.5.1 カーネル動作状態と非動作状態</a></h4>
<div class="paragraph">
<p>カーネルの初期化が完了した後，カーネルの終了処理が開始されるまでの間を，カーネル動作状態と呼ぶ．それ以外の状態，すなわちカーネルの初期化完了前（初期化ルーチンの実行中を含む）と終了処理開始後（終了処理ルーチンの実行中を含む）を，カーネル非動作状態と呼ぶ．プロセッサは，カーネル動作状態かカーネル非動作状態のいずれかの状態を取る【NGKI0143】．</p>
</div>
<div class="paragraph">
<p>カーネル非動作状態では，原則として，NMIを除くすべての割込みがマスクされる【NGKI0144】．</p>
</div>
<div class="paragraph">
<p>カーネル非動作状態では，システムインタフェースレイヤのAPIとカーネル非動作状態を参照するサービスコール（sns_ker）のみを呼び出すことができる【NGKI0145】．カーネル非動作状態で，その他のサービスコールを呼び出した場合の動作は，保証されない【NGKI0146】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，カーネル動作状態かカーネル非動作状態のいずれかの状態を取る【NGKI0147】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_2_タスクコンテキストと非タスクコンテキスト"><a class="anchor" href="#_2_5_2_タスクコンテキストと非タスクコンテキスト"></a><a class="link" href="#_2_5_2_タスクコンテキストと非タスクコンテキスト">2.5.2 タスクコンテキストと非タスクコンテキスト</a></h4>
<div class="paragraph">
<p>処理単位が実行される環境（用いるスタック領域やプロセッサの動作モードなど）をコンテキストと呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル動作状態において，処理単位が実行されるコンテキストは，タスクコンテキストと非タスクコンテキストに分類される【NGKI0148】．</p>
</div>
<div class="paragraph">
<p>タスクが実行されるコンテキストは，タスクコンテキストに分類される【NGKI0149】．また，タスクコンテキストから呼び出した拡張サービスコールが実行されるコンテキストは，タスクコンテキストに分類される【NGKI0150】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラ（割込みサービスルーチンおよびタイムイベントハンドラを含む）とCPU例外ハンドラが実行されるコンテキストは，非タスクコンテキストに分類される【NGKI0151】．また，非タスクコンテキストから呼び出した拡張サービスコールが実行されるコンテキストは，非タスクコンテキストに分類される【NGKI0152】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストで実行される処理単位は，別に規定がない限り，タスクのスタック領域を用いて実行される【NGKI0153】．非タスクコンテキストで実行される処理単位は，別に規定がない限り，非タスクコンテキスト用スタック領域を用いて実行される【NGKI0154】．</p>
</div>
<div class="paragraph">
<p>非タスクコンテキストからは，タスクコンテキスト専用のサービスコールを呼び出すことはできない．呼び出した場合にはE_CTXエラーとなる【NGKI0157】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>非タスクコンテキスト専用のサービスコールの概念を廃止し，非タスクコンテキストからも，タスクコンテキストと同じ名称のサービスコールを呼び出すこととした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_3_カーネルの振舞いに影響を与える状態"><a class="anchor" href="#_2_5_3_カーネルの振舞いに影響を与える状態"></a><a class="link" href="#_2_5_3_カーネルの振舞いに影響を与える状態">2.5.3 カーネルの振舞いに影響を与える状態</a></h4>
<div class="paragraph">
<p>カーネル動作状態において，プロセッサは，カーネルの振舞いに影響を与える状態として，次の状態を持つ【NGKI0158】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>全割込みロックフラグ（全割込みロック状態と全割込みロック解除状態）</p>
</li>
<li>
<p>CPUロックフラグ（CPUロック状態とCPUロック解除状態）</p>
</li>
<li>
<p>割込み優先度マスク（割込み優先度マスク全解除状態と全解除でない状態）</p>
</li>
<li>
<p>ディスパッチ禁止フラグ（ディスパッチ禁止状態とディスパッチ許可状態）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これらの状態は，それぞれ独立な状態である．すなわち，プロセッサは上記の状態の任意の組合せを取ることができ，それぞれの状態を独立に変化させることができる【NGKI0159】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_4_全割込みロック状態と全割込みロック解除状態"><a class="anchor" href="#_2_5_4_全割込みロック状態と全割込みロック解除状態"></a><a class="link" href="#_2_5_4_全割込みロック状態と全割込みロック解除状態">2.5.4 全割込みロック状態と全割込みロック解除状態</a></h4>
<div class="paragraph">
<p>プロセッサは，NMIを除くすべての割込みをマスクするための全割込みロックフラグを持つ【NGKI0160】．全割込みロックフラグがセットされた状態を全割込みロック状態，クリアされた状態を全割込みロック解除状態と呼ぶ．すなわち，全割込みロック状態では，NMIを除くすべての割込みがマスクされる．</p>
</div>
<div class="paragraph">
<p>全割込みロック状態では，システムインタフェースレイヤのAPIとカーネル非動作状態を参照するサービスコール（sns_ker），カーネルを終了するサービスコール（ext_ker）のみを呼び出すことができる【NGKI0161】．全割込みロック状態で，その他のサービスコール（拡張サービスコールを含む）を呼び出した場合の動作は，保証されない【NGKI0162】．また，全割込みロック状態で，実行中の処理単位からリターンしてはならない．リターンした場合の動作は保証されない【NGKI0164】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，全割込みロックフラグを持つ【NGKI0165】．すなわち，プロセッサ毎に，全割込みロック状態か全割込みロック解除状態のいずれかの状態を取る．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_5_cpuロック状態とcpuロック解除状態"><a class="anchor" href="#_2_5_5_cpuロック状態とcpuロック解除状態"></a><a class="link" href="#_2_5_5_cpuロック状態とcpuロック解除状態">2.5.5 CPUロック状態とCPUロック解除状態</a></h4>
<div class="paragraph">
<p>プロセッサは，カーネル管理の割込み（「<a href="#_2_7_7_カーネル管理外の割込み">2.7.7 カーネル管理外の割込み</a>」の節を参照）をすべてマスクするためのCPUロックフラグを持つ【NGKI0166】．CPUロックフラグがセットされた状態をCPUロック状態，クリアされた状態をCPUロック解除状態と呼ぶ．CPUロック状態では，すべてのカーネル管理の割込みがマスクされ，ディスパッチが保留される【NGKI0167】．</p>
</div>
<div class="paragraph">
<p>CPUロック状態で呼び出すことができるサービスコールは次の通り【NGKI0168】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システムインタフェースレイヤのAPI</p>
</li>
<li>
<p>loc_cpu，unl_cpu</p>
</li>
<li>
<p>unl_spn（マルチプロセッサ対応カーネルのみ）</p>
</li>
<li>
<p>dis_int，ena_int，clr_int，ras_int，prb_int</p>
</li>
<li>
<p>sns_ter，sns_ctx，sns_loc，sns_dsp，sns_dpn，sns_ker</p>
</li>
<li>
<p>xsns_dpn（CPU例外ハンドラからのみ）</p>
</li>
<li>
<p>fch_hrt</p>
</li>
<li>
<p>ext_tsk，ext_ker</p>
</li>
<li>
<p>prb_mem（保護機能対応カーネルのみ）</p>
</li>
<li>
<p>cal_svc（保護機能対応カーネルのみ）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CPUロック状態で，その他のサービスコールを呼び出した場合には，E_CTXエラーとなる【NGKI0169】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，CPUロックフラグを持つ【NGKI0170】．すなわち，プロセッサ毎に，CPUロック状態かCPUロック解除状態のいずれかの状態を取る．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>NMI以外にカーネル管理外の割込みを設けない場合には，全割込みロックフラグとCPUロックフラグの機能は同一となるが，両フラグは独立に存在する．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，あるプロセッサがCPUロック状態にある間は，そのプロセッサにおいてのみ，すべてのカーネル管理の割込みがマスクされ，ディスパッチが保留される．それに対して他のプロセッサにおいては，割込みはマスクされず，ディスパッチも起こるため，CPUロック状態を使って他のプロセッサで実行される処理単位との排他制御を実現することはできない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_6_割込み優先度マスク"><a class="anchor" href="#_2_5_6_割込み優先度マスク"></a><a class="link" href="#_2_5_6_割込み優先度マスク">2.5.6 割込み優先度マスク</a></h4>
<div class="paragraph">
<p>プロセッサは，割込み優先度を基準に割込みをマスクするための割込み優先度マスクを持つ【NGKI0171】．割込み優先度マスクがTIPM_ENAALL（＝0）の時は，いずれの割込み要求もマスクされない【NGKI0172】．この状態を割込み優先度マスク全解除状態と呼ぶ．割込み優先度マスクがTIPM_ENAALL（＝0）以外の時は，割込み優先度マスクと同じかそれより低い割込み優先度を持つ割込みはマスクされ，ディスパッチは保留される【NGKI0173】．この状態を割込み優先度マスクが全解除でない状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>割込み優先度マスクが全解除でない状態では，別に規定がない限りは，自タスクを広義の待ち状態に遷移させる可能性のあるサービスコールを呼び出すことはできない．呼び出した場合には，E_CTXエラーとなる【NGKI0175】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，割込み優先度マスクを持つ【NGKI0176】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_7_ディスパッチ禁止状態とディスパッチ許可状態"><a class="anchor" href="#_2_5_7_ディスパッチ禁止状態とディスパッチ許可状態"></a><a class="link" href="#_2_5_7_ディスパッチ禁止状態とディスパッチ許可状態">2.5.7 ディスパッチ禁止状態とディスパッチ許可状態</a></h4>
<div class="paragraph">
<p>プロセッサは，ディスパッチを保留するためのディスパッチ禁止フラグを持つ【NGKI0177】．ディスパッチ禁止フラグがセットされた状態をディスパッチ禁止状態，クリアされた状態をディスパッチ許可状態と呼ぶ．すなわち，ディスパッチ禁止状態では，ディスパッチは保留される．</p>
</div>
<div class="paragraph">
<p>ディスパッチ禁止状態では，別に規定がない限りは，自タスクを広義の待ち状態に遷移させる可能性のあるサービスコールを呼び出すことはできない．呼び出した場合には，E_CTXエラーとなる【NGKI0179】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，ディスパッチ禁止フラグを持つ【NGKI0180】．すなわち，プロセッサ毎に，ディスパッチ禁止状態かディスパッチ許可状態のいずれかの状態を取る．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応カーネルにおいて，あるプロセッサがディスパッチ禁止状態にある間は，そのプロセッサにおいてのみ，ディスパッチが保留される．それに対して他のプロセッサにおいては，ディスパッチが起こるため，ディスパッチ禁止状態を使って他のプロセッサで実行されるタスクとの排他制御を実現することはできない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_8_ディスパッチ保留状態"><a class="anchor" href="#_2_5_8_ディスパッチ保留状態"></a><a class="link" href="#_2_5_8_ディスパッチ保留状態">2.5.8 ディスパッチ保留状態</a></h4>
<div class="paragraph">
<p>非タスクコンテキストの実行中，CPUロック状態，割込み優先度マスクが全解除でない状態，ディスパッチ禁止状態では，ディスパッチが保留される【NGKI0181】．これらの状態を総称して，ディスパッチ保留状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，ディスパッチ保留状態かそうでない状態のいずれかの状態を取る【NGKI0182】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>全割込みロック状態はカーネルが管理しておらず，ディスパッチが保留されることをカーネルが保証できないため，ディスパッチ保留状態に含めていない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_9_カーネル管理外の状態"><a class="anchor" href="#_2_5_9_カーネル管理外の状態"></a><a class="link" href="#_2_5_9_カーネル管理外の状態">2.5.9 カーネル管理外の状態</a></h4>
<div class="paragraph">
<p>全割込みロック状態，カーネル管理外の割込みハンドラ実行中（「<a href="#_2_7_7_カーネル管理外の割込み">2.7.7 カーネル管理外の割込み</a>」の節を参照），カーネル管理外のCPU例外ハンドラ実行中（「<a href="#_2_8_4_カーネル管理外のcpu例外">2.8.4 カーネル管理外のCPU例外</a>」の節を参照）を総称して，カーネル管理外の状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の状態では，システムインタフェースレイヤのAPIとsns_ker，ext_kerのみ（カーネル管理外のCPU例外ハンドラからは，それに加えてxsns_dpn）を呼び出すことができ，その他のサービスコールを呼び出すことはできない【NGKI0543】．カーネル管理外の状態から，その他のサービスコールを呼び出した場合の動作は，保証されない【NGKI0544】．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の状態では，少なくとも，カーネル管理の割込みはマスクされている【NGKI0545】．カーネル管理外の割込み（の一部）もマスクされている場合もある【NGKI0546】．保護機能対応カーネルでは，カーネル管理外の状態になるのは，特権モードで実行している間に限られる【NGKI0547】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_5_10_処理単位の開始終了とシステム状態"><a class="anchor" href="#_2_5_10_処理単位の開始終了とシステム状態"></a><a class="link" href="#_2_5_10_処理単位の開始終了とシステム状態">2.5.10 処理単位の開始・終了とシステム状態</a></h4>
<div class="paragraph">
<p>各処理単位が実行開始されるシステム状態の条件（実行開始条件），各処理単位の実行開始時にカーネルによって行われるシステム状態の変更処理（実行開始時処理），各処理単位からのリターン前（または終了前）にアプリケーションが設定しておくべきシステム状態（リターン前または終了前），各処理単位からのリターン時（または終了時）にカーネルによって行われるシステム状態の変更処理（リターン時処理または終了時処理）は，次の表の通りである．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 25.9259%;">
<col style="width: 22.2222%;">
<col style="width: 29.6296%;">
<col style="width: 22.2223%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPUロックフラグ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度マスク</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディスパッチ禁止フラグ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">【タスク】【NGKI0183】</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">許可</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則全解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則許可(*1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">許可する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">【カーネル管理の割込みハンドラ】【NGKI0185】</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自優先度より低い</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自優先度に(*2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">【割込みサービスルーチン】【NGKI0566】</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">【タイムイベントハンドラ】【NGKI0567】</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意(*4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま(*4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま(*4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">【CPU例外ハンドラ】【NGKI0188】</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま(*6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則元に(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す(*5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">【拡張サービスコール】【NGKI0189】</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>この表の中で「原則(*1)」とは，処理単位からのリターン前（または終了前）に，アプリケーションが指定された状態に設定しておくことが原則であるが，この原則に従わなくても，リターン時（または終了時）にカーネルによって状態が設定されるため，支障がないことを意味する．</p>
</div>
<div class="paragraph">
<p>「自優先度に(*2)」とは，割込みハンドラを起動した割込みの割込み優先度に変更することを意味する．</p>
</div>
<div class="paragraph">
<p>「変更不可(*3)」とは，その処理単位中で，そのシステム状態を変更するAPIが用意されていないことを示す．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>割込みサービスルーチンは，カーネル内の割込みハンドラから呼び出される．また，タイムイベントハンドラの内，周期ハンドラとアラームハンドラは高分解能タイマ割込みハンドラから，オーバランハンドラはオーバランタイマ割込みハンドラから，それぞれ呼び出される．割込み優先度マスクは，それらを呼び出す割込みハンドラでの状態のまま呼び出され，リターン時にも変更されない(*4)．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>割込みサービスルーチンおよびタイムイベントハンドラからのリターン時に，TOPPERS新世代カーネル統合仕様では割込み優先度マスクを元に戻すものとしていたが，この仕様では元に戻さない（そのままとする）ものとした．これは，ターゲットによっては，割込み優先度マスクを元に戻すためのオーバヘッドが大きいためである．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>CPU例外ハンドラ中で割込み優先度マスクを変更するAPIが用意されていないにもかかわらず，CPU例外ハンドラからのリターン時に元の状態に戻す(*5)理由は次の通りである．プロセッサによっては，割込み優先度マスクがステータスレジスタ等に含まれており，CPU例外ハンドラからのリターンで自然に元の状態に戻ってしまう．ターゲットによって振舞いが異なるのは望ましくないため，ターゲットによらず，元の状態に戻すこととしている．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの実行開始時には，CPUロックフラグは変更されない(*6)ことから，CPUロック状態でCPU例外が発生した場合，CPU例外ハンドラの実行開始直後はCPUロック状態となっている．CPUロック状態でCPU例外が発生した場合，起動されるCPU例外ハンドラはカーネル管理外のCPU例外ハンドラであり（xsns_dpnはtrueを返す），CPU例外ハンドラ中でunl_cpuを呼び出してCPUロック状態を解除しようとした場合の動作は保証されない．ただし，保証されないにも関わらずunl_cpuを呼び出した場合も考えられるため，リターン時には元に戻すこととしている．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_6_タスクの状態遷移とスケジューリング規則"><a class="anchor" href="#_2_6_タスクの状態遷移とスケジューリング規則"></a><a class="link" href="#_2_6_タスクの状態遷移とスケジューリング規則">2.6 タスクの状態遷移とスケジューリング規則</a></h3>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0/PX仕様で導入された待ち禁止状態，TOPPERS新世代カーネル統合仕様で導入されたタスク例外処理マスク状態の概念は廃止した．新たに導入したタスク終了要求フラグがセットされた状態が，待ち禁止状態の役割を兼ねている．また，時間パーティショニングの機能とスケジューリング単位の概念を新たに導入した．</p>
</div>
<div class="sect3">
<h4 id="_2_6_1_基本的なタスク状態"><a class="anchor" href="#_2_6_1_基本的なタスク状態"></a><a class="link" href="#_2_6_1_基本的なタスク状態">2.6.1 基本的なタスク状態</a></h4>
<div class="paragraph">
<p>カーネルに登録したタスクは，実行できる状態，休止状態，広義の待ち状態のいずれかの状態を取る【NGKI0193】．また，実行できる状態と広義の待ち状態を総称して，起動された状態と呼ぶ．さらに，タスクをカーネルに登録していない仮想的な状態を，未登録状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>(a) 実行できる状態（runnable）</p>
</div>
<div class="paragraph">
<p>タスクを実行できる条件が，プロセッサが使用できるかどうかを除いて，揃っている状態．実行できる状態は，さらに，実行状態と実行可能状態に分類される．</p>
</div>
<div class="paragraph">
<p>(a.1) 実行状態（running）</p>
</div>
<div class="paragraph">
<p>タスクが実行されている状態．または，そのタスクの実行中に，割込みまたはCPU例外により非タスクコンテキストの実行が開始され，かつ，タスクコンテキストに戻った後に，そのタスクの実行を再開するという状態．</p>
</div>
<div class="paragraph">
<p>(a.2) 実行可能状態（ready）</p>
</div>
<div class="paragraph">
<p>タスク自身は実行できる状態にあるが，それよりも優先順位の高いタスクが実行状態にあるために，そのタスクが実行されない状態．</p>
</div>
<div class="paragraph">
<p>(b) 休止状態（dormant）</p>
</div>
<div class="paragraph">
<p>タスクが実行すべき処理がない状態．タスクの実行を終了した後，次に起動するまでの間は，タスクは休止状態となっている．タスクが休止状態にある時には，タスクの実行を再開するための情報（実行再開番地やレジスタの内容など）は保存されていない【NGKI0194】．</p>
</div>
<div class="paragraph">
<p>(c) 広義の待ち状態（blocked）</p>
</div>
<div class="paragraph">
<p>タスクが，処理の途中で実行を止められている状態．タスクが広義の待ち状態にある時には，タスクの実行を再開するための情報（実行再開番地やレジスタの内容など）は保存されており，タスクが実行を再開する時には，広義の待ち状態に遷移する前の状態に戻される【NGKI0195】．広義の待ち状態は，さらに，（狭義の）待ち状態，強制待ち状態，二重待ち状態に分類される．</p>
</div>
<div class="paragraph">
<p>(c.1) （狭義の）待ち状態（waiting）</p>
</div>
<div class="paragraph">
<p>タスクが何らかの条件が揃うのを待つために，自ら実行を止めている状態．</p>
</div>
<div class="paragraph">
<p>(c.2) 強制待ち状態（suspended）</p>
</div>
<div class="paragraph">
<p>他のタスクによって，強制的に実行を止められている状態．ただし，自タスクを強制待ち状態にすることも可能である．</p>
</div>
<div class="paragraph">
<p>(c.3) 二重待ち状態（waiting-suspended）</p>
</div>
<div class="paragraph">
<p>待ち状態と強制待ち状態が重なった状態．すなわち，タスクが何らかの条件が揃うのを待つために自ら実行を止めている時に，他のタスクによって強制的に実行を止められている状態．</p>
</div>
<div class="paragraph">
<p>単にタスクが「待ち状態である」といった場合には，二重待ち状態である場合を含み，「待ち状態でない」といった場合には，二重待ち状態でもないことを意味する．また，単にタスクが「強制待ち状態である」といった場合には，二重待ち状態である場合を含み，「強制待ち状態でない」といった場合には，二重待ち状態でもないことを意味する．</p>
</div>
<div class="paragraph">
<p>(d) 未登録状態（non-existent）</p>
</div>
<div class="paragraph">
<p>タスクをカーネルに登録していない仮想的な状態．タスクの生成前と削除後は，タスクは未登録状態にあるとみなす．</p>
</div>
<div class="paragraph">
<p>カーネルによっては，これらのタスク状態以外に，過渡的な状態が存在する場合がある【NGKI0196】．過渡的な状態については，「<a href="#_2_6_5_ディスパッチ保留状態で実行中のタスクに対する強制待ち">2.6.5 ディスパッチ保留状態で実行中のタスクに対する強制待ち</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，タスクが未登録状態になることはない【ASPS0005】．また，上記のタスク状態以外の過渡的な状態になることもない【ASPS0006】．ただし，動的生成機能拡張パッケージでは，タスクが未登録状態になる【ASPS0007】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，タスクが未登録状態になることはない【FMPS0003】．上記のタスク状態以外の過渡的な状態として，タスクが強制待ち状態［実行継続中］になることがある【FMPS0004】．詳しくは，「<a href="#_2_6_5_ディスパッチ保留状態で実行中のタスクに対する強制待ち">2.6.5 ディスパッチ保留状態で実行中のタスクに対する強制待ち</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，タスクが未登録状態になることはない【HRPS0002】．また，上記のタスク状態以外の過渡的な状態になることもない【HRPS0003】．ただし，動的生成機能拡張パッケージでは，タスクが未登録状態になる【HRPS0010】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，タスクが未登録状態になることはない【HRMPS0004】．上記のタスク状態以外の過渡的な状態として，タスクが強制待ち状態［実行継続中］になることがある【HRMPS0005】．詳しくは，「<a href="#_2_6_5_ディスパッチ保留状態で実行中のタスクに対する強制待ち">2.6.5 ディスパッチ保留状態で実行中のタスクに対する強制待ち</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，タスクが広義の待ち状態と未登録状態になることはない【SSPS0003】．また，上記のタスク状態以外の過渡的な状態になることもない【SSPS0004】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_6_2_タスクの状態遷移"><a class="anchor" href="#_2_6_2_タスクの状態遷移"></a><a class="link" href="#_2_6_2_タスクの状態遷移">2.6.2 タスクの状態遷移</a></h4>
<div class="paragraph">
<p>タスクの状態遷移を図2-2に示す【NGKI0197】．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-2.png" alt="figure2 2">
</div>
</div>
<div class="paragraph">
<p>未登録状態のタスクをカーネルに登録することを，タスクを生成する（create）という．生成されたタスクは，休止状態に遷移する【NGKI0198】．また，タスク生成時の属性指定により，生成と同時にタスクを起動し，実行できる状態にすることもできる【NGKI0199】．逆に，登録されたタスクを未登録状態に遷移させることを，タスクを削除する（delete）という．</p>
</div>
<div class="paragraph">
<p>休止状態のタスクを，実行できる状態にすることを，タスクを起動する（activate）という．起動されたタスクは，実行できる状態になる【NGKI0200】．逆に，起動された状態のタスクを，休止状態（または未登録状態）に遷移させることを，タスクを終了する（terminate）という．</p>
</div>
<div class="paragraph">
<p>実行できる状態になったタスクは，まずは実行可能状態に遷移するが，そのタスクの優先順位が実行状態のタスクよりも高い場合には，ディスパッチ保留状態でない限りはただちにディスパッチが起こり，実行状態へ遷移する【NGKI0201】．この時，それまで実行状態であったタスクは実行可能状態に遷移する【NGKI0202】．この時，実行状態に遷移したタスクは，実行可能状態に遷移したタスクをプリエンプトしたという．逆に，実行可能状態に遷移したタスクは，プリエンプトされたという．</p>
</div>
<div class="paragraph">
<p>タスクを待ち解除するとは，タスクが待ち状態（二重待ち状態を除く）であれば実行できる状態に，二重待ち状態であれば強制待ち状態に遷移させることをいう．また，タスクを強制待ちから再開するとは，タスクが強制待ち状態（二重待ち状態を除く）であれば実行できる状態に，二重待ち状態であれば待ち状態に遷移させることをいう．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>タスクの実行開始とは，タスクが起動された後に最初に実行される（実行状態に遷移する）時のことをいう．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_6_3_タスクのスケジューリング規則"><a class="anchor" href="#_2_6_3_タスクのスケジューリング規則"></a><a class="link" href="#_2_6_3_タスクのスケジューリング規則">2.6.3 タスクのスケジューリング規則</a></h4>
<div class="paragraph">
<p>実行できるタスクは，優先順位の高いものから順に実行される【NGKI0203】．すなわち，ディスパッチ保留状態でない限りは，実行できるタスクの中で最も高い優先順位を持つタスクが実行状態となり，他は実行可能状態となる．</p>
</div>
<div class="paragraph">
<p>タスクの優先順位は，タスクの優先度とタスクが実行できる状態になった順序から，次のように定まる．優先度の異なるタスクの間では，優先度の高いタスクが高い優先順位を持つ【NGKI0204】．優先度が同一のタスクの間では，別に規定がない限りは，先に実行できる状態になったタスクが高い優先順位を持つ【NGKI0205】．すなわち，同じ優先度を持つタスクは，FCFS（First Come First Served）方式でスケジューリングされる．ただし，サービスコールの呼出しにより，同じ優先度を持つタスク間の優先順位を変更することも可能である【NGKI0206】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，カーネルドメインに属するタスクとユーザドメインに属するタスクが同一の優先度を持つ場合には，カーネルドメインに属するタスクが高い優先順位を持つ【NGKI0588】．同一の保護ドメイン内では，別に規定がない限りは，先に実行できる状態になったタスクが高い優先順位を持つ【NGKI0589】．なお，時間パーティショニングを使用した場合のスケジューリング規則については，「<a href="#_2_6_7_時間パーティショニング使用時のスケジューリング規則">2.6.7 時間パーティショニング使用時のスケジューリング規則</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>サブ優先度機能をサポートするカーネルにおいては，サブ優先度を使用して優先順位を決定すると設定した同一の優先度を持つタスク（保護機能対応カーネルにおいては，さらに，同じ保護ドメインに属するもの）の間では，サブ優先度の高いタスクが高い優先順位を持つ【NGKI0560】．サブ優先度も同一のタスクの間では，先に実行できる状態になったタスクが高い優先順位を持つ【NGKI0561】．</p>
</div>
<div class="paragraph">
<p>最も高い優先順位を持つタスクが変化した場合には，ディスパッチ保留状態でない限りはただちにディスパッチが起こり，最も高い優先順位を持つタスクが実行状態となる【NGKI0207】．ディスパッチ保留状態においては，実行状態のタスクは切り換わらず，最も高い優先順位を持つタスクは実行可能状態にとどまる【NGKI0208】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，上記のスケジューリング規則を適用して，タスクスケジューリングを行う【NGKI0209】．すなわち，プロセッサがディスパッチ保留状態でない限りは，そのプロセッサに割り付けられた実行できるタスクの中で最も高い優先順位を持つタスクが実行状態となり，他は実行可能状態となる．そのため，実行状態のタスクは，プロセッサ毎に存在する．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>サブ優先度機能を追加した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>保護機能対応カーネルにおいて，カーネルドメインに属するタスクは，ユーザドメインに属する同じ優先度のタスクよりも，高い優先順位を持つものとした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_6_4_待ち行列と待ち解除の順序"><a class="anchor" href="#_2_6_4_待ち行列と待ち解除の順序"></a><a class="link" href="#_2_6_4_待ち行列と待ち解除の順序">2.6.4 待ち行列と待ち解除の順序</a></h4>
<div class="paragraph">
<p>タスクが待ち解除される順序の管理のために，待ち状態のタスクがつながれているキューを，待ち行列と呼ぶ．また，タスクが同期・通信オブジェクトの待ち行列につながれている場合に，そのオブジェクトを，タスクの待ちオブジェクトと呼ぶ．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクをつなぐ順序には，FIFO順とタスクの優先度順がある．どちらの順序でつなぐかは，待ち行列毎に規定される【NGKI0210】．多くの待ち行列において，どちらの順序でつなぐかを，オブジェクト属性により指定できる【NGKI0211】．</p>
</div>
<div class="paragraph">
<p>FIFO順の待ち行列においては，新たに待ち状態に遷移したタスクは待ち行列の最後につながれる【NGKI0212】．それに対してタスクの優先度順の待ち行列においては，新たに待ち状態に遷移したタスクは，優先度の高い順に待ち行列につながれる【NGKI0213】．同じ優先度のタスクが待ち行列につながれている場合には，新たに待ち状態に遷移したタスクが，同じ優先度のタスクの中で最後につながれる【NGKI0214】．</p>
</div>
<div class="paragraph">
<p>待ち解除の条件がタスクによって異なる場合には，待ち行列の先頭のタスクは待ち解除の条件を満たさないが，後方のタスクが待ち解除の条件を満たす場合がある．このような場合の振舞いとして，次の2つのケースがある．どちらの振舞いをするかは，待ち行列毎に規定される【NGKI0215】．</p>
</div>
<div class="paragraph">
<p>(a) 待ち解除の条件を満たしたタスクの中で，待ち行列の前方につながれたものから順に待ち解除される【NGKI0216】．すなわち，待ち行列の前方に待ち解除の条件を満たさないタスクがあっても，後方のタスクが待ち解除の条件を満たしていれば，先に待ち解除される．</p>
</div>
<div class="paragraph">
<p>(b) タスクの待ち解除は，待ち行列につながれている順序で行われる【NGKI0217】．すなわち，待ち行列の前方に待ち解除の条件を満たさないタスクがあると，後方のタスクが待ち解除の条件を満たしても，待ち解除されない．</p>
</div>
<div class="paragraph">
<p>ここで，(b)の振舞いをする待ち行列においては，待ち行列につながれたタスクの強制終了，タスク優先度の変更（待ち行列がタスクの優先度順の場合のみ），待ち状態の強制解除が行われた場合に，タスクの待ち解除が起こることがある．具体的には，これらの操作により新たに待ち行列の先頭になったタスクが，待ち解除の条件を満たしていれば，ただちに待ち解除される【NGKI0218】．さらに，この待ち解除により新たに待ち行列の先頭になったタスクに対しても，同じ処理が繰り返される【NGKI0219】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_6_5_ディスパッチ保留状態で実行中のタスクに対する強制待ち"><a class="anchor" href="#_2_6_5_ディスパッチ保留状態で実行中のタスクに対する強制待ち"></a><a class="link" href="#_2_6_5_ディスパッチ保留状態で実行中のタスクに対する強制待ち">2.6.5 ディスパッチ保留状態で実行中のタスクに対する強制待ち</a></h4>
<div class="paragraph">
<p>ディスパッチ保留状態において，実行状態のタスクを強制待ち状態へ遷移させるサービスコールを呼び出した場合，実行状態のタスクの切換えは，ディスパッチ保留状態が解除されるまで保留される【NGKI0226】．</p>
</div>
<div class="paragraph">
<p>この間，それまで実行状態であったタスクは，実行状態と強制待ち状態の間の過渡的な状態にあると考える【NGKI0227】．この状態を，強制待ち状態［実行継続中］と呼ぶ．一方，ディスパッチ保留状態が解除された後に実行すべきタスクは，実行可能状態にとどまる【NGKI0228】．</p>
</div>
<div class="paragraph">
<p>タスクが強制待ち状態［実行継続中］にある時に，ディスパッチ保留状態が解除されると，ただちにディスパッチが起こり，タスクは強制待ち状態に遷移する【NGKI0229】．</p>
</div>
<div class="paragraph">
<p>過渡的な状態も含めたタスクの状態遷移を図2-3に示す【NGKI0230】．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-3.png" alt="figure2 3">
</div>
</div>
<div class="paragraph">
<p>タスクが強制待ち状態［実行継続中］である時の扱いは次の通りである．</p>
</div>
<div class="paragraph">
<p>(a) プロセッサを占有して実行を継続する．</p>
</div>
<div class="paragraph">
<p>強制待ち状態［実行継続中］のタスクは，プロセッサを占有して，そのまま継続して実行される【NGKI0231】．</p>
</div>
<div class="paragraph">
<p>強制待ち状態［実行継続中］のタスクが，自タスクを終了させるサービスコールを発行すると，休止状態に遷移する【NGKI0629】．ただし，マルチプロセッサ対応カーネルでは，CPUロック状態で強制待ち状態［実行継続中］のタスクがext_tskを発行した場合には，強制待ち状態に遷移する場合もある【NGKI0648】．</p>
</div>
<div class="paragraph">
<p>(b) 実行状態のタスクに関する情報を参照するサービスコールでは，実行状態であるものと扱う．</p>
</div>
<div class="paragraph">
<p>実行状態のタスクに関する情報を参照するサービスコール（get_tid，get_did，sns_ter）では，強制待ち状態［実行継続中］のタスクが，それを実行するプロセッサにおいて実行状態のタスクであるものと扱う．具体的には，強制待ち状態［実行継続中］のタスクが実行されている時にget_tidを発行すると，そのタスクのID番号を参照する【NGKI0232】．また，get_didを発行するとそのタスクが属する保護ドメインのID番号を，sns_terを発行するとそのタスクのタスク終了禁止フラグを参照する【NGKI0534】．</p>
</div>
<div class="paragraph">
<p>(c) その他のサービスコールでは，強制待ち状態であるものと扱う．</p>
</div>
<div class="paragraph">
<p>その他のサービスコールでは，強制待ち状態［実行継続中］のタスクは，強制待ち状態であるものと扱う【NGKI0234】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ディスパッチ保留状態において実行状態のタスクを強制待ち状態へ遷移させるサービスコールはサポートしていないため，タスクが強制待ち状態［実行継続中］になることはない【ASPS0008】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ディスパッチ保留状態において実行状態のタスクを強制待ち状態へ遷移させるサービスコールを，他のプロセッサから呼び出すことができるため，タスクが強制待ち状態［実行継続中］になる場合がある【FMPS0005】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ディスパッチ保留状態において実行状態のタスクを強制待ち状態へ遷移させるサービスコールはサポートしていないため，タスクが強制待ち状態［実行継続中］になることはない【HRPS0004】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ディスパッチ保留状態において実行状態のタスクを強制待ち状態へ遷移させるサービスコールを，他のプロセッサから呼び出すことができるため，タスクが強制待ち状態［実行継続中］になる場合がある【HRMPS0006】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，タスクが広義の待ち状態になることはないため，タスクが強制待ち状態［実行継続中］になることもない【SSPS0005】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>この仕様では，ディスパッチ保留状態において，実行状態のタスクを強制終了させるサービスコールはサポートしていない．そのため，実行状態と休止状態の間の過渡的な状態は存在しない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_6_6_制約タスク"><a class="anchor" href="#_2_6_6_制約タスク"></a><a class="link" href="#_2_6_6_制約タスク">2.6.6 制約タスク</a></h4>
<div class="paragraph">
<p>制約タスク（restricted task）は，複数のタスクでスタック領域を共有することによるメモリ使用量の削減を目的に，通常のタスクに対して，広義の待ち状態を持たないなどの機能制限を加えたものである．具体的には，制約タスクには以下の機能制限がある．</p>
</div>
<div class="paragraph">
<p>(a) 広義の待ち状態に入ることができない【NGKI0235】．</p>
</div>
<div class="paragraph">
<p>(b) サービスコールによりベース優先度やサブ優先度を変更することができない【NGKI0236】．</p>
</div>
<div class="paragraph">
<p>(c) 対象優先度の中の先頭のタスクが制約タスクである場合には，タスクの優先順位の回転（rot_rdq）を行うことができない【NGKI0237】．</p>
</div>
<div class="paragraph">
<p>(d) マルチプロセッサ対応カーネルでは，割付けプロセッサを変更することができない【NGKI0238】．</p>
</div>
<div class="paragraph">
<p>制約タスクに対して，機能制限により使用できなくなったサービスコールを呼び出した場合には，E_NOSPTエラーとなる【NGKI0239】．E_NOSPTエラーが返ることに依存している場合を除いては，制約タスクを通常のタスクに置き換えることができる【NGKI0240】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，制約タスクをサポートしていない【ASPS0009】．ただし，制約タスク拡張パッケージを用いると，制約タスクの機能を追加することができる【ASPS0010】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，制約タスクをサポートしていない【FMPS0006】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，制約タスクをサポートしていない【HRPS0005】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，制約タスクをサポートしていない【HRMPS0007】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，制約タスクのみをサポートする【SSPS0006】．そのため，すべてのタスクと非タスクコンテキストがスタック領域を共有することができ，すべての処理単位で同一のスタック領域を使用している【SSPS0007】．このスタック領域を，共有スタック領域と呼ぶ．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>制約タスクは，μITRON4.0仕様の自動車制御プロファイルで導入された機能である．この仕様における制約タスクは，μITRON4.0仕様の制約タスクよりも機能制限が少なくなっている．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_6_7_時間パーティショニング使用時のスケジューリング規則"><a class="anchor" href="#_2_6_7_時間パーティショニング使用時のスケジューリング規則"></a><a class="link" href="#_2_6_7_時間パーティショニング使用時のスケジューリング規則">2.6.7 時間パーティショニング使用時のスケジューリング規則</a></h4>
<div class="paragraph">
<p>保護機能対応カーネルで，時間パーティショニングを使用する場合には，以下の規則に従ってタスクがスケジューリングされる．</p>
</div>
<div class="paragraph">
<p>プロセッサは，システム周期毎に，現在のシステム動作モードに対して登録されたタイムウィンドウを順に実行する（図2-4）【NGKI0590】．あるタイムウィンドウの実行中は，カーネルドメインに属する実行できる処理単位と，そのタイムウィンドウを割り当てられたユーザドメインに属する実行できるタスクの中で，優先順位の高いものから順に実行される【NGKI0591】．これらの保護ドメインに属する実行できる処理単位がない場合には，アイドルドメインに属する実行できるタスクの中で，優先順位の高いものから順に実行される【NGKI0592】．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-4.png" alt="figure2 4">
</div>
</div>
<div class="paragraph">
<p>実行中のタイムウィンドウが使用したプロセッサ時間（いずれの処理単位も実行していなかった時間も含む）から，カーネルドメインに属する処理単位（ユーザタスクから呼び出された拡張サービスコールを除く）用したプロセッサ時間を減じたものが，タイムウィンドウの長さに達すると，次のタイムウィンドウに切り換えられる（図2-5）【NGKI0593】．次のタイムウィンドウが設定されていない場合（言い換えると，実行中のタイムウィンドウが，現在のシステム動作モードに対して設定された最後のタイムウィンドウである場合）には，アイドルウィンドウに切り換えられる【NGKI0594】．アイドルウィンドウの実行中は，カーネルドメインに属する実行できる処理単位と，アイドルドメインに属する実行できるタスクの中で，優先順位の高いものから順に実行される【NGKI0595】．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-5.png" alt="figure2 5">
</div>
</div>
<div class="paragraph">
<p>システム周期の終了時刻になると，システム周期の切換え処理が行われる．具体的には，まず，アイドルウィンドウが実行中であるか（言い換えると，現在のシステム動作モードに対して設定されたタイムウィンドウの実行がすべて終わっているか）をチェックし，そうでない場合，カーネルはエミュレートされたCPU例外を発生させる【NGKI0596】．これを，システム周期オーバラン例外と呼ぶ．次に，システム動作モードを，次のシステム周期での遷移先システム動作モードに切り換える【NGKI0597】．その後に，新しいシステム周期を開始する．すなわち，新しいシステム動作モードに対して設定された最初のタイムウィンドウに切り換える【NGKI0598】．</p>
</div>
<div class="paragraph">
<p>システム動作モードがシステム周期停止モードである場合には，システム周期の切換えも，タイムウィンドウの実行も行われず，カーネルドメインに属する処理単位（ユーザタスクから呼び出された拡張サービスコールを除く）の中で，優先順位が高いものから順に実行される【NGKI0599】．</p>
</div>
<div class="paragraph">
<p>ユーザドメインに属するタイムイベントの処理（ユーザドメインに属する周期通知とアラーム通知の処理，ユーザドメインに属するタスクに対するタイムアウト処理と時間経過待ち状態からの待ち解除処理）は，そのユーザドメインに割り当てられたタイムウィンドウへの切換え時（厳密には，タイムウィンドウを切り換え，タイムウィンドウ通知を処理した後，タスクの実行を開始する前）に実行される【NGKI0600】．アイドルドメインに属するタイムイベントの処理は，アイドルウィンドウへの切換え時に実行される【NGKI0601】．</p>
</div>
<div class="paragraph">
<p>ディスパッチ保留状態では，システム周期の切換えとタイムウィンドウの切換えは保留される【NGKI0602】．</p>
</div>
<div class="paragraph">
<p>システム周期の切換えは，高分解能タイマ割込みをきっかけに実行される．そのため，高分解能タイマ割込みのマスクや，ディスパッチの保留によって，システム周期の切換えは遅れることになる．この場合，その遅れ時間の分，次のシステム周期（結果的には，その最後のアイドルウィンドウ）が短くなる【NGKI0650】．システム周期の切換えが，次のシステム周期末を超えて遅れる状況では，カーネルの動作は保証されない【NGKI0651】．</p>
</div>
<div class="paragraph">
<p>また，タイムウィンドウの切換えは，タイムウィンドウタイマ割込みをきっかけに実行される．そのため，タイムウィンドウタイマ割込みのマスクや，ディスパッチの保留によって，タイムウィンドウの切換えは遅れることになる．この場合，その遅れ時間の分，そのシステム周期の最後のアイドルウィンドウが短くなる【NGKI0652】．タイムウィンドウの切換えが，そのシステム周期末を超えて遅れる状況では，カーネルの動作は保証されない【NGKI0653】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，上記のスケジューリング規則を適用してタスクがスケジューリングされる【NGKI0625】．システム周期とシステム動作モードは，すべてのプロセッサで共通である【NGKI0626】．ただし，システム周期の切換え処理は，各プロセッサで同期して行われるわけではない．現在のシステム動作モードは，システム周期の切換え処理を最初に行ったプロセッサによって切り換えられる【NGKI0637】．そのため，他のプロセッサでは，一時的に，切換え前のシステム動作モードで実行している状況が生じる【NGKI0636】．なお，タイムウィンドウは，プロセッサ毎に登録することができる［NGKI0624］．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，また，アイドルドメインにまとめられていないユーザドメインに属するタスク，周期通知，アラーム通知を，そのユーザドメインに対してどのシステム動作モードにおいてもタイムウィンドウを割り当てられていないプロセッサに割り付けることはできない【NGKI0628】．そのため例えば，プロセッサAでタイムウィンドウを割り当てられており，プロセッサBでタイムウィンドウを割り当てられていないユーザドメインに属するタスクを，プロセッサBに割り付けることはできない．</p>
</div>
<div class="paragraph">
<p>なお，システム周期オーバラン例外は，カーネル管理外のCPU例外であり，その例外ハンドラ番号はターゲット定義である【NGKI0603】．システム周期オーバラン例外に対して登録したCPU例外ハンドラからリターンすると，実行中のタイムウィンドウは打ち切られ，システム周期の切換え処理が継続される【NGKI0635】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>システム周期内で，カーネルとカーネルドメインに属する処理単位（ユーザタスクから呼び出された拡張サービスコールを除く）が使用するプロセッサ時間や，システム時刻の調整やドリフト量の設定によるシステム周期の短縮，タイマ割込みのマスクやディスパッチの保留によるシステム周期の切換えとタイムウィンドウの切換えの遅延を考慮し，十分な長さのアイドルウィンドウを確保するのは，ユーザの責任である．</p>
</div>
<div class="paragraph">
<p>ユーザドメインに割り当てられたタイムウィンドウの実行途中に，そのユーザドメインに属するタイムイベントの発生時刻になっても，タイムイベントはすぐには処理されない．タイムイベントが処理されるのは，そのユーザドメインに割り当てられた次のタイムウィンドウへの切換え時である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>時間パーティショニングの機能を新たに導入した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_6_8_スケジューリング単位"><a class="anchor" href="#_2_6_8_スケジューリング単位"></a><a class="link" href="#_2_6_8_スケジューリング単位">2.6.8 スケジューリング単位</a></h4>
<div class="paragraph">
<p>タスクのスケジューリングに関する以上の仕様より，タスクを，FCFS方式に基づく優先順位が管理される単位に分類することができる．この単位（タスクの集合）をスケジューリング単位と呼ぶ．カーネルの実装上は，スケジューリング単位毎にレディキューを持つ．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサのいずれにも対応しないカーネルは，唯一のスケジューリング単位を持つ．すなわち，すべてのタスクが1つのスケジューリング単位に属する．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサのいずれかまたは両方に対応するカーネルは，複数のスケジューリング単位を持つ．また，スケジューリング単位を指定して操作を行うサービスコールをサポートする．それらのサービスコールにおいて，スケジューリング単位を指定する番号を，スケジューリング単位番号と呼ぶ．スケジューリング単位番号は，符号付きの整数型であるID型で表す．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，カーネルドメイン，アイドルドメイン，アイドルドメインにまとめられていない各ユーザドメインがスケジューリング単位となる．スケジューリング単位番号には，保護ドメインIDまたは呼び出した処理単位が属する保護ドメインを表すTDOM_SELF（＝0）を指定することができる【NGKI0630】．保護ドメインIDで指定したユーザドメインがアイドルドメインにまとめられている場合には，アイドルドメインを指定したものとする【NGKI0631】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，各プロセッサがスケジューリング単位となる．スケジューリング単位番号には，プロセッサIDを指定することができる【NGKI0632】．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサの両方に対応するカーネルにおいては，各プロセッサに対して，カーネルドメイン，アイドルドメイン，アイドルドメインにまとめられていない各ユーザドメインがスケジューリング単位となる．スケジューリング単位番号には，SCHEDNO(prcid, domid)を指定する【NGKI0633】．ここで，prcidはマルチプロセッサ対応カーネルにおけるスケジューリング単位番号，domidは保護機能対応カーネルにおけるスケジューリング単位番号，SCHEDNOは保護機能とマルチプロセッサの両方に対応するカーネルにおけるスケジューリング単位番号を構成するためのマクロである．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_7_割込み処理モデル"><a class="anchor" href="#_2_7_割込み処理モデル"></a><a class="link" href="#_2_7_割込み処理モデル">2.7 割込み処理モデル</a></h3>
<div class="paragraph">
<p>TOPPERS第3世代カーネルにおける割込み処理モデルの概念図を図2-6に示す【NGKI0241】．この図は，割込み処理モデルの持つすべての機能が，ハードウェア（プロセッサおよび割込みコントローラ）で実現されているとして描いた概念図である．実際のハードウェアで不足している機能については，カーネル内の割込み処理のソフトウェアで実現される．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-6.png" alt="figure2 6">
</div>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>割込み処理モデルは，μITRON4.0仕様から大幅に拡張している．</p>
</div>
<div class="sect3">
<h4 id="_2_7_1_割込み処理の流れ"><a class="anchor" href="#_2_7_1_割込み処理の流れ"></a><a class="link" href="#_2_7_1_割込み処理の流れ">2.7.1 割込み処理の流れ</a></h4>
<div class="paragraph">
<p>周辺デバイス（以下，デバイスと呼ぶ）からの割込み要求は，割込みコントローラ（IRC）を経由して，プロセッサに伝えられる．デバイスから割込みコントローラに割込み要求を伝えるための信号線を，割込み要求ラインと呼ぶ．一般には，1つの割込み要求ラインに，複数のデバイスからの割込み要求が接続される．</p>
</div>
<div class="paragraph">
<p>プロセッサは，デバイスからの割込み要求を受け付ける条件が満たされた場合，割込み要求を受け付ける【NGKI0242】．受け付けた割込み要求が，カーネル管理の割込みである場合には，カーネル内の割込みハンドラの入口処理（割込み入口処理）を経由して，カーネル内の割込みハンドラを実行する【NGKI0243】．</p>
</div>
<div class="paragraph">
<p>カーネル内の割込みハンドラは，アプリケーションが割込み要求ラインに対して登録した割込みサービスルーチン（ISR）を呼び出す【NGKI0244】．割込みサービスルーチンは，プロセッサの割込みアーキテクチャや割込みコントローラに依存せず，割込みを要求したデバイスのみに依存して記述するのが原則である【NGKI0245】．1つの割込み要求ラインに対して複数のデバイスが接続されることから，1つの割込み要求ラインに対して複数の割込みサービスルーチンを登録することができる【NGKI0246】．</p>
</div>
<div class="paragraph">
<p>ただし，カーネルが標準的に用意している割込みハンドラで対応できない特殊なケースも考えられる．このような場合に対応するために，アプリケーションが用意した割込みハンドラをカーネルに登録することもできる【NGKI0247】．</p>
</div>
<div class="paragraph">
<p>カーネルが用いる高分解能タイマおよびオーバランタイマからの割込み要求の場合，カーネル内の割込みハンドラにより，タイムイベントの処理が行われる．具体的には，タイムアウト処理やタイムイベントの通知処理（タイムイベントハンドラの呼出しを含む）などが行われる【NGKI0248】．</p>
</div>
<div class="paragraph">
<p>なお，受け付けた割込み要求に対して，割込みサービスルーチンも割込みハンドラも登録していない場合の振舞いは，ターゲット定義である【NGKI0249】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_7_2_割込み優先度"><a class="anchor" href="#_2_7_2_割込み優先度"></a><a class="link" href="#_2_7_2_割込み優先度">2.7.2 割込み優先度</a></h4>
<div class="paragraph">
<p>割込み要求は，割込み処理の優先順位を指定するための割込み優先度を持つ【NGKI0250】．プロセッサは，割込み優先度マスクの現在値よりも高い割込み優先度を持つ割込み要求のみを受け付ける【NGKI0251】．逆に言うと，割込み優先度マスクの現在値と同じか，それより低い割込み優先度を持つ割込みは，マスクされる．</p>
</div>
<div class="paragraph">
<p>プロセッサは，割込み要求を受け付けると，割込み優先度マスクを，受け付けた割込み要求の割込み優先度に設定する（ただし，受け付けた割込みがNMIである場合には例外とする）【NGKI0252】．また，割込み処理からのリターンにより，割込み優先度マスクを，割込み要求を受け付ける前の値に戻す【NGKI0253】．</p>
</div>
<div class="paragraph">
<p>これらのことから，他の方法で割込みをマスクしていない限り，ある割込み要求の処理中は，それと同じかそれより低い割込み優先度を持つ割込み要求は受け付けられず，それより高い割込み優先度を持つ割込み要求は受け付けられることになる．つまり，割込み優先度は，多重割込みを制御するためのものと位置付けることができる．それに対して，同時に発生している割込み要求の中で，割込み優先度の高い割込み要求が先に受け付けられるとは限らない【NGKI0254】．</p>
</div>
<div class="paragraph">
<p>割込み優先度は，PRI型で表現し，値が小さいほど優先度が高いものとするが，［NGKI0037］の原則には従わず，-1から連続した負の値を用いる【NGKI0255】．</p>
</div>
<div class="paragraph">
<p>割込み優先度の段階数は，ターゲット定義である【NGKI0256】．プロセッサが割込み優先度マスクを実現するための機能を持たないか，実現するために大きいオーバヘッドを生じる場合には，ターゲット定義で，割込み優先度の段階数を1にする（すなわち，多重割込みを許さない）場合がある．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>割込み優先度に-1から連続した負の値を用いるのは，割込み優先度とタスク優先度を比較できるようになることと，いずれの割込みもマスクしない割込み優先度マスクの値を0にできるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_7_3_割込み要求ラインの属性"><a class="anchor" href="#_2_7_3_割込み要求ラインの属性"></a><a class="link" href="#_2_7_3_割込み要求ラインの属性">2.7.3 割込み要求ラインの属性</a></h4>
<div class="paragraph">
<p>各割込み要求ラインは，以下の属性を持つ．なお，1つの割込み要求ラインに複数のデバイスからの割込み要求が接続されている場合，それらの割込み要求は同一の属性を持つ【NGKI0257】．それらの割込み要求に別々の属性を設定することはできない．</p>
</div>
<div class="paragraph">
<div class="title">(1) 割込み要求禁止フラグ</div>
<p>割込み要求ライン毎に，割込みをマスクするための割込み要求禁止フラグを持つ【NGKI0258】．割込み要求禁止フラグをセットすると，その割込み要求ラインによって伝えられる割込み要求はマスクされる【NGKI0259】．</p>
</div>
<div class="paragraph">
<p>プロセッサが割込み要求禁止フラグを実現するための機能を持たないか，実現するために大きいオーバヘッドを生じる場合には，ターゲット定義で，割込み要求禁止フラグをサポートしない場合がある【NGKI0260】．また，プロセッサの持つ割込み要求禁止フラグの機能がこの仕様に合致しない場合には，ターゲット定義で，割込み要求禁止フラグをサポートしないか，振舞いが異なるものとする場合がある【NGKI0261】．</p>
</div>
<div class="paragraph">
<div class="title">(2) 割込み優先度</div>
<p>割込み要求ライン毎に，割込み優先度を設定することができる【NGKI0262】．割込み要求の割込み優先度とは，その割込み要求を伝える割込み要求ラインに対して設定された割込み優先度のことである【NGKI0263】．</p>
</div>
<div class="paragraph">
<div class="title">(3) トリガモード</div>
<p>割込み要求ラインに対する割込み要求が，レベルトリガであるかエッジトリガであるかを設定することができる【NGKI0264】．エッジトリガの場合には，さらに，ターゲット定義で，ポジティブエッジトリガかネガティブエッジトリガか両エッジトリガかを設定できる場合もある【NGKI0265】．また，レベルトリガの場合には，ターゲット定義で，ローレベルトリガかハイレベルトリガかを設定できる場合もある【NGKI0266】．</p>
</div>
<div class="paragraph">
<p>プロセッサがトリガモードを設定するための機能を持たないか，設定するために大きいオーバヘッドを生じる場合には，ターゲット定義で，トリガモードの設定をサポートしない場合がある【NGKI0267】．</p>
</div>
<div class="paragraph">
<p>属性が設定されていない割込み要求ラインに対しては，割込み要求禁止フラグがセットされ，割込み要求はマスクされる【NGKI0268】．また，割込み要求禁止フラグをクリアすることもできない【NGKI0269】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>アプリケーションが，割込み要求禁止フラグを動的にセット／クリアする機能を用いると，次の理由でソフトウェアの再利用性が下がる可能性があるため，注意が必要である．プロセッサによっては，この割込み処理モデルに合致した割込み要求禁止フラグの機能を実現できない場合がある．また，割込み要求禁止フラグをセットすることで，複数のデバイスからの割込みがマスクされる場合がある．ソフトウェアの再利用性を上げるためには，あるデバイスからの割込みのみをマスクしたい場合には，そのデバイス自身の機能を使ってマスクを実現すべきである．</p>
</div>
<div class="paragraph">
<p>複数のデバイスからの割込み要求が接続されている割込み要求ラインを，エッジトリガに設定することは推奨されない．これは，次のような状況において，割込み要求を取りこぼす可能性があるためである．ある割込み要求ラインに，デバイスAとデバイスBからの割込み要求が接続されており，デバイスAの割込み処理を先に行う場合を考える．この時，デバイスBからの割込み要求によって割込みハンドラが実行され，デバイスAの割込み処理を行った後，デバイスBの割込み処理を行う前に，デバイスAからの割込み要求が発生した場合に，デバイスAからの割込み要求を取りこぼしてしまう．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_7_4_割込みを受け付ける条件"><a class="anchor" href="#_2_7_4_割込みを受け付ける条件"></a><a class="link" href="#_2_7_4_割込みを受け付ける条件">2.7.4 割込みを受け付ける条件</a></h4>
<div class="paragraph">
<p>NMI以外の割込み要求は，次の4つの条件が揃った場合に受け付けられる【NGKI0270】．</p>
</div>
<div class="paragraph">
<p>(a) 割込み要求ラインに対する割込み要求禁止フラグがクリアされていること</p>
</div>
<div class="paragraph">
<p>(b) 割込み要求ラインに設定された割込み優先度が，割込み優先度マスクの現在値よりも高い（優先度の値としては小さい）こと</p>
</div>
<div class="paragraph">
<p>(c) 全割込みロックフラグがクリアされていること</p>
</div>
<div class="paragraph">
<p>(d) 割込み要求がカーネル管理の割込みである場合には，CPUロックフラグがクリアされていること</p>
</div>
<div class="paragraph">
<p>これらの条件が揃った割込み要求が複数ある場合に，どの割込み要求が最初に受け付けられるかは，この仕様では規定しない【NGKI0271】．すなわち，割込み優先度の高い割込み要求が先に受け付けられるとは限らない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_7_5_割込み番号と割込みハンドラ番号"><a class="anchor" href="#_2_7_5_割込み番号と割込みハンドラ番号"></a><a class="link" href="#_2_7_5_割込み番号と割込みハンドラ番号">2.7.5 割込み番号と割込みハンドラ番号</a></h4>
<div class="paragraph">
<p>割込み要求ラインを識別するための番号を，割込み番号と呼ぶ．割込み番号は，符号無しの整数型であるINTNO型で表し，ターゲットハードウェアの仕様から決まる自然な番号付けを基本として，ターゲット定義で付与される【NGKI0272】．そのため，1から連続した正の値であるとは限らない．</p>
</div>
<div class="paragraph">
<p>それに対して，アプリケーションが用意した割込みハンドラをカーネルに登録する場合に，割込みハンドラの登録対象となる割込みを識別するための番号を，割込みハンドラ番号と呼ぶ．割込みハンドラ番号は，符号無しの整数型であるINHNO型で表し，ターゲットハードウェアの仕様から決まる自然な番号付けを基本として，ターゲット定義で付与される【NGKI0273】．そのため，1から連続した正の値であるとは限らない．</p>
</div>
<div class="paragraph">
<p>割込みハンドラ番号は，割込み番号と1対1に対応するのが基本である（両者が一致する場合が多い）【NGKI0274】．</p>
</div>
<div class="paragraph">
<p>ただし，割込みを要求したデバイスが割込みベクタを生成してプロセッサに渡すアーキテクチャなどでは，割込み番号と割込みハンドラ番号の対応を，カーネルが管理していない場合がある【NGKI0275】．そこで，ターゲット定義で，割込み番号に対応しない割込みハンドラ番号や，割込みハンドラ番号に対応しない割込み番号を設ける場合もある【NGKI0276】．ただし，割込みサービスルーチンの登録対象にできる割込み番号は，割込みハンドラ番号との1対1の対応関係をカーネルが管理しているもののみである【NGKI0277】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_7_6_マルチプロセッサにおける割込み処理"><a class="anchor" href="#_2_7_6_マルチプロセッサにおける割込み処理"></a><a class="link" href="#_2_7_6_マルチプロセッサにおける割込み処理">2.7.6 マルチプロセッサにおける割込み処理</a></h4>
<div class="paragraph">
<p>この節では，マルチプロセッサにおける割込み処理について説明する．この節の内容は，マルチプロセッサ対応カーネルにのみ適用される．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，割込み処理モデルの概念図（図2-6）の中で，破線に囲まれた部分はプロセッサ毎に持ち，それ以外の部分はシステム全体で1つのみ持つ【NGKI0278】．すなわち，全割込みロックフラグ，CPUロックフラグ，割込み優先度マスクはプロセッサ毎に持つのに対して，割込み要求ラインおよびその属性（割込み要求禁止フラグ，割込み優先度，トリガモード）はシステム全体で共通に持つ．</p>
</div>
<div class="paragraph">
<p>割込み番号は，割込み要求ラインを識別するための番号であることから，割込み要求ラインが複数のプロセッサに接続されている場合でも，1つの割込み要求ラインには1つの割込み番号を付与する【NGKI0279】．逆に，複数のプロセッサが同じ種類のデバイスを持っている場合でも，別のデバイスからの割込み要求ラインには異なる割込み番号を付与する（図2-7）【NGKI0280】．図2-7において，ローカルIRCは個々のプロセッサに対する割込みを制御するための回路であり，グローバルIRCはデバイスからの割込みをプロセッサに分配するための回路である．グローバルIRCは，必ず備わっているとは限らない．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-7.png" alt="figure2 7">
</div>
</div>
<div class="paragraph">
<p>割込み要求禁止フラグは，この仕様上はシステム全体で共通に持つこととしているが，実際のターゲットハードウェア（特に，グローバルIRCを備えていないもの）では，プロセッサ毎に持っている場合がある．そのため，ターゲット定義で，あるプロセッサで割込み要求禁止フラグを動的にセット／クリアしても，他のプロセッサに対しては割込みがマスク／マスク解除されない場合があるものとする【NGKI0281】．</p>
</div>
<div class="paragraph">
<p>複数のプロセッサに接続された割込み要求ラインに対して登録された割込みサービスルーチンは，それらのプロセッサのいずれによっても実行することができる【NGKI0282】．ただし，その内のどのプロセッサで割込みサービスルーチンを実行するかは，割込みサービスルーチンが属するクラスの割付け可能プロセッサにより決定される（「<a href="#_2_4_4_処理単位を実行するプロセッサ">2.4.4 処理単位を実行するプロセッサ</a>」の節を参照）．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンが属するクラスの割付け可能プロセッサは，登録対象の割込み要求ラインが接続されたプロセッサの集合に含まれていなければならない【NGKI0283】．また，同一の割込み要求ラインに対して登録する割込みサービスルーチンは，同一のクラスに属していなければならない【NGKI0284】．</p>
</div>
<div class="paragraph">
<p>それに対して，割込みハンドラはプロセッサ毎に登録する．そのため，同じ割込み要求に対応する割込みハンドラであっても，プロセッサ毎に異なる割込みハンドラ番号を付与する（図2-7）【NGKI0285】．割込みハンドラが属するクラスの初期割付けプロセッサは，割込みが要求されるプロセッサと一致していなければならない【NGKI0286】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応カーネルにおける割込み番号の付与方法は，複数のプロセッサに接続された割込み要求ラインに対しては，割込み番号の上位ビットを0とし，1つのプロセッサのみに接続された割込み要求ラインに対しては，割込み番号の上位ビットに，接続されたプロセッサのID番号を含める方法を基本とする．また，割込みハンドラ番号の付与方法は，割込みハンドラ番号の上位ビットに，その割込みハンドラを実行するプロセッサのID番号を含める方法を基本とする（図2-7）．</p>
</div>
<div class="paragraph">
<p>1つのプロセッサのみに接続された割込み要求ラインに対して登録された割込みサービスルーチンは，そのプロセッサのみを割付け可能プロセッサとするクラスに属していなければならない．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>複数のプロセッサで実行することができる割込みサービスルーチンは，それらのプロセッサのいずれかで実行されるものと設定した場合でも，複数回の割込み要求により，異なるプロセッサで同時に実行される可能性がある．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_7_7_カーネル管理外の割込み"><a class="anchor" href="#_2_7_7_カーネル管理外の割込み"></a><a class="link" href="#_2_7_7_カーネル管理外の割込み">2.7.7 カーネル管理外の割込み</a></h4>
<div class="paragraph">
<p>高い割込み応答性を求められるアプリケーションでは，カーネル内で割込みをマスクすることにより，割込み応答性の要求を満たせなくなる場合がある．このような要求に対応するために，カーネル内では，ある割込み優先度（これを，TMIN_INTPRIと書く）よりも高い割込み優先度を持つ割込みをマスクしないこととしている【NGKI0287】．TMIN_INTPRIを固定するか設定できるようにするか，設定できるようにする場合の設定方法は，ターゲット定義である【NGKI0288】．</p>
</div>
<div class="paragraph">
<p>TMIN_INTPRIよりも高い割込み優先度を持ち，カーネル内でマスクしない割込みを，カーネル管理外の割込みと呼ぶ．また，カーネル管理外の割込みによって起動される割込みハンドラを，カーネル管理外の割込みハンドラと呼ぶ．NMIは，カーネル管理外の割込みとして扱う．NMI以外にカーネル管理外の割込みを設けるか（設けられるようにするか）どうかは，ターゲット定義である【NGKI0289】．</p>
</div>
<div class="paragraph">
<p>それに対して，TMIN_INTPRIと同じかそれよりも低い割込み優先度を持つ割込みをカーネル管理の割込み，カーネル管理の割込みによって起動される割込みハンドラをカーネル管理の割込みハンドラと呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の割込みハンドラは，カーネル内の割込み入口処理を経由せずに実行するのが基本である【NGKI0290】．ただし，すべての割込みで同じ番地に分岐するプロセッサでは，カーネル内の割込み入口処理を全く経由せずにカーネル管理外の割込みハンドラを実行することができず，入口処理の一部分を経由してカーネル管理外の割込みハンドラが実行されることになる【NGKI0291】．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の割込みハンドラが実行開始される時のシステム状態とコンテキスト，割込みハンドラの終了時に行われる処理，割込みハンドラの記述方法は，ターゲット定義である【NGKI0292】．カーネル管理外の割込みハンドラからは，システムインタフェースレイヤのAPIとsns_ker，ext_kerのみを呼び出すことができ，その他のサービスコールを呼び出すことはできない【NGKI0293】．カーネル管理外の割込みハンドラから，その他のサービスコールを呼び出した場合の動作は，保証されない【NGKI0294】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_7_8_カーネル管理外の割込みの設定方法"><a class="anchor" href="#_2_7_8_カーネル管理外の割込みの設定方法"></a><a class="link" href="#_2_7_8_カーネル管理外の割込みの設定方法">2.7.8 カーネル管理外の割込みの設定方法</a></h4>
<div class="paragraph">
<p>カーネル管理外の割込みの設定方法は，ターゲット定義で，次の3つの方法のいずれかが採用される【NGKI0295】．</p>
</div>
<div class="paragraph">
<p>(a-1) NMI以外にカーネル管理外の割込みを設けない(a-2) カーネル構築時に特定の割込みをカーネル管理外にすると決める</p>
</div>
<div class="paragraph">
<p>これら場合には，カーネル管理外とする割込みはカーネル構築時（ターゲット依存部の実装時やカーネルのコンパイル時）に決まるため，カーネル管理外とする割込みをアプリケーション側で設定する必要はない【NGKI0296】．ここで，カーネル管理外とされた割込みに対して，カーネルのAPIにより割込みハンドラを登録できるかと，割込み要求ラインの属性を設定できるかは，ターゲット定義である【NGKI0297】．割込みハンドラを登録できる場合には，それを定義するAPIにおいて，カーネル管理外であることを示す割込みハンドラ属性（TA_NONKERNEL）を指定する【NGKI0298】．また，割込み要求ラインの属性を設定できる場合には，設定する割込み優先度をTMIN_INTPRIよりも高い値とする【NGKI0299】．</p>
</div>
<div class="paragraph">
<p>(b) カーネル管理外とする割込みをアプリケーションで設定できるようにする</p>
</div>
<div class="paragraph">
<p>この場合には，カーネル管理外とする割込みの設定は，次の方法で行う．まず，カーネル管理外とする割込みハンドラを定義するAPIにおいて，カーネル管理外であることを示す割込みハンドラ属性（TA_NONKERNEL）を指定する【NGKI0300】．また，カーネル管理外とする割込みの割込み要求ラインに対して設定する割込み優先度を，TMIN_INTPRIよりも高い値とする【NGKI0301】．</p>
</div>
<div class="paragraph">
<p>いずれの場合にも，カーネル管理の割込みの割込み要求ラインに対して設定する割込み優先度は，TMIN_INTPRIより高い値であってはならない【NGKI0302】．また，カーネル管理外の割込みに対して，割込みサービスルーチンを登録することはできない【NGKI0303】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_8_cpu例外処理モデル"><a class="anchor" href="#_2_8_cpu例外処理モデル"></a><a class="link" href="#_2_8_cpu例外処理モデル">2.8 CPU例外処理モデル</a></h3>
<div class="paragraph">
<p>プロセッサが検出するCPU例外の種類や，CPU例外検出時のプロセッサの振舞いは，プロセッサによって大きく異なる．そのため，CPU例外ハンドラをターゲットハードウェアに依存せずに記述することは，少なくとも現時点では困難である．そこでこの仕様では，CPU例外の処理モデルを厳密に標準化するのではなく，ターゲットハードウェアに依存せずに決められる範囲で規定する．</p>
</div>
<div class="sect3">
<h4 id="_2_8_1_cpu例外処理の流れ"><a class="anchor" href="#_2_8_1_cpu例外処理の流れ"></a><a class="link" href="#_2_8_1_cpu例外処理の流れ">2.8.1 CPU例外処理の流れ</a></h4>
<div class="paragraph">
<p>アプリケーションは，プロセッサが検出するCPU例外の種類毎に，CPU例外ハンドラを登録することができる【NGKI0304】．プロセッサがCPU例外の発生を検出すると，カーネル内のCPU例外ハンドラの入口処理（CPU例外入口処理）を経由して，発生したCPU例外に対して登録したCPU例外ハンドラが呼び出される【NGKI0305】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの登録対象となるCPU例外を識別するための番号を，CPU例外ハンドラ番号と呼ぶ．CPU例外ハンドラ番号は，符号無しの整数型であるEXCNO型で表し，ターゲットハードウェアの仕様から決まる自然な番号付けを基本として，ターゲット定義で付与される【NGKI0306】．そのため，1から連続した正の値であるとは限らない．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，異なるプロセッサで発生するCPU例外は，異なるCPU例外であると扱う【NGKI0307】．すなわち，同じ種類のCPU例外であっても，異なるプロセッサのCPU例外には異なるCPU例外ハンドラ番号を付与し，プロセッサ毎にCPU例外ハンドラを登録する．CPU例外ハンドラが属するクラスの初期割付けプロセッサは，CPU例外が発生するプロセッサと一致していなければならない【NGKI0308】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラにおいては，CPU例外が発生した状態からのリカバリ処理を行う【NGKI0309】．どのようなリカバリ処理を行うかは，一般にはCPU例外の種類やそれが発生したコンテキストおよび状態に依存するが，大きく次の3つの方法に分類できる【NGKI0310】．</p>
</div>
<div class="paragraph">
<p>(a) カーネルに依存しない形でCPU例外の原因を取り除き，実行を継続する．</p>
</div>
<div class="paragraph">
<p>(b) CPU例外を起こしたタスクより優先して実行されるタスクを起動または待ち解除し，そのタスクでリカバリ処理を行う（例えば，CPU例外を起こしたタスクを強制終了し，再度起動する）．ただし，リカバリ処理を行うタスクを，CPU例外を起こしたタスクより優先して実行することができない場合には，この方法でリカバリ処理を行うことはできない【NGKI0311】．</p>
</div>
<div class="paragraph">
<p>(c) システム全体に対してリカバリ処理を行う（例えば，システムを再起動する）．</p>
</div>
<div class="paragraph">
<p>この中で(a)と(c)の方法は，カーネルの機能を必要としないため，CPU例外が発生したコンテキストおよび状態に依存せずに常に行える【NGKI0312】．それに対して(b)の方法は，CPU例外ハンドラからそのためのサービスコールを呼び出せることが必要であり，それが行えるかどうかは，CPU例外が発生したコンテキストおよび状態に依存する【NGKI0313】．</p>
</div>
<div class="paragraph">
<p>なお，発生したCPU例外に対して，CPU例外ハンドラを登録していない場合の振舞いは，ターゲット定義である【NGKI0314】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>CPU例外入口処理でCPU例外が発生し，それを処理するためのCPU例外ハンドラの入口処理で同じ原因でCPU例外が発生すると，CPU例外が繰り返し発生し，アプリケーションが登録したCPU例外ハンドラまで処理が到達しない状況が考えられる．このような状況が発生するかどうかはターゲットによるが，これが許容できない場合には，CPU例外入口処理を経由せずに，アプリケーションが用意したCPU例外ハンドラを直接実行するようにしなければならない．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応カーネルにおけるCPU例外ハンドラ番号の付与方法は，CPU例外ハンドラ番号の上位ビットに，そのCPU例外が発生するプロセッサのID番号を含める方法を基本とする．</p>
</div>
<div class="paragraph">
<p>(b)の方法でリカバリ処理が行えないのは，保護機能対応でないカーネルで最高優先度のタスクがCPU例外を起こした場合と，保護機能対応のカーネルでカーネルドメインに属する最高優先度のタスクがCPU例外を起こした場合に限られる．これらの場合にも，リカバリ処理を行うタスクを最高優先度とし，そのタスクの起動または待ち解除後に優先順位を回転させることで，リカバリ処理を行える場合もあるが，CPU例外を起こしたタスクが制約タスクの場合には適用できないなど，推奨できる方法ではない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，CPU例外からのリカバリ処理の方法については，記述されていない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>タスク例外処理ルーチンを廃止したことで，タスク例外処理ルーチンでリカバリ処理を行う方法が使えなくなったため，それに関する記述を削除した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_8_2_cpu例外ハンドラから呼び出せるサービスコール"><a class="anchor" href="#_2_8_2_cpu例外ハンドラから呼び出せるサービスコール"></a><a class="link" href="#_2_8_2_cpu例外ハンドラから呼び出せるサービスコール">2.8.2 CPU例外ハンドラから呼び出せるサービスコール</a></h4>
<div class="paragraph">
<p>CPU例外ハンドラからは，CPU例外発生時のディスパッチ保留状態を参照するサービスコール（xsns_dpn）を呼び出すことができる【NGKI0535】．</p>
</div>
<div class="paragraph">
<p>xsns_dpnは，CPU例外がタスクコンテキストで発生し，そのタスクがディスパッチできる状態であった場合にfalseを返す【NGKI0316】．xsns_dpnがfalseを返した場合，そのCPU例外ハンドラから，非タスクコンテキストから呼び出せるすべてのサービスコールを呼び出すことができ，［NGKI0311］の状況を除いては，(b)の方法によるリカバリ処理が可能である【NGKI0317】．</p>
</div>
<div class="paragraph">
<p>xsns_dpnがtrueを返した場合，そのCPU例外ハンドラからは，xsns_dpnに加えて，システムインタフェースレイヤのAPIとsns_ker，ext_kerのみを呼び出すことができ，その他のサービスコールを呼び出すことはできない【NGKI0321】．xsns_dpnがtrueを返したにもかかわらず，その他のサービスコールを呼び出した場合の動作は，保証されない【NGKI0322】．この場合には，(b)の方法によるリカバリ処理は行うことはできず，(a)または(c)の方法によるリカバリ処理を行うしかないことになる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>CPU例外ハンドラで行える操作に関しては，μITRON4.0仕様を見直し，全面的に修正した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>CPU例外発生時にタスク例外処理ルーチンを実行開始できない状態であったかを参照するサービスコール（xsns_xpn）を廃止した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_8_3_エミュレートされたcpu例外ハンドラ"><a class="anchor" href="#_2_8_3_エミュレートされたcpu例外ハンドラ"></a><a class="link" href="#_2_8_3_エミュレートされたcpu例外ハンドラ">2.8.3 エミュレートされたCPU例外ハンドラ</a></h4>
<div class="paragraph">
<p>エラーコードによってアプリケーションに通知できないエラーをカーネルが検出した場合に，アプリケーションが登録したエラー処理を，カーネルが呼び出す場合がある【NGKI0323】．この場合に，カーネルが検出するエラーをCPU例外と同等に扱うものとし，エミュレートされたCPU例外と呼ぶ【NGKI0324】．また，エラー処理のためのプログラムをCPU例外ハンドラと同等に扱うものとし，エミュレートされたCPU例外ハンドラと呼ぶ【NGKI0325】．</p>
</div>
<div class="paragraph">
<p>具体的には，エミュレートされたCPU例外ハンドラに対してもCPU例外ハンドラ番号が付与され，CPU例外ハンドラと同じ方法で登録できる【NGKI0326】．また，エミュレートされたCPU例外ハンドラからも，CPU例外ハンドラから呼び出せるサービスコールを呼び出すことができ，CPU例外ハンドラと同様のリカバリ処理を行うことができる【NGKI0327】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>エミュレートされたCPU例外およびCPU例外ハンドラは，μITRON4.0仕様に定義されていない概念である．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_8_4_カーネル管理外のcpu例外"><a class="anchor" href="#_2_8_4_カーネル管理外のcpu例外"></a><a class="link" href="#_2_8_4_カーネル管理外のcpu例外">2.8.4 カーネル管理外のCPU例外</a></h4>
<div class="paragraph">
<p>カーネル非動作状態，カーネル内のクリティカルセクションの実行中，全割込みロック状態，CPUロック状態，カーネル管理外の割込みハンドラ実行中のいずれかで発生したCPU例外を，カーネル管理外のCPU例外と呼ぶ．また，それによって起動されるCPU例外ハンドラを，カーネル管理外のCPU例外ハンドラと呼ぶ．さらに，カーネル管理外のCPU例外ハンドラ実行中に発生したCPU例外も，カーネル管理外のCPU例外とする．</p>
</div>
<div class="paragraph">
<p>それに対して，カーネル管理外のCPU例外以外のCPU例外をカーネル管理のCPU例外，カーネル管理のCPU例外によって起動されるCPU例外ハンドラをカーネル管理のCPU例外ハンドラと呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル管理外のCPU例外ハンドラにおいては，xsns_dpnはtrueを返す【NGKI0330】．そのため，「<a href="#_2_8_2_cpu例外ハンドラから呼び出せるサービスコール">2.8.2 CPU例外ハンドラから呼び出せるサービスコール</a>」の節で述べた制限［NGKI0321］［NGKI0322］が課される．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>カーネル管理外のCPU例外は，カーネル管理外の割込みと異なり，特定のCPU例外をカーネル外とするわけではない．同じCPU例外であっても，CPU例外が起こる状況によって，カーネル管理となる場合とカーネル管理外となる場合がある．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_9_システムの初期化と終了"><a class="anchor" href="#_2_9_システムの初期化と終了"></a><a class="link" href="#_2_9_システムの初期化と終了">2.9 システムの初期化と終了</a></h3>
<div class="sect3">
<h4 id="_2_9_1_システム初期化手順"><a class="anchor" href="#_2_9_1_システム初期化手順"></a><a class="link" href="#_2_9_1_システム初期化手順">2.9.1 システム初期化手順</a></h4>
<div class="paragraph">
<p>システムのリセット後，最初に実行するプログラムを，スタートアップモジュールと呼ぶ．スタートアップモジュールはカーネルの管理外であり，アプリケーションで用意するのが基本であるが，スタートアップモジュールで行うべき処理を明確にするために，カーネルの配布パッケージの中に，標準のスタートアップモジュールが用意されている【NGKI0331】．</p>
</div>
<div class="paragraph">
<p>標準のスタートアップモジュールは，プロセッサのモードとスタックポインタ等の初期化，NMIを除くすべての割込みのマスク（全割込みロック状態と同等の状態にする），ターゲットシステム依存の初期化フックの呼出し，ゼロ初期化データセクション（bssセクション）のクリア，初期化データセクション（dataセクション）の初期化，ソフトウェア環境（ライブラリなど）依存の初期化フックの呼出しを行った後，カーネルの初期化処理へ分岐する【NGKI0332】．ここで呼び出すターゲットシステム依存の初期化フックでは，リセット後に速やかに行うべき初期化処理を行うことが想定されている．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがスタートアップモジュールを実行し，カーネルの初期化処理へ分岐する【NGKI0333】．ただし，共有リソースの初期化処理（ゼロ初期化データセクションのクリア，初期化データセクションの初期化，ソフトウェア環境依存の初期化フックの呼出しなど）は，マスタプロセッサのみで実行する【NGKI0334】．各プロセッサがカーネルの初期化処理へ分岐するのは，共有リソースの初期化処理が完了した後でなければならないため，スレーブプロセッサは，カーネルの初期化処理へ分岐する前に，マスタプロセッサによる共有リソースの初期化処理の完了を待ち合わせる必要がある【NGKI0335】．</p>
</div>
<div class="paragraph">
<p>カーネルの初期化処理においては，まず，カーネル自身の初期化処理（カーネル内のデータ構造の初期化，カーネルが用いるデバイスの初期化など）と静的APIの処理（オブジェクトの登録など）が行われる【NGKI0336】．静的APIのパラメータに関するエラーは，コンフィギュレータによって検出されるのが原則であるが，コンフィギュレータで検出できないエラーが，この処理中に検出される場合もある【NGKI0337】．</p>
</div>
<div class="paragraph">
<p>静的APIの処理順序によりシステムの規定された振舞いが変化する場合には，システムコンフィギュレーションファイルにおける静的APIの記述順と同じ順序で静的APIが処理された場合と，同じ振舞いとなる【NGKI0338】．例えば，静的APIによって同じ優先度のタスクを複数生成・起動した場合，静的APIの記述順が先のタスクが高い優先順位を持つ．それに対して，最初の通知時刻が同じである複数の周期通知の通知順序は，同じシステム時刻で行うべき処理が複数ある場合の処理順序が規定されないことから（「<a href="#_4_6_1_システム時刻管理">4.6.1 システム時刻管理</a>」の節を参照），静的APIの記述順となるとは限らない．</p>
</div>
<div class="paragraph">
<p>次に，静的API（ATT_INI）により登録した初期化ルーチンが，システムコンフィギュレーションファイルにおける静的APIの記述順と同じ順序で実行される【NGKI0339】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがカーネル自身の初期化処理と静的APIの処理を完了した後に，マスタプロセッサがグローバル初期化ルーチンを実行する【NGKI0340】．グローバル初期化ルーチンの実行が完了した後に，各プロセッサは，自プロセッサに割り付けられたローカル初期化ルーチンを実行する【NGKI0341】．すなわち，ローカル初期化ルーチンは，初期割付けプロセッサにより実行される．</p>
</div>
<div class="paragraph">
<p>以上が終了すると，カーネル非動作状態から動作状態に遷移し（「<a href="#_2_5_1_カーネル動作状態と非動作状態">2.5.1 カーネル動作状態と非動作状態</a>」の節を参照），カーネルの動作が開始される【NGKI0342】．具体的には，システム状態が，全割込みロック解除状態・CPUロック解除状態・割込み優先度マスク全解除状態・ディスパッチ許可状態に設定され（すなわち，割込みがマスク解除され），タスクの実行が開始される．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがローカル初期化ルーチンの実行を完了した後に，カーネル非動作状態から動作状態に遷移し，カーネルの動作が開始される【NGKI0343】．マルチプロセッサ対応カーネルにおけるシステム初期化の流れと，各プロセッサが同期を取るタイミングを，図2-8に示す【NGKI0344】．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-8.png" alt="figure2 8">
</div>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様においては，初期化ルーチンの実行は静的APIの処理に含まれるものとしていたが，この仕様では，初期化ルーチンを登録する静的APIの処理は，初期化ルーチンを登録することのみを意味し，初期化ルーチンの実行は含まないものとした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_9_2_システム終了手順"><a class="anchor" href="#_2_9_2_システム終了手順"></a><a class="link" href="#_2_9_2_システム終了手順">2.9.2 システム終了手順</a></h4>
<div class="paragraph">
<p>カーネルを終了させるサービスコール（ext_ker）を呼び出すと，カーネル動作状態から非動作状態に遷移する（「<a href="#_2_5_1_カーネル動作状態と非動作状態">2.5.1 カーネル動作状態と非動作状態</a>」の節を参照）【NGKI0345】．具体的には，NMIを除くすべての割込みがマスクされ，タスクの実行が停止される．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，カーネルを終了させるサービスコール（ext_ker）は，どのプロセッサからでも呼び出すことができる【NGKI0346】．1つのプロセッサでカーネルを終了させるサービスコールを呼び出すと，そのプロセッサがカーネル動作状態から非動作状態に遷移した後，他のプロセッサに対してカーネル終了処理の開始を要求する【NGKI0347】．複数のプロセッサから，カーネルを終了させるサービスコール（ext_ker）を呼び出してもよい【NGKI0348】．</p>
</div>
<div class="paragraph">
<p>次に，静的API（ATT_TER）により登録した終了処理ルーチンが，システムコンフィギュレーションファイルにおける静的APIの記述順と逆の順序で実行される【NGKI0349】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがカーネル非動作状態に遷移した後に，各プロセッサが，自プロセッサに割り付けられたローカル終了処理ルーチンを実行する【NGKI0350】．すなわち，ローカル終了処理ルーチンは，初期割付けプロセッサにより実行される．すべてのプロセッサでローカル終了処理ルーチンの実行が完了した後に，マスタプロセッサがグローバル終了処理ルーチンを実行する【NGKI0351】．</p>
</div>
<div class="paragraph">
<p>以上が終了すると，ターゲットシステム依存の終了処理が呼び出される【NGKI0352】．ターゲットシステム依存の終了処理は，カーネルの管理外であり，アプリケーションで用意するのが基本であるが，カーネルの配布パッケージの中に，ターゲットシステム毎に標準的なルーチンが用意されている【NGKI0353】．標準のターゲットシステム依存の終了処理では，ソフトウェア環境（ライブラリなど）依存の終了処理フックを呼び出す【NGKI0354】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサで，ターゲットシステム依存の終了処理が呼び出される【NGKI0355】．マルチプロセッサ対応カーネルにおけるシステム終了処理の流れと，各プロセッサが同期を取るタイミングを，図2-9に示す【NGKI0356】．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-9.png" alt="figure2 9">
</div>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>マルチプロセッサ対応カーネルで，あるプロセッサからカーネルを終了させるサービスコール（ext_ker）を呼び出しても，他のプロセッサがカーネル動作状態で割込みをマスクしたまま実行し続けると，カーネルが終了しない．</p>
</div>
<div class="paragraph">
<p>プロセッサが割込みをマスクしたまま実行し続けないようにするのは，アプリケーションの責任である．例えば，ある時間を超えて割込みをマスクしたまま実行し続けていないかを，ウォッチドッグタイマを用いて監視する方法が考えられる．割込みをマスクしたまま実行し続けていた場合には，そのプロセッサからもカーネルを終了させるサービスコール（ext_ker）を呼び出すことで，カーネルを終了させることができる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様には，システム終了に関する規定はない．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_10_オブジェクトの登録とその解除"><a class="anchor" href="#_2_10_オブジェクトの登録とその解除"></a><a class="link" href="#_2_10_オブジェクトの登録とその解除">2.10 オブジェクトの登録とその解除</a></h3>
<div class="sect3">
<h4 id="_2_10_1_id番号で識別するオブジェクト"><a class="anchor" href="#_2_10_1_id番号で識別するオブジェクト"></a><a class="link" href="#_2_10_1_id番号で識別するオブジェクト">2.10.1 ID番号で識別するオブジェクト</a></h4>
<div class="paragraph">
<p>ID番号で識別するオブジェクトは，オブジェクトを生成する静的API（CRE_YYY）またはサービスコール（acre_yyy）によってカーネルに登録する【NGKI0357】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成する静的API（CRE_YYY）は，生成するオブジェクトにID番号を割り付け，ID番号を指定するパラメータとして記述した識別名を，割り付けたID番号にマクロ定義する【NGKI0359】．同じ識別名のオブジェクトが生成済みの場合には，E_OBJエラーとなる【NGKI0360】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成するサービスコール（acre_yyy）は，割付け可能なID番号の数を指定する静的API（AID_YYY）によって確保されたID番号の中から，使用されていないID番号を1つ選び，生成するオブジェクトに割り付ける【NGKI0361】．割り付けたID番号は，サービスコールの返値としてアプリケーションに通知する【NGKI0362】．使用されていないID番号が残っていない場合には，E_NOIDエラーとなる【NGKI0363】．</p>
</div>
<div class="paragraph">
<p>割付け可能なID番号の数を指定する静的API（AID_YYY）は，システムコンフィギュレーションファイル中に複数記述することができる【NGKI0364】．その場合，各静的APIで指定した数の合計の数のID番号が確保される【NGKI0365】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成するサービスコール（acre_yyy）によって登録したオブジェクトは，オブジェクトを削除するサービスコール（del_yyy）によって登録を解除することができる【NGKI0366】．登録解除したオブジェクトのID番号は，未使用の状態に戻され，新たに生成するオブジェクトに割り付けられる【NGKI0367】．この場合に，登録解除前のオブジェクトに対して行うつもりの操作が，新たに生成したオブジェクトに対して行われないように，注意が必要である．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成または追加する静的APIによって登録したオブジェクトは，登録を解除することができない．登録を解除しようとした場合には，E_OBJエラーとなる【NGKI0369】．</p>
</div>
<div class="paragraph">
<p>タスク以外の処理単位は，その処理単位が実行されている間でも，登録解除することができる【NGKI0370】．この場合，登録解除された処理単位の実行が途中で終了させられることはなく，処理単位が自ら実行を終了するまで，処理単位の実行は継続される【NGKI0371】．</p>
</div>
<div class="paragraph">
<p>同期・通信オブジェクトを削除した時に，そのオブジェクトを待っているタスクがあった場合，それらのタスクは待ち解除され，待ち状態に遷移させたサービスコールはE_DLTエラーとなる【NGKI0372】．複数のタスクが待ち解除される場合には，待ち行列につながれていた順序で待ち解除される【NGKI0373】．削除した同期・通信オブジェクトが複数の待ち行列を持つ場合には，別の待ち行列で待っていたタスクの間の待ち解除の順序は，該当するサービスコール毎に規定する【NGKI0374】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを再初期化するサービスコール（ini_yyy）は，指定したオブジェクトを削除した後に，同じパラメータで再度生成したのと等価の振舞いをする【NGKI0375】．ただし，オブジェクトを生成または追加する静的APIによって登録したオブジェクトも，再初期化することができる【NGKI0376】．</p>
</div>
<div class="paragraph">
<p>なお，動的生成対応でないカーネルでは，オブジェクトを生成するサービスコール（acre_yyy），割付け可能なID番号の数を指定する静的API（AID_YYY），オブジェクトのアクセス許可ベクタを設定するサービスコール（sac_yyy），オブジェクトを削除するサービスコール（del_yyy）は，サポートされない【NGKI0377】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>ID番号を指定してオブジェクトを生成するサービスコール（cre_yyy）を廃止した．また，オブジェクトを生成または追加する静的APIによって登録したオブジェクトは，登録解除できないこととした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，割付け可能なID番号の数を指定する静的API（AID_YYY）は規定されていない．</p>
</div>
<div class="paragraph">
<p>複数の待ち行列を持つ同期・通信オブジェクトを削除した時に，別の待ち行列で待っていたタスクの間の待ち解除の順序は，μITRON4.0仕様では実装依存とされている．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>アクセス許可ベクタを指定してオブジェクトを生成する静的API（CRA_YYY）は廃止し，オブジェクトの登録後にアクセス許可ベクタを設定する静的API（SAC_YYY）をサポートすることとした．これにあわせて，アクセス許可ベクタを指定してオブジェクトを登録するサービスコール（cra_yyy，acra_yyy，ata_yyy）も廃止した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>ID番号を指定してオブジェクトを生成するサービスコール（cre_yyy）とアクセス許可ベクタを指定してオブジェクトを登録するサービスコール（cra_yyy，acra_yyy，ata_yyy）を廃止したのは，必要性が低いと考えたためである．静的APIについても，サービスコールに整合するよう変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_10_2_オブジェクト番号で識別するオブジェクト"><a class="anchor" href="#_2_10_2_オブジェクト番号で識別するオブジェクト"></a><a class="link" href="#_2_10_2_オブジェクト番号で識別するオブジェクト">2.10.2 オブジェクト番号で識別するオブジェクト</a></h4>
<div class="paragraph">
<p>オブジェクト番号で識別するオブジェクトは，オブジェクトを定義する静的API（DEF_YYY）またはサービスコール（def_yyy）によってカーネルに登録する【NGKI0378】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを定義するサービスコール（def_yyy）によって登録したオブジェクトは，同じサービスコールを，オブジェクトの定義情報を入れたパケットへのポインタをNULLとして呼び出すことによって，登録を解除することができる【NGKI0379】．登録解除したオブジェクト番号は，オブジェクト登録前の状態に戻され，同じオブジェクト番号に対して新たにオブジェクトを定義することができる【NGKI0380】．登録解除されていないオブジェクト番号に対して再度オブジェクトを登録しようとした場合には，E_OBJエラーとなる【NGKI0381】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを定義する静的APIによって登録したオブジェクトは，登録を解除することができない【NGKI0382】．登録を解除しようとした場合には，E_OBJエラーとなる【NGKI0383】．</p>
</div>
<div class="paragraph">
<p>なお，動的生成対応でないカーネルでは，オブジェクトを定義するサービスコール（def_yyy）はサポートされない【NGKI0384】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>この仕様では，オブジェクトの定義を変更したい場合には，一度登録解除した後に，新たにオブジェクトを定義する必要がある．また，オブジェクトを定義する静的APIによって登録したオブジェクトは，この仕様では，登録解除できないこととした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_10_3_識別番号を持たないオブジェクト"><a class="anchor" href="#_2_10_3_識別番号を持たないオブジェクト"></a><a class="link" href="#_2_10_3_識別番号を持たないオブジェクト">2.10.3 識別番号を持たないオブジェクト</a></h4>
<div class="paragraph">
<p>識別する必要がないために，識別番号を持たないオブジェクトは，オブジェクトを追加する静的API（ATT_YYY）によってカーネルに登録する【NGKI0604】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_10_4_オブジェクト生成に必要なメモリ領域"><a class="anchor" href="#_2_10_4_オブジェクト生成に必要なメモリ領域"></a><a class="link" href="#_2_10_4_オブジェクト生成に必要なメモリ領域">2.10.4 オブジェクト生成に必要なメモリ領域</a></h4>
<div class="paragraph">
<p>カーネルオブジェクトを生成する際に，サイズが一定でないメモリ領域を必要とする場合には，カーネルオブジェクトを生成する静的APIおよびサービスコールに，使用するメモリ領域の先頭番地を渡すパラメータを設けている【NGKI0385】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいて，使用するメモリ領域の先頭番地を渡すパラメータをNULLとした場合，必要なメモリ領域は，コンフィギュレータによって確保される【NGKI0386】．保護機能対応カーネルでは，必要なメモリ領域は，別に規定がない限りは，カーネルドメイン向け（マルチプロセッサ対応カーネルの場合には，さらに，オブジェクトが属するクラス向け）の標準メモリリージョン内に確保される【NGKI0649】．</p>
</div>
<div class="paragraph">
<p>サービスコールにおいて，使用するメモリ領域の先頭番地を渡すパラメータをNULLとした場合，必要なメモリ領域は，カーネルによって，別に規定がない限りは，カーネルメモリプール領域から確保される【NGKI0618】．保護機能対応カーネルまたはマルチプロセッサ対応カーネルで，どのカーネルメモリプール領域が使用されるかについては，「<a href="#_4_13_システム構成管理機能">4.13 システム構成管理機能</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>カーネルオブジェクトを生成する際には，管理ブロックなどを置くためのメモリ領域も必要になるが，サイズが一定のメモリ領域はコンフィギュレータにより確保されるため，カーネルオブジェクトを生成する静的APIおよびサービスコールにそれらのメモリ領域の先頭番地を渡すパラメータを設けていない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_10_5_オブジェクトが属する保護ドメインの設定"><a class="anchor" href="#_2_10_5_オブジェクトが属する保護ドメインの設定"></a><a class="link" href="#_2_10_5_オブジェクトが属する保護ドメインの設定">2.10.5 オブジェクトが属する保護ドメインの設定</a></h4>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，カーネルオブジェクトが属する保護ドメインは，オブジェクトの登録時に決定し，登録後に変更することはできない【NGKI0387】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトを静的APIによって登録する場合には，オブジェクトを登録する静的APIを，そのオブジェクトを属させる保護ドメインの囲みの中に記述する【NGKI0388】．無所属のオブジェクトを登録する静的APIは，保護ドメインの囲みの外に記述する（「<a href="#_2_12_3_保護ドメインの指定">2.12.3 保護ドメインの指定</a>」の節を参照）【NGKI0389】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトをサービスコールによって登録する場合には，オブジェクト属性にTA_DOM(domid)を指定することにより，オブジェクトを属させる保護ドメインを設定する【NGKI0390】．ここでdomidは，そのオブジェクトを属させる保護ドメインのID番号であり，TDOM_KERNEL（＝-1）を指定することでカーネルドメインに属させることができる．また，domidにTDOM_SELF（＝0）を指定するか，オブジェクト属性にTA_DOM(domid)を指定しないことで，自タスクが属する保護ドメインに属させることができる．さらに，無所属のオブジェクトを登録する場合には，domidにTDOM_NONE（＝-2）を指定する．</p>
</div>
<div class="paragraph">
<p>ただし，特定の保護ドメインのみに属することができるカーネルオブジェクトを登録するサービスコールの中には，オブジェクトを属させる保護ドメインをオブジェクト属性で設定する必要がないものもある【NGKI0391】．</p>
</div>
<div class="paragraph">
<p>割付け可能なID番号の数を指定する静的API（AID_YYY）で確保したID番号は，AID_YYYを保護ドメインの囲みの中に記述した場合には，その保護ドメインに属するオブジェクトに，保護ドメインの囲みの外に記述した場合には，無所属のオブジェクトに割り付けられる【NGKI0610】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>この仕様では，カーネルオブジェクトの属する保護ドメインを参照する機能は用意していない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>割付け可能なID番号は保護ドメイン毎に確保することにし，AID_YYYを保護ドメインの囲みの中にも記述できることとした．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>カーネルオブジェクトをサービスコールによって登録する場合に，オブジェクトを属させる保護ドメインをオブジェクト属性で指定することにしたのは，保護機能対応でないカーネルとの互換性のためには，サービスコールのパラメータを増やさない方が望ましいためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_10_6_オブジェクトが属するクラスの設定"><a class="anchor" href="#_2_10_6_オブジェクトが属するクラスの設定"></a><a class="link" href="#_2_10_6_オブジェクトが属するクラスの設定">2.10.6 オブジェクトが属するクラスの設定</a></h4>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，カーネルオブジェクトが属するクラスは，オブジェクトの登録時に決定し，登録後に変更することはできない【NGKI0395】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトを静的APIによって登録する場合には，オブジェクトを登録する静的APIを，そのオブジェクトを属させるクラスの囲みの中に記述する【NGKI0396】．クラスに属さないオブジェクトを登録する静的APIは，クラスの囲みの外に記述する（「<a href="#_2_12_4_クラスの指定">2.12.4 クラスの指定</a>」の節を参照）【NGKI0397】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトをサービスコールによって登録する場合には，オブジェクト属性にTA_CLS(clsid)を指定することにより，オブジェクトを属させるクラスを設定する【NGKI0398】．ここでclsidは，そのオブジェクトを属させるクラスのID番号であり，clsidにTCLS_SELF（＝0）を指定するか，オブジェクト属性にTA_CLS(clsid)を指定しないことで，自タスクが属するクラスに属させることができる．</p>
</div>
<div class="paragraph">
<p>割付け可能なID番号の数を指定する静的API（AID_YYY）で確保したID番号は，AID_YYYを囲むクラスに属するオブジェクトにのみ割り付けられる【NGKI0399】．AID_YYYは，確保したID番号を割り付けるオブジェクトの属すべきクラスの囲みの中に記述しなければならない．クラスの囲みの外に記述した場合には，E_RSATRエラーとなる【NGKI0401】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>この仕様では，カーネルオブジェクトの属するクラスを参照する機能は用意していない．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>カーネルオブジェクトをサービスコールによって登録する場合に，オブジェクトを属させるクラスをオブジェクト属性で指定することにしたのは，マルチプロセッサ対応でないカーネルとの互換性のためには，サービスコールのパラメータを増やさない方が望ましいためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_10_7_オブジェクトの状態参照"><a class="anchor" href="#_2_10_7_オブジェクトの状態参照"></a><a class="link" href="#_2_10_7_オブジェクトの状態参照">2.10.7 オブジェクトの状態参照</a></h4>
<div class="paragraph">
<p>ID番号で識別するオブジェクトのすべてと，オブジェクト番号で識別するオブジェクトの一部に対して，オブジェクトの状態を参照するサービスコール（ref_yyy，get_yyy）を用意する【NGKI0402】．</p>
</div>
<div class="paragraph">
<p>オブジェクトの状態を参照するサービスコールでは，オブジェクトの登録時に指定し，その後に変化しない情報（例えば，タスクのタスク属性や初期優先度）を参照するための機能は用意しないことを原則とする【NGKI0403】．自タスクの拡張情報の参照するサービスコール（get_inf）は，この原則に対する例外である【NGKI0404】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_11_オブジェクトのアクセス保護"><a class="anchor" href="#_2_11_オブジェクトのアクセス保護"></a><a class="link" href="#_2_11_オブジェクトのアクセス保護">2.11 オブジェクトのアクセス保護</a></h3>
<div class="paragraph">
<p>この節では，カーネルオブジェクトのアクセス保護について述べる．この節の内容は，保護機能対応カーネルにのみ適用される．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>システム時刻に対するアクセス許可ベクタと，それを設定する静的APIおよびサービスコールを廃止し，保護ドメインに対するアクセス許可ベクタと，それを設定する静的APIおよびサービスコールを追加した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>保護ドメインに対するアクセス許可ベクタと，それを設定する静的APIおよびサービスコールを追加した．</p>
</div>
<div class="sect3">
<h4 id="_2_11_1_オブジェクトのアクセス保護とアクセス違反の通知"><a class="anchor" href="#_2_11_1_オブジェクトのアクセス保護とアクセス違反の通知"></a><a class="link" href="#_2_11_1_オブジェクトのアクセス保護とアクセス違反の通知">2.11.1 オブジェクトのアクセス保護とアクセス違反の通知</a></h4>
<div class="paragraph">
<p>カーネルオブジェクトに対するアクセスは，そのオブジェクトに対して設定されたアクセス許可ベクタによって保護される【NGKI0405】．ただし，アクセス許可ベクタを持たないオブジェクトに対するアクセスや，特定のオブジェクトに関連しないシステムの状態に対する操作，オブジェクトを定義するサービスコールについては，スケジューリングに関係するものは保護ドメインに対するアクセス許可ベクタによって，その他はシステム状態に対するアクセス許可ベクタによって保護される【NGKI0568】．また，オブジェクトを生成するサービスコールは，生成するオブジェクトが属する保護ドメインに対するアクセス許可ベクタによって保護される【NGKI0612】．</p>
</div>
<div class="paragraph">
<p>アクセス許可ベクタによって許可されていないアクセス（アクセス違反）は，カーネルによって検出され，以下の方法によって通知される．</p>
</div>
<div class="paragraph">
<p>サービスコールにより，メモリオブジェクト以外のカーネルオブジェクトに対して，許可されていないアクセスを行おうとした場合，サービスコールからE_OACVエラーが返る【NGKI0408】．また，メモリオブジェクトに対して，許可されていない管理操作または参照操作を行おうとした場合も，サービスコールからE_OACVエラーが返る【NGKI0409】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに対して，通常のメモリアクセスにより，許可されていない書込みアクセスまたは読出しアクセス（実行アクセスを含む）を行おうとした場合，CPU例外ハンドラが起動される【NGKI0410】．どのCPU例外ハンドラが起動されるかは，ターゲット定義である【NGKI0411】．ターゲットによっては，エミュレートされたCPU例外ハンドラの場合もある．また，ターゲット定義で，アクセス違反の状況に応じて異なるCPU例外ハンドラが起動される場合もある．この（これらの）CPU例外ハンドラを，メモリアクセス違反ハンドラと呼ぶ．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに対して，サービスコールを通じて，許可されていない書込みアクセスまたは読出しアクセスを行おうとした場合，サービスコールからE_MACVエラーが返るか，メモリアクセス違反ハンドラが起動される【NGKI0412】．E_MACVエラーが返るかメモリアクセス違反ハンドラが起動されるかは，ターゲット定義である【NGKI0413】．</p>
</div>
<div class="paragraph">
<p>メモリアクセス違反ハンドラでは，アクセス違反を発生させたアクセスに関する情報（アクセスした番地，アクセスの種別，アクセスした命令の番地など）を参照する方法を，ターゲット定義で用意する【NGKI0414】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトとしてカーネルに登録されていないメモリ領域に対して，ユーザドメインから書込みアクセスまたは読出しアクセス（実行アクセスを含む）を行おうとした場合には，メモリオブジェクトに対するアクセスが許可されていない場合と同様に扱われる【NGKI0415】．カーネルドメインから同様のアクセスを行おうとした場合の動作は保証されない【NGKI0416】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様では，アクセス保護の実装定義の制限について規定しているが，この仕様では，メモリオブジェクトに対するアクセス許可ベクタのターゲット定義の制限以外については規定していない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>オブジェクトを生成するサービスコールの保護は，TOPPERS新世代カーネル統合仕様では，システム状態に対するアクセス許可ベクタによって行っていたが，この仕様では，生成するオブジェクトが属する保護ドメインに対するアクセス許可ベクタによって行うものとした．これに伴って，オブジェクトを生成する際に使用するリソース（ID番号，カーネルメモリプール領域）の確保量についても，保護ドメイン毎に設定することとした．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>オブジェクトを登録するサービスコールを，そのオブジェクトのアクセス許可ベクタによって保護しないのは，オブジェクトを登録する前には，アクセス許可ベクタが設定されていないためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_11_2_メモリオブジェクトに対するアクセス許可ベクタの制限"><a class="anchor" href="#_2_11_2_メモリオブジェクトに対するアクセス許可ベクタの制限"></a><a class="link" href="#_2_11_2_メモリオブジェクトに対するアクセス許可ベクタの制限">2.11.2 メモリオブジェクトに対するアクセス許可ベクタの制限</a></h4>
<div class="paragraph">
<p>メモリオブジェクトの書込みアクセスと読出しアクセス（実行アクセスを含む）に対して設定できるアクセス許可パターンは，ターゲット定義で制限される場合がある【NGKI0417】．</p>
</div>
<div class="paragraph">
<p>ただし，少なくとも，次の5つの組み合わせの設定は，行うことができる．</p>
</div>
<div class="paragraph">
<p>(a) メモリオブジェクトが属する保護ドメインのみに，読出しアクセス（実行アクセスを含む）のみを許可する【NGKI0418】．これを，専有リードオンリー（private read only）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>(b) メモリオブジェクトが属する保護ドメインのみに，書込みアクセスと読出しアクセス（実行アクセスを含む）を許可する【NGKI0419】．これを，専有リードライト（private read/write）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>(c) すべての保護ドメインに，読出しアクセス（実行アクセスを含む）のみを許可する【NGKI0420】．これを，共有リードオンリー（shared read only）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>(d) すべての保護ドメインに，書込みアクセスと読出しアクセス（実行アクセスを含む）を許可する【NGKI0421】．これを，共有リードライト（shared read/write）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>(e) メモリオブジェクトが属する保護ドメインに，書込みアクセスと読出しアクセス（実行アクセスを含む）を許可し，他の保護ドメインには，読出しアクセス（実行アクセスを含む）のみを許可する【NGKI0422】．これを，共有リード専有ライト（shared read private write）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>また，ターゲット定義で，1つの保護ドメインに登録できるメモリオブジェクトの数が制限される場合がある【NGKI0423】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_11_3_デフォルトのアクセス許可ベクタ"><a class="anchor" href="#_2_11_3_デフォルトのアクセス許可ベクタ"></a><a class="link" href="#_2_11_3_デフォルトのアクセス許可ベクタ">2.11.3 デフォルトのアクセス許可ベクタ</a></h4>
<div class="paragraph">
<p>カーネルオブジェクトを登録した直後は，次に規定されるデフォルトのアクセス許可ベクタが設定される．</p>
</div>
<div class="paragraph">
<p>保護ドメインに属するカーネルオブジェクトに対しては，通常操作1，通常操作2，参照操作の3つの種別のアクセスが，その保護ドメインのみに許可される【NGKI0613】．すなわち，カーネルドメインに属するオブジェクトに対しては，上記の3つのアクセス種別のアクセス許可パターンがTACP_KERNELに，ユーザドメインに属するオブジェクトに対しては，上記の3つのアクセス種別のアクセス許可パターンがTACP(domid)（domidはオブジェクトが属する保護ドメインのID番号）に設定される．管理操作のアクセス許可パターンは，そのカーネルオブジェクトが属する保護ドメインに対する通常操作1のアクセス許可パターンと同じ値に設定される【NGKI0614】．</p>
</div>
<div class="paragraph">
<p>無所属のカーネルオブジェクトに対しては，通常操作1，通常操作2，参照操作の3つの種別のアクセスが，すべての保護ドメインに許可される【NGKI0615】．すなわち，上記の3つのアクセス種別のアクセス許可パターンが，TACP_SHAREDに設定される．管理操作のアクセス許可パターンは，無所属に対する通常操作1のアクセス許可パターンと同じ値に設定される【NGKI0616】．</p>
</div>
<div class="paragraph">
<p>保護ドメインのアクセス許可ベクタは，通常操作1と参照操作はその保護ドメインのみに許可され，通常操作2と管理操作はカーネルドメインのみに許可される【NGKI0569】．すなわち，カーネルドメインに対しては，4つのアクセス許可パターンがいずれもTACP_KERNELに，ユーザドメインに対しては，通常操作1と参照操作のアクセス許可パターンがTACP(domid)に，通常操作2と管理操作のアクセス許可パターンがTACP_KERNELに設定される．</p>
</div>
<div class="paragraph">
<p>無所属に対するアクセス許可ベクタは，通常操作1と参照操作はすべての保護ドメインに許可され，通常操作2と管理操作はカーネルドメインのみに許可される【NGKI0617】．すなわち，通常操作1と参照操作のアクセス許可パターンがTACP_SHAREDに，通常操作2と管理操作のアクセス許可パターンがTACP_KERNELに設定される．</p>
</div>
<div class="paragraph">
<p>システム状態のアクセス許可ベクタは，4つの種別のアクセスがいずれも，カーネルドメインのみに許可される【NGKI0426】．すなわち，4つのアクセス許可パターンがいずれも，TACP_KERNELに設定される．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>保護ドメイン以外のカーネルオブジェクトに対する管理操作のアクセス許可パターンを，そのカーネルオブジェクトが属する保護ドメインに対する通常操作1（無所属のカーネルドメイン場合は，無所属に対する通常操作1）のアクセス許可パターンと同じ値に設定されるものとした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_11_4_アクセス許可ベクタの設定"><a class="anchor" href="#_2_11_4_アクセス許可ベクタの設定"></a><a class="link" href="#_2_11_4_アクセス許可ベクタの設定">2.11.4 アクセス許可ベクタの設定</a></h4>
<div class="paragraph">
<p>アクセス許可ベクタをデフォルト以外の値に設定するために，カーネルオブジェクトのアクセス許可ベクタを設定する静的API（SAC_YYY）と，保護ドメインのアクセス許可ベクタを設定する静的API（ACV_DOM），システム状態のアクセス許可ベクタを設定する静的API（SAC_SYS）が用意されている【NGKI0570】．</p>
</div>
<div class="paragraph">
<p>また，動的生成対応カーネルにおいては，カーネルオブジェクトのアクセス許可ベクタを設定するサービスコール（sac_yyy）と，保護ドメインのアクセス許可ベクタを設定するサービスコール（sac_dom），システム状態のアクセス許可ベクタを設定するサービスコール（sac_sys）が用意されている【NGKI0571】．ただし，静的APIによって登録したオブジェクトは，サービスコール（sac_yyy）によってアクセス許可ベクタを設定することができない．アクセス許可ベクタを設定しようとした場合には，E_OBJエラーとなる【NGKI0430】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに対しては，アクセス許可ベクタを設定する静的APIは用意されておらず，オブジェクトを追加する静的API（ATT_YYY）によって，登録と同時にアクセス許可ベクタを設定することができる【NGKI0605】．アクセス許可ベクタの記述を省略した場合には，デフォルトのアクセス許可ベクタが設定される【NGKI0606】．</p>
</div>
<div class="paragraph">
<p>オブジェクトに対するアクセスが許可されているかは，そのオブジェクトにアクセスするサービスコールを呼び出した時点でチェックされる【NGKI0432】．そのため，アクセス許可ベクタを変更しても，変更以前に呼び出されたサービスコールの振舞いには影響しない．例えば，待ち行列を持つ同期・通信オブジェクトのアクセス許可ベクタを変更しても，呼び出した時点ですでに待ち行列につながれているタスクには影響しない．また，ミューテックスのアクセス許可ベクタを変更しても，呼び出した時点ですでにミューテックをロックしていたタスクには影響しない．</p>
</div>
<div class="paragraph">
<p>この仕様では，カーネルオブジェクトに設定されたアクセス許可ベクタを参照する機能は用意していない．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>カーネルオブジェクトのアクセス許可ベクタをデフォルト以外の値に設定する際に，オブジェクトに対して同じ保護ドメインに属する処理単位からアクセスできるようにするには，その保護ドメインからアクセスできることを明示的に指定する必要がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>アクセス許可ベクタを指定してオブジェクトを生成する静的API（CRA_YYY）は廃止し，オブジェクトの登録後にアクセス許可ベクタを設定する静的API（SAC_YYY）をサポートすることとした．</p>
</div>
<div class="paragraph">
<p>静的APIによって登録したオブジェクトは，サービスコール（sac_yyy）によってアクセス許可ベクタを設定することができないこととした．</p>
</div>
<div class="paragraph">
<p>オブジェクトの状態参照するサービスコール（ref_yyy）により，オブジェクトに設定されたアクセス許可ベクタを参照する機能サポートしないこととした．これは，［NGKI0403］の原則に合わせるための修正である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>メモリオブジェクトに対しては，オブジェクトを追加する静的API（ATT_YYY）によって，オブジェクトの登録と同時にアクセス許可ベクタを設定することができるようにし，登録と同時にアクセス許可ベクタを設定する静的API（ATA_YYY）は廃止した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_11_5_カーネルの管理領域のアクセス保護"><a class="anchor" href="#_2_11_5_カーネルの管理領域のアクセス保護"></a><a class="link" href="#_2_11_5_カーネルの管理領域のアクセス保護">2.11.5 カーネルの管理領域のアクセス保護</a></h4>
<div class="paragraph">
<p>カーネルオブジェクトの生成に必要なメモリ領域（「<a href="#_2_10_4_オブジェクト生成に必要なメモリ領域">2.10.4 オブジェクト生成に必要なメモリ領域</a>」の節を参照）の中で，カーネルの内部およびカーネルドメインに属する処理単位のみからアクセスされるものを，カーネルの管理領域と呼ぶ．</p>
</div>
<div class="paragraph">
<p>ユーザドメインに属する処理単位からカーネルを保護するためには，カーネルの管理領域にアクセスできるのは，カーネルドメインのみでなければならない．そのため，カーネルの管理領域は，書込みアクセスおよび読出しアクセスが可能で，4つの種別のアクセスがカーネルドメインのみに許可されたメモリオブジェクト（これを，カーネル専用のメモリオブジェクトと呼ぶ）の中に置かれる【NGKI0433】．</p>
</div>
<div class="paragraph">
<p>カーネルの管理領域として，カーネル専用のメモリオブジェクトに含まれないメモリ領域を指定した場合，E_OBJエラーとなる【NGKI0434】．また，カーネルの管理領域の先頭番地にNULLを指定した場合，必要なメモリ領域が，カーネル専用のメモリオブジェクトの中に確保される【NGKI0435】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>以下のメモリ領域が，カーネルの管理領域に該当する．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システムタスクのスタック領域</p>
</li>
<li>
<p>ユーザタスクのシステムスタック領域</p>
</li>
<li>
<p>データキュー管理領域</p>
</li>
<li>
<p>優先度データキュー管理領域</p>
</li>
<li>
<p>メッセージバッファ管理領域</p>
</li>
<li>
<p>固定長メモリプール管理領域</p>
</li>
<li>
<p>非タスクコンテキスト用のスタック領域</p>
</li>
<li>
<p>カーネルメモリプール領域</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ユーザタスクのユーザスタック領域と固定長メモリプール領域は，ユーザドメインに属する処理単位からもアクセスされるため，カーネルの管理領域には該当しない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_11_6_ユーザタスクのユーザスタック領域"><a class="anchor" href="#_2_11_6_ユーザタスクのユーザスタック領域"></a><a class="link" href="#_2_11_6_ユーザタスクのユーザスタック領域">2.11.6 ユーザタスクのユーザスタック領域</a></h4>
<div class="paragraph">
<p>ユーザタスクが非特権モードで実行する間に用いるスタック領域を，システムスタック領域（「<a href="#_4_1_タスク管理機能">4.1 タスク管理機能</a>」の節を参照）と対比させて，ユーザスタック領域と呼ぶ．ユーザスタック領域は，そのタスクと同じ保護ドメインに属する1つのメモリオブジェクトとしてカーネルに登録される【NGKI0437】．ただし，他のメモリオブジェクトとは異なり，次のように扱われる．</p>
</div>
<div class="paragraph">
<p>タスクのユーザスタック領域に対しては，そのタスクのみが書込みアクセスおよび読出しアクセスを行うことができる【NGKI0438】．そのため，通常操作1（書込みアクセス）と通常操作2（読出しアクセスおよび実行アクセス）に対するアクセス許可パターンは意味を持たない【NGKI0439】．管理操作と参照操作に対するアクセス許可パターンは，タスクと同じ値に設定される【NGKI0609】．ユーザスタック領域に対して実行アクセスを行えるかどうかは，ターゲット定義である【NGKI0440】．</p>
</div>
<div class="paragraph">
<p>ただし，上記の仕様を実現するために大きいオーバヘッドを生じる場合には，ターゲット定義で，タスクのユーザスタック領域を，そのタスクが属する保護ドメイン全体からアクセスできるものとする場合がある【NGKI0441】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>この仕様では，タスクのユーザスタック領域は，そのタスクのみがアクセスできるものとした．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_12_システムコンフィギュレーション手順"><a class="anchor" href="#_2_12_システムコンフィギュレーション手順"></a><a class="link" href="#_2_12_システムコンフィギュレーション手順">2.12 システムコンフィギュレーション手順</a></h3>
<div class="sect3">
<h4 id="_2_12_1_システムコンフィギュレーションファイル"><a class="anchor" href="#_2_12_1_システムコンフィギュレーションファイル"></a><a class="link" href="#_2_12_1_システムコンフィギュレーションファイル">2.12.1 システムコンフィギュレーションファイル</a></h4>
<div class="paragraph">
<p>カーネルやシステムサービスが管理するオブジェクトの生成情報や初期状態などを記述するファイルを，システムコンフィギュレーションファイル（system configuration file）と呼ぶ．また，システムコンフィギュレーションファイルを解釈して，カーネルやシステムサービスの構成・初期化情報を含むファイルなどを生成するツールを，コンフィギュレータ（configurator）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>システムコンフィギュレーションファイルには，カーネルの静的API，システムサービスの静的API，保護ドメインの囲み，クラスの囲み，コンフィギュレータに対するINCLUDEディレクティブ，C言語プリプロセッサのインクルードディレクティブ（#include）と条件ディレクティブ（#if，#ifdefなど）のみを記述することができる【NGKI0442】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータに対するINCLUDEディレクティブは，システムコンフィギュレーションファイルを複数のファイルに分割して記述するために用いるもので，その文法は次の通りである【NGKI0619】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	INCLUDE("ファイル名");</code></pre>
</div>
</div>
<div class="paragraph">
<p>コンフィギュレータは，INCLUDEディレクティブによって指定されたファイル中の記述を，システムコンフィギュレーションファイルの一部分として解釈する【NGKI0444】．すなわち，INCLUDEディレクティブによって指定されたファイル中には，カーネルの静的API，システムサービスの静的API，コンフィギュレータに対するINCLUDEディレクティブ，C言語プリプロセッサのインクルードディレクティブと条件ディレクティブのみを記述することができる．</p>
</div>
<div class="paragraph">
<p>C言語プリプロセッサのインクルードディレクティブは，静的APIのパラメータを解釈するために必要なC言語のヘッダファイルを指定するために用いる【NGKI0445】．コンフィギュレータが生成するファイルでは，インクルードディレクティブは先頭に集められる【NGKI0447】．</p>
</div>
<div class="paragraph">
<p>C言語プリプロセッサの条件ディレクティブは，有効とする静的APIとC言語プリプロセッサのディレクティブを選択するために用いることができる【NGKI0620】．1つの静的APIの記述の途中に，条件ディレクティブを記述することはできない【NGKI0448】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，システムコンフィギュレーションファイル中の静的APIを，その記述順に解釈する【NGKI0449】．そのため例えば，タスクを生成する静的APIの前に，そのタスクにアクセス許可ベクタを設定する静的APIが記述されていた場合，アクセス許可ベクタを設定する静的APIがE_NOEXSエラーとなる．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>C言語プリプロセッサのインクルードディレクティブは，コンフィギュレータが生成するファイルでは先頭に集められるため，インクルードするC言語のヘッダファイル中でマクロの定義を変更（定義を解除した後に，定義し直す）した場合，意図しない動作をする可能性がある．</p>
</div>
<div class="paragraph">
<p>C言語プリプロセッサの条件ディレクティブは，保護ドメインの囲みやINCLUDEディレクティブを無効にしない．そのため，例えば，条件ディレクティブで囲みが選択されなかった保護ドメインに対しても，保護ドメインIDが割り付けられる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>システムコンフィギュレーションファイルにおけるC言語プリプロセッサのディレクティブの扱いを全面的に見直し，コンフィギュレータに対するINCLUDEディレクティブを設けた．また，共通静的APIを廃止した．μITRON4.0仕様における#includeディレクティブの役割は，この仕様ではINCLUDEディレクティブに置き換わる．逆に，μITRON4.0仕様におけるINCLUDE静的APIの役割は，この仕様では#includeディレクティブに置き換わる．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_12_2_静的apiの文法とパラメータ"><a class="anchor" href="#_2_12_2_静的apiの文法とパラメータ"></a><a class="link" href="#_2_12_2_静的apiの文法とパラメータ">2.12.2 静的APIの文法とパラメータ</a></h4>
<div class="paragraph">
<p>静的APIは，次に述べる例外を除いては，C言語の関数呼出しと同様の文法で記述する【NGKI0450】．すなわち，静的APIの名称に続けて，静的APIの各パラメータを","で区切って列挙したものを"("と")"で囲んで記述し，最後に";"を記述する．ただし，静的APIのパラメータに構造体（または構造体へのポインタ）を記述する場合には，構造体の各フィールドを","で区切って列挙したものを"{"と"}"で囲んだ形で記述する【NGKI0451】．</p>
</div>
<div class="paragraph">
<p>サービスコールに対応する静的APIの場合，静的APIのパラメータは，対応するサービスコールのパラメータと同一とすることを原則とする【NGKI0452】．</p>
</div>
<div class="paragraph">
<p>静的APIのパラメータは，次の4種類に分類される．</p>
</div>
<div class="paragraph">
<p>(a) オブジェクト識別名</p>
</div>
<div class="paragraph">
<p>オブジェクトのID番号を指定するパラメータ．オブジェクトの名称を表す単一の識別名のみを記述することができる．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，オブジェクト生成のための静的API（CRE_YYY）を処理する際に，オブジェクトにID番号を割り付け，構成・初期化ヘッダファイルに，指定された識別名を割り付けたID番号にマクロ定義するC言語プリプロセッサのディレクティブ（#define）を生成する【NGKI0453】．</p>
</div>
<div class="paragraph">
<p>オブジェクト生成以外の静的APIが，オブジェクトのID番号をパラメータに取る場合（カーネルの静的APIでは，SAC_TSKのtskidパラメータ等がこれに該当する）には，パラメータとして記述する識別名は，生成済みのオブジェクトの名称を表す識別名でなければならない．そうでない場合には，コンフィギュレータがエラーを報告する【NGKI0455】．</p>
</div>
<div class="paragraph">
<p>静的APIの整数定数式パラメータの記述に，オブジェクト識別名を使用することはできない【NGKI0456】．</p>
</div>
<div class="paragraph">
<p>(b) 整数定数式パラメータ</p>
</div>
<div class="paragraph">
<p>オブジェクト番号や機能コード，オブジェクト属性，サイズや数，優先度など，整数値を指定するパラメータ．プログラムが配置される番地に依存せずに値の決まる整数定数式を記述することができる．</p>
</div>
<div class="paragraph">
<p>整数定数式の解釈に必要な定義や宣言等は，システムコンフィギュレーションファイルからC言語プリプロセッサのインクルードディレクティブによってインクルードするファイルに含まれていなければならない【NGKI0457】．</p>
</div>
<div class="paragraph">
<p>(c) 一般定数式パラメータ</p>
</div>
<div class="paragraph">
<p>処理単位のエントリ番地，メモリ領域の先頭番地，拡張情報など，番地を指定する可能性のあるパラメータ．任意の定数式を記述することができる．</p>
</div>
<div class="paragraph">
<p>定数式の解釈に必要な定義や宣言等は，システムコンフィギュレーションファイルからC言語プリプロセッサのインクルードディレクティブによってインクルードするファイルに含まれていなければならない【NGKI0458】．</p>
</div>
<div class="paragraph">
<p>NULLを指定することが特別な意味を持つ一般定数式パラメータにおいて，NULLの意味を持たせたい場合には，静的APIのパラメータに「NULL」と記述しなければならない【NGKI0638】．NULLに展開されるマクロを記述しても，NULLの意味にはならないので注意すること．</p>
</div>
<div class="paragraph">
<p>(d) 文字列パラメータ</p>
</div>
<div class="paragraph">
<p>オブジェクトモジュール名やセクション名など，文字列を指定するパラメータ．任意の文字列を，C言語の文字列の記法で記述することができる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様においては，静的APIのパラメータを次の4種類に分類していたが，コンフィギュレータの仕組みを見直したことに伴い全面的に見直した．</p>
</div>
<div class="paragraph">
<p>(A) 自動割付け対応整数値パラメータ<br>
(B) 自動割付け非対応整数値パラメータ<br>
(C) プリプロセッサ定数式パラメータ<br>
(D) 一般定数式パラメータ</p>
</div>
<div class="paragraph">
<p>この仕様の(a)が，おおよそμITRON4.0仕様の(A)に相当するが，(a)には整数値を記述できない点が異なる．(b)〜(c)と(B)〜(D)の間には単純な対応関係がないが，記述できる定数式の範囲には，(B)⊂(C)⊂(b)⊂(c)＝(D)の関係がある．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，静的APIのパラメータは基本的には(D)とし，コンフィギュレータが値を知る必要があるパラメータを(B)，構成・初期化ファイルに生成するC言語プリプロセッサの条件ディレクティブ（#if）中に含めたい可能性のあるパラメータを(C)としていた．</p>
</div>
<div class="paragraph">
<p>それに対して，この仕様におけるコンフィギュレータの処理モデル（「<a href="#_2_12_5_コンフィギュレータの処理モデル">2.12.5 コンフィギュレータの処理モデル</a>」の節を参照）では，コンフィギュレータのパス2において定数式パラメータの値を知ることができるため，(B)〜(D)の区別をする必要がない．そのため，静的APIのパラメータは基本的には(b)とし，パス2で値を知ることのできない定数式パラメータのみを(c)としている．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_12_3_保護ドメインの指定"><a class="anchor" href="#_2_12_3_保護ドメインの指定"></a><a class="link" href="#_2_12_3_保護ドメインの指定">2.12.3 保護ドメインの指定</a></h4>
<div class="paragraph">
<p>保護機能対応カーネルでは，オブジェクトを登録する静的API等を，そのオブジェクトが属する保護ドメインの囲みの中に記述する【NGKI0459】．無所属のオブジェクトを登録する静的APIは，保護ドメインの囲みの外に記述する【NGKI0460】．保護ドメインに属すべきオブジェクトを登録する静的API等を，保護ドメインの囲みの外に記述した場合には，コンフィギュレータがE_RSATRエラーを報告する【NGKI0461】．</p>
</div>
<div class="paragraph">
<p>ユーザドメインの囲みの文法は次の通り【NGKI0462】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	DOMAIN(保護ドメイン名) {
		ユーザドメインに属するオブジェクトを登録する静的API等
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>保護ドメイン名には，ユーザドメインの名称を表す単一の識別名のみを記述することができる【NGKI0463】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，ユーザドメインの囲みを処理する際に，ユーザドメインに保護ドメインIDを割り付け，構成・初期化ヘッダファイルに，指定された保護ドメイン名を割り付けた保護ドメインIDにマクロ定義するC言語プリプロセッサのディレクティブ（#define）を生成する【NGKI0464】．また，ユーザドメインの囲みの中およびそれ以降に記述する静的APIの整数定数式パラメータの記述に保護ドメイン名を記述すると，割り付けた保護ドメインIDの値に評価される【NGKI0465】．</p>
</div>
<div class="paragraph">
<p>ユーザドメインの囲みの中を空にすることで，ユーザドメインへの保護ドメインIDの割付けのみを行うことができる【NGKI0466】．</p>
</div>
<div class="paragraph">
<p>カーネルドメインの囲みの文法は次の通り【NGKI0467】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	KERNEL_DOMAIN {
		カーネルドメインに属するオブジェクトを登録する静的API等
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>同じ保護ドメイン名を指定したユーザドメインの囲みや，カーネルドメインの囲みを，複数回記述してもよい【NGKI0468】．保護機能対応でないカーネルで保護ドメインの囲みを記述した場合や，保護ドメインの囲みの中に保護ドメインの囲みを記述した場合には，コンフィギュレータがエラーを報告する【NGKI0469】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>保護ドメインの囲みの文法を変更した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>保護ドメインに属すべきオブジェクトを登録する静的API等を保護ドメインの囲みの外に記述した場合のエラーコードをE_RSATRとしたのは，オブジェクトを動的に登録するAPIにおいては，オブジェクトの属する保護ドメインを，オブジェクト属性によって指定するためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_12_4_クラスの指定"><a class="anchor" href="#_2_12_4_クラスの指定"></a><a class="link" href="#_2_12_4_クラスの指定">2.12.4 クラスの指定</a></h4>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，オブジェクトを登録する静的API等を，そのオブジェクトが属するクラスの囲みの中に記述する【NGKI0470】．クラスに属すべきオブジェクトを登録する静的API等を，クラスの囲みの外に記述した場合には，コンフィギュレータがE_RSATRエラーを報告する【NGKI0471】．</p>
</div>
<div class="paragraph">
<p>クラスの囲みの文法は次の通り【NGKI0472】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CLASS(クラスID) {
		クラスに属するオブジェクトを登録する静的API等
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>クラスIDには，静的APIの整数定数式パラメータと同等の定数式を記述することができる【NGKI0473】．使用できないクラスIDを指定した場合には，コンフィギュレータがE_IDエラーを報告する【NGKI0474】．</p>
</div>
<div class="paragraph">
<p>同じクラスIDを指定したクラスの囲みを複数回記述してもよい【NGKI0475】．マルチプロセッサ対応でないカーネルでクラスの囲みを記述した場合や，クラスの囲みの中にクラスの囲みを記述した場合には，コンフィギュレータがエラーを報告する【NGKI0476】．</p>
</div>
<div class="paragraph">
<p>なお，保護機能とマルチプロセッサの両方に対応するカーネルでは，保護ドメインの囲みとクラスの囲みはどちらが外側になっていてもよい【NGKI0477】．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>クラスに属すべきオブジェクトを登録する静的API等をクラスの囲みの外に記述した場合のエラーコードをE_RSATRとしたのは，オブジェクトを動的に登録するAPIにおいては，オブジェクトの属するクラスを，オブジェクト属性によって指定するためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_12_5_コンフィギュレータの処理モデル"><a class="anchor" href="#_2_12_5_コンフィギュレータの処理モデル"></a><a class="link" href="#_2_12_5_コンフィギュレータの処理モデル">2.12.5 コンフィギュレータの処理モデル</a></h4>
<div class="paragraph">
<p>コンフィギュレータは，次の3つないしは4つのパスにより，システムコンフィギュレーションファイルを解釈し，構成・初期化情報を含むファイルなどを生成する（図2-10）．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-10.png" alt="figure2 10">
</div>
</div>
<div class="paragraph">
<p>最初のパス1では，システムコンフィギュレーションファイルを解釈し，そこに含まれる静的APIの整数定数式パラメータの値をCコンパイラを用いて求めるために，パラメータ計算用C言語ファイル（cfg1_out.c）を生成する．この時，システムコンフィギュレーションファイルに含まれるC言語プリプロセッサのインクルードディレクティブは，パラメータ計算用C言語ファイルの先頭に集めて生成する．また，条件ディレクティブは，順序も含めて，そのままの形でパラメータ計算用C言語ファイルに出力する．システムコンフィギュレーションファイルに文法エラーや未サポートの記述があった場合には，この段階で検出される．</p>
</div>
<div class="paragraph">
<p>次に，Cコンパイラおよび関連ツールを用いて，パラメータ計算用C言語ファイルをコンパイルし，ロードモジュールを生成する．また，それをSレコードフォーマットの形に変換したSレコードファイル（cfg1_out.srec）と，その中の各シンボルとアドレスの対応表を含むシンボルファイル（cfg1_out.syms）を生成する．静的APIの整数定数式パラメータに解釈できない式が記述された場合には，この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータのパス2では，パス1で生成されたロードモジュールのSレコードファイルとシンボルファイルから，C言語プリプロセッサの条件ディレクティブによりどの静的APIが有効となったかと，それらの静的APIの整数定数式パラメータの値を取り出し，カーネルおよびシステムサービスの構成・初期化ファイル（kernel_cfg.cなど）と構成・初期化ヘッダファイル（kernel_cfg.hなど）を生成する．構成・初期化ヘッダファイルには，登録できるオブジェクトの数（動的生成対応でないカーネルでは，静的APIによって登録されたオブジェクトの数に一致）やオブジェクトのID番号などの定義を出力する．静的APIの整数定数式パラメータに不正がある場合には，この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>パス2で生成されたファイルを，他のソースファイルとあわせてコンパイルし，アプリケーションのロードモジュールを生成する．また，そのSレコードファイル（system.srec）とシンボルファイル（system.syms）を生成する．静的APIの一般定数式パラメータに解釈できない式が記述された場合には，この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータのパス3では，パス1およびパス2で生成されたロードモジュールのSレコードファイルとシンボルファイルから，静的APIのパラメータの値などを取り出し，妥当性のチェックを行う．静的APIの一般定数式パラメータに不正がある場合には，この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルで自動メモリ配置の場合には，メモリ配置を決定し，メモリ保護のための設定情報を生成するために，さらに以下の処理を行う（図2-11）．</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="figures/figure2-11.png" alt="figure2 11">
</div>
</div>
<div class="paragraph">
<p>コンフィギュレータは，決定したメモリ配置に従ってロードモジュールを生成するために，リンカスクリプト（ldscript.ld）を生成する．また，メモリ保護のための設定情報を，メモリ構成・初期化ファイル（kernel_mem.c）に生成する．これらのファイルを生成するためには，パス3以降で初めて得られる情報が必要となるため，これらのファイルはパス3以降でしか生成できず，最終的なロードモジュールも，パス3以降で生成する．</p>
</div>
<div class="paragraph">
<p>そのため，パス2で生成されたロードモジュールは，仮のロードモジュールという位置付けになる．ここで，パス3以降で必要な情報を取り出し，最終的なロードモジュールのサイズを割り出せるように，パス3以降でメモリ構成・初期化ファイルに生成するのと同様のデータ構造を，パス2において仮のメモリ構成・初期化ファイル（kernel_mem2.c）に生成する．また，これをリンクするための仮のリンカスクリプト（cfg2_out.ld）を生成し，これらを用いて仮のロードモジュールを生成する．さらに，仮のロードモジュールのSレコードファイル（cfg2_out.srec）とシンボルファイル（cfg2_out.syms）も，最終的なものと混同しないように，異なるファイル名で生成する．</p>
</div>
<div class="paragraph">
<p>パス3は，ターゲット依存で用いるパスで，メモリ配置やメモリ保護のための設定情報のサイズを最適化するための処理を行う．パス2で生成された仮のロードモジュールのSレコードファイルとシンボルファイルから必要な情報を取り出し，再度，仮のメモリ構成・初期化ファイル（kernel_mem3.c）と仮のリンカスクリプト（cfg3_out.ld）を生成する．また，これらのファイルを他のソースファイルとあわせてコンパイルして仮のロードモジュールを生成し，そのSレコードファイル（cfg3_out.srec）とシンボルファイル（cfg3_out.syms）を生成する．この段階で，メモリオブジェクトに重なりがあるなどのエラーが検出される場合もある．</p>
</div>
<div class="paragraph">
<p>パス4では，パス3（パス3を用いない場合はパス2）で生成された仮のロードモジュールのSレコードファイルとシンボルファイルから必要な情報を取り出し，最終的なメモリ構成・初期化ファイル（kernel_mem.c）とリンカスクリプト（ldscript.ld）を生成する．またパス4では，保護機能対応でないカーネルにおいてパス3で行っていた静的APIパラメータの値などの妥当性のチェックも行う．そのため，静的APIの一般定数式パラメータに不正がある場合には，この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>パス4で生成されたファイルを，他のソースファイルとあわせてコンパイルし，アプリケーションの最終的なロードモジュールを生成する．また，そのSレコードファイル（system.srec，必要な場合のみ）とシンボルファイル（system.syms）を生成する．</p>
</div>
<div class="paragraph">
<p>最後に，最終的なロードモジュールが，パス3（パス3を用いない場合はパス2）で生成された仮のロードモジュールと同じメモリ配置であることをチェックする．両者のメモリ配置が異なっていた場合には，ロードモジュールが正しく生成されていない可能性があるが，これは，コンフィギュレーション処理の不具合を示すものである．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>コンフィギュレータの処理モデルは全面的に変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_12_6_静的apiのパラメータに関するエラー検出"><a class="anchor" href="#_2_12_6_静的apiのパラメータに関するエラー検出"></a><a class="link" href="#_2_12_6_静的apiのパラメータに関するエラー検出">2.12.6 静的APIのパラメータに関するエラー検出</a></h4>
<div class="paragraph">
<p>静的APIのパラメータに関するエラー検出は，同じものがサービスコールとして呼ばれた場合と同等とすることを原則とする【NGKI0478】．言い換えると，サービスコールによっても検出できないエラーは，静的APIにおいても検出しない．静的APIの機能説明中の「E_XXXXXエラーとなる」または「E_XXXXXエラーが返る」という記述は，コンフィギュレータがそのエラーを検出することを意味する．</p>
</div>
<div class="paragraph">
<p>ただし，エラーの種類によっては，サービスコールと同等のエラー検出を行うことが難しいため，そのようなものについては例外とする【NGKI0479】．例えば，メモリ不足をコンフィギュレータによって検出するのは容易ではない．</p>
</div>
<div class="paragraph">
<p>逆に，オブジェクト属性については，サービスコールより強力なエラーチェックを行える可能性がある．例えば，タスク属性にTA_STAと記述されている場合，サービスコールではエラーを検出できないが，コンフィギュレータでは検出できる可能性がある．ただし，このようなエラー検出を完全に行おうとするとコンフィギュレータが複雑になるため，このようなエラーを検出することは必須とせず，検出できた場合には警告メッセージを出力する【NGKI0480】．</p>
</div>
<div class="paragraph">
<p>なお，コンフィギュレータは，この仕様で警告メッセージを出力すると規定されている以外の状況でも，警告メッセージを出力する場合がある【NGKI0641】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，静的APIのパラメータに関するエラー検出について規定されていない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_12_7_オブジェクトのid番号の指定"><a class="anchor" href="#_2_12_7_オブジェクトのid番号の指定"></a><a class="link" href="#_2_12_7_オブジェクトのid番号の指定">2.12.7 オブジェクトのID番号の指定</a></h4>
<div class="paragraph">
<p>コンフィギュレータのオプション機能として，アプリケーション設計者がオブジェクトのID番号を指定するための次の機能を用意する．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータのオプション指定により，オブジェクト識別名とID番号の対応表を含むファイルを渡すと，コンフィギュレータはそれに従ってオブジェクトにID番号を割り付ける【NGKI0481】．それに従ったID番号割付けができない場合（ID番号に抜けができる場合など）には，コンフィギュレータはエラーを報告する【NGKI0482】．</p>
</div>
<div class="paragraph">
<p>またコンフィギュレータは，オプション指定により，オブジェクト識別名とコンフィギュレータが割り付けたID番号の対応表を含むファイルを，コンフィギュレータに渡すファイルと同じフォーマットで生成する【NGKI0483】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，オブジェクト生成のための静的APIのID番号を指定するパラメータに整数値を記述できるため，このような機能は用意されていない．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_13_toppersネーミングコンベンション"><a class="anchor" href="#_2_13_toppersネーミングコンベンション"></a><a class="link" href="#_2_13_toppersネーミングコンベンション">2.13 TOPPERSネーミングコンベンション</a></h3>
<div class="paragraph">
<p>この節では，TOPPERSソフトウェアのAPIの構成要素の名称に関するネーミングコンベンションについて述べる．このネーミングコンベンションは，モジュール間のインタフェースに関わる名称に適用することを想定しているが，モジュール内部の名称に適用してもよい．</p>
</div>
<div class="sect3">
<h4 id="_2_13_1_モジュール識別名"><a class="anchor" href="#_2_13_1_モジュール識別名"></a><a class="link" href="#_2_13_1_モジュール識別名">2.13.1 モジュール識別名</a></h4>
<div class="paragraph">
<p>異なるモジュールのAPIの構成要素の名称が衝突することを避けるために，各モジュールに対して，それを識別するためのモジュール識別名を定める．モジュール識別名は，英文字と数字で構成し，2〜8文字程度の長さとする．</p>
</div>
<div class="paragraph">
<p>カーネルのモジュール識別名は"kernel"，システムインタフェースレイヤのモジュール識別名は"sil"とする．</p>
</div>
<div class="paragraph">
<p>APIの構成要素の名称には，モジュール識別名を含めることを原則とするが，カーネルのAPIなど，頻繁に使用されて衝突のおそれが少ない場合には，モジュール識別名を含めない名称を使用する．</p>
</div>
<div class="paragraph">
<p>以下では，モジュール識別名の英文字を英小文字としたものをwww，英大文字としたものをWWWと表記する．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_13_2_データ型名"><a class="anchor" href="#_2_13_2_データ型名"></a><a class="link" href="#_2_13_2_データ型名">2.13.2 データ型名</a></h4>
<div class="paragraph">
<p>各サイズの整数型など，データの意味を定めない基本データ型の名称は，英小文字，数字，"_"で構成する．データ型であることを明示するために，末尾が"_t"である名称とする．</p>
</div>
<div class="paragraph">
<p>複合データ型やデータの意味を定めるデータ型の名称は，英大文字，数字，"<em>"で構成する．データ型であることを明示するために，先頭が"T</em>"または末尾が"_T"である名称とする場合もある．</p>
</div>
<div class="paragraph">
<p>データ型の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) パケットのデータ型</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_yyyに渡すパケットのデータ型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_DYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_yyyに渡すパケットのデータ型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_yyyに渡すパケットのデータ型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_WWW_CYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www_acre_yyyに渡すパケットのデータ型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_WWW_DYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www_def_yyyに渡すパケットのデータ型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_WWW_RYYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www_ref_yyyに渡すパケットのデータ型</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_2_13_3_関数名"><a class="anchor" href="#_2_13_3_関数名"></a><a class="link" href="#_2_13_3_関数名">2.13.3 関数名</a></h4>
<div class="paragraph">
<p>関数の名称は，英小文字，数字，"_"で構成する．</p>
</div>
<div class="paragraph">
<p>関数の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) サービスコール</p>
</div>
<div class="paragraph">
<p>サービスコールは，xxx_yyyまたはwww_xxx_yyyの名称とする．ここで，xxxは操作の方法，yyyは操作の対象を表す．xxx_yyyまたはwww_xxx_yyyから派生したサービスコールは，それぞれzxxx_yyyまたはwww_zxxx_yyyの名称とする．ここでzは，派生したことを表す文字である．派生したことを表す文字を2つ付加する場合には，zzxxx_yyyまたはwww_zzxxx_yyyの名称となる．</p>
</div>
<div class="paragraph">
<p>非タスクコンテキストから呼び出せるサービスコールは，サービスコールの名称に"i"を付加した，ixxx_yyy，izxxx_yyy，www_ixxx_yyy，www_izxxx_yyyといった名称で呼び出すこともできる【NGKI0562】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>サービスコールの名称を構成する省略名（xxx，yyy，z）の元になった英語については，「<a href="#_5_10_省略名の元になった英語">5.10 省略名の元になった英語</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，μITRON4.0/PX仕様との関係】</div>
<p>「<a href="#_2_5_2_タスクコンテキストと非タスクコンテキスト">2.5.2 タスクコンテキストと非タスクコンテキスト</a>」の節で述べた通り，非タスクコンテキストからもタスクコンテキストと同じ名称のサービスコールを呼び出すこととしたが，過去との互換性のために，"i"を付加した名称で呼び出すこともできるものとした．</p>
</div>
<div class="paragraph">
<p>(B) コールバック</p>
</div>
<div class="paragraph">
<p>コールバックの名称は，サービスコールのネーミングコンベンションに従う．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_13_4_変数名"><a class="anchor" href="#_2_13_4_変数名"></a><a class="link" href="#_2_13_4_変数名">2.13.4 変数名</a></h4>
<div class="paragraph">
<p>変数（const修飾子のついたものを含む）の名称は，英小文字，数字，"_"で構成する．データ型が異なる変数には，異なる名称を付けることを原則とする．</p>
</div>
<div class="paragraph">
<p>変数の名称に関して，次のガイドラインを設ける．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜ID（オブジェクトのID番号，ID型）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜番号（オブジェクト番号）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜atr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜属性（オブジェクト属性，ATR型）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜stat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜状態（オブジェクト状態，STAT型）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜モード（サービスコールの動作モード，MODE型）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜pri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜優先度（優先度，PRI型）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜sz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜サイズ（単位はバイト数，size_t型またはuint_t型）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜cnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の個数（単位は個数，uint_t型）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜ptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜tim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜時刻，〜時間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜cd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜コード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の初期値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">max〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の最大値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">min〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の最小値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の残り</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>また，ポインタ変数（関数ポインタを除く）の名称に関して，次のガイドラインを設ける．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pp_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポインタを入れる領域へのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パケットへのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ppk_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パケットへのポインタを入れる領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>変数の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) パケットへのポインタ</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cyyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_yyyに渡すパケットへのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_dyyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_yyyに渡すパケットへのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_ryyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_yyyに渡すパケットへのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_www_cyyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www_acre_yyyに渡すパケットへのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_www_dyyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www_def_yyyに渡すパケットへのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_www_ryyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www_ref_yyyに渡すパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_2_13_5_定数名"><a class="anchor" href="#_2_13_5_定数名"></a><a class="link" href="#_2_13_5_定数名">2.13.5 定数名</a></h4>
<div class="paragraph">
<p>定数（C言語プリプロセッサのマクロ定義によるもの）の名称は，英大文字，数字，"_"で構成する．</p>
</div>
<div class="paragraph">
<p>定数の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) メインエラーコード</p>
</div>
<div class="paragraph">
<p>メインエラーコードは，先頭が"E_"である名称とする．</p>
</div>
<div class="paragraph">
<p>(B) 機能コード</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFN_XXX_YYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx_yyyの機能コード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFN_WWW_XXX_YYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www_xxx_yyyの機能コード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(C) その他の定数</p>
</div>
<div class="paragraph">
<p>その他の定数は，先頭がTUU_またはTUU_WWW_である名称とする．ここでUUは，定数の種類またはデータ型を表す．同じパラメータまたはリターンパラメータに用いられる定数の名称については，UUを同一にすることを原則とする．</p>
</div>
<div class="paragraph">
<p>また，定数の名称に関して，次のガイドラインを設ける．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトの属性値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜のサイズ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBIT_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜のビット数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の最大値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の最小値</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_2_13_6_マクロ名"><a class="anchor" href="#_2_13_6_マクロ名"></a><a class="link" href="#_2_13_6_マクロ名">2.13.6 マクロ名</a></h4>
<div class="paragraph">
<p>マクロ（C言語プリプロセッサのマクロ定義によるもの）の名称は，それが表す構成要素のネーミングコンベンションに従う．すなわち，関数を表すマクロは関数のネーミングコンベンションに，定数を表すマクロは定数のネーミングコンベンションに従う．ただし，簡単な関数を表すマクロや，副作用があるなどの理由でマクロであることを明示したい場合には，英大文字，数字，"_"で構成する場合もある．</p>
</div>
<div class="paragraph">
<p>マクロの種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) 構成マクロ</p>
</div>
<div class="paragraph">
<p>構成マクロの名称は，英大文字，数字，"_"で構成し，次のガイドラインを設ける．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜のサイズ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBIT_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜のビット数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の最大値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_〜</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">〜の最小値</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_2_13_7_静的api名"><a class="anchor" href="#_2_13_7_静的api名"></a><a class="link" href="#_2_13_7_静的api名">2.13.7 静的API名</a></h4>
<div class="paragraph">
<p>静的APIの名称は，英大文字，数字，"_"で構成し，対応するサービスコールの名称中の英小文字を英大文字で置き換えたものとする．対応するサービスコールがない場合には，サービスコールのネーミングコンベンションに従って定めた名称中の英小文字を英大文字で置き換えたものとする．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_13_8_ファイル名"><a class="anchor" href="#_2_13_8_ファイル名"></a><a class="link" href="#_2_13_8_ファイル名">2.13.8 ファイル名</a></h4>
<div class="paragraph">
<p>ファイルの名称は，英小文字，数字，"_"，"."で構成する．英大文字と英小文字を区別しないファイルシステムに対応するために，英大文字は使用しない．また，"-"も使用しない．</p>
</div>
<div class="paragraph">
<p>ファイルの種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) ヘッダファイル</p>
</div>
<div class="paragraph">
<p>モジュールを用いるために必要な定義を含むヘッダファイルは，そのモジュールのモジュール識別名の末尾に".h"を付加した名前（すなわち，www.h）とする．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_13_9_モジュール内部の名称の衝突回避"><a class="anchor" href="#_2_13_9_モジュール内部の名称の衝突回避"></a><a class="link" href="#_2_13_9_モジュール内部の名称の衝突回避">2.13.9 モジュール内部の名称の衝突回避</a></h4>
<div class="paragraph">
<p>モジュール内部の名称が，他のモジュール内部の名称と衝突することを避けるために，次のガイドラインを設ける．</p>
</div>
<div class="paragraph">
<p>モジュール内部に閉じて使われる関数や変数などの名称で，オブジェクトファイルのシンボル表に登録されて外部から参照できる名称は，C言語レベルで，先頭が_www_または_WWW_である名称とする．例えば，カーネルの内部シンボルは，C言語レベルで，先頭が"<em>kernel</em>"または"<em>KERNEL</em>"である名称とする．</p>
</div>
<div class="paragraph">
<p>また，モジュールを用いるために必要な定義を含むヘッダファイル中に用いる名称で，それをインクルードする他のモジュールで使用する名称と衝突する可能性のある名称は，"TOPPERS_"で始まる名称とする．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_14_toppers共通定義"><a class="anchor" href="#_2_14_toppers共通定義"></a><a class="link" href="#_2_14_toppers共通定義">2.14 TOPPERS共通定義</a></h3>
<div class="paragraph">
<p>TOPPERSソフトウェアに共通に用いる定義を，TOPPERS共通定義と呼ぶ．</p>
</div>
<div class="sect3">
<h4 id="_2_14_1_toppers共通ヘッダファイル"><a class="anchor" href="#_2_14_1_toppers共通ヘッダファイル"></a><a class="link" href="#_2_14_1_toppers共通ヘッダファイル">2.14.1 TOPPERS共通ヘッダファイル</a></h4>
<div class="paragraph">
<p>TOPPERS共通定義（共通データ型，共通定数，共通マクロ）は，TOPPERS共通ヘッダファイル（t_stddef.h）およびそこからインクルードされるファイルに含まれている【NGKI0484】．TOPPERS共通定義を用いる場合には，TOPPERS共通ヘッダファイルをインクルードする【NGKI0485】．</p>
</div>
<div class="paragraph">
<p>TOPPERS共通ヘッダファイルは，カーネルヘッダファイル（kernel.h）やシステムインタフェースレイヤヘッダファイル（sil.h）からインクルードされるため，これらのファイルをインクルードする場合には，TOPPERS共通ヘッダファイルを直接インクルードする必要はない【NGKI0486】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_14_2_toppers共通データ型"><a class="anchor" href="#_2_14_2_toppers共通データ型"></a><a class="link" href="#_2_14_2_toppers共通データ型">2.14.2 TOPPERS共通データ型</a></h4>
<div class="paragraph">
<p>C90に規定されているデータ型以外で，TOPPERSソフトウェアで共通に用いるデータ型は次の通りである（一部，C90に規定されているものも含む）【NGKI0542】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き8ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し8ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き16ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し16ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き32ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し32ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き64ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し64ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き128ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint128_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し128ビット整数（オプション，C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8ビット以上の符号付き整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_least8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_t型と同じサイズの符号無し整数（C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float32_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE754準拠の32ビット単精度浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double64_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE754準拠の64ビット倍精度浮動小数点数（オプション）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">真偽値（trueまたはfalse）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16ビット以上の符号付き整数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_t型と同じサイズの符号無し整数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32ビット以上かつint_t型以上のサイズの符号付き整数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_t型と同じサイズの符号無し整数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ領域のサイズを表す符号無し整数（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポインタを格納できるサイズの符号付き整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uintptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t型と同じサイズの符号無し整数（C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機能コード（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトのID番号（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト属性（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトの状態（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコールの動作モード（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト指定（符号無し32ビット整数，単位はマイクロ秒，uint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">相対時間（符号無し32ビット整数，単位はマイクロ秒，uint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SYSTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻（符号無し整数，単位はマイクロ秒，uint64_tまたはuint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRCTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロセッサ時間（符号無し整数，単位はマイクロ秒，uint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高分解能タイマのカウント値（符号無し整数，uint32_tまたはuint64_tに定義）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プログラムの起動番地（型の定まらない関数ポインタ）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_BOOL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードまたは真偽値（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードまたはID番号（符号付き整数，int_tに定義，負のID番号は格納できない）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_UINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードまたは符号無し整数（符号付き整数，int_tに定義，符号無し整数を格納する場合の有効ビット数はuint_tより1ビット短い）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MB_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト管理領域を確保するためのデータ型</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可パターン（符号無し32ビット整数，uint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ここで，データ型が「AまたはB」とは，AかBのいずれかの値を取ることを示す．例えばER_BOOLは，エラーコードまたは真偽値のいずれかの値を取る．</p>
</div>
<div class="paragraph">
<p>int8_t，uint8_t，int64_t，uint64_t，int128_t，uint128_t，float32_t，double64_tが使用できるかどうかは，ターゲット定義である【NGKI0488】．これらが使用できるかどうかは，それぞれ，INT8_MAX，UINT8_MAX，INT64_MAX，UINT64_MAX，INT128_MAX，UINT128_MAX，FLOAT32_MAX，DOUBLE64_MAXがマクロ定義されているかどうかで判別することができる【NGKI0489】．IEEE754準拠の浮動小数点数がサポートされていない場合には，ターゲット定義で，float32_tとdouble64_tは使用できないものとする【NGKI0490】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>B，UB，H，UH，W，UW，D，UD，VP_INTに代えて，C99準拠のint8_t，uint8_t，int16_t，uint16_t，int32_t，uint32_t，int64_t，uint64_t，intptr_tを用いることにした．また，uintptr_t，int128_t，uint128_tを用意することにした．</p>
</div>
<div class="paragraph">
<p>メモリ領域のサイズを表すデータ型として，SIZEに代えて，C90準拠のsize_tを用いることにした．</p>
</div>
<div class="paragraph">
<p>データタイプが定まらないものへのポインタを表すデータ型であるVPは，void*と等価であるため，用意しないことにした．また，ターゲットシステムにより振舞いが一定しないことから，VB，VH，VW，VDに代わるデータ型は用意しないことにした．</p>
</div>
<div class="paragraph">
<p>INT，UINTに代えて，C99の型名と相性が良いint_t，uint_tを用いることにした．また，32ビット以上かつint_t型（またはuint_t型）以上のサイズが保証される整数型として，long_t，ulong_tを用意し，8ビット以上のサイズで必ず存在する整数型として，C99準拠のint_least8_t，uint_least8_tを導入することにした．int_least16_t，uint_least16_t，int_least32_t，uint_least32_tを導入しなかったのは，16ビットおよび32ビットの整数型があることを仮定しており，それぞれint16_t，uint16_t，int32_t，uint32_tで代用できるためである．</p>
</div>
<div class="paragraph">
<p>TECSとの整合性を取るために，BOOLに代えて，bool_tを用いることにした．また，IEEE754準拠の単精度浮動小数点数を表す型としてfloat32_t，IEEE754準拠の倍精度浮動小数点数を表す型としてdouble64_tを導入した．</p>
</div>
<div class="paragraph">
<p>高分解能タイマのカウント値のデータ型としてHRTCNTを，オブジェクト管理領域を確保するためのデータ型としてMB_Tを用意することにした．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>メモリ領域のサイズを表すデータ型として，SIZEに代えて，C90準拠のsize_tを用いることにした．</p>
</div>
<div class="paragraph">
<p>性能評価用システム時刻のためのデータ型であるSYSUTMを廃止し，高分解能タイマのカウント値のデータ型であるHRTCNTを追加した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_14_3_toppers共通定数"><a class="anchor" href="#_2_14_3_toppers共通定数"></a><a class="link" href="#_2_14_3_toppers共通定数">2.14.3 TOPPERS共通定数</a></h4>
<div class="paragraph">
<p>C90に規定されている定数以外で，TOPPERSソフトウェアで共通に用いる定数は次の通りである（一部，C90に規定されているものも含む）．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) 一般定数【NGKI0491】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効ポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">真</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">偽</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>BOOLをbool_tに代えたことから，TRUEおよびFALSEに代えて，trueおよびfalseを用いることにした．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 整数型に格納できる最大値と最小値【NGKI0492】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT8_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8_tに格納できる最小値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint8_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT16_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT16_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_tに格納できる最小値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT16_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT32_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_tに格納できる最小値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT64_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT64_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_tに格納できる最小値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT64_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT128_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT128_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_tに格納できる最小値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT128_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint128_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_LEAST8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_LEAST8_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_tに格納できる最小値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT_LEAST8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_least8_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_tに格納できる最小値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONG_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONG_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_tに格納できる最小値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ULONG_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIZE_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_tに格納できる最大値（C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOAT32_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float32_tに格納できる最小の正規化された正の浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOAT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float32_tに格納できる表現可能な最大の有限浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE64_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double64_tに格納できる最小の正規化された正の浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE64_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double64_tに格納できる表現可能な最大の有限浮動小数点数（オプション）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) 整数型のビット数【NGKI0493】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char型のビット数（C90準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(4) オブジェクト属性【NGKI0494】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト属性を指定しない</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(5) タイムアウト指定【NGKI0555】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 22.8571%;">
<col style="width: 54.2859%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO_POL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO_FEVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">永久待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO_NBLK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_MAX-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ノンブロッキング</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) アクセス許可パターン【NGKI0496】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TACP_KERNEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルドメインのみにアクセスを許可</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TACP_SHARED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての保護ドメインにアクセスを許可</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_2_14_4_toppers共通エラーコード"><a class="anchor" href="#_2_14_4_toppers共通エラーコード"></a><a class="link" href="#_2_14_4_toppers共通エラーコード">2.14.4 TOPPERS共通エラーコード</a></h4>
<div class="paragraph">
<p>TOPPERSソフトウェアで共通に用いるメインエラーコードは次の通りである【NGKI0540】．</p>
</div>
<div class="paragraph">
<p>(A) 内部エラークラス（EC_SYS，-5〜-8）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_SYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムエラー</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(B) 未サポートエラークラス（EC_NOSPT，-9〜-16）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSFN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約機能コード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(C) パラメータエラークラス（EC_PAR，-17〜-24）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(D) 呼出しコンテキストエラークラス（EC_CTX，-25〜-32）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(E) 資源不足エラークラス（EC_NOMEM，-33〜-40）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-33</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-34</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NORES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">資源不足</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(F) オブジェクト状態エラークラス（EC_OBJ，-41〜-48）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-42</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_QOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングオーバフロー</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(G) 待ち解除エラークラス（EC_RLWAI，-49〜-56）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-49</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-51</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-52</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの状態変化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(H) 警告クラス（EC_WARN，-57〜-64）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_WBLK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-57</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ノンブロッキング受付け</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_BOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バッファオーバフロー</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>このエラークラスに属するエラーコードは，警告を表すエラーコードであり，［NGKI0019］の原則では例外としている．</p>
</div>
<div class="paragraph">
<p>(I) 通信エラークラス（EC_COMM，-65〜-72）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_COMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通信エラー</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>このエラークラスに属するエラーコードは，通信エラー表すエラーコードであり，［NGKI0019］の原則では例外としている．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>通信エラークラスは，μITRON4.0仕様に規定されていないエラークラスである．E_NORES，E_RASTER，E_COMMは，μITRON4.0仕様に規定されていないエラーコードである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>通信エラークラスは，TOPPERS新世代カーネル統合仕様に規定されていないエラークラスである．E_RASTERとE_COMMは，TOPPERS新世代カーネル統合仕様に規定されていないエラーコードである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_14_5_toppers共通マクロ"><a class="anchor" href="#_2_14_5_toppers共通マクロ"></a><a class="link" href="#_2_14_5_toppers共通マクロ">2.14.5 TOPPERS共通マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) 整数定数を作るマクロ【NGKI0498】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT8_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT8_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_least8_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT16_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT16_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT32_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT64_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT64_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT128_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT128_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint128_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t型の定数を作るマクロ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ULONG_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong_t型の定数を作るマクロ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>C99に用意されていないUINT_CとULONG_Cを導入したのは，アセンブリ言語からも参照する定数を記述するためである．C言語のみで用いる定数をこれらのマクロを使って記述する必要はない．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 型に関する情報を取り出すためのマクロ【NGKI0499】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offsetof(structure, field)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">構造体structure中のフィールドfieldのバイト位置を返すマクロ（C90準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alignof(type)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">型typeのアラインメント単位を返すマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALIGN_TYPE(addr, type)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">番地addrが型typeに対してアラインしているかどうかを返すマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) assertマクロ【NGKI0500】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assert(exp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">expが成立しているかを検査するマクロ（C90準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(4) コンパイラの拡張機能のためのマクロ【NGKI0501】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インライン関数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルローカルなインライン関数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インラインアセンブラ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インラインアセンブラ（最適化抑止）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">throw()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">例外を発生しない関数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NoReturn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターンしない関数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(5) エラーコード構成・分解マクロ【NGKI0502】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERCD(mercd, sercd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メインエラーコードmercdとサブエラーコードsercdから，エラーコードを構成するためのマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MERCD(ercd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードercdからメインエラーコードを抽出するためのマクロ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERCD(ercd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードercdからサブエラーコードを抽出するためのマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) アクセス許可パターン構成マクロ【NGKI0503】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TACP(domid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domidで指定されるユーザドメインのみにアクセスを許可するアクセス許可パターンを構成するためのマクロ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ここで，TACPのパラメータ（domid）には，ユーザドメインのID番号のみを指定することができる【NGKI0504】．TDOM_SELF，TDOM_KERNEL，TDOM_NONEを指定した場合，どのようなアクセス許可パターンが構成されるかは保証されない【NGKI0505】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0仕様では，エラーコード構成・分解マクロ（ERCD，MERCD，SERCD）のみが定義されており，μITRON4.0/PX仕様で，アクセス許可パターン構成マクロ（TACP）が追加定義されている．他は追加したものである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_14_6_toppers共通構成マクロ"><a class="anchor" href="#_2_14_6_toppers共通構成マクロ"></a><a class="link" href="#_2_14_6_toppers共通構成マクロ">2.14.6 TOPPERS共通構成マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) 相対時間の範囲【NGKI0557】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">相対時間に指定できる最大値（＝4,000,000,000）</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_2_15_カーネル共通定義"><a class="anchor" href="#_2_15_カーネル共通定義"></a><a class="link" href="#_2_15_カーネル共通定義">2.15 カーネル共通定義</a></h3>
<div class="paragraph">
<p>カーネルの複数の機能で共通に用いる定義を，カーネル共通定義と呼ぶ．</p>
</div>
<div class="sect3">
<h4 id="_2_15_1_カーネルヘッダファイル"><a class="anchor" href="#_2_15_1_カーネルヘッダファイル"></a><a class="link" href="#_2_15_1_カーネルヘッダファイル">2.15.1 カーネルヘッダファイル</a></h4>
<div class="paragraph">
<p>カーネルを用いるために必要な定義は，カーネルヘッダファイル（kernel.h）およびそこからインクルードされるファイルに含まれている【NGKI0507】．カーネルを用いる場合には，カーネルヘッダファイルをインクルードする【NGKI0508】．</p>
</div>
<div class="paragraph">
<p>ただし，カーネルを用いるために必要な定義の中で，コンフィギュレータによって生成されるものは，カーネル構成・初期化ヘッダファイル（kernel_cfg.h）に含まれる【NGKI0509】．具体的には，登録できるオブジェクトの数（TNUM_YYY）やオブジェクトのID番号などの定義が，これに該当する．これらの定義を用いる場合には，カーネル構成・初期化ヘッダファイルをインクルードする【NGKI0510】．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様で規定されており，この仕様で廃止されたデータ型および定数を用いる場合には，ITRON仕様互換ヘッダファイル（itron.h）をインクルードする【NGKI0511】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>この仕様では，コンフィギュレータが生成するヘッダファイルに，オブジェクトのID番号の定義に加えて，登録できるオブジェクトの数（TNUM_YYY）の定義が含まれることとした．これに伴い，ヘッダファイルの名称を，μITRON4.0仕様の自動割付け結果ヘッダファイル（kernel_id.h）から，カーネル構成・初期化ヘッダファイル（kernel_cfg.h）に変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_15_2_カーネル共通定数"><a class="anchor" href="#_2_15_2_カーネル共通定数"></a><a class="link" href="#_2_15_2_カーネル共通定数">2.15.2 カーネル共通定数</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) オブジェクト属性【NGKI0512】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの待ち行列をタスクの優先度順に</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>値が0のオブジェクト属性（TA_HLNG，TA_TFIFO，TA_WSGL）は，デフォルトの扱いにして廃止した．これは，「(tskatr &amp; TA_HLNG) != 0U」のような間違いを防ぐためである．TA_ASMは，有効な使途がないために廃止した．メールボックス機能を廃止したため，TA_MPRIとTA_MFIFOは廃止した．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 保護ドメインID【NGKI0513】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDOM_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">呼び出した処理単位が属する保護ドメイン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDOM_KERNEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルドメイン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDOM_NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無所属（保護ドメインに属さない）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) その他のカーネル共通定数【NGKI0514】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSOM_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム周期の停止</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCLS_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自タスクの属するクラス</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRC_NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付けプロセッサの指定がない</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRC_INI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期割付けプロセッサ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSK_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自タスク指定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSK_NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">該当するタスクがない</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRI_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自タスクのベース優先度の指定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRI_INI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動時優先度の指定</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIPM_ENAALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度マスク全解除</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(4) カーネルで用いるメインエラーコード</div>
<p>「<a href="#_2_14_4_toppers共通エラーコード">2.14.4 TOPPERS共通エラーコード</a>」の節で定義したメインエラーコードの中で，E_CLS，E_WBLK，E_BOVR，E_COMMの4つは，カーネルでは使用しない【NGKI0541】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，サービスコールから，E_RSFN，E_RSATR，E_MACV，E_OACV，E_NOMEM，E_NOID，E_NORES，E_NOEXSが返る状況は起こらない【ASPS0011】．E_RSATRは，コンフィギュレータによって検出される【ASPS0012】．ただし，動的生成機能拡張パッケージでは，サービスコールから，E_RSATR，E_NOMEM，E_NOID，E_NOEXSが返る状況が起こる【ASPS0013】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，サービスコールから，E_RSFN，E_RSATR，E_MACV，E_OACV，E_NOMEM，E_NOID，E_NORES，E_NOEXSが返る状況は起こらない【FMPS0007】．E_RSATRとE_NORESは，コンフィギュレータによって検出される【FMPS0008】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，サービスコールから，E_RSATR，E_NOID，E_NORESが返る状況は起こらない【HRPS0006】．E_RSATRは，コンフィギュレータによって検出される【HRPS0007】．ただし，動的生成機能拡張パッケージでは，サービスコールから，E_RSATR，E_NOIDが返る状況が起こる【HRPS0011】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，サービスコールから，E_RSATR，E_NOID，E_NORESが返る状況は起こらない【HRMPS0008】．E_RSATRとE_NORESは，コンフィギュレータによって検出される【HRMPS0009】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，サービスコールから，E_RSFN，E_RSATR，E_MACV，E_OACV，E_ILUSE，E_NOMEM，E_NOID，E_NORES，E_NOEXS，E_RLWAI，E_TMOUT，E_DLTが返る状況は起こらない【SSPS0008】．E_RSATRは，コンフィギュレータによって検出される【SSPS0009】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_15_3_カーネル共通マクロ"><a class="anchor" href="#_2_15_3_カーネル共通マクロ"></a><a class="link" href="#_2_15_3_カーネル共通マクロ">2.15.3 カーネル共通マクロ</a></h4>
<div class="paragraph">
<div class="title">(1) スタック領域をアプリケーションで確保するためのデータ型とマクロ</div>
<p>スタック領域をアプリケーションで確保するために，次のデータ型とマクロを用意している【NGKI0516】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STK_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スタック領域を確保するためのデータ型</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT_STK_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズszのスタック領域を確保するために必要なSTK_T型の配列の要素数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROUND_STK_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要素数COUNT_STK_T(sz)のSTK_T型の配列のサイズ（szを，STK_T型のサイズの倍数になるように大きい方に丸めた値）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらを用いて，サイズszのスタック領域を確保する方法は次の通り【NGKI0517】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	STK_T	&lt;スタック領域の変数名&gt;[COUNT_STK_T(sz)];</code></pre>
</div>
</div>
<div class="paragraph">
<p>この方法で確保したスタック領域を，サービスコールまたは静的APIに渡す場合，スタック領域のサイズにはROUND_STK_T(sz)を，スタック領域の先頭番地には&lt;スタック領域の変数名&gt;を指定する【NGKI0518】．</p>
</div>
<div class="paragraph">
<p>ただし，保護機能対応カーネルにおいては，上の方法によりタスクのユーザスタック領域を確保することはできない【NGKI0519】．詳しくは，「<a href="#_4_1_タスク管理機能">4.1 タスク管理機能</a>」の節のCRE_TSKの機能の項を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">(2) オブジェクト属性を作るマクロ</div>
<p>保護機能対応カーネルでは，オブジェクトが属する保護ドメインを指定するためのオブジェクト属性を作るマクロとして，次のマクロを用意している【NGKI0520】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DOM(domid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domidで指定される保護ドメインに属する</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，オブジェクトが属するクラスを指定するためのオブジェクト属性を作るマクロとして，次のマクロを用意している【NGKI0521】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_CLS(clsid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clsidで指定されるクラスに属する</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(3) サービスコールの呼出し方法を指定するマクロ</div>
<p>保護機能対応カーネルでは，サービスコールの呼出し方法を指定するためのマクロとして，次のマクロを用意している【NGKI0522】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVC_CALL(svc)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">svcで指定されるサービスコールを関数呼出しによって呼び出すための名称</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(4) スケジューリング単位番号を構成するマクロ</div>
<p>保護機能とマルチプロセッサのいずれかまたは両方に対応するカーネルでは，スケジューリング単位番号を構成するためのマクロとして，次のマクロを用意している【NGKI0634】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCHEDNO(prcid, domid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マルチプロセッサ対応カーネルにおけるスケジューリング単位番号prcidと，保護機能対応カーネルにおけるスケジューリング単位番号domidから，保護機能とマルチプロセッサの両方に対応するカーネルにおけるスケジューリング単位番号を構成するためのマクロ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>スケジューリング単位番号を構成するマクロ（SCHEDNO）を追加した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_2_15_4_カーネル共通構成マクロ"><a class="anchor" href="#_2_15_4_カーネル共通構成マクロ"></a><a class="link" href="#_2_15_4_カーネル共通構成マクロ">2.15.4 カーネル共通構成マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) サポートする機能【NGKI0523】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 45.7142%;">
<col style="width: 48.5716%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_PROTECT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保護機能対応のカーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_MULTI_PRC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マルチプロセッサ対応のカーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_DYNAMIC_CRE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">動的生成対応のカーネル</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 優先度の範囲【NGKI0524】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク優先度の最小値（＝1）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク優先度の最大値</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている【ASPS0014】．ただし，タスク優先度拡張パッケージを用いると，TMAX_TPRIを256に拡張することができる【ASPS0015】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている【FMPS0009】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている【HRPS0008】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている【HRMPS0010】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている【SSPS0010】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>メールボックス機能を廃止したため，メッセージ優先度の最小値（TMIN_MPRI）と最大値（TMAX_MPRI）は廃止した．</p>
</div>
<div class="paragraph">
<div class="title">(3) プロセッサの数</div>
<p>マルチプロセッサ対応カーネルでは，プロセッサの数を知るためのマクロとして，次の構成マクロを用意している【NGKI0525】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_PRCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロセッサの数</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(4) 特殊な役割を持ったプロセッサ</div>
<p>マルチプロセッサ対応カーネルでは，特殊な役割を持ったプロセッサを知るためのマクロとして，次の構成マクロを用意している【NGKI0526】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_MASTER_PRCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マスタプロセッサのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_TEPP_PRC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムイベント処理プロセッサのリスト</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ここでTOPPERS_TEPP_PRCは，タイムイベント処理プロセッサのリストをビットマップとして表す符号無し整数型の数値で，プロセッサIDがNのプロセッサがタイムイベント処理プロセッサである場合に下位からN番目のビットが1，そうでない場合には下位からN番目のビットが0となっている．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，すべてのプロセッサがタイムイベント処理プロセッサであるため，TOPPERS_TEPP_PRCは用意していない【HRMPS0012】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS_SYSTIM_PRCID（システム時刻管理プロセッサのID番号），TOPPERS_SYSTIM_LOCAL（ローカルタイマ方式），TOPPERS_SYSTIM_GLOBAL（グローバルタイマ方式）を廃止した．</p>
</div>
<div class="paragraph">
<div class="title">(5) メモリ配置の方法</div>
<p>保護機能対応カーネルでは，自動メモリ配置と手動メモリ配置のどちらが使われているかを知るためのマクロとして，次の構成マクロを用意している【NGKI0607】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_ML_AUTO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自動メモリ配置の場合にマクロ定義</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_ML_MANUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">手動メモリ配置の場合にマクロ定義</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) バージョン情報【NGKI0528】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_MAKER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルのメーカコード（＝0x0118）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_PRID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルの識別番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_SPVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネル仕様のバージョン番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_PRVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルのバージョン番号</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>カーネルのメーカコード（TKERNEL_MAKER）は，TOPPERSプロジェクトから配布するカーネルでは，TOPPERSプロジェクトを表す値（0x0118）に設定されている．</p>
</div>
<div class="paragraph">
<p>カーネルの識別番号（TKERNEL_PRID）は，TOPPERSカーネルの種類を表す．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/JSPカーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約（IIMPカーネル）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約（IDLカーネル）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/FI4カーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/FDMPカーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/HRPカーネル（TOPPERS/HRP2カーネル，TOPPERS/HRP3カーネルを含む）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/ASPカーネル（TOPPERS/ASP3カーネルを含む）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/FMPカーネル（TOPPERS/FMP3カーネルを含む）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/SSPカーネル（TOPPERS/SSP3カーネルを含む）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x000a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS/ASP Safetyカーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x000b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPRES/HRMPカーネル（TOPPERS/HRMP3カーネル）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>カーネル仕様のバージョン番号（TKERNEL_SPVER）は，上位8ビット（0xf6）がTOPPERS第3世代カーネル（ITRON系）仕様であることを，中位4ビットがメジャーバージョン番号，下位4ビットがマイナーバージョン番号を表す．</p>
</div>
<div class="paragraph">
<p>カーネルのバージョン番号（TKERNEL_PRVER）は，上位4ビットがメジャーバージョン番号，中位8ビットがマイナーバージョン番号，下位4ビットがパッチレベルを表す．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_第３章_システムインタフェースレイヤapi仕様"><a class="anchor" href="#_第３章_システムインタフェースレイヤapi仕様"></a><a class="link" href="#_第３章_システムインタフェースレイヤapi仕様">第３章 システムインタフェースレイヤAPI仕様</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_3_1_システムインタフェースレイヤの概要"><a class="anchor" href="#_3_1_システムインタフェースレイヤの概要"></a><a class="link" href="#_3_1_システムインタフェースレイヤの概要">3.1 システムインタフェースレイヤの概要</a></h3>
<div class="paragraph">
<p>システムインタフェースレイヤ（この章では，SILと略記する）は，デバイスを直接操作するプログラムが用いるための機能である．ITRONデバイスドライバ設計ガイドラインの一部分として検討されたものをベースに，TOPPERSプロジェクトにおいて修正を加えて用いている．</p>
</div>
<div class="paragraph">
<p>SILの機能は，プロセッサの特権モードで実行されているプログラムが使用することを想定している【NGKI0801】．非特権モードで実行されているプログラムからSILの機能を呼び出した場合の動作は，次の例外を除いては保証されない【NGKI0802】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>エンディアンの取得のためのマクロを参照すること</p>
</li>
<li>
<p>メモリ空間アクセス関数により，アクセスを許可されたメモリ領域にアクセスすること</p>
</li>
<li>
<p>I/O空間アクセス関数により，アクセスを許可されたI/O領域にアクセスすること</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，システムインタフェースレイヤAPI仕様は規定されていなかった．</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_2_silヘッダファイル"><a class="anchor" href="#_3_2_silヘッダファイル"></a><a class="link" href="#_3_2_silヘッダファイル">3.2 SILヘッダファイル</a></h3>
<div class="paragraph">
<p>SILを用いるために必要な定義は，SILヘッダファイル（sil.h）およびそこからインクルードされるファイルに含まれている【NGKI0803】．SILを用いる場合には，SILヘッダファイルをインクルードする【NGKI0804】．</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_3_全割込みロック状態の制御"><a class="anchor" href="#_3_3_全割込みロック状態の制御"></a><a class="link" href="#_3_3_全割込みロック状態の制御">3.3 全割込みロック状態の制御</a></h3>
<div class="paragraph">
<p>デバイスを扱うプログラムの中では，すべての割込み（NMIを除く，以下同じ）をマスクしたい場合がある．カーネルで制御できるCPUロック状態は，カーネル管理外の割込み（NMI以外にカーネル管理外の割込みがあるかはターゲット定義）をマスクしないため，このような場合に用いることはできない．</p>
</div>
<div class="paragraph">
<p>そこで，SILでは，すべての割込みをマスクする全割込みロック状態を制御するための以下の機能を用意している．</p>
</div>
<div class="paragraph">
<div class="title">(1) SIL_PRE_LOC</div>
<p>全割込みロック状態の制御に必要な変数を宣言するマクロ【NGKI0805】．通常は，型と変数名を並べたもので，最後に";"を含まない．</p>
</div>
<div class="paragraph">
<p>このマクロは，SIL_LOC_INT，SIL_UNL_INTを用いる関数またはブロックの先頭の変数宣言部に記述しなければならない【NGKI0806】．SIL_LOC_INT，SIL_UNL_INTを1つの関数内でネストして用いることは可能であるが，その場合には，ネストレベル毎にブロックを作り，そのブロックの先頭の変数宣言部にSIL_PRE_LOCを記述しなければならない【NGKI0807】．そのように記述しなかった場合の動作は保証されない【NGKI0808】．</p>
</div>
<div class="paragraph">
<div class="title">(2) SIL_LOC_INT()</div>
<p>全割込みロックフラグをセットすることで，NMIを除くすべての割込みをマスクし，全割込みロック状態に遷移する【NGKI0809】．</p>
</div>
<div class="paragraph">
<div class="title">(3) SIL_UNL_INT()</div>
<p>全割込みロックフラグを，対応するSIL_LOC_INTを実行する前の状態に戻す【NGKI0810】．SIL_LOC_INTを実行せずにSIL_UNL_INTを呼び出した場合の動作は保証されない【NGKI0811】．</p>
</div>
<div class="paragraph">
<p>なお，全割込みロック状態で呼び出せるサービスコールなどの制限事項については，「<a href="#_2_5_4_全割込みロック状態と全割込みロック解除状態">2.5.4 全割込みロック状態と全割込みロック解除状態</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>全割込みロック状態の制御機能の使用例は次の通り．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	{
		SIL_PRE_LOC;

		SIL_LOC_INT();
		// この間はNMIを除くすべての割込みがマスクされる．
		// この間にサービスコールを呼び出してはならない（一部例外あり）．
		SIL_UNL_INT();
	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_4_silスピンロック"><a class="anchor" href="#_3_4_silスピンロック"></a><a class="link" href="#_3_4_silスピンロック">3.4 SILスピンロック</a></h3>
<div class="paragraph">
<p>マルチプロセッサシステムにおいて，カーネルの機能を用いずに，他のプロセッサとの間でも排他制御を実現したい場合がある．そこでSILでは，割込みのマスクとプロセッサ間ロックの取得により排他制御を行うためのスピンロックの機能を用意している．これを，カーネルのスピンロック機能と区別するために，SILスピンロックと呼ぶ．</p>
</div>
<div class="paragraph">
<p>SILスピンロックで用いるプロセッサ間ロックは，システムに唯一存在する【NGKI0815】．この節でプロセッサ間ロックと言った場合には，SILスピンロックで用いるプロセッサ間ロックのことを指す．</p>
</div>
<div class="paragraph">
<p>プロセッサ間ロックを取得している間は，全割込みロック状態にすることですべての割込み（NMIを除く）がマスクされる【NGKI0812】．ロックが他のプロセッサに取得されている場合には，ロックが取得できるまでループによって待つ【NGKI0813】．ロックの取得を待つ間は，割込みはマスクされない（ただし，ロックの取得を試みる前からマスクしていた割込みは，マスクしたままとなる）【NGKI0814】．プロセッサ間ロックを取得し割込みをマスクすることを，SILスピンロックを取得するという．また，プロセッサ間ロックを返却し割込みをマスク解除することを，SILスピンロックを返却するという．</p>
</div>
<div class="paragraph">
<div class="title">(1) SIL_PRE_LOC</div>
<p>全割込みロック状態の制御に必要な変数を宣言するマクロであるが，SILスピンロックの取得・解放にも兼用する【NGKI0816】．</p>
</div>
<div class="paragraph">
<p>このマクロは，SIL_LOC_SPN，SIL_UNL_SPNを用いる関数またはブロックの先頭の変数宣言部に記述しなければならない【NGKI0817】．SIL_LOC_SPN，SIL_UNL_SPNを，同じ関数内のSIL_LOC_INT，SIL_UNL_INTとネストして用いることは可能であるが，その場合には，ネストレベル毎にブロックを作り，そのブロックの先頭の変数宣言部にSIL_PRE_LOCを記述しなければならない【NGKI0818】．そのように記述しなかった場合の動作は保証されない【NGKI0819】．</p>
</div>
<div class="paragraph">
<div class="title">(2) SIL_LOC_SPN()</div>
<p>プロセッサ間ロックが取得されていない状態である場合には，ロックの取得を試みる【NGKI0820】．ロックが他のプロセッサに取得されている状態である場合や，他のプロセッサがロックの取得に成功した場合には，ロックが返却されるまでループによって待ち，返却されたらロックの取得を試みる【NGKI0821】．ロックの取得に成功した場合には，全割込みロックフラグをセットし，全割込みロック状態に遷移する【NGKI0822】．</p>
</div>
<div class="paragraph">
<p>プロセッサ間ロックが，SIL_LOC_SPNを呼び出したプロセッサによって取得されている状態である場合には，全割込みロック状態への遷移のみを行う【NGKI0852】．</p>
</div>
<div class="paragraph">
<div class="title">(3) SIL_UNL_SPN()</div>
<p>プロセッサ間ロックの取得状態と，全割込みロックフラグを，対応するSIL_LOC_SPNを実行する前の状態に戻す【NGKI0823】．SIL_LOC_SPNを実行せずにSIL_UNL_SPNを呼び出した場合の動作は保証されない【NGKI0825】．</p>
</div>
<div class="paragraph">
<p>なお，SILスピンロック取得中は全割込みロック状態となっているため，SILスピンロック取得中に呼び出せるサービスコールなどについては，「<a href="#_2_5_4_全割込みロック状態と全割込みロック解除状態">2.5.4 全割込みロック状態と全割込みロック解除状態</a>」の節の制限事項が適用される．</p>
</div>
<div class="paragraph">
<p>なお，マルチプロセッサシステム以外では，SIL_LOC_SPNとSIL_UNL_SPNは用意されていない【NGKI0826】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>全割込ロック状態やCPUロック状態でSIL_LOC_SPNを呼び出すことはできるが，割込みがマスクされている時間が長くなるために，そのような使い方は避けるべきである．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>SILスピンロック機能の使用例は次の通り．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	{
		SIL_PRE_LOC;

		SIL_LOC_SPN();
		// この間はSILスピンロックを取得している．
		// この間はNMIを除くすべての割込みがマスクされる．
		// この間にサービスコールを呼び出してはならない（一部例外あり）．
		SIL_UNL_SPN();
	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_5_微少時間待ち"><a class="anchor" href="#_3_5_微少時間待ち"></a><a class="link" href="#_3_5_微少時間待ち">3.5 微少時間待ち</a></h3>
<div class="paragraph">
<p>デバイスをアクセスする際に，微少な時間待ちを入れなければならない場合がある．そのような場合に，NOP命令をいくつか入れるなどの方法で対応すると，ポータビリティを損なうことになる．そこで，SILでは，微少な時間待ちを行うための以下の機能を用意している．</p>
</div>
<div class="paragraph">
<div class="title">(1) void sil_dly_nse(ulong_t dlytim)</div>
<p>dlytimで指定された以上の時間（単位はナノ秒），ループなどによって待つ【NGKI0827】．指定した値によっては，指定した時間よりもかなり長く待つ場合があるので注意すること．</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_6_エンディアンの取得"><a class="anchor" href="#_3_6_エンディアンの取得"></a><a class="link" href="#_3_6_エンディアンの取得">3.6 エンディアンの取得</a></h3>
<div class="paragraph">
<p>プロセッサのバイトエンディアンを取得するためのマクロとして，SILでは，以下のマクロを定義している．</p>
</div>
<div class="paragraph">
<div class="title">(1) SIL_ENDIAN_BIG，SIL_ENDIAN_LITTLE</div>
<p>ビッグエンディアンプロセッサではSIL_ENDIAN_BIGを，リトルエンディアンプロセッサではSIL_ENDIAL_LITTLEを，マクロ定義している【NGKI0828】．</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_7_メモリ空間アクセス関数"><a class="anchor" href="#_3_7_メモリ空間アクセス関数"></a><a class="link" href="#_3_7_メモリ空間アクセス関数">3.7 メモリ空間アクセス関数</a></h3>
<div class="paragraph">
<p>メモリ空間にマッピングされたデバイスレジスタや，デバイスとの共有メモリをアクセスするために，SILでは，以下の関数を用意している．</p>
</div>
<div class="paragraph">
<div class="title">(1) uint8_t sil_reb_mem(const uint8_t *mem)</div>
<p>memで指定されるアドレスから8ビット単位で読み出した値を返す【NGKI0829】．</p>
</div>
<div class="paragraph">
<div class="title">(2) void sil_wrb_mem(uint8_t *mem, uint8_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を8ビット単位で書き込む【NGKI0830】．</p>
</div>
<div class="paragraph">
<div class="title">(3) uint16_t sil_reh_mem(const uint16_t *mem)</div>
<p>memで指定されるアドレスから16ビット単位で読み出した値を返す【NGKI0831】．</p>
</div>
<div class="paragraph">
<div class="title">(4) void sil_wrh_mem(uint16_t *mem, uint16_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を16ビット単位で書き込む【NGKI0832】．</p>
</div>
<div class="paragraph">
<div class="title">(5) uint16_t sil_reh_lem(const uint16_t *mem)</div>
<p>memで指定されるアドレスから16ビット単位でリトルエンディアンで読み出した値を返す【NGKI0833】．リトルエンディアンプロセッサでは，sil_reh_memと一致する．ビッグエンディアンプロセッサでは，sil_reh_memが返す値を，エンディアン変換した値を返す．</p>
</div>
<div class="paragraph">
<div class="title">(6) void sil_wrh_lem(uint16_t *mem, uint16_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を16ビット単位でリトルエンディアンで書き込む【NGKI0834】．リトルエンディアンプロセッサでは，sil_wrh_memと一致する．ビッグエンディアンプロセッサでは，dataをエンディアン変換した値を，sil_wrh_memで書き込むのと同じ結果となる．</p>
</div>
<div class="paragraph">
<div class="title">(7) uint16_t sil_reh_bem(const uint16_t *mem)</div>
<p>memで指定されるアドレスから16ビット単位でビッグエンディアンで読み出した値を返す【NGKI0835】．ビッグエンディアンプロセッサでは，sil_reh_memと一致する．リトルエンディアンプロセッサでは，sil_reh_memが返す値を，エンディアン変換した値を返す．</p>
</div>
<div class="paragraph">
<div class="title">(8) void sil_wrh_bem(uint16_t *mem, uint16_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を16ビット単位でビッグエンディアンで書き込む【NGKI0836】．ビッグエンディアンプロセッサでは，sil_wrh_memと一致する．リトルエンディアンプロセッサでは，dataをエンディアン変換した値を，sil_wrh_memで書き込むのと同じ結果となる．</p>
</div>
<div class="paragraph">
<div class="title">(9) uint32_t sil_rew_mem(const uint32_t *mem)</div>
<p>memで指定されるアドレスから32ビット単位で読み出した値を返す【NGKI0837】．</p>
</div>
<div class="paragraph">
<div class="title">(10) void sil_wrw_mem(uint32_t *mem, uint32_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を32ビット単位で書き込む【NGKI0838】．</p>
</div>
<div class="paragraph">
<div class="title">(11) uint32_t sil_rew_lem(const uint32_t *mem)</div>
<p>memで指定されるアドレスから32ビット単位でリトルエンディアンで読み出した値を返す【NGKI0839】．リトルエンディアンプロセッサでは，sil_rew_memと一致する．ビッグエンディアンプロセッサでは，sil_rew_memが返す値を，エンディアン変換した値を返す．</p>
</div>
<div class="paragraph">
<div class="title">(12) void sil_wrw_lem(uint32_t *mem, uint32_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を32ビット単位でリトルエンディアンで書き込む【NGKI0840】．リトルエンディアンプロセッサでは，sil_wrw_memと一致する．ビッグエンディアンプロセッサでは，dataをエンディアン変換した値を，sil_wrw_memで書き込むのと同じ結果となる．</p>
</div>
<div class="paragraph">
<div class="title">(13) uint32_t sil_rew_bem(const uint32_t *mem)</div>
<p>memで指定されるアドレスから32ビット単位でビッグエンディアンで読み出した値を返す【NGKI0841】．ビッグエンディアンプロセッサでは，sil_rew_memと一致する．リトルエンディアンプロセッサでは，sil_rew_memが返す値を，エンディアン変換した値を返す．</p>
</div>
<div class="paragraph">
<div class="title">(14) void sil_wrw_bem(uint32_t *mem, uint32_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を32ビット単位でビッグエンディアンで書き込む【NGKI0842】．ビッグエンディアンプロセッサでは，sil_wrw_memと一致する．リトルエンディアンプロセッサでは，dataをエンディアン変換した値を，sil_wrw_memで書き込むのと同じ結果となる．</p>
</div>
<div class="paragraph">
<p>また，デバイスレジスタやメモリへの書込みが完了するまで待つために，以下のメモリ空間同期書込み関数を用意している．</p>
</div>
<div class="paragraph">
<div class="title">(15) void sil_swrb_mem(uint8_t *mem, uint8_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を8ビット単位で書き込み，書込みが完了するまで待つ【NGKI0845】．</p>
</div>
<div class="paragraph">
<div class="title">(16) void sil_swrh_mem(uint16_t *mem, uint16_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を16ビット単位で書き込み，書込みが完了するまで待つ【NGKI0846】．</p>
</div>
<div class="paragraph">
<div class="title">(17) void sil_swrh_lem(uint16_t *mem, uint16_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を16ビット単位でリトルエンディアンで書き込み，書込みが完了するまで待つ【NGKI0847】．</p>
</div>
<div class="paragraph">
<div class="title">(18) void sil_swrh_bem(uint16_t *mem, uint16_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を16ビット単位でビッグエンディアンで書き込み，書込みが完了するまで待つ【NGKI0848】．</p>
</div>
<div class="paragraph">
<div class="title">(19) void sil_swrw_mem(uint32_t *mem, uint32_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を32ビット単位で書き込み，書込みが完了するまで待つ【NGKI0849】．</p>
</div>
<div class="paragraph">
<div class="title">(20) void sil_swrw_lem(uint32_t *mem, uint32_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を32ビット単位でリトルエンディアンで書き込み，書込みが完了するまで待つ【NGKI0850】．</p>
</div>
<div class="paragraph">
<div class="title">(21) void sil_swrw_bem(uint32_t *mem, uint32_t data)</div>
<p>memで指定されるアドレスにdataで指定される値を32ビット単位でビッグエンディアンで書き込み，書込みが完了するまで待つ【NGKI0851】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>メモリ空間同期書込み関数群を追加した．</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_8_io空間アクセス関数"><a class="anchor" href="#_3_8_io空間アクセス関数"></a><a class="link" href="#_3_8_io空間アクセス関数">3.8 I/O空間アクセス関数</a></h3>
<div class="paragraph">
<p>メモリ空間とは別にI/O空間を持つプロセッサでは，I/O空間にあるデバイスレジスタをアクセスするために，メモリ空間アクセス関数と同等の以下の関数を用意している【NGKI0843】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>I/O空間同期書込み関数群を追加した．</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_9_プロセッサidの参照"><a class="anchor" href="#_3_9_プロセッサidの参照"></a><a class="link" href="#_3_9_プロセッサidの参照">3.9 プロセッサIDの参照</a></h3>
<div class="paragraph">
<p>マルチプロセッサシステムにおいては，プログラムがどのプロセッサで実行されているかを参照するために，以下の関数を用意している．</p>
</div>
<div class="paragraph">
<div class="title">(1) void sil_get_pid(ID *p_prcid)</div>
<p>この関数を呼び出したプログラムを実行しているプロセッサのID番号を参照し，p_prcidで指定したメモリ領域に返す【NGKI0844】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>タスクは，sil_get_pidを用いて，自タスクを実行しているプロセッサを正しく参照できるとは限らない．これは，sil_get_pidを呼び出し，自タスクを実行しているプロセッサのID番号を参照した直後に割込みが発生した場合，sil_get_pidから戻ってきた時には自タスクを実行しているプロセッサが変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_第４章_カーネルapi仕様"><a class="anchor" href="#_第４章_カーネルapi仕様"></a><a class="link" href="#_第４章_カーネルapi仕様">第４章 カーネルAPI仕様</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>この章では，カーネルのAPI仕様について規定する．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TOPPERS共通データ型に従い，パラメータのデータ型を次の通り変更した．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT → int_t</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT → uint_t</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VP → void *</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VP_INT → intptr_t</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIZE → size_t</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>タスク例外処理機能を廃止し，それに代えて，タスク終了要求機能を追加した．これに関連して，待ち状態に入るすべてのサービスコールから，E_RASTERエラーが返る場合ある．</p>
</div>
<div class="paragraph">
<p>非タスクコンテキスト専用のサービスコールの概念を廃止し，非タスクコンテキストからも，タスクコンテキストと同じ名称のサービスコールを呼び出すこととした．</p>
</div>
<div class="paragraph">
<p>以上の変更については，個別のAPI仕様では記述しない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>ID番号で識別するオブジェクトのアクセス許可ベクタをデフォルト以外に設定する場合には，オブジェクトを生成した後に設定することとし，アクセス許可ベクタを設定する静的API（SAC_YYY）を新設した．逆に，アクセス許可ベクタを指定してオブジェクトを生成する機能（CRA_YYY，cra_yyy，acra_yyy）は廃止した．これらの変更については，個別のAPI仕様では記述しない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS共通データ型の変更に従い，パラメータのデータ型を次の通り変更した．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIZE → size_t</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>タスク例外処理機能を廃止し，それに代えて，タスク終了要求機能を追加した．これに関連して，待ち状態に入るすべてのサービスコールから，E_RASTERエラーが返る場合ある．</p>
</div>
<div class="paragraph">
<p>非タスクコンテキスト専用のサービスコールの概念を廃止し，非タスクコンテキストからも，タスクコンテキストと同じ名称のサービスコールを呼び出すこととした．</p>
</div>
<div class="paragraph">
<p>以上の変更については，個別のAPI仕様では記述しない．</p>
</div>
<div class="sect2">
<h3 id="_4_1_タスク管理機能"><a class="anchor" href="#_4_1_タスク管理機能"></a><a class="link" href="#_4_1_タスク管理機能">4.1 タスク管理機能</a></h3>
<div class="paragraph">
<p>タスクは，プログラムの並行実行の単位で，カーネルが実行を制御する処理単位である．タスクは，タスクIDと呼ぶID番号によって識別する【NGKI1001】．</p>
</div>
<div class="paragraph">
<p>タスク管理機能に関連して，各タスクが持つ情報は次の通り【NGKI1002】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>タスク属性</p>
</li>
<li>
<p>タスク状態</p>
</li>
<li>
<p>ベース優先度</p>
</li>
<li>
<p>現在優先度</p>
</li>
<li>
<p>サブ優先度（サブ優先度機能をサポートするカーネルの場合）</p>
</li>
<li>
<p>起動要求キューイング数</p>
</li>
<li>
<p>割付けプロセッサ（マルチプロセッサ対応カーネルの場合）</p>
</li>
<li>
<p>次回起動時の割付けプロセッサ（マルチプロセッサ対応カーネルの場合）</p>
</li>
<li>
<p>拡張情報</p>
</li>
<li>
<p>メインルーチンの先頭番地</p>
</li>
<li>
<p>起動時優先度</p>
</li>
<li>
<p>実行時優先度（TOPPERS/SSP3カーネルの場合）</p>
</li>
<li>
<p>スタック領域</p>
</li>
<li>
<p>システムスタック領域（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>タスクのベース優先度は，タスクの現在優先度を決定するために使われる優先度であり，タスクの起動時に起動時優先度に初期化される【NGKI1003】．</p>
</div>
<div class="paragraph">
<p>タスクの現在優先度は，タスクの優先順位を決定するために使われる優先度である．単にタスクの優先度と言った場合には，現在優先度のことを指す．タスクがミューテックスをロックしていない間は，タスクの現在優先度はベース優先度に一致する【NGKI1004】．ミューテックスをロックしている間のタスクの現在優先度については，「<a href="#_4_4_5_ミューテックス">4.4.5 ミューテックス</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>タスクのサブ優先度は，優先度が同一のタスクの間の優先順位を決定するために使われる値であり，タスクの生成時にUINT_MAXに初期化される【NGKI3681】．</p>
</div>
<div class="paragraph">
<p>タスクの起動要求キューイング数は，処理されていないタスクの起動要求の数であり，タスクの生成時に0に初期化される【NGKI1005】．</p>
</div>
<div class="paragraph">
<p>割付けプロセッサは，マルチプロセッサ対応カーネルにおいて，タスクを実行するプロセッサで，タスクの生成時に，タスクが属するクラスの初期割付けプロセッサに初期化される【NGKI1006】．</p>
</div>
<div class="paragraph">
<p>次回起動時の割付けプロセッサは，マルチプロセッサ対応カーネルにおいて，タスクの起動要求がmact_tskによりキューイングされている状況で，タスクが次に起動される時に割り付けられるプロセッサである．タスクの生成時に未設定の状態に初期化され，タスクの起動要求キューイング数が0の間は，未設定の状態になっている【NGKI1007】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，スタック領域の扱いは，ユーザタスクとシステムタスクで異なる．ユーザタスクのスタック領域は，ユーザタスクが非特権モードで実行する間に用いるスタック領域であり，ユーザスタック領域と呼ぶ【NGKI1010】．その扱いについては，「<a href="#_2_11_6_ユーザタスクのユーザスタック領域">2.11.6 ユーザタスクのユーザスタック領域</a>」の節を参照すること．システムタスクのスタック領域は，カーネルの管理領域として扱われる【NGKI1011】．</p>
</div>
<div class="paragraph">
<p>システムスタック領域は，保護機能対応カーネルにおいて，ユーザタスクがサービスコール（拡張サービスコールを含む）を呼び出し，特権モードで実行する間に用いるスタック領域である【NGKI1012】．システムスタック領域は，カーネルの管理領域として扱われる【NGKI1013】．</p>
</div>
<div class="paragraph">
<p>タスク属性には，次の属性を指定することができる【NGKI3526】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_ACT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの生成時にタスクを起動する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOACTQUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクに対する起動要求をキューイングしない</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_RSTR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するタスクを制約タスクとする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_ACTを指定しない場合，タスクの生成直後には，タスクは休止状態となる【NGKI1015】．また，ターゲットによっては，ターゲット定義のタスク属性を指定できる場合がある【NGKI1016】．ターゲット定義のタスク属性として，次の属性を予約している【NGKI1017】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_FPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPUレジスタをコンテキストに含める</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>C言語によるタスクの記述形式は次の通り【NGKI1018】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void task(intptr_t exinf)
	{
		タスク本体
		ext_tsk();
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，タスクの拡張情報が渡される【NGKI1019】．ext_tskを呼び出さず，タスクのメインルーチンからリターンした場合，ext_tskを呼び出した場合と同じ動作をする【NGKI1020】．</p>
</div>
<div class="paragraph">
<p>タスク管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_ACTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動要求キューイング数の最大値【NGKI1021】</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_TSKID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるタスクの数（動的生成対応でないカーネルでは，静的APIによって登録されたタスクの数に一致）【NGKI1022】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，TMAX_ACTCNTは1に固定されている【ASPS0101】．また，制約タスクはサポートしない［ASPS0009］．ただし，制約タスク拡張パッケージを用いると，制約タスクの機能を追加することができる［ASPS0010］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，TMAX_ACTCNTは1に固定されている【FMPS0101】．また，制約タスクはサポートしない［FMPS0006］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，TMAX_ACTCNTは1に固定されている【HRPS0101】．また，制約タスクはサポートしない［HRPS0005］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，TMAX_ACTCNTは1に固定されている【HRMPS0101】．また，制約タスクはサポートしない［HRMPS0007］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，TMAX_ACTCNTは1に固定されている【SSPS0101】．</p>
</div>
<div class="paragraph">
<p>SSP3カーネルは，制約タスクのみをサポートすることから，すべてのタスクでスタック領域を共有しており，タスク毎にスタック領域の情報を持たない【SSPS0102】．</p>
</div>
<div class="paragraph">
<p>SSP3カーネルにおける追加機能として，タスクに対して，実行時優先度の情報を持つ【SSPS0103】．SSP3カーネルにおいては，タスクが起動された後，最初に実行状態になる時に，タスクのベース優先度が，タスクの実行時優先度に設定される【SSPS0104】．実行時優先度の機能は，起動時優先度よりも高い優先度でタスクを実行することで，同時期に共有スタック領域を使用している状態になるタスクの組み合わせを限定し，スタック領域を節約するための機能である．</p>
</div>
<div class="paragraph">
<p>タスクの実行時優先度は，実行時優先度を定義する静的API（DEF_EPR）によって設定する【SSPS0105】．実行時優先度を定義しない場合，タスクの実行時優先度は，起動時優先度と同じ値に設定される【SSPS0106】．</p>
</div>
<div class="paragraph">
<div class="title">〔実行時優先度によるスタック領域の節約〕</div>
<p>いずれのタスクにも実行時優先度が設定されていない場合には，すべてのタスクが同時期に共有スタック領域を使用している状態になる可能性があるため，すべてのタスクのスタック領域のサイズの和に，非タスクコンテキスト用のスタック領域のサイズを加えたものが，共有スタック領域に必要なサイズとなる．</p>
</div>
<div class="paragraph">
<p>タスクAに対して実行時優先度が設定されており，タスクAの起動時優先度よりも高く，タスクAの実行時優先度と同じかそれよりも低い起動時優先度を持つタスクBがある場合，タスクAとタスクBは同時期に共有スタック領域を使用している状態にならない．そのため，タスクAとタスクBの内，サイズが小さい方のスタック領域のサイズは，共有スタック領域のサイズに加える必要がなくなり，スタック領域を節約できることになる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>起動コードを指定してタスクを起動するサービスコール（sta_tsk），タスクを終了と同時に削除するサービスコール（exd_tsk），タスクの状態を参照するサービスコールの簡易版（ref_tst）を廃止し，自タスクの拡張情報の参照するサービスコール（get_inf），タスク状態を参照するサービスコール（get_tst），タスクのサブ優先度を変更するサービスコール（chg_spr）を追加した．</p>
</div>
<div class="paragraph">
<p>タスク属性に，TA_NOACTQUE（タスクに対する起動要求をキューイングしない）を追加した．</p>
</div>
<div class="paragraph">
<p>TNUM_TSKIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>タスク状態を参照するサービスコール（get_tst）とタスクのサブ優先度を変更するサービスコール（chg_spr）を追加した．</p>
</div>
<div class="paragraph">
<p>タスク属性に，TA_NOACTQUE（タスクに対する起動要求をキューイングしない）を追加した．TA_ACTの値を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_TSK</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの生成〔S〕【NGKI1023】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの生成〔TD〕【NGKI1024】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【静的API】</div>
<p>＊保護機能対応でないカーネルの場合</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_TSK(ID tskid, { ATR tskatr, intptr_t exinf, TASK task,
									PRI itskpri, size_t stksz, STK_T *stk })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ stkの記述は省略することができる【NGKI3900】．</p>
</div>
<div class="paragraph">
<p>＊保護機能対応カーネルの場合</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_TSK(ID tskid, { ATR tskatr, intptr_t exinf, TASK task, PRI itskpri,
						size_t stksz, STK_T *stk, size_t sstksz, STK_T *sstk })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ stk，sstksz，sstkの記述は省略することができる【NGKI1025】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID tskid = acre_tsk(const T_CTSK *pk_ctsk)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するタスクのID番号（CRE_TSKの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CTSK *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_ctsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊タスクの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exinf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの拡張情報</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのメインルーチンの先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">itskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動時優先度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stksz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのスタック領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STK_T *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのスタック領域の先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sstksz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのシステムスタック領域のサイズ（バイト数，保護機能対応カーネルの場合，静的APIにおいては省略可）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STK_T *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sstk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのシステムスタック領域の先頭番地（保護機能対応カーネルの場合，静的APIにおいては省略可）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたタスクのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1026】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1027】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・tskatrが無効【NGKI1028】<br>
・属する保護ドメインの指定が有効範囲外または無所属〔sP〕【NGKI1029】<br>
・保護ドメインの囲みの中に記述されていない〔SP〕【NGKI1030】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI1032】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI1031】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・taskがプログラムの先頭番地として正しくない【NGKI1033】<br>
・itskpriが有効範囲外【NGKI1034】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメインに対する通常操作1が許可されていない〔sP〕【NGKI3966】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_ctskが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI1036】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるタスクIDがない〔sD〕【NGKI1037】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・スタック領域が確保できない【NGKI1038】<br>
・システムスタック領域が確保できない〔P〕【NGKI1039】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・tskidで指定したタスクが登録済み〔S〕【NGKI1040】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したタスクの生成情報に従って，タスクを生成する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>まず，stkとstkszからタスクが用いるスタック領域が設定される【NGKI1041】．ただし，保護機能対応カーネルで，生成するタスクがシステムタスクの場合には，スタック領域の設定にsstkszも用いられる．stkszに0を指定した時や，設定されるスタック領域のサイズがターゲット定義の最小値よりも小さくなる時には，E_PARエラーとなる【NGKI1042】．</p>
</div>
<div class="paragraph">
<p>また，保護機能対応カーネルで，生成するタスクがユーザタスクの場合には，sstkとsstkszからシステムスタック領域が設定される【NGKI1043】．この場合，sstkszに0を指定した時や，ターゲット定義の最小値よりも小さい値を指定した時には，E_PARエラーとなる【NGKI1044】．</p>
</div>
<div class="paragraph">
<p>次に，生成されたタスクに対してタスク生成時に行うべき初期化処理が行われ，生成されたタスクは休止状態になる【NGKI1045】．さらに，tskatrにTA_ACTを指定した場合には，タスク起動時に行うべき初期化処理が行われ，生成されたタスクは実行できる状態になる【NGKI1046】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，tskidはオブジェクト識別名，tskatr，itskpri，stksz，sstkszは整数定数式パラメータ，exinf，task，stk，sstkは一般定数式パラメータである【NGKI1047】．ただし，保護機能対応カーネルで手動メモリ配置の場合には，stkは整数定数式パラメータである【NGKI3906】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI1048】．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサの両方に対応するカーネルでは，生成するタスクがユーザタスクの場合に，［NGKI0628］の制約が課される．具体的には，生成するタスクが属するユーザドメインが，アイドルドメインにまとめられておらず，属するクラスの初期割付けプロセッサでタイムウィンドウを割り当てられていない場合，E_PARエラーとなる【NGKI5108】．</p>
</div>
<div class="paragraph">
<div class="title">〔stkにNULLを指定した場合〕</div>
<p>stkをNULLとするか，静的APIにおいてstkの記述を省略した場合，stkszで指定したサイズのスタック領域が，コンフィギュレータまたはカーネルにより確保される【NGKI1049】．stkszにターゲット定義の制約に合致しないサイズを指定した時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで確保される【NGKI1050】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，生成するタスクがユーザタスクの場合，コンフィギュレータにより確保されるスタック領域（ユーザスタック領域）は，タスクが属する保護ドメイン向け（マルチプロセッサ対応カーネルの場合には，さらに，タスクが属するクラス向け）の標準メモリリージョン内に配置され，「<a href="#_2_11_6_ユーザタスクのユーザスタック領域">2.11.6 ユーザタスクのユーザスタック領域</a>」の節の規定に従って，メモリオブジェクトとしてカーネルに登録される【NGKI1051】．</p>
</div>
<div class="paragraph">
<p>ただし，保護機能対応カーネルで手動メモリ配置の場合で，生成するタスクがユーザタスクの場合には，stkがNULLであってはならず，静的APIにおいてstkの記述を省略することができない．stkがNULLであった場合や，stkの記述を省略した場合には，E_PARエラーとなる【NGKI3907】．</p>
</div>
<div class="paragraph">
<p>静的APIにより制約タスクを生成する場合（tskatrにTA_RSTRを指定して生成する場合），スタック領域は，制約タスクの起動時優先度毎に確保され，同じ起動時優先度を持つ制約タスクで共有される【NGKI1052】．確保されるスタック領域のサイズは，それを共有する制約タスクのスタック領域のサイズ（stksz）の最大値となる【NGKI1053】．マルチプロセッサ対応カーネルでは，以上のスタック領域の確保処理を，制約タスクの初期割付けプロセッサ毎に行う【NGKI1054】．</p>
</div>
<div class="paragraph">
<div class="title">〔stkにNULL以外を指定した場合〕</div>
<p>stkにNULL以外を指定した場合，stkとstkszで指定したスタック領域は，アプリケーションで確保しておく必要がある【NGKI1055】．スタック領域をアプリケーションで確保する方法については，「<a href="#_2_15_3_カーネル共通マクロ">2.15.3 カーネル共通マクロ</a>」の節を参照すること．その方法に従わず，stkやstkszにターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI1056】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，生成するタスクがシステムタスクの場合に，stkとstkszで指定したスタック領域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI1057】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，生成するタスクがユーザタスクの場合，stkとstkszで指定したスタック領域（ユーザスタック領域）は，「<a href="#_2_11_6_ユーザタスクのユーザスタック領域">2.11.6 ユーザタスクのユーザスタック領域</a>」の節の規定に従って，メモリオブジェクトとしてカーネルに登録される【NGKI1058】．そのため，上の方法を用いてスタック領域を確保しても，ターゲット定義の制約に合致する先頭番地とサイズとなるとは限らず，スタック領域をアプリケーションで確保する方法は，ターゲット定義である【NGKI1059】．また，stkとstkszで指定したスタック領域が，登録済みのメモリオブジェクトとメモリ領域が重なる場合には，E_OBJエラーとなる【NGKI1060】．</p>
</div>
<div class="paragraph">
<div class="title">〔sstkとsstkszの扱い〕</div>
<p>保護機能対応カーネルにおけるsstkとsstkszの扱いは，生成するタスクがユーザタスクの場合とシステムタスクの場合で異なる．</p>
</div>
<div class="paragraph">
<p>生成するタスクがユーザタスクの場合の扱いは次の通り．</p>
</div>
<div class="paragraph">
<p>sstkをNULLとするか，静的APIにおいてsstkの記述を省略した場合，sstkszで指定したサイズのシステムスタック領域が，コンフィギュレータまたはカーネルにより確保される【NGKI1061】．sstkszにターゲット定義の制約に合致しないサイズを指定した時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで確保される【NGKI1062】．sstkszの記述も省略した場合には，ターゲット定義のデフォルトのサイズで確保される【NGKI1063】．</p>
</div>
<div class="paragraph">
<p>sstkにNULL以外を指定した場合，sstkとsstkszで指定したスタック領域は，アプリケーションで確保しておく必要がある【NGKI1064】．スタック領域をアプリケーションで確保する方法については，「<a href="#_2_15_3_カーネル共通マクロ">2.15.3 カーネル共通マクロ</a>」の節を参照すること．その方法に従わず，sstkやsstkszにターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI1065】．また，sstkとsstkszで指定したシステムスタック領域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI1066】．</p>
</div>
<div class="paragraph">
<p>生成するタスクがシステムタスクの場合の扱いは次の通り．</p>
</div>
<div class="paragraph">
<p>sstkに指定することができるのは，NULLのみである．sstkにNULL以外を指定した場合には，E_PARエラーとなる【NGKI1068】．</p>
</div>
<div class="paragraph">
<p>sstkszに0以外の値を指定した場合で，stkがNULLの場合には，コンフィギュレータまたはカーネルにより確保されるスタック領域のサイズに，sstkszが加えられる【NGKI1069】．stkszにsstkszを加えた値が，ターゲット定義の制約に合致しないサイズになる時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで確保される【NGKI1070】．</p>
</div>
<div class="paragraph">
<p>sstkszに0以外の値を指定した場合で，stkがNULLでない場合には，E_PARエラーとなる【NGKI1071】．</p>
</div>
<div class="paragraph">
<p>静的APIでsstkszの記述を省略するか，sstkszに0を指定した場合，これらの処理は行わず，E_PARエラーにもならない【NGKI1072】．</p>
</div>
<div class="paragraph">
<div class="title">〔スタック領域への他のタスクからのアクセス〕</div>
<p>この仕様では，タスクのスタック領域に，他のタスクからアクセスできるとは限らない【NGKI5166】．実際，保護機能対応カーネルでは，ユーザタスクのユーザスタック領域には，他のユーザタスクはアクセスすることができないのが基本である．また，マルチプロセッサ対応カーネルでは，スタック領域が他のプロセッサからアクセスできない領域に配置される場合もある．そのため，ローカル変数へのポインタを渡すなどして，他のタスクからローカル変数にアクセスさせることは推奨しない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_tskをサポートする【ASPS0105】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_tskをサポートする【HRPS0175】．ただし，生成するタスクがユーザタスクの場合，stkとstkszで指定するユーザスタック領域の扱いは，以下の点でCRE_TSKと異なる．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stkにNULLが指定されるとカーネルがスタック領域を確保する機能はサポートしない．stkにNULLを指定した場合には，E_NOSPTエラーとなる【HRPS0176】．</p>
</li>
<li>
<p>ユーザスタック領域をアプリケーションで確保する方法は，ターゲット定義で，CRE_TSKとは異なる場合がある【HRPS0240】．その方法に従わず，指定したユーザスタック領域がターゲット定義の制約に合致しない場合には，E_OBJエラーとなる【HRPS0241】．</p>
</li>
<li>
<p>指定したユーザスタック領域は，カーネルにメモリオブジェクトとして登録されない【HRPS0242】．そのため，指定したユーザスタック領域が，動的に生成された他のタスクのユーザスタック領域と重なる場合のエラーチェックは行われない【HRPS0243】．同時に起動される他のタスクのユーザスタック領域と重ならないようにするのは，アプリケーションの責任である．</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，複数のタスクに対して，同じ起動時優先度を設定することはできない．設定した場合には，コンフィギュレータがE_PARエラーを報告する【SSPS0109】．</p>
</div>
<div class="paragraph">
<p>SSP3カーネルでは，制約タスクのみをサポートするため，タスク属性にTA_RSTRを指定しない場合でも，生成されるタスクは制約タスクとなる【SSPS0110】．</p>
</div>
<div class="paragraph">
<p>SSP3カーネルでは，stkにはNULLを指定しなくてはならず，その場合でも，コンフィギュレータはタスクのスタック領域を確保しない【SSPS0111】．これは，SSP3カーネルでは，すべての処理単位が共有スタック領域を使用し，タスク毎にスタック領域を持たないためである．stkにNULL以外を指定した場合には，E_PARエラーとなる【SSPS0112】．</p>
</div>
<div class="paragraph">
<p>共有スタック領域の設定方法については，DEF_STKの項を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>taskのデータ型をTASKに，stkのデータ型をSTK_T *に変更した．COUNT_STK_TとROUND_STK_Tを新設し，スタック領域をアプリケーションで確保する方法を規定した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>sstkのデータ型をSTK_T *に変更した．システムスタック領域をアプリケーションで確保する方法を規定した．</p>
</div>
<div class="paragraph">
<div class="title">【未決定事項】</div>
<p>サービスコール（acre_tsk）で，stkにNULLを指定して制約タスクを生成する場合のスタック領域の確保方法については，今後の課題である．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，サービスコール（acre_tsk）で，tskにNULLを指定してユーザタスクを生成する場合のユーザスタック領域の確保方法については，今後の課題である．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>保護機能対応カーネルにおいて，sstkszおよびsstkの記述は省略することができることとしたのは，保護機能対応でないカーネル用のシステムコンフィギュレーションファイルを，保護機能対応カーネルにも変更なしに使えるようにするためである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_TSK</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なタスクIDの数の指定〔SD〕【NGKI1073】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_TSK(uint_t notsk)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">notsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なタスクIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・保護ドメインの囲みの中に記述されていない〔P〕【NGKI3979】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI1075】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5111】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>notskで指定した数のタスクIDを，タスクを生成するサービスコールによって割付け可能なタスクIDとして確保する【NGKI1076】．</p>
</div>
<div class="paragraph">
<p>notskは整数定数式パラメータである【NGKI1077】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_TSKをサポートする【ASPS0210】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_TSKをサポートする【HRPS0211】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_TSK</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクのアクセス許可ベクタの設定〔SP〕【NGKI1078】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクのアクセス許可ベクタの設定〔TPD〕【NGKI1079】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_TSK(ID tskid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_tsk(ID tskid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1080】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1081】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外〔s〕【NGKI1082】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象タスクが属する保護ドメインの囲みの中に記述されていない〔S〕【NGKI1083】<br>
・対象タスクが属するクラスの囲みの中に記述されていない〔SM〕【NGKI1084】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録【NGKI1085】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する管理操作が許可されていない〔s〕【NGKI1086】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI1087】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクは静的APIで生成された〔s〕【NGKI1088】<br>
・対象タスクに対してアクセス許可ベクタが設定済み〔S〕【NGKI1089】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI1090】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，tskidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI1091】．</p>
</div>
<div class="paragraph">
<p>sac_tskにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1092】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_tskをサポートする【HRPS0177】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_EPR</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの実行時優先度の定義〔S〕【NGKI1093】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_EPR(ID tskid, { PRI exepri })</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exepri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの実行時優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・exepriが有効範囲外【NGKI1094】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクに対して実行優先度が設定済み【NGKI1095】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【サポートするカーネル】</div>
<p>DEF_EPRは，TOPPERS/SSP3カーネルのみがサポートする静的APIである．他のカーネルは，DEF_EPRをサポートしない【NGKI1096】．</p>
</div>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）の実行時優先度を，exepriで指定した優先度に設定する【NGKI1097】．</p>
</div>
<div class="paragraph">
<p>tskidはオブジェクト識別名，exepriは整数定数式パラメータである【NGKI1098】．</p>
</div>
<div class="paragraph">
<p>exepriが，対象タスクの起動時優先度よりも低い場合には，E_ILUSEエラーとなる【NGKI1099】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの削除〔TD〕【NGKI1100】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_tsk(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1101】<br>
・CPUロック状態からの呼出し【NGKI1102】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1103】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録【NGKI1104】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する管理操作が許可されていない〔P〕【NGKI1105】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態でない【NGKI1106】<br>
・対象タスクは静的APIで生成された【NGKI1107】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態である場合には，対象タスクの登録が解除され，そのタスクIDが未使用の状態に戻される【NGKI1108】．また，タスクの生成時にタスクのスタック領域およびシステムスタック領域がカーネルによって確保された場合は，それらのメモリ領域が解放される【NGKI1109】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_tskをサポートする【ASPS0108】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_tskをサポートする【HRPS0178】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>act_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの起動〔TI〕【NGKI3529】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = act_tsk(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI1114】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1115】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1116】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作1が許可されていない〔P〕【NGKI1117】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_QOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングオーバフロー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）に対して起動要求を行う．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態である場合には，対象タスクに対してタスク起動時に行うべき初期化処理が行われ，対象タスクは実行できる状態になる【NGKI1118】．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でなく，対象タスクがTA_NOACTQUE属性でない場合には，対象タスクの起動要求キューイング数に1が加えられる【NGKI3527】．対象タスクがTA_NOACTQUE属性である場合や，起動要求キューイング数に1を加えるとTMAX_ACTCNTを超える場合には，E_QOVRエラーとなる【NGKI3528】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストから呼び出した場合，tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1121】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応カーネルでは，act_tskは，対象タスクの次回起動時の割付けプロセッサを設定しない．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>mact_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付けプロセッサ指定でのタスクの起動〔TIM〕【NGKI3530】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = mact_tsk(ID tskid, ID prcid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの割付け対象のプロセッサのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI1126】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1127】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1128】<br>
・prcidが有効範囲外【NGKI1129】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1130】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作1が許可されていない〔P〕【NGKI1131】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_QOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングオーバフロー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>prcidで指定したプロセッサを割付けプロセッサとして，tskidで指定したタスク（対象タスク）に対して起動要求を行う．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態である場合には，対象タスクの割付けプロセッサがprcidで指定したプロセッサに変更された後，対象タスクに対してタスク起動時に行うべき初期化処理が行われ，対象タスクは実行できる状態になる【NGKI1132】．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でなく，対象タスクがTA_NOACTQUE属性でない場合には，対象タスクの起動要求キューイング数に1が加えられ，次回起動時の割付けプロセッサがprcidで指定したプロセッサに設定される【NGKI3557】．対象タスクがTA_NOACTQUE属性である場合や，起動要求キューイング数に1を加えるとTMAX_ACTCNTを超える場合には，E_QOVRエラーとなる【NGKI3558】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストから呼び出した場合，tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1135】．</p>
</div>
<div class="paragraph">
<p>対象タスクの属するクラスの割付け可能プロセッサが，prcidで指定したプロセッサを含んでいない場合には，E_PARエラーとなる【NGKI1136】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，対象タスクがユーザタスクの場合に，［NGKI0628］の制約が課される．具体的には，対象タスクが属するユーザドメインが，アイドルドメインにまとめられておらず，prcidで指定したプロセッサでタイムウィンドウを割り当てられていない場合，E_PARエラーとなる【NGKI5109】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象タスクの割付けプロセッサを，それが属するクラスの初期割付けプロセッサとする【NGKI1137】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>TMAX_ACTCNTが2以上の場合でも，対象タスクが次に起動される時の割付けプロセッサは，キューイングされない．すなわち，プロセッサAに割り付けられた休止状態でないタスクを対象として，プロセッサBを割付けプロセッサとしてmact_tskを呼び出し，さらにプロセッサCを割付けプロセッサとしてmact_tskを呼び出すと，対象タスクの次回起動時の割付けプロセッサがプロセッサCに変更され，対象タスクがプロセッサBで実行されることはない．なお，TMAX_ACTCNTが1の場合には，プロセッサCを割付けプロセッサとした2回目のmact_tskがE_QOVRエラーとなるため，次回起動時の割付けプロセッサはプロセッサBのまま変更されない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>can_act</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスク起動要求のキャンセル〔T〕【NGKI1138】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_UINT	actcnt = can_act(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_UINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングされていた起動要求の数（正の値または0）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1139】<br>
・CPUロック状態からの呼出し【NGKI1140】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1141】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1142】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作1が許可されていない〔P〕【NGKI1143】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）に対する処理されていない起動要求をすべてキャンセルし，キャンセルした起動要求の数を返す．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクの起動要求キューイング数が0に設定され，0に設定する前の起動要求キューイング数が，サービスコールの返値として返される【NGKI1144】．また，マルチプロセッサ対応カーネルにおいては，対象タスクの次回起動時の割付けプロセッサが未設定の状態に戻される【NGKI1145】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1146】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，can_actをサポートしない【SSPS0116】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>mig_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの割付けプロセッサの変更〔TM〕【NGKI1147】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = mig_tsk(ID tskid, ID prcid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの割付けプロセッサのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1148】<br>
・CPUロック状態からの呼出し【NGKI1149】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1150】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1151】<br>
・prcidが有効範囲外【NGKI1152】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1153】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作1が許可されていない〔P〕【NGKI1154】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスクの割付けプロセッサを，prcidで指定したプロセッサに変更する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが，自タスクが割り付けられたプロセッサに割り付けられている場合には，対象タスクをprcidで指定したプロセッサに割り付ける【NGKI1155】．対象タスクが実行できる状態の場合には，prcidで指定したプロセッサに割り付けられた優先度が同じタスク（サブ優先度が使われる状況では，サブ優先度も同じタスク）の中で，優先順位が最も低くなる【NGKI1156】．</p>
</div>
<div class="paragraph">
<p>対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられている場合には，E_OBJエラーとなる【NGKI1157】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1158】．</p>
</div>
<div class="paragraph">
<p>ディスパッチ保留状態で，対象タスクを自タスクとしてmig_tskを呼び出すと，E_CTXエラーとなる【NGKI1159】．</p>
</div>
<div class="paragraph">
<p>対象タスクの属するクラスの割付け可能プロセッサが，prcidで指定したプロセッサを含んでいない場合には，E_PARエラーとなる【NGKI1160】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，対象タスクがユーザタスクの場合に，［NGKI0628］の制約が課される．具体的には，対象タスクが属するユーザドメインが，アイドルドメインにまとめられておらず，prcidで指定したプロセッサでタイムウィンドウを割り当てられていない場合，E_PARエラーとなる【NGKI5110】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象タスクの割付けプロセッサを，それが属するクラスの初期割付けプロセッサに変更する【NGKI1161】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>この仕様では，タスクをマイグレーションさせることができるのは，そのタスクと同じプロセッサに割り付けられたタスクのみである．そのため，CPUロック状態やディスパッチ禁止状態を用いて，他のタスクへのディスパッチが起こらないようにすることで，自タスクが他のプロセッサへマイグレーションされるのを防ぐことができる．</p>
</div>
<div class="paragraph">
<p>対象タスクが，最初からprcidで指定したプロセッサに割り付けられている場合には，割付けプロセッサの変更は起こらないが，優先度が同じタスク（サブ優先度が使われる状況では，サブ優先度も同じタスク）の中で，優先順位が最も低くなる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_tst</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスク状態の参照〔T〕【NGKI3613】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_tst(ID tskid, STAT *p_tskstat)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_tskstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク状態を入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク状態</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3614】<br>
・CPUロック状態からの呼出し【NGKI3615】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI3616】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI3617】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する参照操作が許可されていない〔P〕【NGKI3618】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_tskstatが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3619】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）のタスク状態を参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクの現在のタスク状態を表す次のいずれかの値が，p_tskstatが指すメモリ領域に返される【NGKI3620】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_RUN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_RDY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行可能状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_WAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_SUS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x08U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">強制待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_WAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0cU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">二重待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_DMT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">休止状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI3621】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>chg_pri</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクのベース優先度の変更〔T〕【NGKI1183】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = chg_pri(ID tskid, PRI tskpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ベース優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1184】<br>
・CPUロック状態からの呼出し【NGKI1185】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1186】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1187】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI1188】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1189】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI1190】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態【NGKI1191】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）のベース優先度を，tskpriで指定した優先度に変更する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクのベース優先度が，tskpriで指定した優先度に変更される【NGKI1192】．それに伴って，対象タスクの現在優先度も変更される【NGKI1193】．</p>
</div>
<div class="paragraph">
<p>対象タスクが，優先度上限ミューテックスをロックしていない場合には，次の処理が行われる．対象タスクが実行できる状態の場合には，優先度が同じタスク（サブ優先度が使われる状況では，サブ優先度も同じタスク）の中で，対象タスクの優先順位が最も低くなる【NGKI1194】．対象タスクが待ち状態で，タスクの優先度順の待ち行列につながれている場合には，対象タスクの変更後の現在優先度に従って，その待ち行列中での順序が変更される【NGKI1195】．待ち行列中に同じ現在優先度のタスクがある場合には，対象タスクの順序はそれらの中で最後になる【NGKI1196】．</p>
</div>
<div class="paragraph">
<p>対象タスクが，優先度上限ミューテックスをロックしている場合には，対象タスクの現在優先度が変更されることはなく，優先順位も変更されない【NGKI1197】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1198】．また，tskpriにTPRI_INI（＝0）を指定すると，対象タスクのベース優先度が，起動時優先度に変更される【NGKI1199】．</p>
</div>
<div class="paragraph">
<p>対象タスクが優先度上限ミューテックスをロックしているかロックを待っている場合，tskpriは，それらのミューテックスの上限優先度と同じかそれより低くなければならない．そうでない場合には，E_ILUSEエラーとなる【NGKI1201】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，chg_priをサポートしない【SSPS0121】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>対象タスクが，同じ優先度のタスクの中で最低の優先順位となる（対象タスクが待ち状態で，タスクの優先度順の待ち行列につながれている場合には，同じ優先度のタスクの中での順序が最後になる）条件を変更した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ユーザドメインが指定できる最高のタスク優先度の機能を廃止した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_pri</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスク優先度の参照〔T〕【NGKI1202】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_pri(ID tskid, PRI *p_tskpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在優先度を入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1203】<br>
・CPUロック状態からの呼出し【NGKI1204】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1205】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1206】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する参照操作が許可されていない〔P〕【NGKI1207】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_tskpriが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1208】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態【NGKI1209】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）の現在優先度を参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクの現在優先度が，p_tskpriが指すメモリ領域に返される【NGKI1210】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1211】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，get_priをサポートしない【SSPS0122】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>chg_spr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクのサブ優先度の変更〔T〕【NGKI3665】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = chg_spr(ID tskid, uint_t subpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サブ優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3666】<br>
・CPUロック状態からの呼出し【NGKI3667】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI3668】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI3669】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI3670】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI3671】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）のサブ優先度を，subpriで指定した値に変更する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクのサブ優先度が，subpriで指定した値に変更される【NGKI3672】．対象タスクが実行できる状態で，対象タスクの現在優先度がサブ優先度を使用すると設定されている場合には，優先度とサブ優先度が同じタスクの中で，対象タスクの優先順位が最も低くなる【NGKI3673】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI3674】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，chg_sprをサポートしない【ASPS0231】．ただし，サブ優先度機能拡張パッケージでは，chg_sprをサポートする【ASPS0232】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，chg_sprをサポートする【FMPS0169】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，chg_sprをサポートしない【HRPS0224】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，chg_sprをサポートしない【HRMPS0103】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，chg_sprをサポートしない【SSPS0161】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様およびTOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_inf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>自タスクの拡張情報の参照〔T〕【NGKI1212】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_inf(intptr_t *p_exinf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_exinf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張情報を入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exinf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張情報</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1213】<br>
・CPUロック状態からの呼出し【NGKI1214】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_exinfが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1215】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>自タスクの拡張情報を参照する．参照した拡張情報は，p_exinfが指すメモリ領域に返される【NGKI1216】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，get_infをサポートしない【SSPS0123】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの状態参照〔T〕【NGKI1217】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_tsk(ID tskid, T_RTSK *pk_rtsk)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RTSK *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rtsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊タスクの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの現在優先度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskbpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのベース優先度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのサブ優先度（サブ優先度機能をサポートするカーネルの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskwait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの待ち要因</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wobjid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの待ち対象のオブジェクトのID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lefttmo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクがタイムアウトするまでの時間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動要求キューイング数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wupcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起床要求キューイング数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク終了要求状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dister</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク終了禁止状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">svclevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの拡張サービスコールのネストレベル（保護機能対応カーネルの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの割付けプロセッサのID（マルチプロセッサ対応カーネルの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actprc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの次回起動時の割付けプロセッサのID（マルチプロセッサ対応カーネルの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1218】<br>
・CPUロック状態からの呼出し【NGKI1219】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1220】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1221】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する参照操作が許可されていない〔P〕【NGKI1222】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rtskが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1223】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）の現在状態を参照する．参照した現在状態は，pk_rtskで指定したメモリ領域に返される【NGKI1224】．</p>
</div>
<div class="paragraph">
<p>tskstatには，対象タスクの現在のタスク状態を表す次のいずれかの値が返される【NGKI1225】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_RUN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_RDY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行可能状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_WAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_SUS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x08U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">強制待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_WAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0cU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">二重待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_DMT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">休止状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクが自タスクの場合にも，tskstatがTTS_SUSとなる場合がある【NGKI1226】．この状況は，自タスクに対してref_tskを発行するのと同じタイミングで，他のプロセッサで実行されているタスクから同じタスクに対してsus_tskが発行された場合に発生する可能性がある．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，tskpriには対象タスクの現在優先度が，tskbpriには対象タスクのベース優先度が返される【NGKI1227】．対象タスクが休止状態である場合には，tskpriとtskbpriの値は保証されない【NGKI1228】．</p>
</div>
<div class="paragraph">
<p>サブ優先度機能をサポートするカーネルでは，subpriには対象タスクのサブ優先度が返される【NGKI3662】．</p>
</div>
<div class="paragraph">
<p>対象タスクが待ち状態である場合には，tskwaitには，対象タスクが何を待っている状態であるかを表す次のいずれかの値が返される【NGKI1229】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SLP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0001U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">起床待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_DLY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0002U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">時間経過待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0004U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの資源獲得待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_FLG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0008U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグ待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0010U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューへの送信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_RDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0020U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューからの受信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SPDQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0100U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューへの送信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_RPDQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0200U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューからの受信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_MTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0080U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックスのロック待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SMBF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0400U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファへの送信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_RMBF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0800U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファからの受信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_MPF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2000U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリブロックの獲得待ち</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>対象タスクが待ち状態でない場合には，tskwaitの値は保証されない【NGKI1230】．</p>
</div>
<div class="paragraph">
<p>対象タスクが起床待ち状態および時間経過待ち状態以外の待ち状態である場合には，wobjidに，対象タスクが待っているオブジェクトのID番号が返される【NGKI1231】．対象タスクが待ち状態でない場合や，起床待ち状態または時間経過待ち状態である場合には，wobjidの値は保証されない【NGKI1232】．</p>
</div>
<div class="paragraph">
<p>対象タスクが時間経過待ち状態以外の待ち状態である場合には，lefttmoに，タスクがタイムアウトを起こすまでの相対時間が返される【NGKI1233】．タスクがタイムアウトを起こさない場合には，TMO_FEVR（＝UINT32_MAX）が返される【NGKI1234】．</p>
</div>
<div class="paragraph">
<p>対象タスクが時間経過待ち状態である場合には，lefttmoに，タスクの遅延時間が経過して待ち解除されるまでの相対時間が返される【NGKI1235】．</p>
</div>
<div class="paragraph">
<p>対象タスクが待ち状態でない場合には，lefttmoの値は保証されない【NGKI1237】．</p>
</div>
<div class="paragraph">
<p>actcntには，対象タスクの起動要求キューイング数が返される【NGKI1238】．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，wupcntに，タスクの起床要求キューイング数が返される【NGKI1239】．また，rasterには，タスク終了要求フラグがセットされている場合にはtrue，クリアされている場合にはfalseが返される【NGKI3467】．disterには，タスク終了禁止状態の場合にはtrue，タスク終了許可状態の場合にはfalseが返される【NGKI3468】．対象タスクが休止状態である場合には，wupcnt，raster，disterの値は保証されない【NGKI1240】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルで，対象タスクが休止状態でない場合には，svclevelに，対象タスクが拡張サービスコールを呼び出していない場合には0，呼び出している場合には，実行中の拡張サービスコールがネスト段数が返される【NGKI1243】．対象タスクが休止状態である場合には，svclevelの値は保証されない【NGKI1244】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，prcidに，対象タスクの割付けプロセッサのID番号が返される【NGKI1245】．またactprcには，対象タスクの次回起動時の割付けプロセッサのID番号が返される【NGKI1246】．次回起動時の割付けプロセッサが未設定の場合には，actprcにTPRC_NONE（＝0）が返される【NGKI1247】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1248】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，tskwaitにTTW_SMBF，TTW_RMBFが返ることはない【ASPS0235】．ただし，メッセージバッファ機能拡張パッケージを用いると，tskwaitにTTW_SMBFとTTW_RMBFが返る場合がある【ASPS0208】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，tskwaitにTTW_SMBF，TTW_RMBFが返ることはない【FMPS0173】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ref_tskをサポートしない【SSPS0124】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_tskはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_tskを呼び出し，対象タスクの現在状態を参照した直後に割込みが発生した場合，ref_tskから戻ってきた時には対象タスクの状態が変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>対象タスクが時間経過待ち状態の時にlefttmoに返される値について規定した．参照できる情報に，タスク終了要求状態（raster）とタスク終了禁止状態か否か（dister）を追加した．逆に，参照できるタスクの状態から，強制待ち要求ネスト数（suscnt）を除外した．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで参照できる情報として，割付けプロセッサのID（prcid）と次回起動時の割付けプロセッサのID（actprc）を追加した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>保護機能対応カーネルで参照できる情報として，拡張サービスコールのネストレベル（svclevel）を追加した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>参照できる情報に，タスク終了要求状態（raster）とタスク終了禁止状態か否か（dister）を追加した．逆に，保護機能対応カーネルで参照できる情報から，タスク例外処理マスク状態か否か（texmsk）と待ち禁止状態か否か（waifbd）を削除した．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_2_タスク付属同期機能"><a class="anchor" href="#_4_2_タスク付属同期機能"></a><a class="link" href="#_4_2_タスク付属同期機能">4.2 タスク付属同期機能</a></h3>
<div class="paragraph">
<p>タスク付属同期機能は，タスクとタスクの間，または非タスクコンテキストの処理とタスクの間で同期を取るために，タスク単独で持っている機能である．</p>
</div>
<div class="paragraph">
<p>タスク付属同期機能に関連して，各タスクが持つ情報は次の通り【NGKI1249】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>起床要求キューイング数</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>タスクの起床要求キューイング数は，処理されていないタスクの起床要求の数であり，タスクの起動時に0に初期化される【NGKI1250】．</p>
</div>
<div class="paragraph">
<p>タスク付属同期機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_WUPCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起床要求キューイング数の最大値【NGKI1251】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，TMAX_WUPCNTは1に固定されている【ASPS0113】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，TMAX_WUPCNTは1に固定されている【FMPS0107】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，TMAX_WUPCNTは1に固定されている【HRPS0109】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，TMAX_WUPCNTは1に固定されている【HRMPS0104】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，タスク付属同期機能をサポートしない【SSPS0125】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>この仕様では，強制待ち要求をネストする機能をサポートしないこととした．言い換えると，強制待ち要求ネスト数の最大値を1に固定する．これに伴い，強制待ち状態から強制再開するサービスコール（frsm_tsk）とタスクの強制待ち要求ネスト数の最大値を表すカーネル構成マクロ（TMAX_SUSCNT）は廃止した．また，ref_tskで参照できる情報（T_RTSKのフィールド）から，強制待ち要求ネスト数（suscnt）を除外した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>待ち禁止状態への遷移を行うサービスコール（dis_wai）とその解除を行うサービスコール（ena_wai）を廃止した．待ち禁止状態の役割は，新たに導入したタスク終了要求フラグがセットされた状態が兼ねている．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>slp_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>起床待ち〔T〕【NGKI1252】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>tslp_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>起床待ち（タイムアウト付き）〔T〕【NGKI1253】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = slp_tsk()
	ER ercd = tslp_tsk(TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（tslp_tskの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・ディスパッチ保留状態からの呼出し【NGKI1254】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し【NGKI1255】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（tslp_tskの場合）【NGKI1256】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（slp_tskを除く）【NGKI1257】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除【NGKI1258】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求【NGKI3455】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>自タスクを起床待ちさせる．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>自タスクの起床要求キューイング数が0でない場合には，起床要求キューイング数から1が減ぜられる【NGKI1259】．起床要求キューイング数が0の場合には，自タスクは起床待ち状態となる【NGKI1260】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>自タスクの起床要求キューイング数が0でない場合には，自タスクは実行できる状態を維持し，自タスクの優先順位は変化しない．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>wup_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの起床〔TI〕【NGKI3531】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = wup_tsk(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI1265】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1266】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1267】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1268】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作1が許可されていない〔P〕【NGKI1269】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態【NGKI1270】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_QOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングオーバフロー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）を起床する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが起床待ち状態である場合には，対象タスクが待ち解除される【NGKI1271】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1272】．</p>
</div>
<div class="paragraph">
<p>対象タスクが起床待ち状態でなく，休止状態でもない場合には，対象タスクの起床要求キューイング数に1が加えられる【NGKI1273】．起床要求キューイング数に1を加えるとTMAX_WUPCNTを超える場合には，E_QOVRエラーとなる【NGKI1274】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストから呼び出した場合，tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1275】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>can_wup</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスク起床要求のキャンセル〔T〕【NGKI1276】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_UINT wupcnt = can_wup(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_UINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wupcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングされていた起床要求の数（正の値または0）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1277】<br>
・CPUロック状態からの呼出し【NGKI1278】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1279】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1280】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1281】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作1が許可されていない〔P〕【NGKI1282】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態【NGKI1283】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）に対する処理されていない起床要求をすべてキャンセルし，キャンセルした起床要求の数を返す．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクの起床要求キューイング数が0に設定され，0に設定する前の起床要求キューイング数が，サービスコールの返値として返される【NGKI1284】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1285】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>rel_wai</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>強制的な待ち解除〔TI〕【NGKI3532】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = rel_wai(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI1290】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1291】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1292】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1293】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI1294】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが待ち状態でない【NGKI1295】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）を，強制的に待ち解除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが待ち状態である場合には，対象タスクが待ち解除される【NGKI1296】．待ち解除されたタスクには，待ち状態となったサービスコールからE_RLWAIが返る【NGKI1297】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sus_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>強制待ち状態への遷移〔T〕【NGKI1298】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sus_tsk(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1299】<br>
・CPUロック状態からの呼出し【NGKI1300】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1301】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1302】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1303】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI1304】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態【NGKI1305】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求<br>
・対象タスクのタスク終了要求フラグがセットされている【NGKI3605】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_QOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングオーバフロー<br>
・対象タスクが強制待ち状態（二重待ち状態を含む）【NGKI1306】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）を強制待ちにする．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが実行できる状態である場合には，対象タスクは強制待ち状態となる【NGKI1307】．また，待ち状態（二重待ち状態を除く）である場合には，二重待ち状態となる【NGKI1308】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクが自タスクの場合にも，E_QOVRエラーとなる場合がある【NGKI1309】．この状況は，自タスクに対してsus_tskを発行するのと同じタイミングで，他のプロセッサで実行されているタスクから同じタスクに対してsus_tskが発行された場合に発生する可能性がある．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI1310】．</p>
</div>
<div class="paragraph">
<p>ディスパッチ保留状態で，対象タスクを自タスクとしてsus_tskを呼び出すと，E_CTXエラーとなる【NGKI1311】．なお，sus_tskは，自タスクを広義の待ち状態に遷移させる可能性のあるサービスコールであるが，対象タスクが自タスクでない場合には，割込み優先度マスクが全解除でない状態やディスパッチ禁止状態で呼び出しても，E_CTXエラーにはならない【NGKI3604】．これは，［NGKI0175］と［NGKI0179］の原則の例外となっている．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>rsm_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>強制待ち状態からの再開〔T〕【NGKI1312】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = rsm_tsk(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1313】<br>
・CPUロック状態からの呼出し【NGKI1314】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・対象タスクが制約タスク【NGKI1315】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1316】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1317】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI1318】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが強制待ち状態（二重待ち状態を含む）でない【NGKI1319】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）を，強制待ちから再開する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが強制待ち状態である場合には，対象タスクは強制待ちから再開される【NGKI1320】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>dly_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>自タスクの遅延〔T〕【NGKI1348】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = dly_tsk(RELTIM dlytim)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dlytim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">遅延時間</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・ディスパッチ保留状態からの呼出し【NGKI1349】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し【NGKI1350】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・dlytimがTMAX_RELTIMより大きい【NGKI1351】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除【NGKI1352】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求【NGKI3456】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dlytimで指定した時間，自タスクを遅延させる．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>自タスクは，dlytimで指定した時間が経過するまでの間，時間経過待ち状態となる【NGKI1353】．dly_tskを呼び出してからdlytimで指定した相対時間後に，自タスクは待ち解除され，dly_tskからE_OKが返る【NGKI1354】．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_3_タスク終了機能"><a class="anchor" href="#_4_3_タスク終了機能"></a><a class="link" href="#_4_3_タスク終了機能">4.3 タスク終了機能</a></h3>
<div class="paragraph">
<p>タスク終了機能には，自タスクを終了させる機能，タスクを安全に終了させるためのタスク終了要求機能，タスクを強制終了させる機能が含まれる．</p>
</div>
<div class="paragraph">
<p>タスク終了時には，次の処理が行われる．まず，終了するタスク（対象タスク）に対してタスク終了時に行うべきその他の処理が行われた後，対象タスクは休止状態になる【NGKI1178】．対象タスクの起動要求キューイング数が0でない場合には，対象タスクに対してタスク起動時に行うべき処理が行われ，対象タスクは実行できる状態になる【NGKI1179】．またこの時，起動要求キューイング数から1が減ぜられる【NGKI1180】．さらに，マルチプロセッサ対応カーネルにおいては，次回起動時の割付けプロセッサが設定されていれば，タスクの割付けプロセッサがそのプロセッサに変更され，次回起動時の割付けプロセッサは未設定の状態に戻される【NGKI1008】．</p>
</div>
<div class="paragraph">
<p>タスク終了要求機能に関連して，各タスクが持つ情報は次の通り【NGKI3684】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>タスク終了要求フラグ</p>
</li>
<li>
<p>タスク終了禁止フラグ</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>タスク終了要求フラグは，タスクに対する終了要求を記憶するためのフラグであり，タスクの起動時にクリアした状態に初期化される【NGKI3451】．</p>
</div>
<div class="paragraph">
<p>タスク終了禁止フラグは，タスクに対する終了要求を保留するためのフラグで，タスクの起動時にクリアした状態に初期化される【NGKI3454】．タスク終了禁止フラグがセットされた状態をタスク終了禁止状態，クリアされた状態をタスク終了許可状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>実行状態のタスクに対して，「タスク終了要求フラグがセットされる」「タスク終了許可状態である」「ディスパッチ許可状態である」「割込み優先度マスク全解除状態である」「CPUロック状態でない」の5つの条件が揃った場合，そのタスクは終了する．すなわち，そのタスクに対して，タスク終了時に行うべき処理が行われる【NGKI3683】．</p>
</div>
<div class="paragraph">
<p>タスク終了要求フラグがセットされたタスクは，広義の待ち状態になることがない．具体的には，広義の待ち状態のタスクのタスク終了要求フラグがセットされた場合，タスクは実行できる状態に遷移する【NGKI3452】．また，タスク終了要求フラグがセットされたタスクが，自タスクを待ち状態に遷移させる可能性のあるサービスコールを呼び出した場合には，E_RASTERエラーとなる【NGKI3453】．さらに，タスク終了要求フラグがセットされたタスクを強制待ち状態に遷移させるサービスコールを呼び出した場合にも，E_RASTERエラーとなる【NGKI3607】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>タスク終了要求機能を追加した．</p>
</div>
<div class="paragraph">
<p>タスク終了要求フラグがセットされた状態は，μITRON4.0/PX仕様で導入された待ち禁止状態を役割を兼ねている．ただし，この仕様でタスク終了要求フラグがセットされたタスクが自タスクを待ち状態に遷移させる可能性のあるサービスコールを呼び出した場合，無条件にエラーになる［NGKI3453］のに対して，TOPPERS新世代カーネル統合仕様で待ち禁止状態のタスクが同様のサービスコールを呼び出した場合には，待ち状態に遷移しようとした場合にのみエラーとなる［NGKI0222］．例えば，資源数が1のセマフォに対して，待ち禁止状態のタスクがwai_semを発行した場合，セマフォの獲得に成功するのに対して，タスク終了要求フラグがセットされたタスクが発行した場合には，E_RASTERエラーとなる．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ext_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>自タスクの終了〔T〕【NGKI1162】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ext_tsk()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_SYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムエラー<br>
・カーネルの誤動作【NGKI1163】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1164】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>自タスクを終了させる．具体的には，自タスクに対してタスク終了時に行うべき処理が行われる【NGKI3449】．</p>
</div>
<div class="paragraph">
<p>ext_tskは，CPUロック解除状態，割込み優先度マスク全解除状態，ディスパッチ許可状態で呼び出すのが原則であるが，そうでない状態で呼び出された場合には，CPUロック解除状態，割込み優先度マスク全解除状態，ディスパッチ許可状態に遷移させた後，自タスクを終了させる【NGKI1168】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，CPUロック解除状態に遷移させた後，自タスクを終了させる前に，割込みを受け付ける場合があり，その結果，他のタスクに切り換わる場合もある【NGKI5183】．これは，カーネル処理の不可分性の原則の例外となっている．</p>
</div>
<div class="paragraph">
<p>ext_tskが正常に処理された場合，ext_tskからはリターンしない【NGKI1169】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>保護機能対応カーネルにおいては，ext_tskによりCPUロック解除状態，割込み優先度マスク全解除状態，ディスパッチ許可状態に遷移した場合，システム周期の切換えとタイムウィンドウの切換えの保留が解除され，システム周期の切換えとタイムウィンドウの切換えが起こる可能性がある．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ext_tskをサポートしない【SSPS0118】．自タスクを終了させる場合には，タスクのメインルーチンからリターンする【SSPS0119】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>ext_tskを非タスクコンテキストから呼び出した場合に，E_CTXエラーが返ることとした．μITRON4.0仕様においては，ext_tskからはリターンしないと規定されている．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ras_ter</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの終了要求〔T〕【NGKI3469】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ras_ter(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3470】<br>
・CPUロック状態からの呼出し【NGKI3471】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI3472】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI3473】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI3474】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・対象タスクが自タスク【NGKI3475】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態【NGKI3476】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）に終了要求を行う．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でなく，タスク終了許可状態である場合には，対象タスクに対してタスク終了時に行うべき処理が行われる【NGKI3477】．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でなく，タスク終了禁止状態である場合には，対象タスクのタスク終了要求フラグがセットされる【NGKI3478】．また，対象タスクが待ち状態である場合には，対象タスクが待ち解除される【NGKI3479】．待ち解除されたタスクには，待ち状態となったサービスコールからE_RASTERが返る【NGKI3480】．さらに，対象タスクが強制待ち状態である場合には，対象タスクは強制待ちから再開される【NGKI3606】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクは，自タスクと同じプロセッサに割り付けられているタスクに限られる．対象タスクが自タスクと異なるプロセッサに割り付けられている場合には，E_OBJエラーとなる【NGKI3481】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ras_terをサポートしない【SSPS0151】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>dis_ter</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスク終了の禁止〔T〕【NGKI3482】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = dis_ter()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3483】<br>
・CPUロック状態からの呼出し【NGKI3484】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・自タスクが属する保護ドメインに対する通常操作2が許可されていない〔P〕【NGKI3764】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>自タスクのタスク終了禁止フラグをセットする【NGKI3486】．すなわち，自タスクをタスク終了禁止状態に遷移させる．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，dis_terをサポートしない【SSPS0152】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ena_ter</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスク終了の許可〔T〕【NGKI3487】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ena_ter()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3488】<br>
・CPUロック状態からの呼出し【NGKI3489】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・自タスクが属する保護ドメインに対する通常操作2が許可されていない〔P〕【NGKI3765】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>自タスクのタスク終了禁止フラグをクリアする【NGKI3491】．すなわち，自タスクをタスク終了許可状態に遷移させる．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>自タスクのタスク終了処理要求フラグがセットされていた場合には，タスク終了許可状態へ遷移した結果，自タスクが終了する可能性がある．この場合，ena_terからはリターンしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ena_terをサポートしない【SSPS0153】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sns_ter</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスク終了禁止状態の参照〔TI〕【NGKI3494】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = sns_ter()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク終了禁止状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>実行状態のタスク（タスクコンテキストから呼び出した場合には自タスク）のタスク終了禁止フラグを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>実行状態のタスクが，タスク終了禁止状態の場合にtrue，タスク終了許可状態の場合にfalseが返る【NGKI3495】．sns_terを非タスクコンテキストから呼び出した場合で，実行状態のタスクがない場合には，trueが返る【NGKI3496】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，サービスコールを呼び出した処理単位を実行しているプロセッサにおいて実行状態のタスクのタスク終了禁止フラグを参照する【NGKI3497】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>sns_terをタスクコンテキストから呼び出した場合，実行状態のタスクは自タスクに一致する．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，sns_terをサポートしない【SSPS0154】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ter_tsk</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの強制終了〔T〕【NGKI1170】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ter_tsk(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1171】<br>
・CPUロック状態からの呼出し【NGKI1172】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI1173】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI1174】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する管理操作が許可されていない〔P〕【NGKI3508】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・対象タスクが自タスク【NGKI1176】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象タスクが休止状態【NGKI1177】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）を終了させる．具体的には，対象タスクが休止状態でない場合には，対象タスクに対してタスク終了時に行うべき処理が行われる【NGKI3450】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクは，自タスクと同じプロセッサに割り付けられているタスクに限られる．対象タスクが自タスクと異なるプロセッサに割り付けられている場合には，E_OBJエラーとなる【NGKI1182】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ter_tskをサポートしない【SSPS0120】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>アクセス権を制御するためのアクセスの種別を，タスクに対する管理操作に変更した．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_4_同期通信機能"><a class="anchor" href="#_4_4_同期通信機能"></a><a class="link" href="#_4_4_同期通信機能">4.4 同期・通信機能</a></h3>
<div class="paragraph">
<p>同期・通信機能は，タスクとは独立したオブジェクトにより，タスクとタスクの間，または非タスクコンテキストの処理とタスクの間で同期・通信を行うための機能である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，同期・通信機能をサポートしない【SSPS0127】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>メールボックス機能を廃止した．また，ランデブ機能はサポートしていない．今後の検討により，ランデブ機能をサポートすることに変更する可能性もある．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>メールボックス機能を廃止した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>メールボックス機能を廃止したのは，保護機能対応カーネルではサポートできないためである．メールボックス機能は，ほとんどの場合に，データキュー機能または優先度データキュー機能を用いて，メッセージを置いたメモリ領域へのポインタを送受信する方法で置き換えることができる．</p>
</div>
<div class="sect3">
<h4 id="_4_4_1_セマフォ"><a class="anchor" href="#_4_4_1_セマフォ"></a><a class="link" href="#_4_4_1_セマフォ">4.4.1 セマフォ</a></h4>
<div class="paragraph">
<p>セマフォは，資源の数を表す0以上の整数値を取るカウンタ（資源数）を介して，排他制御やイベント通知を行うための同期・通信オブジェクトである．セマフォの資源数から1を減ずることを資源の獲得，資源数に1を加えることを資源の返却と呼ぶ．セマフォは，セマフォIDと呼ぶID番号によって識別する【NGKI1445】．</p>
</div>
<div class="paragraph">
<p>各セマフォが持つ情報は次の通り【NGKI1446】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>セマフォ属性</p>
</li>
<li>
<p>資源数（の現在値）</p>
</li>
<li>
<p>待ち行列（セマフォの資源獲得待ち状態のタスクのキュー）</p>
</li>
<li>
<p>初期資源数</p>
</li>
<li>
<p>最大資源数</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，セマフォの資源が獲得できるまで待っている状態（セマフォの資源獲得待ち状態）のタスクが，資源を獲得できる順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>セマフォの初期資源数は，セマフォを生成または再初期化した際の，資源数の初期値である．また，セマフォの最大資源数は，資源数が取りうる最大値である．資源数が最大資源数に一致している時に資源を返却しようとすると，E_QOVRエラーとなる【NGKI1447】．</p>
</div>
<div class="paragraph">
<p>セマフォ属性には，次の属性を指定することができる【NGKI1448】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち行列をタスクの優先度順にする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，待ち行列はFIFO順になる【NGKI1449】．</p>
</div>
<div class="paragraph">
<p>セマフォ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_MAXSEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの最大資源数の最大値（＝UINT_MAX）【NGKI1450】</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_SEMID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるセマフォの数（動的生成対応でないカーネルでは，静的APIによって登録されたセマフォの数に一致）【NGKI1451】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TNUM_SEMIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_SEM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの生成〔S〕【NGKI1452】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの生成〔TD〕【NGKI1453】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_SEM(ID semid, { ATR sematr, uint_t isemcnt, uint_t maxsem })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID semid = acre_sem(const T_CSEM *pk_csem)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するセマフォのID番号（CRE_SEMの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CSEM *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_csem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊セマフォの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sematr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォ属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isemcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの初期資源数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxsem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの最大資源数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたセマフォのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1454】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1455】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・sematrが無効【NGKI1456】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1457】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI1459】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI1458】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・maxsemが有効範囲（1以上，TMAX_MAXSEM以下）外【NGKI1468】<br>
・isemcntが有効範囲（0以上，maxsem以下）外【NGKI1466】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3967】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_csemが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI1461】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるセマフォIDがない〔sD〕【NGKI1462】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・semidで指定したセマフォが登録済み〔S〕【NGKI1463】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したセマフォの生成情報に従って，セマフォを生成する．生成されたセマフォの資源数は初期資源数に，待ち行列は空の状態に初期化される【NGKI1464】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，semidはオブジェクト識別名，sematr，isemcnt，maxsemは整数定数式パラメータである【NGKI1465】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_semをサポートする【ASPS0120】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_semをサポートする【HRPS0180】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_SEM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なセマフォIDの数の指定〔SD〕【NGKI1469】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_SEM(uint_t nosem)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nosem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なセマフォIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI1470】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5112】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nosemで指定した数のセマフォIDを，セマフォを生成するサービスコールによって割付け可能なセマフォIDとして確保する【NGKI1471】．</p>
</div>
<div class="paragraph">
<p>nosemは整数定数式パラメータである【NGKI1472】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_SEMをサポートする【ASPS0211】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_SEMをサポートする【HRPS0212】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_SEM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォのアクセス許可ベクタの設定〔SP〕【NGKI1473】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォのアクセス許可ベクタの設定〔TPD〕【NGKI1474】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_SEM(ID semid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_sem(ID semid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象セマフォのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1475】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1476】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・semidが有効範囲外〔s〕【NGKI1477】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象セマフォが属する保護ドメインの囲みの中（対象セマフォが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI1478】<br>
・対象セマフォが属するクラスの囲みの中に記述されていない〔SM〕【NGKI1479】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象セマフォが未登録【NGKI1480】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象セマフォに対する管理操作が許可されていない〔s〕【NGKI1481】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI1482】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象セマフォは静的APIで生成された〔s〕【NGKI1483】<br>
・対象セマフォに対してアクセス許可ベクタが設定済み〔S〕【NGKI1484】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>semidで指定したセマフォ（対象セマフォ）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI1485】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，semidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI1486】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_semをサポートする【HRPS0181】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの削除〔TD〕【NGKI1487】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_sem(ID semid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象セマフォのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1488】<br>
・CPUロック状態からの呼出し【NGKI1489】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・semidが有効範囲外【NGKI1490】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象セマフォが未登録【NGKI1491】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象セマフォに対する管理操作が許可されていない〔P〕【NGKI1492】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象セマフォは静的APIで生成された【NGKI1493】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>semidで指定したセマフォ（対象セマフォ）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの登録が解除され，そのセマフォIDが未使用の状態に戻される【NGKI1494】．また，対象セマフォの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI1495】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1496】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_semをサポートする【ASPS0123】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_semをサポートする【HRPS0182】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sig_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの資源の返却〔TI〕【NGKI3533】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sig_sem(ID semid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象セマフォのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI1501】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・semidが有効範囲外【NGKI1502】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象セマフォが未登録〔D〕【NGKI1503】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象セマフォに対する通常操作1が許可されていない〔P〕【NGKI1504】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_QOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングオーバフロー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>semidで指定したセマフォ（対象セマフォ）に資源を返却する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの待ち行列にタスクが存在する場合には，待ち行列の先頭のタスクが待ち解除される【NGKI1505】．この時，待ち解除されたタスクが資源を獲得したことになるため，対象セマフォの資源数は変化しない【NGKI1506】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1507】．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクが存在しない場合には，対象セマフォの資源数に1が加えられる【NGKI1508】．資源数に1を加えるとそのセマフォの最大資源数を越える場合には，E_QOVRエラーとなる【NGKI1509】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>wai_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの資源の獲得〔T〕【NGKI1510】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>pol_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの資源の獲得（ポーリング）〔T〕【NGKI1511】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>twai_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの資源の獲得（タイムアウト付き）〔T〕【NGKI1512】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = wai_sem(ID semid)
	ER ercd = pol_sem(ID semid)
	ER ercd = twai_sem(ID semid, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象セマフォのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（twai_semの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1513】<br>
・CPUロック状態からの呼出し【NGKI1514】<br>
・ディスパッチ保留状態からの呼出し（pol_semを除く）【NGKI1515】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（pol_semを除く）【NGKI1516】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・semidが有効範囲外【NGKI1517】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（twai_semの場合）【NGKI1518】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象セマフォが未登録〔D〕【NGKI1519】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象セマフォに対する通常操作2が許可されていない〔P〕【NGKI1520】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（wai_semを除く）【NGKI1521】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（pol_semを除く）【NGKI1522】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（pol_semを除く）【NGKI3457】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（pol_semを除く）【NGKI1523】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>semidで指定したセマフォ（対象セマフォ）から資源を獲得する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの資源数が1以上の場合には，資源数から1が減ぜられる【NGKI1524】．資源数が0の場合には，自タスクはセマフォの資源獲得待ち状態となり，対象セマフォの待ち行列につながれる【NGKI1525】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ini_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの再初期化〔T〕【NGKI1526】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ini_sem(ID semid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象セマフォのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1527】<br>
・CPUロック状態からの呼出し【NGKI1528】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・semidが有効範囲外【NGKI1529】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象セマフォが未登録〔D〕【NGKI1530】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象セマフォに対する管理操作が許可されていない〔P〕【NGKI1531】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>semidで指定したセマフォ（対象セマフォ）を再初期化する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの資源数は，初期資源数に初期化される【NGKI1532】．また，対象セマフォの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI1533】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1534】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>セマフォを再初期化した場合に，アプリケーションとの整合性を保つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_sem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セマフォの状態参照〔T〕【NGKI1535】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_sem(ID semid, T_RSEM *pk_rsem)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象セマフォのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RSEM *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rsem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊セマフォの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wtskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの資源数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1536】<br>
・CPUロック状態からの呼出し【NGKI1537】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・semidが有効範囲外【NGKI1538】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象セマフォが未登録〔D〕【NGKI1539】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象セマフォに対する参照操作が許可されていない〔P〕【NGKI1540】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rsemが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1541】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>semidで指定したセマフォ（対象セマフォ）の現在状態を参照する．参照した現在状態は，pk_rsemで指定したパケットに返される【NGKI1542】．</p>
</div>
<div class="paragraph">
<p>対象セマフォの待ち行列にタスクが存在しない場合，wtskidにはTSK_NONE（＝0）が返る【NGKI1543】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_semはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_semを呼び出し，対象セマフォの現在状態を参照した直後に割込みが発生した場合，ref_semから戻ってきた時には対象セマフォの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_4_2_イベントフラグ"><a class="anchor" href="#_4_4_2_イベントフラグ"></a><a class="link" href="#_4_4_2_イベントフラグ">4.4.2 イベントフラグ</a></h4>
<div class="paragraph">
<p>イベントフラグは，イベントの発生の有無を表すビットの集合（ビットパターン）を介して，イベント通知を行うための同期・通信オブジェクトである．イベントが発生している状態を1，発生していない状態を0とし，ビットパターンにより複数のイベントの発生の有無を表す【NGKI1544】．イベントフラグは，イベントフラグIDと呼ぶID番号によって識別する【NGKI1545】．</p>
</div>
<div class="paragraph">
<p>1つまたは複数のビットを1にする（セットする）ことを，イベントフラグをセットするといい，0にする（クリアする）ことを，イベントフラグをクリアするという．イベントフラグによりイベントを通知する側のタスクは，イベントフラグをセットまたはクリアすることで，イベントの発生を通知する．</p>
</div>
<div class="paragraph">
<p>イベントフラグによりイベントの通知を受ける側のタスクは，待ちビットパターンと待ちモードにより，どのビットがセットされるのを待つかを指定する．待ちモードにTWF_ORW（＝0x01U）を指定した場合，待ちビットパターンに含まれるいずれかのビットがセットされるのを待つ【NGKI1546】．待ちモードにTWF_ANDW（＝0x02U）を指定した場合，待ちビットパターンに含まれるすべてのビットがセットされるのを待つ【NGKI1547】．この条件を，イベントフラグの待ち解除の条件と呼ぶ．</p>
</div>
<div class="paragraph">
<p>各イベントフラグが持つ情報は次の通り【NGKI1548】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>イベントフラグ属性</p>
</li>
<li>
<p>ビットパターン（の現在値）</p>
</li>
<li>
<p>待ち行列（イベントフラグ待ち状態のタスクのキュー）</p>
</li>
<li>
<p>初期ビットパターン</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，イベントフラグが指定した待ち解除の条件を満たすまで待っている状態（イベントフラグ待ち状態）のタスクがつながれているキューである．待ち行列につながれたタスクの待ち解除は，待ち解除の条件を満たした中で，待ち行列の前方につながれたものから順に行われる（〔NGKI0216〕に該当）【NGKI1549】．</p>
</div>
<div class="paragraph">
<p>イベントフラグの初期ビットパターンは，イベントフラグを生成または再初期化した際の，ビットパターンの初期値である．</p>
</div>
<div class="paragraph">
<p>イベントフラグ属性には，次の属性を指定することができる【NGKI1550】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち行列をタスクの優先度順にする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_WMUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">複数のタスクが待つのを許す</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_CLR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの待ち解除時にイベントフラグをクリアする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，待ち行列はFIFO順になる【NGKI1551】．TA_WMULを指定しない場合，1つのイベントフラグに複数のタスクが待つことを禁止する【NGKI1552】．</p>
</div>
<div class="paragraph">
<p>TA_CLRを指定した場合，タスクの待ち解除時に，イベントフラグのビットパターンを0にクリアする【NGKI1553】．TA_CLRを指定しない場合，タスクの待ち解除時にイベントフラグをクリアしない【NGKI1554】．</p>
</div>
<div class="paragraph">
<p>イベントフラグ機能に用いるデータ型は次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのビットパターン（符号無し整数，uint_tに定義）【NGKI1555】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>イベントフラグ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBIT_FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのビット数（FLGPTNの有効ビット数）【NGKI1556】</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_FLGID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるイベントフラグの数（動的生成対応でないカーネルでは，静的APIによって登録されたイベントフラグの数に一致）【NGKI1557】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，イベントフラグのビット数（TBIT_FLGPTN）は16以上である【ASPS0124】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，イベントフラグのビット数（TBIT_FLGPTN）は16以上である【FMPS0115】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，イベントフラグのビット数（TBIT_FLGPTN）は16以上である【HRPS0115】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，イベントフラグのビット数（TBIT_FLGPTN）は16以上である【HRMPS0105】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TNUM_FLGIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_FLG</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグの生成〔S〕【NGKI1558】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグの生成〔TD〕【NGKI1559】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_FLG(ID flgid, { ATR flgatr, FLGPTN iflgptn })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID flgid = acre_flg(const T_CFLG *pk_cflg)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するイベントフラグのID番号（CRE_FLGの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CFLG *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cflg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊イベントフラグの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグ属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iflgptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグの初期ビットパターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたイベントフラグのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1560】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1561】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・flgatrが無効【NGKI1562】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1563】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI1565】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI1564】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・iflgptnがFLGPTNに格納できない〔S〕【NGKI3275】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3968】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cflgが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI1567】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるイベントフラグIDがない〔sD〕【NGKI1568】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・flgidで指定したイベントフラグが登録済み〔S〕【NGKI1569】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したイベントフラグの生成情報に従って，イベントフラグを生成する．生成されたイベントフラグのビットパターンは初期ビットパターンに，待ち行列は空の状態に初期化される【NGKI1570】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，flgidはオブジェクト識別名，flgatrとiflgptnは整数定数式パラメータである【NGKI1571】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_flgをサポートする【ASPS0126】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_flgをサポートする【HRPS0183】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_FLG</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なイベントフラグIDの数の指定〔SD〕【NGKI1572】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_FLG(uint_t noflg)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">noflg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なイベントフラグIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI1573】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5113】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>noflgで指定した数のイベントフラグIDを，イベントフラグを生成するサービスコールによって割付け可能なイベントフラグIDとして確保する【NGKI1574】．</p>
</div>
<div class="paragraph">
<p>noflgは整数定数式パラメータである【NGKI1575】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_FLGをサポートする【ASPS0212】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_FLGをサポートする【HRPS0213】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_FLG</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグのアクセス許可ベクタの設定〔SP〕【NGKI1576】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグのアクセス許可ベクタの設定〔TPD〕【NGKI1577】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_FLG(ID flgid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_flg(ID flgid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象イベントフラグのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1578】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1579】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・flgidが有効範囲外〔s〕【NGKI1580】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象イベントフラグが属する保護ドメインの囲みの中（対象イベントフラグが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI1581】<br>
・対象イベントフラグが属するクラスの囲みの中に記述されていない〔SM〕【NGKI1582】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象イベントフラグが未登録【NGKI1583】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象イベントフラグに対する管理操作が許可されていない〔s〕【NGKI1584】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI1585】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象イベントフラグは静的APIで生成された〔s〕【NGKI1586】<br>
・対象イベントフラグに対してアクセス許可ベクタが設定済み〔S〕【NGKI1587】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>flgidで指定したイベントフラグ（対象イベントフラグ）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI1588】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，flgidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI1589】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_flgをサポートする【HRPS0184】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグの削除〔TD〕【NGKI1590】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_flg(ID flgid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象イベントフラグのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1591】<br>
・CPUロック状態からの呼出し【NGKI1592】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・flgidが有効範囲外【NGKI1593】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象イベントフラグが未登録【NGKI1594】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象イベントフラグに対する管理操作が許可されていない〔P〕【NGKI1595】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象イベントフラグは静的APIで生成された【NGKI1596】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>flgidで指定したイベントフラグ（対象イベントフラグ）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグの登録が解除され，そのイベントフラグIDが未使用の状態に戻される【NGKI1597】．また，対象イベントフラグの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI1598】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1599】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_flgをサポートする【ASPS0129】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_flgをサポートする【HRPS0185】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>set_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグのセット〔TI〕【NGKI3534】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = set_flg(ID flgid, FLGPTN setptn)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象イベントフラグのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セットするビットパターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI1604】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・flgidが有効範囲外【NGKI1605】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象イベントフラグが未登録〔D〕【NGKI1606】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象イベントフラグに対する通常操作1が許可されていない〔P〕【NGKI1607】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>flgidで指定したイベントフラグ（対象イベントフラグ）のsetptnで指定したビットをセットする．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグのビットパターンは，それまでの値とsetptnで指定した値のビット毎論理和（C言語の"|"）に更新される【NGKI1608】．対象イベントフラグの待ち行列にタスクが存在する場合には，待ち解除の条件を満たしたタスクが，待ち行列の前方につながれたものから順に待ち解除される【NGKI1609】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1610】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>対象イベントフラグがTA_CLR属性である場合には，待ち解除の条件を満たしたタスクを1つ待ち解除した時点で，対象イベントフラグのビットパターンが0にクリアされるため，他のタスクが待ち解除されることはない．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>clr_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグのクリア〔T〕【NGKI1611】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = clr_flg(ID flgid, FLGPTN clrptn)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象イベントフラグのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clrptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">クリアするビットパターン（クリアしないビットを1，クリアするビットを0とする）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1612】<br>
・CPUロック状態からの呼出し【NGKI1613】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・flgidが有効範囲外【NGKI1614】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象イベントフラグが未登録〔D〕【NGKI1615】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象イベントフラグに対する通常操作1が許可されていない〔P〕【NGKI1616】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>flgidで指定したイベントフラグ（対象イベントフラグ）のclrptnで指定したビットをクリアする．対象イベントフラグのビットパターンは，それまでの値とclrptnで指定した値のビット毎論理積（C言語の"&amp;"）に更新される【NGKI1617】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>wai_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグ待ち〔T〕【NGKI1618】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>pol_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグ待ち（ポーリング）〔T〕【NGKI1619】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>twai_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグ待ち（タイムアウト付き）〔T〕【NGKI1620】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = wai_flg(ID flgid, FLGPTN waiptn, MODE wfmode, FLGPTN *p_flgptn)
	ER ercd = pol_flg(ID flgid, FLGPTN waiptn, MODE wfmode, FLGPTN *p_flgptn)
	ER ercd = twai_flg(ID flgid, FLGPTN waiptn,
									MODE wfmode, FLGPTN *p_flgptn, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象イベントフラグのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">waiptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちビットパターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wfmode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちモード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_flgptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち解除時のビットパターンを入れるメモリ領域へのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（twai_flgの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち解除時のビットパターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1621】<br>
・CPUロック状態からの呼出し【NGKI1622】<br>
・ディスパッチ保留状態からの呼出し（pol_flgを除く）【NGKI1623】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（pol_flgを除く）【NGKI1624】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・flgidが有効範囲外【NGKI1625】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・waiptnが0【NGKI1626】<br>
・wfmodeが無効（TWF_ORWまたはTWF_ANDWでない）【NGKI1627】<br>
・tmoutが無効（twai_flgの場合）【NGKI1628】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象イベントフラグが未登録〔D〕【NGKI1629】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象イベントフラグに対する通常操作2が許可されていない〔P〕【NGKI1630】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_flgptnが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1631】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・TA_WMUL属性でないイベントフラグで待ちタスクあり【NGKI1632】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（wai_flgを除く）【NGKI1633】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（pol_flgを除く）【NGKI1634】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（pol_flgを除く）【NGKI3458】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（pol_flgを除く）【NGKI1635】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>flgidで指定したイベントフラグ（対象イベントフラグ）が，waiptnとwfmodeで指定した待ち解除の条件を満たすのを待つ．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグが，waiptnとwfmodeで指定した待ち解除の条件を満たしている場合には，対象イベントフラグのビットパターンの現在値がp_flgptnが指すメモリ領域に返される【NGKI1636】．対象イベントフラグがTA_CLR属性である場合には，対象イベントフラグのビットパターンが0にクリアされる【NGKI1637】．</p>
</div>
<div class="paragraph">
<p>待ち解除の条件を満たしていない場合には，自タスクはイベントフラグ待ち状態となり，対象イベントフラグの待ち行列につながれる【NGKI1638】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ini_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグの再初期化〔T〕【NGKI1639】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ini_flg(ID flgid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象イベントフラグのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1640】<br>
・CPUロック状態からの呼出し【NGKI1641】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・flgidが有効範囲外【NGKI1642】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象イベントフラグが未登録〔D〕【NGKI1643】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象イベントフラグに対する管理操作が許可されていない〔P〕【NGKI1644】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>flgidで指定したイベントフラグ（対象イベントフラグ）を再初期化する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグのビットパターンは，初期ビットパターンに初期化される【NGKI1645】．また，対象イベントフラグの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI1646】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1647】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>イベントフラグを再初期化した場合に，アプリケーションとの整合性を保つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_flg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>イベントフラグの状態参照〔T〕【NGKI1648】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_flg(ID flgid, T_RFLG *pk_rflg)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象イベントフラグのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RFLG *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rflg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊イベントフラグの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wtskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグの待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flgptn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのビットパターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1649】<br>
・CPUロック状態からの呼出し【NGKI1650】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・flgidが有効範囲外【NGKI1651】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象イベントフラグが未登録〔D〕【NGKI1652】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象イベントフラグに対する参照操作が許可されていない〔P〕【NGKI1653】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rflgが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1654】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>flgidで指定したイベントフラグ（対象イベントフラグ）の現在状態を参照する．参照した現在状態は，pk_rflgで指定したパケットに返される【NGKI1655】．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグの待ち行列にタスクが存在しない場合，wtskidにはTSK_NONE（＝0）が返る【NGKI1656】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_flgはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_flgを呼び出し，対象イベントフラグの現在状態を参照した直後に割込みが発生した場合，ref_flgから戻ってきた時には対象イベントフラグの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_4_3_データキュー"><a class="anchor" href="#_4_4_3_データキュー"></a><a class="link" href="#_4_4_3_データキュー">4.4.3 データキュー</a></h4>
<div class="paragraph">
<p>データキューは，1ワードのデータをメッセージとして，FIFO順で送受信するための同期・通信オブジェクトである．より大きいサイズのメッセージを送受信したい場合には，メッセージを置いたメモリ領域へのポインタを1ワードのデータとして送受信する方法がある．データキューは，データキューIDと呼ぶID番号によって識別する【NGKI1657】．</p>
</div>
<div class="paragraph">
<p>各データキューが持つ情報は次の通り【NGKI1658】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>データキュー属性</p>
</li>
<li>
<p>データキュー管理領域</p>
</li>
<li>
<p>送信待ち行列（データキューへの送信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>受信待ち行列（データキューからの受信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>データキュー管理領域は，データキューに送信されたデータを，送信された順に格納しておくためのメモリ領域である．データキュー生成時に，データキュー管理領域に格納できるデータ数を0とすることで，データキュー管理領域のサイズを0とすることができる【NGKI1659】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，データキュー管理領域は，カーネルの管理領域として扱われる【NGKI1660】．</p>
</div>
<div class="paragraph">
<p>送信待ち行列は，データキューに対してデータが送信できるまで待っている状態（データキューへの送信待ち状態）のタスクが，データを送信できる順序でつながれているキューである．また，受信待ち行列は，データキューからデータが受信できるまで待っている状態（データキューからの受信待ち状態）のタスクが，データを受信できる順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>データキュー属性には，次の属性を指定することができる【NGKI1661】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信待ち行列をタスクの優先度順にする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，送信待ち行列はFIFO順になる【NGKI1662】．受信待ち行列は，FIFO順に固定されている【NGKI1663】．</p>
</div>
<div class="paragraph">
<p>データキュー機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_DTQID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるデータキューの数（動的生成対応でないカーネルでは，静的APIによって登録されたデータキューの数に一致）【NGKI1664】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TNUM_DTQIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_DTQ</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューの生成〔S〕【NGKI1665】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューの生成〔TD〕【NGKI1666】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_DTQ(ID dtqid, { ATR dtqatr, uint_t dtqcnt, void *dtqmb })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ dtqmbの記述は省略することができる【NGKI3901】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID dtqid = acre_dtq(const T_CDTQ *pk_cdtq)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するデータキューのID番号（CRE_DTQの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CDTQ *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cdtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊データキューの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキュー属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキュー管理領域に格納できるデータ数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqmb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキュー管理領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたデータキューのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1667】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1668】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・dtqatrが無効【NGKI1669】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1670】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI1672】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI1671】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については各カーネルにおける規定の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3969】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cdtqが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI1674】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるデータキューIDがない〔sD〕【NGKI1675】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・データキュー管理領域が確保できない【NGKI1676】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・dtqidで指定したデータキューが登録済み〔S〕【NGKI1677】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したデータキューの生成情報に従って，データキューを生成する．dtqcntとdtqmbからデータキュー管理領域が設定され，格納されているデータがない状態に初期化される【NGKI1678】．また，送信待ち行列と受信待ち行列は，空の状態に初期化される【NGKI1679】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，dtqidはオブジェクト識別名，dtqatrとdtqcntは整数定数式パラメータ，dtqmbは一般定数式パラメータである【NGKI1680】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI1681】．</p>
</div>
<div class="paragraph">
<p>dtqmbをNULLとするか，静的APIにおいてdtqmbの記述を省略した場合，dtqcntで指定した数のデータを格納できるデータキュー管理領域が，コンフィギュレータまたはカーネルにより確保される【NGKI1682】．</p>
</div>
<div class="paragraph">
<div class="title">〔dtqmbにNULL以外を指定した場合〕</div>
<p>dtqmbにNULL以外を指定した場合，dtqmbを先頭番地とするデータキュー管理領域は，アプリケーションで確保しておく必要がある【NGKI1683】．データキュー管理領域をアプリケーションで確保するために，次のマクロを用意している【NGKI1684】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_DTQMB(dtqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqcntで指定した数のデータを格納できるデータキュー管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_DTQMB(dtqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqcntで指定した数のデータを格納できるデータキュー管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらを用いて，dtqcntで指定した数のデータを格納できるデータキュー管理領域を確保する方法は次の通り【NGKI1685】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	MB_T	&lt;データキュー管理領域の変数名&gt;[TCNT_DTQMB(dtqcnt)];</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時，dtqmbには&lt;データキュー管理領域の変数名&gt;を指定する【NGKI1686】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，dtqmbにターゲット定義の制約に合致しない先頭番地を指定した時には，E_PARエラーとなる【NGKI1687】．また，保護機能対応カーネルにおいて，dtqmbで指定したデータキュー管理領域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI1688】．</p>
</div>
<div class="paragraph">
<p>なお，dtqmbにNULL以外を指定できないカーネルでは，TSZ_DTQMBとTCNT_DTQMBは用意していない【NGKI5179】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，dtqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【ASPS0132】．</p>
</div>
<div class="paragraph">
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_dtqをサポートする【ASPS0133】．acre_dtqに対しては，dtqmbにNULL以外を指定できないという制限はない【ASPS0134】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，dtqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【FMPS0121】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，dtqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRPS0121】．</p>
</div>
<div class="paragraph">
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_dtqをサポートする【HRPS0186】．acre_dtqに対しては，dtqmbにNULL以外を指定できないという制限はない【HRPS0187】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，dtqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRMPS0106】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0/PX仕様にあわせて，データキューの生成情報の最後のパラメータを，dtq（データキュー領域の先頭番地）から，dtqmb（データキュー管理領域の先頭番地）に改名した．また，TSZ_DTQをTSZ_DTQMBに改名した．</p>
</div>
<div class="paragraph">
<p>TCNT_DTQMBを新設し，データキュー管理領域をアプリケーションで確保する方法を規定した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_DTQ</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なデータキューIDの数の指定〔SD〕【NGKI1689】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_DTQ(uint_t nodtq)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なデータキューIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI1690】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5114】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nodtqで指定した数のデータキューIDを，データキューを生成するサービスコールによって割付け可能なデータキューIDとして確保する【NGKI1691】．</p>
</div>
<div class="paragraph">
<p>nodtqは整数定数式パラメータである【NGKI1692】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_DTQをサポートする【ASPS0213】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_DTQをサポートする【HRPS0214】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_DTQ</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューのアクセス許可ベクタの設定〔SP〕【NGKI1693】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューのアクセス許可ベクタの設定〔TPD〕【NGKI1694】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_DTQ(ID dtqid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_dtq(ID dtqid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1695】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1696】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・dtqidが有効範囲外〔s〕【NGKI1697】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象データキューが属する保護ドメインの囲みの中（対象データキューが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI1698】<br>
・対象データキューが属するクラスの囲みの中に記述されていない〔SM〕【NGKI1699】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象データキューが未登録【NGKI1700】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象データキューに対する管理操作が許可されていない〔s〕【NGKI1701】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI1702】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象データキューは静的APIで生成された〔s〕【NGKI1703】<br>
・対象データキューに対してアクセス許可ベクタが設定済み〔S〕【NGKI1704】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dtqidで指定したデータキュー（対象データキュー）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI1705】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，dtqidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI1706】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_dtqをサポートする【HRPS0188】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューの削除〔TD〕【NGKI1707】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_dtq(ID dtqid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象データキューのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1708】<br>
・CPUロック状態からの呼出し【NGKI1709】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・dtqidが有効範囲外【NGKI1710】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象データキューが未登録【NGKI1711】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象データキューに対する管理操作が許可されていない〔P〕【NGKI1712】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象データキューは静的APIで生成された【NGKI1713】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dtqidで指定したデータキュー（対象データキュー）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューの登録が解除され，そのデータキューIDが未使用の状態に戻される【NGKI1714】．また，対象データキューの送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタスクから順に待ち解除される【NGKI1715】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1716】．</p>
</div>
<div class="paragraph">
<p>データキューの生成時に，データキュー管理領域がカーネルによって確保された場合は，そのメモリ領域が解放される【NGKI1717】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_dtqをサポートする【ASPS0137】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_dtqをサポートする【HRPS0189】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>snd_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューへの送信〔T〕【NGKI1718】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>psnd_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューへの送信（ポーリング）〔TI〕【NGKI3535】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>tsnd_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューへの送信（タイムアウト付き）〔T〕【NGKI1721】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = snd_dtq(ID dtqid, intptr_t data)
	ER ercd = psnd_dtq(ID dtqid, intptr_t data)
	ER ercd = tsnd_dtq(ID dtqid, intptr_t data, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信データ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（tsnd_dtqの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し（psnd_dtqを除く）【NGKI1722】<br>
・CPUロック状態からの呼出し【NGKI1724】<br>
・ディスパッチ保留状態からの呼出し（psnd_dtqを除く）【NGKI1725】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（psnd_dtqを除く）【NGKI1726】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・dtqidが有効範囲外【NGKI1727】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（tsnd_dtqの場合）【NGKI1728】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象データキューが未登録〔D〕【NGKI1729】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象データキューに対する通常操作1が許可されていない〔P〕【NGKI1730】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（snd_dtqを除く）【NGKI1731】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（psnd_dtqを除く）【NGKI1732】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（psnd_dtqを除く）【NGKI3459】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（psnd_dtqを除く）【NGKI1733】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dtqidで指定したデータキュー（対象データキュー）に，dataで指定したデータを送信する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在する場合には，受信待ち行列の先頭のタスクが，dataで指定したデータを受信し，待ち解除される【NGKI1734】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1735】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域にデータを格納するスペースがある場合には，dataで指定したデータが，FIFO順でデータキュー管理領域に格納される【NGKI1736】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域にデータを格納するスペースがない場合には，自タスクはデータキューへの送信待ち状態となり，対象データキューの送信待ち行列につながれる【NGKI1737】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>fsnd_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューへの強制送信〔TI〕【NGKI3536】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = fsnd_dtq(ID dtqid, intptr_t data)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信データ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI1742】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・dtqidが有効範囲外【NGKI1743】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象データキューが未登録〔D〕【NGKI1744】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象データキューに対する通常操作1が許可されていない〔P〕【NGKI1745】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・対象データキューのデータキュー管理領域のサイズが0【NGKI1746】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dtqidで指定したデータキュー（対象データキュー）に，dataで指定したデータを強制送信する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在する場合には，受信待ち行列の先頭のタスクが，dataで指定したデータを受信し，待ち解除される【NGKI1747】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1748】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域にデータを格納するスペースがある場合には，dataで指定したデータが，FIFO順でデータキュー管理領域に格納される【NGKI1749】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域にデータを格納するスペースがない場合には，データキュー管理領域の先頭に格納されたデータを削除し，空いたスペースを用いて，dataで指定したデータが，FIFO順でデータキュー管理領域に格納される【NGKI1750】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>rcv_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューからの受信〔T〕【NGKI1751】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>prcv_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューからの受信（ポーリング）〔T〕【NGKI1752】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>trcv_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューからの受信（タイムアウト付き）〔T〕【NGKI1753】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = rcv_dtq(ID dtqid, intptr_t *p_data)
	ER ercd = prcv_dtq(ID dtqid, intptr_t *p_data)
	ER ercd = trcv_dtq(ID dtqid, intptr_t *p_data, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信データを入れるメモリ領域へのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（trcv_dtqの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信データ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1754】<br>
・CPUロック状態からの呼出し【NGKI1755】<br>
・ディスパッチ保留状態からの呼出し（prcv_dtqを除く）【NGKI1756】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（prcv_dtqを除く）【NGKI1757】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・dtqidが有効範囲外【NGKI1758】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（trcv_dtqの場合）【NGKI1759】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象データキューが未登録〔D〕【NGKI1760】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象データキューに対する通常操作2が許可されていない〔P〕【NGKI1761】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_dataが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1762】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（rcv_dtqを除く）【NGKI1763】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（prcv_dtqを除く）【NGKI1764】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（prcv_dtqを除く）【NGKI3460】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（prcv_dtqを除く）【NGKI1765】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dtqidで指定したデータキュー（対象データキュー）からデータを受信する．データの受信に成功した場合，受信したデータはp_dataが指すメモリ領域に返される【NGKI3421】．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域にデータが格納されている場合には，データキュー管理領域の先頭に格納されたデータを受信する【NGKI1766】．また，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタスクの送信データが，FIFO順でデータキュー管理領域に格納され，そのタスクは待ち解除される【NGKI1767】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1768】．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域にデータが格納されておらず，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタスクの送信データを受信する【NGKI1769】．送信待ち行列の先頭のタスクは，待ち解除される【NGKI3422】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1770】．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域にデータが格納されておらず，送信待ち行列にタスクが存在しない場合には，自タスクはデータキューからの受信待ち状態となり，対象データキューの受信待ち行列につながれる【NGKI1771】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ini_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューの再初期化〔T〕【NGKI1772】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ini_dtq(ID dtqid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象データキューのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1773】<br>
・CPUロック状態からの呼出し【NGKI1774】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・dtqidが有効範囲外【NGKI1775】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象データキューが未登録〔D〕【NGKI1776】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象データキューに対する管理操作が許可されていない〔P〕【NGKI1777】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dtqidで指定したデータキュー（対象データキュー）を再初期化する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域は，格納されているデータがない状態に初期化される【NGKI1778】．また，対象データキューの送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタスクから順に待ち解除される【NGKI1779】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1780】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がない．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>データキューを再初期化した場合に，アプリケーションとの整合性を保つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_dtq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>データキューの状態参照〔T〕【NGKI1781】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_dtq(ID dtqid, T_RDTQ *pk_rdtq)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RDTQ *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rdtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊データキューの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューの送信待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rtskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューの受信待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sdtqcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキュー管理領域に格納されているデータの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1782】<br>
・CPUロック状態からの呼出し【NGKI1783】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・dtqidが有効範囲外【NGKI1784】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象データキューが未登録〔D〕【NGKI1785】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象データキューに対する参照操作が許可されていない〔P〕【NGKI1786】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rdtqが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1787】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>dtqidで指定したデータキュー（対象データキュー）の現在状態を参照する．参照した現在状態は，pk_rdtqで指定したパケットに返される【NGKI1788】．</p>
</div>
<div class="paragraph">
<p>対象データキューの送信待ち行列にタスクが存在しない場合，stskidにはTSK_NONE（＝0）が返る【NGKI1789】．また，受信待ち行列にタスクが存在しない場合，rtskidにはTSK_NONE（＝0）が返る【NGKI1790】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_dtqはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_dtqを呼び出し，対象データキューの現在状態を参照した直後に割込みが発生した場合，ref_dtqから戻ってきた時には対象データキューの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_4_4_優先度データキュー"><a class="anchor" href="#_4_4_4_優先度データキュー"></a><a class="link" href="#_4_4_4_優先度データキュー">4.4.4 優先度データキュー</a></h4>
<div class="paragraph">
<p>優先度データキューは，1ワードのデータをメッセージとして，データの優先度順で送受信するための同期・通信オブジェクトである．より大きいサイズのメッセージを送受信したい場合には，メッセージを置いたメモリ領域へのポインタを1ワードのデータとして送受信する方法がある．優先度データキューは，優先度データキューIDと呼ぶID番号によって識別する【NGKI1791】．</p>
</div>
<div class="paragraph">
<p>各優先度データキューが持つ情報は次の通り【NGKI1792】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>優先度データキュー属性</p>
</li>
<li>
<p>優先度データキュー管理領域</p>
</li>
<li>
<p>送信待ち行列（優先度データキューへの送信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>受信待ち行列（優先度データキューからの受信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>送信できるデータ優先度の最大値</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>優先度データキュー管理領域は，優先度データキューに送信されたデータを，データの優先度順に格納しておくためのメモリ領域である．優先度データキュー生成時に，優先度データキュー管理領域に格納できるデータ数を0とすることで，優先度データキュー管理領域のサイズを0とすることができる【NGKI1793】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，優先度データキュー管理領域は，カーネルの管理領域として扱われる【NGKI1794】．</p>
</div>
<div class="paragraph">
<p>送信待ち行列は，優先度データキューに対してデータが送信できるまで待っている状態（優先度データキューへの送信待ち状態）のタスクが，データを送信できる順序でつながれているキューである．また，受信待ち行列は，優先度データキューからデータが受信できるまで待っている状態（優先度データキューからの受信待ち状態）のタスクが，データを受信できる順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>優先度データキュー属性には，次の属性を指定することができる【NGKI1795】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信待ち行列をタスクの優先度順にする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，送信待ち行列はFIFO順になる【NGKI1796】．受信待ち行列は，FIFO順に固定されている【NGKI1797】．</p>
</div>
<div class="paragraph">
<p>優先度データキュー機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 40%;">
<col style="width: 37.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_DPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データ優先度の最小値（＝1）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">【NGKI1798】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_DPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データ優先度の最大値</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_PDQID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できる優先度データキューの数（動的生成対応でないカーネルでは，静的APIによって登録された優先度データキューの数に一致）【NGKI1799】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，データ優先度の最大値（TMAX_DPRI）は16に固定されている【ASPS0138】．ただし，タスク優先度拡張パッケージでは，TMAX_DPRIを256に拡張する【ASPS0139】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，データ優先度の最大値（TMAX_DPRI）は16に固定されている【FMPS0124】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，データ優先度の最大値（TMAX_DPRI）は16に固定されている【HRPS0124】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，データ優先度の最大値（TMAX_DPRI）は16に固定されている【HRMPS0107】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>データの優先度が使われるのは，データが優先度データキュー管理領域に格納される場合のみであり，データを送信するタスクが送信待ち行列につながれている間には使われない．そのため，送信待ち行列につながれているタスクが，優先度データキュー管理領域に格納されているデータよりも高い優先度のデータを送信しようとしている場合でも，最初に送信されるのは，優先度データキュー管理領域に格納されているデータである．また，TA_TPRI属性の優先度データキューにおいても，送信待ち行列はタスクの優先度順となり，タスクが送信しようとしているデータの優先度順となるわけではない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に規定されていない機能である．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_PDQ</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューの生成〔S〕【NGKI1800】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューの生成〔TD〕【NGKI1801】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_PDQ(ID pdqid, { ATR pdqatr, uint_t pdqcnt, PRI maxdpri, void *pdqmb })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ pdqmbの記述は省略することができる【NGKI3902】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID pdqid = acre_pdq(const T_CPDQ *pk_cpdq)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成する優先度データキューのID番号（CRE_PDQの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CPDQ *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cpdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊優先度データキューの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキュー属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキュー管理領域に格納できるデータ数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxdpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューに送信できるデータ優先度の最大値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqmb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキュー管理領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成された優先度データキューのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1802】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1803】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・pdqatrが無効【NGKI1804】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1805】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI1807】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI1806】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については各カーネルにおける規定の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・maxdpriが有効範囲（TMIN_DPRI以上，TMAX_DPRI以下）外【NGKI1819】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3970】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cpdqが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI1809】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられる優先度データキューIDがない〔sD〕【NGKI1810】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・優先度データキュー管理領域が確保できない【NGKI1811】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・pdqidで指定した優先度データキューが登録済み〔S〕【NGKI1812】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した優先度データキューの生成情報に従って，優先度データキューを生成する．pdqcntとpdqmbから優先度データキュー管理領域が設定され，格納されているデータがない状態に初期化される【NGKI1813】．また，送信待ち行列と受信待ち行列は，空の状態に初期化される【NGKI1814】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，pdqidはオブジェクト識別名，pdqatr，pdqcnt，maxdpriは整数定数式パラメータ，pdqmbは一般定数式パラメータである【NGKI1815】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI1816】．</p>
</div>
<div class="paragraph">
<p>pdqmbをNULLとするか，静的APIにおいてpdqmbの記述を省略した場合，pdqcntで指定した数のデータを格納できる優先度データキュー管理領域が，コンフィギュレータまたはカーネルにより確保される【NGKI1817】．</p>
</div>
<div class="paragraph">
<div class="title">〔pdqmbにNULL以外を指定した場合〕</div>
<p>pdqmbにNULL以外を指定した場合，pdqmbを先頭番地とする優先度データキュー管理領域は，アプリケーションで確保しておく必要がある【NGKI1820】．優先度データキュー管理領域をアプリケーションで確保するために，次のマクロを用意している【NGKI1821】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_PDQMB(pdqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqcntで指定した数のデータを格納できる優先度データキュー管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_PDQMB(pdqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqcntで指定した数のデータを格納できる優先度データキュー管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらを用いて，pdqcntで指定した数のデータを格納できる優先度データキュー管理領域を確保する方法は次の通り【NGKI1822】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	MB_T	&lt;優先度データキュー管理領域の変数名&gt;[TCNT_PDQMB(pdqcnt)];</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時，pdqmbには&lt;優先度データキュー管理領域の変数名&gt;を指定する【NGKI1823】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，pdqmbにターゲット定義の制約に合致しない先頭番地を指定した時には，E_PARエラーとなる【NGKI1824】．また，保護機能対応カーネルにおいて，pdqmbで指定した優先度データキュー管理領域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI1825】．</p>
</div>
<div class="paragraph">
<p>なお，pdqmbにNULL以外を指定できないカーネルでは，TSZ_PDQMBとTCNT_PDQMBは用意していない【NGKI5180】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，pdqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【ASPS0142】．</p>
</div>
<div class="paragraph">
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_pdqをサポートする【ASPS0143】．acre_pdqに対しては，pdqmbにNULL以外を指定できないという制限はない【ASPS0144】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，pdqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【FMPS0127】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，pdqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRPS0127】．</p>
</div>
<div class="paragraph">
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_pdqをサポートする【HRPS0190】．acre_pdqに対しては，pdqmbにNULL以外を指定できないという制限はない【HRPS0191】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，pdqmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRMPS0108】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_PDQ</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能な優先度データキューIDの数の指定〔SD〕【NGKI1826】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_PDQ(uint_t nopdq)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nopdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能な優先度データキューIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI1827】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5115】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nopdqで指定した数の優先度データキューIDを，優先度データキューを生成するサービスコールによって割付け可能な優先度データキューIDとして確保する【NGKI1828】．</p>
</div>
<div class="paragraph">
<p>nopdqは整数定数式パラメータである【NGKI1829】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_PDQをサポートする【ASPS0214】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_PDQをサポートする【HRPS0215】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_PDQ</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューのアクセス許可ベクタの設定〔SP〕【NGKI1830】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューのアクセス許可ベクタの設定〔TPD〕【NGKI1831】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_PDQ(ID pdqid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_pdq(ID pdqid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象優先度データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI1832】<br>
・CPUロック状態からの呼出し〔s〕【NGKI1833】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・pdqidが有効範囲外〔s〕【NGKI1834】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象優先度データキューが属する保護ドメインの囲みの中（対象優先度データキューが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI1835】<br>
・対象優先度データキューが属するクラスの囲みの中に記述されていない〔SM〕【NGKI1836】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象優先度データキューが未登録【NGKI1837】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象優先度データキューに対する管理操作が許可されていない〔s〕【NGKI1838】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI1839】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象優先度データキューは静的APIで生成された〔s〕【NGKI1840】<br>
・対象優先度データキューに対してアクセス許可ベクタが設定済み〔S〕【NGKI1841】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI1842】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，pdqidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI1843】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_pdqをサポートする【HRPS0192】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューの削除〔TD〕【NGKI1844】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_pdq(ID pdqid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象優先度データキューのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1845】<br>
・CPUロック状態からの呼出し【NGKI1846】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・pdqidが有効範囲外【NGKI1847】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象優先度データキューが未登録【NGKI1848】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象優先度データキューに対する管理操作が許可されていない〔P〕【NGKI1849】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象優先度データキューは静的APIで生成された【NGKI1850】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの登録が解除され，その優先度データキューIDが未使用の状態に戻される【NGKI1851】．また，対象優先度データキューの送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタスクから順に待ち解除される【NGKI1852】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1853】．</p>
</div>
<div class="paragraph">
<p>優先度データキューの生成時に，優先度データキュー管理領域がカーネルによって確保された場合は，そのメモリ領域が解放される【NGKI1854】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_pdqをサポートする【ASPS0147】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_pdqをサポートする【HRPS0193】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>snd_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューへの送信〔T〕【NGKI1855】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>psnd_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューへの送信（ポーリング）〔TI〕【NGKI3537】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>tsnd_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューへの送信（タイムアウト付き）〔T〕【NGKI1858】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = snd_pdq(ID pdqid, intptr_t data, PRI datapri)
	ER ercd = psnd_pdq(ID pdqid, intptr_t data, PRI datapri)
	ER ercd = tsnd_pdq(ID pdqid, intptr_t data, PRI datapri, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象優先度データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信データ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datapri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信データの優先度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（tsnd_pdqの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し（psnd_pdqを除く）【NGKI1859】<br>
・CPUロック状態からの呼出し【NGKI1861】<br>
・ディスパッチ保留状態からの呼出し（psnd_pdqを除く）【NGKI1862】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（psnd_pdqを除く）【NGKI1863】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・pdqidが有効範囲外【NGKI1864】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（tsnd_pdqの場合）【NGKI1865】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象優先度データキューが未登録〔D〕【NGKI1866】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象優先度データキューに対する通常操作1が許可されていない〔P〕【NGKI1867】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（snd_pdqを除く）【NGKI1868】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（psnd_pdqを除く）【NGKI1869】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（psnd_pdqを除く）【NGKI3461】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（psnd_pdqを除く）【NGKI1870】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）に，dataで指定したデータを，datapriで指定した優先度で送信する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの受信待ち行列にタスクが存在する場合には，受信待ち行列の先頭のタスクが，dataで指定したデータを受信し，待ち解除される【NGKI1871】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1872】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの受信待ち行列にタスクが存在せず，優先度データキュー管理領域にデータを格納するスペースがある場合には，dataで指定したデータが，datapriで指定したデータの優先度順で優先度データキュー管理領域に格納される【NGKI1873】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの受信待ち行列にタスクが存在せず，優先度データキュー管理領域にデータを格納するスペースがない場合には，自タスクは優先度データキューへの送信待ち状態となり，対象優先度データキューの送信待ち行列につながれる【NGKI1874】．</p>
</div>
<div class="paragraph">
<p>datapriは，TMIN_DPRI以上で，対象データキューに送信できるデータ優先度の最大値以下でなければならない．そうでない場合には，E_PARエラーとなる【NGKI1876】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>rcv_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューからの受信〔T〕【NGKI1877】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>prcv_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューからの受信（ポーリング）〔T〕【NGKI1878】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>trcv_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューからの受信（タイムアウト付き）〔T〕【NGKI1879】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = rcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri)
	ER ercd = prcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri)
	ER ercd = trcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象優先度データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信データを入れるメモリ領域へのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_datapri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信データの優先度を入れるメモリ領域へのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（trcv_pdqの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信データ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datapri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信データの優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1880】<br>
・CPUロック状態からの呼出し【NGKI1881】<br>
・ディスパッチ保留状態からの呼出し（prcv_pdqを除く）【NGKI1882】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（prcv_pdqを除く）【NGKI1883】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・pdqidが有効範囲外【NGKI1884】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（trcv_pdqの場合）【NGKI1885】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象優先度データキューが未登録〔D〕【NGKI1886】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象優先度データキューに対する通常操作2が許可されていない〔P〕【NGKI1887】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_dataが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1888】<br>
・p_datapriが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1889】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（rcv_pdqを除く）【NGKI1890】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（prcv_pdqを除く）【NGKI1891】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（prcv_pdqを除く）【NGKI3462】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（prcv_pdqを除く）【NGKI1892】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）からデータを受信する．データの受信に成功した場合，受信したデータはp_dataが指すメモリ領域に，その優先度はp_datapriが指すメモリ領域に返される【NGKI1894】．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域にデータが格納されている場合には，優先度データキュー管理領域の先頭に格納されたデータを受信する【NGKI1893】．また，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタスクの送信データが，データの優先度順で優先度データキュー管理領域に格納され，そのタスクは待ち解除される【NGKI1895】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1896】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域にデータが格納されておらず，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタスクの送信データを受信する【NGKI1897】．送信待ち行列の先頭のタスクは，待ち解除される【NGKI1899】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI1900】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域にデータが格納されておらず，送信待ち行列にタスクが存在しない場合には，自タスクは優先度データキューからの受信待ち状態となり，対象優先度データキューの受信待ち行列につながれる【NGKI1901】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ini_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューの再初期化〔T〕【NGKI1902】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ini_pdq(ID pdqid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象優先度データキューのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1903】<br>
・CPUロック状態からの呼出し【NGKI1904】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・pdqidが有効範囲外【NGKI1905】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象優先度データキューが未登録〔D〕【NGKI1906】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象優先度データキューに対する管理操作が許可されていない〔P〕【NGKI1907】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）を再初期化する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域は，格納されているデータがない状態に初期化される【NGKI1908】．また，対象優先度データキューの送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタスクから順に待ち解除される【NGKI1909】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1910】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がない．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>優先度データキューを再初期化した場合に，アプリケーションとの整合性を保つのは，アプリケーションの責任である．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_pdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>優先度データキューの状態参照〔T〕【NGKI1911】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_pdq(ID pdqid, T_RPDQ *pk_rpdq)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象優先度データキューのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RPDQ *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rpdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊優先度データキューの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューの送信待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rtskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューの受信待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spdqcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキュー管理領域に格納されているデータの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI1912】<br>
・CPUロック状態からの呼出し【NGKI1913】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・pdqidが有効範囲外【NGKI1914】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象優先度データキューが未登録〔D〕【NGKI1915】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象優先度データキューに対する参照操作が許可されていない〔P〕【NGKI1916】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rpdqが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI1917】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）の現在状態を参照する．参照した現在状態は，pk_rpdqで指定したパケットに返される【NGKI1918】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの送信待ち行列にタスクが存在しない場合，stskidにはTSK_NONE（＝0）が返る【NGKI1919】．また，受信待ち行列にタスクが存在しない場合，rtskidにはTSK_NONE（＝0）が返る【NGKI1920】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_pdqはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_pdqを呼び出し，対象優先度データキューの現在状態を参照した直後に割込みが発生した場合，ref_pdqから戻ってきた時には対象優先度データキューの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_4_5_ミューテックス"><a class="anchor" href="#_4_4_5_ミューテックス"></a><a class="link" href="#_4_4_5_ミューテックス">4.4.5 ミューテックス</a></h4>
<div class="paragraph">
<p>ミューテックスは，タスク間の排他制御を行うための同期・通信オブジェクトである．タスクは，排他制御区間に入る時にミューテックスをロックし，排他制御区間を出る時にロック解除する．ミューテックスは，ミューテックスIDと呼ぶID番号によって識別する【NGKI2007】．</p>
</div>
<div class="paragraph">
<p>ミューテックスは，排他制御に伴う優先度逆転の時間を最小限に抑えるための優先度上限プロトコル（priority ceiling protocol）をサポートする．ミューテックス属性により優先度上限ミューテックスであると指定することで，そのミューテックスの操作時に，優先度上限プロトコルに従った現在優先度の制御が行われる．</p>
</div>
<div class="paragraph">
<p>各ミューテックスが持つ情報は次の通り【NGKI2008】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ミューテックス属性</p>
</li>
<li>
<p>ロック状態（ロックされている状態とロック解除されている状態）</p>
</li>
<li>
<p>ミューテックスをロックしているタスク</p>
</li>
<li>
<p>待ち行列（ミューテックスのロック待ち状態のタスクのキュー）</p>
</li>
<li>
<p>上限優先度（優先度上限ミューテックスの場合）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，ミューテックスをロックできるまで待っている状態（ミューテックスのロック待ち状態）のタスクが，ミューテックスをロックできる順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>上限優先度は，優先度上限ミューテックスに対してのみ有効で，ミューテックスの生成時に，そのミューテックスをロックする可能性のあるタスクのベース優先度の中で最も高い優先度（または，それより高い優先度）に設定する【NGKI2009】．</p>
</div>
<div class="paragraph">
<p>ミューテックス属性には，次の属性を指定することができる【NGKI2010】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち行列をタスクの優先度順にする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_CEILING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度上限ミューテックスとする．待ち行列をタスクの優先度順にする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_TPRI，TA_CEILINGのいずれも指定しない場合，待ち行列はFIFO順になる【NGKI2011】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能に関連して，各タスクが持つ情報は次の通り【NGKI2012】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ロックしているミューテックスのリスト</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ロックしているミューテックスのリストは，タスクの起動時に空に初期化される【NGKI2013】．</p>
</div>
<div class="paragraph">
<p>タスクの現在優先度は，そのタスクのベース優先度と，そのタスクがロックしている優先度上限ミューテックスの優先度上限の中で，最も高い優先度に設定される【NGKI2014】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能によりタスクの現在優先度が変化する場合には，以下の処理が行われる．</p>
</div>
<div class="paragraph">
<p>現在優先度を変化させるサービスコールの前後とも，当該タスクが実行できる状態である場合には，優先度が同じタスク（サブ優先度が使われる状況では，サブ優先度も同じタスク）の中で優先順位が最も高くなる【NGKI2015】．そのサービスコールにより，当該タスクが実行できる状態に遷移する場合には，優先度が同じタスク（この場合には，サブ優先度が使われる状況は起こらない）の中で優先順位が最も低くなる【NGKI2016】．</p>
</div>
<div class="paragraph">
<p>そのサービスコールの後で，当該タスクが待ち状態で，タスクの優先度順の待ち行列につながれている場合には，当該タスクの変更後の現在優先度に従って，その待ち行列中での順序が変更される【NGKI2017】．待ち行列中に同じ現在優先度のタスクがある場合には，当該タスクの順序はそれらの中で最後になる【NGKI2018】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能に関連して，タスクの終了時に行うべき処理として，タスクがロックしているミューテックスのロック解除がある．タスクの終了時にロックしているミューテックスが残っている場合，それらのミューテックスは，ロックしたのと逆の順序でロック解除される【NGKI2019】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_MTXID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるミューテックスの数（動的生成対応でないカーネルでは，静的APIによって登録されたミューテックスの数に一致）【NGKI2020】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>優先度上限プロトコルには，(a) 優先度の低いタスクの排他制御区間に最大1回しかブロックされない，(b) タスクの実行が開始された以降は優先度の低いタスクにブロックされないという利点があるが，これは，タスク間の同期に優先度上限ミューテックスのみを用い，他の方法でタスクのスケジューリングに関与しない場合に得られる利点である．</p>
</div>
<div class="paragraph">
<p>これらの利点を得るためには，タスクの優先順位の回転やディスパッチの禁止を行ってはならないことに加えて，優先度上限ミューテックスをロックしたタスクを待ち状態にしてはならない．特に，優先度上限ミューテックスに対して，タスクがロック待ち状態になる状況に注意が必要である（優先度上限プロトコルでは，タスクがミューテックスのロック待ち状態になることはない）．</p>
</div>
<div class="paragraph">
<p>例えば，着目するタスクAと，タスクAよりベース優先度の低いタスクBとタスクC，タスクAよりも高い上限優先度を持った優先度上限ミューテックスがある場合を考える．タスクAがミューテックスをロックし，タスクBとタスクCがミューテックスを待っている状況で，タスクAがミューテックスをロック解除すると，タスクBがミューテックスをロックして優先度が上がり，タスクBに切り換わる．さらにタスクBがミューテックスをロック解除すると，タスクCがミューテックスをロックして優先度が上がり，タスクCに切り換わる．タスクAが実行されるのは，タスクCがミューテックスをロック解除した後である．この例では，タスクAが実行開始後に，タスクBとタスクCの排他制御区間にブロックされることになる．</p>
</div>
<div class="paragraph">
<p>優先度上限ミューテックスに対してタスクがロック待ち状態になる状況を回避するためには，優先度上限ミューテックスをロックする場合に，待ち状態にならないploc_mtxを用いるのが安全である．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサにおいては，タスク間の同期に優先度上限ミューテックスのみを用い，他の方法でタスクのスケジューリングに関与しない場合でも，優先度上限ミューテックスに対してタスクがロック待ち状態になる場合がある．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>この仕様で優先度上限プロトコルと呼んでいる方式は，オリジナルのpriority ceiling protocolとは異なるものである．この仕様の方式は，OSEK/VDX OS仕様でもpriority ceiling protocolと呼ばれているが，学術論文や他のOSでは，immediate ceiling priority protocol，priority protection protocol，priority ceiling emulation，highest locker protocolなどと呼ばれている．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様の厳密な優先度制御規則を採用し，簡略化した優先度制御規則はサポートしていない．また，μITRON4.0仕様でサポートしている優先度継承プロトコル（priority inheritance protocol）は，現時点ではサポートしていない．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能によりタスクの現在優先度が変化する場合の振舞いは，μITRON4.0仕様では実装依存となっているが，この仕様では規定している．</p>
</div>
<div class="paragraph">
<p>TNUM_MTXIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ミューテックスは標準機能の位置付けとした．そのため，ASP3カーネルとFMP3カーネルにおいても，ミューテックスをサポートする．</p>
</div>
<div class="paragraph">
<p>ミューテックスのロック解除は，ロックしたのと逆順で行わなければならないものとした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_MTX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスの生成〔S〕【NGKI2021】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスの生成〔TD〕【NGKI2022】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_MTX(ID mtxid, { ATR mtxatr, PRI ceilpri })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ 優先度上限ミューテックス以外の場合には，ceilpriの記述を省略することができる【NGKI2035】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID mtxid = acre_mtx(const T_CMTX *pk_cmtx)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するミューテックスのID番号（CRE_MTXの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CMTX *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cmtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックスの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊ミューテックスの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックス属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ceilpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックスの上限優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたミューテックスのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2023】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2024】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・mtxatrが無効【NGKI2025】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2026】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI2028】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI2027】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3971】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cmtxが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI2030】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるミューテックスIDがない〔sD〕【NGKI2031】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・mtxidで指定したミューテックスが登録済み〔S〕【NGKI2032】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したミューテックスの生成情報に従って，ミューテックスを生成する．生成されたミューテックスのロック状態はロックされていない状態に，待ち行列は空の状態に初期化される【NGKI2033】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mtxidはオブジェクト識別名，mtxatrとceilpriは整数定数式パラメータである【NGKI2034】．</p>
</div>
<div class="paragraph">
<p>優先度上限ミューテックスを生成する場合で，ceilpriが有効範囲（TMIN_TPRI以上，TMAX_TPRI以下）外の場合には，E_PARエラーとなる【NGKI2037】．また，サブ優先度機能をサポートするカーネルで，ceilpriで指定した優先度がサブ優先度を使用すると設定されている場合には，E_ILUSEエラーとなる【NGKI3682】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>優先度上限ミューテックス以外の場合には，ceilpriは使用されない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_mtxをサポートする【ASPS0228】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_mtxをサポートする【HRPS0194】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_MTX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なミューテックスIDの数の指定〔SD〕【NGKI2038】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_MTX(uint_t nomtx)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nomtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なミューテックスIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI2039】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5116】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nomtxで指定した数のミューテックスIDを，ミューテックスを生成するサービスコールによって割付け可能なミューテックスIDとして確保する【NGKI2040】．</p>
</div>
<div class="paragraph">
<p>nomtxは整数定数式パラメータである【NGKI2041】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_MTXをサポートする【ASPS0222】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_MTXをサポートする【HRPS0216】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_MTX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスのアクセス許可ベクタの設定〔SP〕【NGKI2042】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスのアクセス許可ベクタの設定〔TPD〕【NGKI2043】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_MTX(ID mtxid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_mtx(ID mtxid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象ミューテックスのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2044】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2045】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mtxidが有効範囲外〔s〕【NGKI2046】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象ミューテックスが属する保護ドメインの囲みの中（対象ミューテックスが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI2047】<br>
・対象ミューテックスが属するクラスの囲みの中に記述されていない〔SM〕【NGKI2048】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象ミューテックスが未登録【NGKI2049】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象ミューテックスに対する管理操作が許可されていない〔s〕【NGKI2050】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI2051】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象ミューテックスは静的APIで生成された〔s〕【NGKI2052】<br>
・対象ミューテックスに対してアクセス許可ベクタが設定済み〔S〕【NGKI2053】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mtxidで指定したミューテックス（対象ミューテックス）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI2054】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mtxidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI2055】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_mtxをサポートする【HRPS0195】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスの削除〔TD〕【NGKI2056】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_mtx(ID mtxid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象ミューテックスのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2057】<br>
・CPUロック状態からの呼出し【NGKI2058】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mtxidが有効範囲外【NGKI2059】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象ミューテックスが未登録【NGKI2060】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象ミューテックスに対する管理操作が許可されていない〔P〕【NGKI2061】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象ミューテックスは静的APIで生成された【NGKI2062】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mtxidで指定したミューテックス（対象ミューテックス）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスの登録が解除され，そのミューテックスIDが未使用の状態に戻される【NGKI2063】．対象ミューテックスをロックしているタスクがある場合には，そのタスクがロックしているミューテックスのリストから対象ミューテックスが削除され，必要な場合にはそのタスクの現在優先度が変更される【NGKI2064】．また，対象ミューテックスの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI2065】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI2066】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>対象ミューテックスをロックしているタスクには，ミューテックスが削除されたことが通知されず，そのミューテックスをロック解除する時点でエラーとなる．これが不都合な場合には，ミューテックスを削除しようとするタスクがミューテックスをロックした状態で，ミューテックスを削除すればよい．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_mtxをサポートする【ASPS0223】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_mtxをサポートする【HRPS0196】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>loc_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスのロック〔T〕【NGKI2067】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ploc_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスのロック（ポーリング）〔T〕【NGKI2068】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>tloc_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスのロック（タイムアウト付き）〔T〕【NGKI2069】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = loc_mtx(ID mtxid)
	ER ercd = ploc_mtx(ID mtxid)
	ER ercd = tloc_mtx(ID mtxid, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象ミューテックスのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（tloc_mtxの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2070】<br>
・CPUロック状態からの呼出し【NGKI2071】<br>
・ディスパッチ保留状態からの呼出し（ploc_mtxを除く）【NGKI2072】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（ploc_mtxを除く）【NGKI2073】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mtxidが有効範囲外【NGKI2074】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（tloc_mtxの場合）【NGKI2075】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象ミューテックスが未登録〔D〕【NGKI2076】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象ミューテックスに対する通常操作1が許可されていない〔P〕【NGKI2077】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象ミューテックスが自タスクによってロックされている【NGKI3609】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（loc_mtxを除く）【NGKI2078】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（ploc_mtxを除く）【NGKI2079】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（ploc_mtxを除く）【NGKI3463】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（ploc_mtxを除く）【NGKI2080】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mtxidで指定したミューテックス（対象ミューテックス）をロックする．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスがロックされていない場合には，自タスクによってロックされている状態になる【NGKI2081】．自タスクがロックしているミューテックスのリストに対象ミューテックスが追加され，必要な場合には自タスクの現在優先度が変更される【NGKI2082】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスが自タスク以外のタスクによってロックされている場合には，自タスクはミューテックスのロック待ち状態となり，対象ミューテックスの待ち行列につながれる【NGKI2083】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスが優先度上限ミューテックスで，その上限優先度より自タスクのベース優先度が高い場合には，E_ILUSEエラーとなる【NGKI2085】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>unl_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスのロック解除〔T〕【NGKI2086】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = unl_mtx(ID mtxid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象ミューテックスのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2087】<br>
・CPUロック状態からの呼出し【NGKI2088】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mtxidが有効範囲外【NGKI2089】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象ミューテックスが未登録〔D〕【NGKI2090】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象ミューテックスに対する通常操作1が許可されていない〔P〕【NGKI3273】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象ミューテックスが，自タスクによってロックされているミューテックスの中で，最後にロックされたものでない【NGKI3611】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mtxidで指定したミューテックス（対象ミューテックス）をロック解除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>まず，自タスクがロックしているミューテックスのリストから対象ミューテックスが削除され，必要な場合には自タスクの現在優先度が変更される【NGKI2091】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスの待ち行列にタスクが存在する場合には，待ち行列の先頭のタスクが待ち解除される【NGKI2092】．対象ミューテックスは，待ち解除されたタスクによってロックされている状態になる【NGKI2093】．待ち解除されたタスクがロックしているミューテックスのリストに対象ミューテックスが追加され，必要な場合にはそのタスクの現在優先度が変更される【NGKI2094】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI2095】．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクが存在しない場合には，対象ミューテックスはロックされていない状態になる【NGKI2096】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ミューテックスのロック解除を，ロックしたのと逆順で行わない場合にエラーになるように，エラーの条件を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ini_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスの再初期化〔T〕【NGKI2098】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ini_mtx(ID mtxid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象ミューテックスのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2099】<br>
・CPUロック状態からの呼出し【NGKI2100】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mtxidが有効範囲外【NGKI2101】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象ミューテックスが未登録〔D〕【NGKI2102】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象ミューテックスに対する管理操作が許可されていない〔P〕【NGKI2103】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mtxidで指定したミューテックス（対象ミューテックス）を再初期化する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスのロック状態は，ロックされていない状態に初期化される【NGKI2104】．対象ミューテックスをロックしているタスクがある場合には，そのタスクがロックしているミューテックスのリストから対象ミューテックスが削除され，必要な場合にはそのタスクの現在優先度が変更される【NGKI2105】．また，対象ミューテックスの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI2106】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI2107】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>対象ミューテックスをロックしているタスクには，ミューテックスが再初期化されたことが通知されず，そのミューテックスをロック解除する時点でエラーとなる．これが不都合な場合には，ミューテックスを再初期化しようとするタスクがミューテックスをロックした状態で，ミューテックスを再初期化すればよい．</p>
</div>
<div class="paragraph">
<p>ミューテックスを再初期化した場合に，アプリケーションとの整合性を保つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_mtx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ミューテックスの状態参照〔T〕【NGKI2108】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_mtx(ID mtxid, T_RMTX *pk_rmtx)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtxid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象ミューテックスのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RMTX *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rmtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックスの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊ミューテックスの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">htskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックスをロックしているタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wtskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックスの待ち行列の先頭のタスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2109】<br>
・CPUロック状態からの呼出し【NGKI2110】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mtxidが有効範囲外【NGKI2111】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象ミューテックスが未登録〔D〕【NGKI2112】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象ミューテックスに対する参照操作が許可されていない〔P〕【NGKI2113】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rmtxが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2114】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mtxidで指定したミューテックス（対象ミューテックス）の現在状態を参照する．参照した現在状態は，pk_rmtxで指定したパケットに返される．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスがロックされていない場合，htskidにはTSK_NONE（＝0）が返る【NGKI2115】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスの待ち行列にタスクが存在しない場合，wtskidにはTSK_NONE（＝0）が返る【NGKI2116】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_mtxはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_mtxを呼び出し，対象ミューテックスの現在状態を参照した直後に割込みが発生した場合，ref_mtxから戻ってきた時には対象ミューテックスの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_4_6_メッセージバッファ"><a class="anchor" href="#_4_4_6_メッセージバッファ"></a><a class="link" href="#_4_4_6_メッセージバッファ">4.4.6 メッセージバッファ</a></h4>
<div class="paragraph">
<p>メッセージバッファは，指定したサイズのバイト列をメッセージとして，FIFO順で送受信するための同期・通信オブジェクトである．メッセージの送受信において，メッセージの単位は保存される．すなわち，送信側が指定したメッセージサイズを，受信側はそのまま受け取る．メッセージバッファは，メッセージバッファIDと呼ぶID番号によって識別する【NGKI3291】．</p>
</div>
<div class="paragraph">
<p>各メッセージバッファが持つ情報は次の通り【NGKI3292】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メッセージバッファ属性</p>
</li>
<li>
<p>最大メッセージサイズ</p>
</li>
<li>
<p>メッセージバッファ管理領域</p>
</li>
<li>
<p>送信待ち行列（メッセージバッファへの送信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>受信待ち行列（メッセージバッファからの受信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メッセージバッファ管理領域は，メッセージバッファに送信されたメッセージを，送信された順に格納しておくためのメモリ領域である．メッセージバッファ生成時の指定により，メッセージバッファ管理領域のサイズを0とすることができる【NGKI3293】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，メッセージバッファ管理領域は，カーネルの管理領域として扱われる【NGKI3294】．</p>
</div>
<div class="paragraph">
<p>送信待ち行列は，メッセージバッファに対してメッセージが送信できるまで待っている状態（メッセージバッファへの送信待ち状態）のタスクが，メッセージを送信できる順序でつながれているキューである．送信待ち行列は，FIFO順に固定されている【NGKI3523】．</p>
</div>
<div class="paragraph">
<p>受信待ち行列は，メッセージバッファからメッセージが受信できるまで待っている状態（メッセージバッファからの受信待ち状態）のタスクが，メッセージを受信できる順序でつながれているキューである．受信待ち行列は，FIFO順に固定されている【NGKI3297】．</p>
</div>
<div class="paragraph">
<p>メッセージバッファ属性に指定できる属性はない【NGKI3521】．そのためメッセージバッファ属性には，TA_NULLを指定しなければならない【NGKI3522】．</p>
</div>
<div class="paragraph">
<p>メッセージバッファ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_MBFID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるメッセージバッファの数（動的生成対応でないカーネルでは，静的APIによって登録されたメッセージバッファの数に一致）【NGKI3298】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，メッセージバッファ機能をサポートしない【ASPS0202】．ただし，メッセージバッファ機能拡張パッケージを用いると，メッセージバッファ機能を追加することができる【ASPS0203】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，メッセージバッファ機能をサポートしない【FMPS0167】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，メッセージバッファ機能をサポートする【HRPS0232】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，メッセージバッファ機能をサポートする【HRMPS0109】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TNUM_MBFIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_MBF</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファの生成〔S〕【NGKI3299】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファの生成〔TD〕【NGKI3300】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_MBF(ID mbfid, { ATR mbfatr, uint_t maxmsz, size_t mbfsz, void *mbfmb })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ mbfmbの記述は省略することができる【NGKI3903】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID mbfid = acre_mbf(const T_CMBF *pk_cmbf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するメッセージバッファのID番号（CRE_MBFの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CMBF *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cmbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊メッセージバッファの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファ属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxmsz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファの最大メッセージサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfsz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファ管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfmb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファ管理領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたメッセージバッファのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI3301】<br>
・CPUロック状態からの呼出し〔s〕【NGKI3302】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・mbfatrが無効【NGKI3303】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI3304】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI3306】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI3305】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については各カーネルにおける規定の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・maxmszが0【NGKI3307】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3972】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cmbfが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI3310】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるメッセージバッファIDがない〔sD〕【NGKI3311】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・メッセージバッファ管理領域が確保できない【NGKI3312】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・mbfidで指定したメッセージバッファが登録済み〔S〕【NGKI3313】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したメッセージバッファの生成情報に従って，メッセージバッファを生成する．mbfszとmbfmbからメッセージバッファ管理領域が設定され，格納されているメッセージがない状態に初期化される【NGKI3314】．また，送信待ち行列と受信待ち行列は，空の状態に初期化される【NGKI3315】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mbfidはオブジェクト識別名，mbfatr，maxmsz，mbfszは整数定数式パラメータ，mbfmbは一般定数式パラメータである【NGKI3316】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI3317】．</p>
</div>
<div class="paragraph">
<p>mbfmbをNULLとするか，静的APIにおいてmbfmbの記述を省略した場合，mbfszで指定したサイズのメッセージバッファ管理領域が，コンフィギュレータまたはカーネルにより確保される【NGKI3318】．mbfszにターゲット定義の制約に合致しないサイズを指定した時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで確保される【NGKI3319】．</p>
</div>
<div class="paragraph">
<div class="title">〔mbfmbにNULL以外を指定した場合〕</div>
<p>mbfmbにNULL以外を指定した場合，mbfmbとmbfszで指定したメッセージバッファ管理領域は，アプリケーションで確保しておく必要がある【NGKI3320】．メッセージバッファ管理領域をアプリケーションで確保するために，次のマクロを用意している【NGKI3321】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_MBFMB(msgcnt, msgsz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msgszで指定したサイズのメッセージを，msgcntで指定した数だけ格納できるメッセージバッファ管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_MBFMB(msgcnt, msgsz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msgszで指定したサイズのメッセージを，msgcntで指定した数だけ格納できるメッセージバッファ管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらを用いて，msgszで指定したサイズのメッセージを，msgcntで指定した数だけ格納できるメッセージバッファ管理領域を確保する方法は次の通り【NGKI3322】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	MB_T	&lt;メッセージバッファ管理領域の変数名&gt;[TCNT_MBFMB(msgcnt, msgsz)];</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時，mbfszにはTSZ_MBFMB(msgcnt, msgsz)を，mbfmbには&lt;メッセージバッファ管理領域の変数名&gt;を指定する【NGKI3323】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，mbfmbとmbfszにターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI3324】．また，保護機能対応カーネルにおいて，mbfmbとmbfszで指定したメッセージバッファ管理領域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI3325】．</p>
</div>
<div class="paragraph">
<p>なお，mbfmbにNULL以外を指定できないカーネルでは，TCNT_MBFMBは用意していない【NGKI5181】．TSZ_MBFMBは，mbfmbにNULLを指定する場合にも，メッセージバッファ管理領域のサイズを決めるために用いることができる．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルのメッセージバッファ機能拡張パッケージでは，mbfmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【ASPS0205】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，mbfmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRPS0171】．</p>
</div>
<div class="paragraph">
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_mbfをサポートする【HRPS0235】．acre_mbfに対しては，mbfmbにNULL以外を指定できないという制限はない【HRPS0236】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，mbfmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRMPS0110】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0/PX仕様にあわせて，メッセージバッファの生成情報の最後のパラメータを，mbf（メッセージバッファ領域の先頭番地）から，mbfmb（メッセージバッファ管理領域の先頭番地）に改名した．また，TSZ_MBFをTSZ_MBFMBに改名した．</p>
</div>
<div class="paragraph">
<p>TCNT_MBFMBを新設し，メッセージバッファ管理領域をアプリケーションで確保する方法を規定した．</p>
</div>
<div class="paragraph">
<p>メッセージバッファの送信待ち行列をタスクの優先度順にする機能を廃止した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>メッセージバッファの送信待ち行列をタスクの優先度順にする機能を廃止した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_MBF</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なメッセージバッファIDの数の指定〔SD〕【NGKI3326】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_MBF(uint_t nombf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nombf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なメッセージバッファIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI3327】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5117】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nombfで指定した数のメッセージバッファIDを，メッセージバッファを生成するサービスコールによって割付け可能なメッセージバッファIDとして確保する【NGKI3329】．</p>
</div>
<div class="paragraph">
<p>nombfは整数定数式パラメータである【NGKI3330】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_MBFをサポートする【HRPS0237】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_MBF</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファのアクセス許可ベクタの設定〔SP〕【NGKI3331】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファのアクセス許可ベクタの設定〔TPD〕【NGKI3332】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_MBF(ID mbfid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_mbf(ID mbfid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象メッセージバッファのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI3333】<br>
・CPUロック状態からの呼出し〔s〕【NGKI3334】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mbfidが有効範囲外〔s〕【NGKI3335】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象メッセージバッファが属する保護ドメインの囲みの中（対象メッセージバッファが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI3336】<br>
・対象メッセージバッファが属するクラスの囲みの中に記述されていない〔SM〕【NGKI3337】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象メッセージバッファが未登録【NGKI3338】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メッセージバッファに対する管理操作が許可されていない〔s〕【NGKI3339】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI3340】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象メッセージバッファは静的APIで生成された〔s〕【NGKI3341】<br>
・対象メッセージバッファに対してアクセス許可ベクタが設定済み〔S〕【NGKI3342】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI3343】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mbfidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI3344】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_mbfをサポートする【HRPS0233】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファの削除〔TD〕【NGKI3345】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_mbf(ID mbfid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象メッセージバッファのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3346】<br>
・CPUロック状態からの呼出し【NGKI3347】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mbfidが有効範囲外【NGKI3348】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象メッセージバッファが未登録【NGKI3349】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メッセージバッファに対する管理操作が許可されていない〔P〕【NGKI3350】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象メッセージバッファは静的APIで生成された【NGKI3351】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの登録が解除され，そのメッセージバッファIDが未使用の状態に戻される【NGKI3352】．また，対象メッセージバッファの送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタスクから順に待ち解除される【NGKI3353】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI3354】．</p>
</div>
<div class="paragraph">
<p>メッセージバッファの生成時に，メッセージバッファ管理領域がカーネルによって確保された場合は，そのメモリ領域が解放される【NGKI3355】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_mbfをサポートする【HRPS0234】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>snd_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファへの送信〔T〕【NGKI3356】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>psnd_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファへの送信（ポーリング）〔T〕【NGKI3357】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>tsnd_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファへの送信（タイムアウト付き）〔T〕【NGKI3358】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = snd_mbf(ID mbfid, const void *msg, uint_t msgsz)
	ER ercd = psnd_mbf(ID mbfid, const void *msg, uint_t msgsz)
	ER ercd = tsnd_mbf(ID mbfid, const void *msg, uint_t msgsz, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象メッセージバッファのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信メッセージの先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msgsz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">送信メッセージのサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（tsnd_mbfの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3359】<br>
・CPUロック状態からの呼出し【NGKI3360】<br>
・ディスパッチ保留状態からの呼出し（psnd_mbfを除く）【NGKI3361】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（psnd_mbfを除く）【NGKI3362】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mbfidが有効範囲外【NGKI3363】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・msgszが有効範囲（0より大きく，対象メッセージバッファの最大メッセージサイズ以下）外【NGKI3364】<br>
・tmoutが無効（tsnd_mbfの場合）【NGKI3365】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象メッセージバッファが未登録〔D〕【NGKI3366】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メッセージバッファに対する通常操作1が許可されていない〔P〕【NGKI3367】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・msgとmsgszが指すメモリ領域への読出しアクセスが許可されていない〔P〕【NGKI3368】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（snd_mbfを除く）【NGKI3369】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（psnd_mbfを除く）【NGKI3370】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（psnd_mbfを除く）【NGKI3464】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（psnd_mbfを除く）【NGKI3371】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）に，msgとmsgszで指定したメッセージ（送信メッセージ）を送信する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの受信待ち行列にタスクが存在する場合には，受信待ち行列の先頭のタスクが，送信メッセージを受信し，待ち解除される【NGKI3372】．待ち解除されたタスクには，待ち状態となったサービスコールから，受信したメッセージのサイズが返る【NGKI3373】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの受信待ち行列にタスクが存在しない場合で，送信待ち行列にタスクが存在せず，メッセージバッファ管理領域に送信メッセージを格納するスペースがある場合には，送信メッセージが，FIFO順でメッセージバッファ管理領域に格納される【NGKI3524】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの受信待ち行列にタスクが存在しない場合で，送信待ち行列にタスクが存在するか，メッセージバッファ管理領域に送信メッセージを格納するスペースがない場合には，自タスクはメッセージバッファへの送信待ち状態となり，対象メッセージバッファの送信待ち行列につながれる【NGKI3525】．</p>
</div>
<div class="paragraph">
<p>メッセージバッファの送信待ち行列の先頭につながれているタスクが，ter_tskにより強制終了した場合や，rel_waiやタイムアウトにより待ち解除された場合，新たに送信待ち行列の先頭になったタスクの送信メッセージを，メッセージバッファ管理領域に格納できる可能性がある．そのため，これらの場合には，メッセージバッファからの受信によりメッセージバッファ管理領域に空きができた時の処理［NGKI3393］［NGKI3394］［NGKI3395］と同じ処理が行われる【NGKI3419】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>送信待ち行列の先頭につながれているタスクの強制終了や待ち解除により，送信待ち行列につながれていたタスクが複数待ち解除される場合がある．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>rcv_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファからの受信〔T〕【NGKI3376】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>prcv_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファからの受信（ポーリング）〔T〕【NGKI3377】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>trcv_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファからの受信（タイムアウト付き）〔T〕【NGKI3378】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_UINT	msgsz = rcv_mbf(ID mbfid, void *msg)
	ER_UINT	msgsz = prcv_mbf(ID mbfid, void *msg)
	ER_UINT	msgsz = trcv_mbf(ID mbfid, void *msg, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象メッセージバッファのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信メッセージを入れるメモリ領域の先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（trcv_mbfの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_UINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msgsz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">受信メッセージサイズ（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3379】<br>
・CPUロック状態からの呼出し【NGKI3380】<br>
・ディスパッチ保留状態からの呼出し（prcv_mbfを除く）【NGKI3381】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（prcv_mbfを除く）【NGKI3382】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mbfidが有効範囲外【NGKI3383】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（trcv_mbfの場合）【NGKI3384】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象メッセージバッファが未登録〔D〕【NGKI3385】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メッセージバッファに対する通常操作2が許可されていない〔P〕【NGKI3386】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・msgを先頭番地とし，対象メッセージバッファの最大メッセージサイズ分のメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3387】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（rcv_mbfを除く）【NGKI3388】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（prcv_mbfを除く）【NGKI3389】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（prcv_mbfを除く）【NGKI3465】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（prcv_mbfを除く）【NGKI3390】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）からメッセージを受信する．メッセージの受信に成功した場合，受信したメッセージはmsgを先頭番地とするメモリ領域に格納され，そのサイズはサービスコールの返値として返される【NGKI3391】．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域にメッセージが格納されている場合には，メッセージバッファ管理領域の先頭に格納されたメッセージを受信する【NGKI3392】．また，送信待ち行列にタスクが存在し，メッセージバッファ管理領域に送信待ち行列の先頭のタスクの送信メッセージを格納するスペースがある場合には，送信メッセージがFIFO順でメッセージバッファ管理領域に格納され，そのタスクは待ち解除される【NGKI3393】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI3394】．この処理を，送信待ち行列にタスクが存在しなくなるか，メッセージバッファ管理領域に送信待ち行列の先頭のタスクの送信メッセージを格納するスペースがなくなるまで繰り返す【NGKI3395】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域にメッセージが格納されておらず，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタスクの送信メッセージを受信する【NGKI3396】．送信待ち行列の先頭のタスクは，待ち解除される【NGKI3397】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI3398】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域にメッセージが格納されておらず，送信待ち行列にタスクが存在しない場合には，自タスクはメッセージバッファからの受信待ち状態となり，対象メッセージバッファの受信待ち行列につながれる【NGKI3399】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>msgで先頭番地を指定する受信メッセージを入れるメモリ領域は，オーバフローを防ぐために，対象メッセージバッファの最大メッセージサイズ分以上を確保しておかなければならない．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ini_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファの再初期化〔T〕【NGKI3400】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ini_mbf(ID mbfid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象メッセージバッファのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3401】<br>
・CPUロック状態からの呼出し【NGKI3402】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mbfidが有効範囲外【NGKI3403】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象メッセージバッファが未登録〔D〕【NGKI3404】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メッセージバッファに対する管理操作が許可されていない〔P〕【NGKI3405】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）を再初期化する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域は，格納されているメッセージがない状態に初期化される【NGKI3406】．また，対象メッセージバッファの送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタスクから順に待ち解除される【NGKI3407】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI3408】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がない．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>メッセージバッファを再初期化した場合に，アプリケーションとの整合性を保つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_mbf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メッセージバッファの状態参照〔T〕【NGKI3409】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_mbf(ID mbfid, T_RMBF *pk_rmbf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象メッセージバッファのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RMBF *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rmbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊メッセージバッファの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファの送信待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rtskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファの受信待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smbfcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファ管理領域に格納されているメッセージの数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmbfsz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファ管理領域中の空き領域のサイズ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3410】<br>
・CPUロック状態からの呼出し【NGKI3411】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mbfidが有効範囲外【NGKI3412】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象メッセージバッファが未登録〔D〕【NGKI3413】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メッセージバッファに対する参照操作が許可されていない〔P〕【NGKI3414】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rmbfが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3415】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）の現在状態を参照する．参照した現在状態は，pk_rmbfで指定したパケットに返される【NGKI3416】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの送信待ち行列にタスクが存在しない場合，stskidにはTSK_NONE（＝0）が返る【NGKI3417】．また，受信待ち行列にタスクが存在しない場合，rtskidにはTSK_NONE（＝0）が返る【NGKI3418】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_mbfはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_mbfを呼び出し，対象メッセージバッファの現在状態を参照した直後に割込みが発生した場合，ref_mbfから戻ってきた時には対象メッセージバッファの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_4_7_スピンロック"><a class="anchor" href="#_4_4_7_スピンロック"></a><a class="link" href="#_4_4_7_スピンロック">4.4.7 スピンロック</a></h4>
<div class="paragraph">
<p>スピンロックは，マルチプロセッサ対応カーネルにおいて，割込みのマスクとプロセッサ間ロックの取得により，排他制御を行うための同期・通信オブジェクトである．スピンロックは，スピンロックIDと呼ぶID番号によって識別する【NGKI2117】．マルチプロセッサ対応でないカーネルでは，スピンロック機能をサポートしない【NGKI3887】．</p>
</div>
<div class="paragraph">
<p>プロセッサ間ロックを取得している間は，CPUロック状態にすることですべてのカーネル管理の割込みがマスクされ，ディスパッチが保留される【NGKI2118】．ロックが他のプロセッサに取得されている場合には，ロックが取得できるまでループによって待つ【NGKI2119】．ロックの取得を待つ間は，CPUロック解除状態であり，割込みはマスクされない【NGKI2120】．プロセッサ間ロックを取得し，CPUロック状態に遷移することを，スピンロックを取得するという．また，プロセッサ間ロックを返却し，CPUロック状態を解除することを，スピンロックを返却するという．</p>
</div>
<div class="paragraph">
<p>タスクが取得したスピンロックを返却せずに終了した場合や，カーネル管理の割込みハンドラ，割込みサービスルーチン，タイムイベントハンドラ，カーネル管理のCPU例外ハンドラが取得したスピンロックを返却せずにリターンした場合には，カーネルによってスピンロックが返却される【NGKI5167】．一方，拡張サービスコールからのリターンでは，スピンロックは返却されない【NGKI2123】．</p>
</div>
<div class="paragraph">
<p>各スピンロックが持つ情報は次の通り【NGKI2124】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>スピンロック属性</p>
</li>
<li>
<p>ロック状態（取得されている状態と取得されていない状態）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>スピンロック属性には，次の属性を指定することができる【NGKI5168】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NATIVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エミュレーションによって実現してはならない</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ターゲットによっては，ターゲット定義のスピンロック属性を指定できる場合がある【NGKI5175】．</p>
</div>
<div class="paragraph">
<p>カーネルが提供するスピンロック（ここでは，スピンロックオブジェクトと呼ぶ）は，ハードウェアが持つスピンロックを実現するための機構を用いて実現される．ターゲットハードウェアが持つ機構で実現できるスピンロックオブジェクトの数にターゲット定義の上限がある場合には，カーネルに登録されたスピンロックオブジェクトのすべてを，ハードウェアが持つ機構で実現できるとは限らない【NGKI5169】．そのような場合には，スピンロックオブジェクトの一部を，カーネル内部用のスピンロックを用いてエミュレートする【NGKI5170】．</p>
</div>
<div class="paragraph">
<p>カーネルに登録されたスピンロックオブジェクトの内，どのスピンロックオブジェクトをエミュレーションによって実現するかは，コンフィギュレータまたはカーネルが決定する【NGKI5171】．その際に，TA_NATIVE属性のスピンロックオブジェクトは，エミュレーションによって実現してはならないものと扱う【NGKI5172】．TA_NATIVE属性のスピンロックオブジェクトを，ターゲットハードウェアが持つ機構で実現できない場合，コンフィギュレータまたはカーネルはエラーを報告する【NGKI5173】．</p>
</div>
<div class="paragraph">
<p>スピンロック機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_SPNID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるスピンロックの数（動的生成対応でないカーネルでは，静的APIによって登録されたスピンロックの数に一致）【NGKI2127】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>CPUロック状態では，スピンロックを取得するサービスコールを呼び出すことができないため，スピンロックを取得しているプロセッサが，さらにスピンロックを取得することはできない．そのため，1つの処理単位が，複数のスピンロックを取得した状態になることはできない．</p>
</div>
<div class="paragraph">
<p>スピンロックを取得した状態でCPU例外が発生した場合，起動されるCPU例外ハンドラはカーネル管理外のCPU例外ハンドラであり（xsns_dpnはtrueを返す），CPU例外ハンドラ中でunl_spnを呼び出してスピンロックを返却しようとした場合の動作は保証されない．保証されないにも関わらずunl_spnを呼び出した場合には，CPU例外ハンドラからのリターン時に元の状態に戻らない．これは，CPUロック状態の扱いと一貫していないため，注意が必要である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>スピンロック機能は，μITRON4.0仕様に定義されていない機能である．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_SPN</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックの生成〔SM〕【NGKI2128】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_spn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックの生成〔TMD〕【NGKI2129】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_SPN(ID spnid, { ATR spnatr })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID spnid = acre_spn(const T_CSPN *pk_cspn)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するスピンロックのID番号（CRE_SPNの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CSPN *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cspn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スピンロックの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊スピンロックの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スピンロック属性</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたスピンロックのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2130】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2131】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・spnatrが無効【NGKI2132】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2133】<br>
・クラスの囲みの中に記述されていない〔S〕【NGKI2135】<br>
・属するクラスの指定が有効範囲外【NGKI2134】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3973】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cspnが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI2137】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるスピンロックIDがない〔sD〕【NGKI2138】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NORES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">資源不足<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・spnidで指定したスピンロックが登録済み〔S〕【NGKI2139】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したスピンロックの生成情報に従って，スピンロックを生成する．生成されたスピンロックのロック状態は，取得されていない状態に初期化される【NGKI2140】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，spnidはオブジェクト識別名，spnatrは整数定数式パラメータである【NGKI2141】．</p>
</div>
<div class="paragraph">
<p>TA_NATIVE属性のスピンロックを生成する場合で，ターゲットハードウェアが持つ機構が不足する場合には，E_NORESエラーとなる【NGKI5174】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_SPN</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なスピンロックIDの数の指定〔SMD〕【NGKI2144】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_SPN(uint_t nospn)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nospn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なスピンロックIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない【NGKI2145】<br>
・属するクラスの指定が有効範囲外【NGKI5118】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nospnで指定した数のスピンロックIDを，スピンロックを生成するサービスコールによって割付け可能なスピンロックIDとして確保する【NGKI2146】．</p>
</div>
<div class="paragraph">
<p>nospnは整数定数式パラメータである【NGKI2147】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_SPN</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックのアクセス許可ベクタの設定〔SPM〕【NGKI2148】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_spn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックのアクセス許可ベクタの設定〔TPMD〕【NGKI2149】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_SPN(ID spnid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_spn(ID spnid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象スピンロックのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2150】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2151】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・spnidが有効範囲外〔s〕【NGKI2152】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象スピンロックが属する保護ドメインの囲みの中（対象スピンロックが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI2153】<br>
・対象スピンロックが属するクラスの囲みの中に記述されていない〔S〕【NGKI2154】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象スピンロックが未登録【NGKI2155】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象スピンロックに対する管理操作が許可されていない〔s〕【NGKI2156】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI2157】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象スピンロックは静的APIで生成された〔s〕【NGKI2158】<br>
・対象スピンロックに対してアクセス許可ベクタが設定済み〔S〕【NGKI2159】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>spnidで指定したスピンロック（対象スピンロック）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI2160】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，spnidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI2161】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_spn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックの削除〔TMD〕【NGKI2162】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_spn(ID spnid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象スピンロックのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2163】<br>
・CPUロック状態からの呼出し【NGKI2164】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・spnidが有効範囲外【NGKI2165】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象スピンロックが未登録【NGKI2166】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象スピンロックに対する管理操作が許可されていない〔P〕【NGKI2167】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象スピンロックは静的APIで生成された【NGKI2168】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>spnidで指定したスピンロック（対象スピンロック）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックの登録が解除され，そのスピンロックIDが未使用の状態に戻される【NGKI2169】．</p>
</div>
<div class="paragraph">
<div class="title">【未決定事項】</div>
<p>対象スピンロックが取得されている状態の場合の振舞いは，今後の課題である．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>loc_spn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックの取得〔TIM〕【NGKI3540】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = loc_spn(ID spnid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象スピンロックのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2174】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・spnidが有効範囲外【NGKI2175】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象スピンロックが未登録〔D〕【NGKI2176】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象スピンロックに対する通常操作1が許可されていない〔P〕【NGKI2177】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>spnidで指定したスピンロック（対象スピンロック）を取得する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが取得されていない状態である場合には，プロセッサ間ロックの取得を試みる【NGKI2178】．ロックが他のプロセッサによって取得されている状態である場合や，他のプロセッサがロックの取得に成功した場合には，ロックが返却されるまでループによって待ち，返却されたらロックの取得を試みる【NGKI2179】．これを，ロックの取得に成功するまで繰り返す【NGKI2180】．</p>
</div>
<div class="paragraph">
<p>ロックの取得に成功した場合には，スピンロックは取得されている状態になる【NGKI2181】．また，CPUロックフラグをセットしてCPUロック状態へ遷移し，サービスコールからリターンする【NGKI2182】．</p>
</div>
<div class="paragraph">
<p>なお，複数のプロセッサがロックの取得を待っている時に，どのプロセッサが最初にロックを取得できるかは，現時点ではターゲット定義とする【NGKI2183】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>対象スピンロックが，loc_spnを呼び出したプロセッサによって取得されている状態である場合には，スピンロックの取得によりCPUロック状態になっているため，loc_spnはE_CTXエラーとなる．</p>
</div>
<div class="paragraph">
<p>プロセッサがロックを取得できる順序を，現時点ではターゲット定義としたが，リアルタイム性保証のためには，（ロックの取得待ちの間に割込みが発生しない限りは）loc_spnを呼び出した順序でロックを取得できるとするのが望ましい．ただし，ターゲットハードウェアの制限で，そのような実装ができるとは限らないため，現時点ではターゲット定義としている．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>try_spn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックの取得（ポーリング）〔TIM〕【NGKI3541】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = try_spn(ID spnid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象スピンロックのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2188】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・spnidが有効範囲外【NGKI2189】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象スピンロックが未登録〔D〕【NGKI2190】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象スピンロックに対する通常操作1が許可されていない〔P〕【NGKI2191】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>spnidで指定したスピンロック（対象スピンロック）の取得を試みる．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが取得されていない状態である場合には，プロセッサ間ロックの取得を試みる【NGKI2192】．ロックの取得に成功した場合には，スピンロックは取得されている状態になる【NGKI2193】．また，CPUロックフラグをセットしてCPUロック状態へ遷移し，サービスコールからリターンする【NGKI2194】．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが他のプロセッサによって取得されている状態である場合や，ロックの取得に失敗した場合（他のプロセッサがロックの取得に成功した場合）には，E_OBJエラーとする【NGKI2195】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>try_spnを，ロックの取得に成功するまで繰り返し呼び出すことによりスピンロックを取得する方法は，loc_spnによりスピンロックを取得する方法と，プロセッサがロックを取得できる順序が異なる可能性ある．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>unl_spn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックの返却〔TIM〕【NGKI3542】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = unl_spn(ID spnid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象スピンロックのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・spnidが有効範囲外【NGKI2200】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象スピンロックが未登録〔D〕【NGKI2201】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象スピンロックに対する通常操作1が許可されていない〔P〕【NGKI2202】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>spnidで指定したスピンロック（対象スピンロック）を返却する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが，unl_spnを呼び出したプロセッサによって取得されている状態である場合には，ロックを返却し，スピンロックを取得されていない状態とする【NGKI2203】．また，CPUロックフラグをクリアし，CPUロック解除状態へ遷移する【NGKI2204】．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが，取得されていない状態である場合や，他のプロセッサによって取得されている状態である場合には，E_ILUSEエラーとなる【NGKI2205】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_spn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>スピンロックの状態参照〔TM〕【NGKI2206】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_spn(ID spnid, T_RSPN *pk_rspn)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象スピンロックのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RSPN *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rspn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スピンロックの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊スピンロックの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spnstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ロック状態</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2207】<br>
・CPUロック状態からの呼出し【NGKI2208】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・spnidが有効範囲外【NGKI2209】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象スピンロックが未登録〔D〕【NGKI2210】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象スピンロックに対する参照操作が許可されていない〔P〕【NGKI2211】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rspnが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2212】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>spnidで指定したスピンロック（対象スピンロック）の現在状態を参照する．参照した現在状態は，pk_rspnで指定したパケットに返される【NGKI2213】．</p>
</div>
<div class="paragraph">
<p>spnstatには，対象スピンロックの現在のロック状態を表す次のいずれかの値が返される【NGKI2214】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSPN_UNL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取得されていない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSPN_LOC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取得されている状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_spnはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_spnを呼び出し，対象スピンロックの現在状態を参照した直後に割込みが発生した場合，ref_spnから戻ってきた時には対象スピンロックの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_4_5_メモリプール管理機能"><a class="anchor" href="#_4_5_メモリプール管理機能"></a><a class="link" href="#_4_5_メモリプール管理機能">4.5 メモリプール管理機能</a></h3>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，メモリプール管理機能をサポートしない【SSPS0128】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>可変長メモリプール機能を廃止した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>可変長メモリプール機能を廃止したのは，メモリ割付けの処理時間とフラグメンテーションの発生を考えると，最適なメモリ管理アルゴリズムはアプリケーション依存となるため，カーネル内で実現するより，ライブラリとして実現する方が適切と考えたためである．</p>
</div>
<div class="sect3">
<h4 id="_4_5_1_固定長メモリプール"><a class="anchor" href="#_4_5_1_固定長メモリプール"></a><a class="link" href="#_4_5_1_固定長メモリプール">4.5.1 固定長メモリプール</a></h4>
<div class="paragraph">
<p>固定長メモリプールは，生成時に決めたサイズのメモリブロック（固定長メモリブロック）を動的に獲得・返却するための同期・通信オブジェクトである．固定長メモリプールは，固定長メモリプールIDと呼ぶID番号で識別する【NGKI2215】．</p>
</div>
<div class="paragraph">
<p>各固定長メモリプールが持つ情報は次の通り【NGKI2216】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>固定長メモリプール属性</p>
</li>
<li>
<p>待ち行列（固定長メモリブロックの獲得待ち状態のタスクのキュー）</p>
</li>
<li>
<p>固定長メモリプール領域</p>
</li>
<li>
<p>固定長メモリプール管理領域</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，固定長メモリブロックが獲得できるまで待っている状態（固定長メモリブロックの獲得待ち状態）のタスクが，固定長メモリブロックを獲得できる順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール領域は，その中から固定長メモリブロックを割り付けるためのメモリ領域である．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール管理領域は，固定長メモリプール領域中の割当て済みの固定長メモリブロックと未割当てのメモリ領域に関する情報を格納しておくためのメモリ領域である．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，固定長メモリプール管理領域は，カーネルの管理領域として扱われる【NGKI2217】．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール属性には，次の属性を指定することができる【NGKI2218】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち行列をタスクの優先度順にする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，待ち行列はFIFO順になる【NGKI2219】．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_MPFID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できる固定長メモリプールの数（動的生成対応でないカーネルでは，静的APIによって登録された固定長メモリプールの数に一致）【NGKI2220】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>固定長メモリプール領域として確保すべき領域のサイズを返すカーネル構成マクロ（TSZ_MPF）は廃止した．これは，固定長メモリプール領域をアプリケーションで確保する方法を定めた結果，そのサイズは(blkcnt * ROUND_MPF_T(blksz))で求めることができるようになったためである．</p>
</div>
<div class="paragraph">
<p>TNUM_MPFIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_MPF</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリプールの生成〔S〕【NGKI2221】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリプールの生成〔TD〕【NGKI2222】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_MPF(ID mpfid, { ATR mpfatr, uint_t blkcnt, uint_t blksz,
										MPF_T *mpf, void *mpfmb })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ mpfとmpfmbの記述は省略することができる【NGKI3904】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID mpfid = acre_mpf(const T_CMPF *pk_cmpf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成する固定長メモリプールのID番号（CRE_MPFの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CMPF *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cmpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプールの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊固定長メモリプールの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプール属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blkcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">獲得できる固定長メモリブロックの数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blksz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリブロックのサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPF_T *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプール領域の先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfmb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプール管理領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成された固定長メモリプールのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2223】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2224】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・mpfatrが無効【NGKI2225】<br>
・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2226】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI2228】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI2227】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については各カーネルにおける規定の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・blkcntが0【NGKI2229】<br>
・blkszが0【NGKI2230】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメイン（または無所属）に対する通常操作1が許可されていない〔sP〕【NGKI3974】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cmpfが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI2232】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられる固定長メモリプールIDがない〔sD〕【NGKI2233】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・固定長メモリプール領域が確保できない【NGKI2234】<br>
・固定長メモリプール管理領域が確保できない【NGKI2235】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・mpfidで指定した固定長メモリプールが登録済み〔S〕【NGKI2236】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した固定長メモリプールの生成情報に従って，固定長メモリプールを生成する．mpf，blkcnt，blkszから固定長メモリプール領域が，mpfmbとblkcntから固定長メモリプール管理領域がそれぞれ設定され，メモリプール領域全体が未割当ての状態に初期化される【NGKI2237】．また，待ち行列は空の状態に初期化される【NGKI2238】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mpfidはオブジェクト識別名，mpfatr，blkcnt，blkszは整数定数式パラメータ，mpfとmpfmbは一般定数式パラメータである【NGKI2239】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI2240】．</p>
</div>
<div class="paragraph">
<p>mpfをNULLとするか，静的APIにおいてmpfの記述を省略した場合，blkcntとblkszから決まるサイズの固定長メモリプール領域が，コンフィギュレータまたはカーネルにより確保される【NGKI2241】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，コンフィギュレータにより確保される固定長メモリプール領域は，固定長メモリプールが属する保護ドメイン向け（固定長メモリプールが無所属の場合は，保護ドメイン共通．マルチプロセッサ対応カーネルの場合には，さらに，固定長メモリプールが属するクラス向け）の標準メモリリージョン内に配置され，固定長メモリプールと同じ保護ドメインに属し，固定長メモリプールと同じアクセス許可ベクタを持ったメモリオブジェクト中に確保される【NGKI2242】．</p>
</div>
<div class="paragraph">
<p>ただし，保護機能対応カーネルで手動メモリ配置の場合，mpfをNULLとしたり，静的APIにおいてmpfの記述を省略することができるのは，カーネルドメインに属し，アクセス許可ベクタがデフォルトの値の固定長メモリプールの場合のみである．そうでない場合には，E_PARエラーとなる【NGKI3908】．</p>
</div>
<div class="paragraph">
<p>mpfmbをNULLとするか，静的APIにおいてmpfmbの記述を省略した場合，blkcntから決まるサイズの固定長メモリプール管理領域が，コンフィギュレータまたはカーネルにより確保される【NGKI2243】．</p>
</div>
<div class="paragraph">
<div class="title">〔mpfにNULL以外を指定した場合〕</div>
<p>mpfにNULL以外を指定した場合，mpfを先頭番地とする固定長メモリプール領域は，アプリケーションで確保しておく必要がある【NGKI2244】．固定長メモリプール領域をアプリケーションで確保するために，次のデータ型とマクロを用意している【NGKI2245】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPF_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプール領域を確保するためのデータ型</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT_MPF_T(blksz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリブロックのサイズがblkszの固定長メモリプール領域を確保するために，固定長メモリブロック1つあたりに必要なMPF_T型の配列の要素数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROUND_MPF_T(blksz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要素数COUNT_MPF_T(blksz)のMPF_T型の配列のサイズ（blkszを，MPF_T型のサイズの倍数になるように大きい方に丸めた値）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらを用いて，blkszで指定したサイズの固定長メモリブロックを，blkcntで指定した数だけ獲得できる固定長メモリプール領域を確保する方法は次の通り【NGKI2246】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	MPF_T	&lt;固定長メモリプール領域の変数名&gt;[(blkcnt) * COUNT_MPF_T(blksz)];</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時，mpfには&lt;固定長メモリプール領域の変数名&gt;を指定する【NGKI2247】．</p>
</div>
<div class="paragraph">
<p>これ以外の方法で固定長メモリプール領域を確保する場合には，上記の配列と同じサイズのメモリ領域を確保しなければならない【NGKI2248】．また，その先頭番地がターゲット定義の制約に合致していなければならない．mpfにターゲット定義の制約に合致しない先頭番地を指定した時には，E_PARエラーとなる【NGKI2249】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，アプリケーションで確保する固定長メモリプール領域は，カーネルに登録されたメモリオブジェクトに含まれていなければならない．指定した固定長メモリプール領域が，カーネルに登録されたメモリオブジェクトに含まれていない場合，E_OBJエラーとなる【NGKI2251】．</p>
</div>
<div class="paragraph">
<div class="title">〔mpfmbにNULL以外を指定した場合〕</div>
<p>mpfmbにNULL以外を指定した場合，mpfmbを先頭番地とする固定長メモリプール管理領域は，アプリケーションで確保しておく必要がある【NGKI2252】．固定長メモリプール管理領域をアプリケーションで確保するために，次のマクロを用意している【NGKI2253】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_MPFMB(blkcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blkcntで指定した数の固定長メモリブロックを管理することができる固定長メモリプール管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_MPFMB(blkcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blkcntで指定した数の固定長メモリブロックを管理することができる固定長メモリプール管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらを用いて，blkcntで指定した数の固定長メモリブロックを管理することができる固定長メモリプール管理領域を確保する方法は次の通り【NGKI2254】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	MB_T	&lt;固定長メモリプール管理領域の変数名&gt;[TCNT_MPFMB(blkcnt)];</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時，mpfmbには&lt;固定長メモリプール管理領域の変数名&gt;を指定する【NGKI2255】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，mpfmbにターゲット定義の制約に合致しない先頭番地を指定した時には，E_PARエラーとなる【NGKI2256】．また，保護機能対応カーネルにおいて，mpfmbで指定した固定長メモリプール管理領域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI2257】．</p>
</div>
<div class="paragraph">
<p>なお，mpfmbにNULL以外を指定できないカーネルでは，TSZ_MPFMBとTCNT_MPFMBは用意していない【NGKI5182】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>保護機能対応カーネルにおいて，固定長メモリプール領域をアプリケーションで確保する場合には，固定長メモリプール領域が属する保護ドメインとアクセス権の設定は変更されない．これらを適切に設定することは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，mpfmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【ASPS0166】．</p>
</div>
<div class="paragraph">
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_mpfをサポートする【ASPS0167】．acre_mpfに対しては，mpfmbにNULL以外を指定できないという制限はない【ASPS0168】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，mpfmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【FMPS0144】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，mpfmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRPS0138】．</p>
</div>
<div class="paragraph">
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_mpfをサポートする【HRPS0197】．acre_mpfに対しては，mpfmbにNULL以外を指定できないという制限はない【HRPS0198】．ただし，mpfにNULLが指定されるとカーネルが固定長メモリプール領域を確保する機能はサポートしない．mpfにNULLを指定した場合には，E_NOSPTエラーとなる【HRPS0199】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，mpfmbにはNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる【HRMPS0111】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>mpfのデータ型をMPF_T *に変更した．COUNT_MPF_TとROUND_MPF_Tを新設し，固定長メモリプール領域をアプリケーションで確保する方法を規定した．また，μITRON4.0/PX仕様にあわせて，固定長メモリプールの生成情報に，mpfmbを追加した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>TCNT_MPFMBを新設し，固定長メモリプール管理領域をアプリケーションで確保する方法を規定した．</p>
</div>
<div class="paragraph">
<div class="title">【未決定事項】</div>
<p>保護機能対応カーネルにおいて，サービスコール（acre_mpf）で，mpfにNULLを指定して固定長メモリプールを生成する場合の固定長メモリプール領域の確保方法については，今後の課題である．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_MPF</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能な固定長メモリプールIDの数の指定〔SD〕【NGKI2258】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_MPF(uint_t nompf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nompf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能な固定長メモリプールIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI2259】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5119】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nompfで指定した数の固定長メモリプールIDを，固定長メモリプールを生成するサービスコールによって割付け可能な固定長メモリプールIDとして確保する【NGKI2260】．</p>
</div>
<div class="paragraph">
<p>nompfは整数定数式パラメータである【NGKI2261】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_MPFをサポートする【ASPS0216】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_MPFをサポートする【HRPS0217】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_MPF</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリプールのアクセス許可ベクタの設定〔SP〕【NGKI2262】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリプールのアクセス許可ベクタの設定〔TPD〕【NGKI2263】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_MPF(ID mpfid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_mpf(ID mpfid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象固定長メモリプールのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2264】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2265】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mpfidが有効範囲外〔s〕【NGKI2266】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象固定長メモリプールが属する保護ドメインの囲みの中（対象固定長メモリプールが無所属の場合は，保護ドメインの囲みの外）に記述されていない〔S〕【NGKI2267】<br>
・対象固定長メモリプールが属するクラスの囲みの中に記述されていない〔SM〕【NGKI2268】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象固定長メモリプールが未登録【NGKI2269】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象固定長メモリプールに対する管理操作が許可されていない〔s〕【NGKI2270】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI2271】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象固定長メモリプールは静的APIで生成された〔s〕【NGKI2272】<br>
・対象固定長メモリプールに対してアクセス許可ベクタが設定済み〔S〕【NGKI2273】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI2274】．対象固定長メモリプールの固定長メモリプール領域がコンフィギュレータまたはカーネルにより確保されたものである場合には，固定長メモリプール領域のアクセス許可ベクタも，各パラメータで指定した値に設定する【NGKI2275】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mpfidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI2276】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_mpfをサポートする【HRPS0200】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリプールの削除〔TD〕【NGKI2277】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_mpf(ID mpfid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象固定長メモリプールのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2278】<br>
・CPUロック状態からの呼出し【NGKI2279】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mpfidが有効範囲外【NGKI2280】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象固定長メモリプールが未登録【NGKI2281】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象固定長メモリプールに対する管理操作が許可されていない〔P〕【NGKI2282】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象固定長メモリプールは静的APIで生成された【NGKI2283】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの登録が解除され，その固定長メモリプールIDが未使用の状態に戻される【NGKI2284】．また，対象固定長メモリプールの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI2285】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI2286】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_mpfをサポートする【ASPS0171】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_mpfをサポートする【HRPS0201】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリブロックの獲得〔T〕【NGKI2287】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>pget_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリブロックの獲得（ポーリング）〔T〕【NGKI2288】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>tget_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリブロックの獲得（タイムアウト付き）〔T〕【NGKI2289】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_mpf(ID mpfid, void **p_blk)
	ER ercd = pget_mpf(ID mpfid, void **p_blk)
	ER ercd = tget_mpf(ID mpfid, void **p_blk, TMO tmout)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象固定長メモリプールのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void **</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_blk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">獲得した固定長メモリブロックの先頭番地を入れるメモリ領域へのポインタ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト時間（twai_mpfの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">獲得した固定長メモリブロックの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2290】<br>
・CPUロック状態からの呼出し【NGKI2291】<br>
・ディスパッチ保留状態からの呼出し（pget_mpfを除く）【NGKI2292】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・制約タスクからの呼出し（pget_mpfを除く）【NGKI2293】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mpfidが有効範囲外【NGKI2294】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tmoutが無効（tget_mpfの場合）【NGKI2295】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象固定長メモリプールが未登録〔D〕【NGKI2296】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象固定長メモリプールに対する通常操作1が許可されていない〔P〕【NGKI2297】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_blkが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2298】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト（get_mpfを除く）【NGKI2299】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除（pget_mpfを除く）【NGKI2300】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求（pget_mpfを除く）【NGKI3466】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化（pget_mpfを除く）【NGKI2301】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）から固定長メモリブロックを獲得し，その先頭番地をp_blkが指すメモリ領域に返す．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの固定長メモリプール領域の中に，固定長メモリブロックを割り付けることのできる未割当てのメモリ領域がある場合には，固定長メモリブロックが1つ割り付けられ，その先頭番地がblkに返される【NGKI2302】．</p>
</div>
<div class="paragraph">
<p>未割当てのメモリ領域がない場合には，自タスクは固定長メモリプールの獲得待ち状態となり，対象固定長メモリプールの待ち行列につながれる【NGKI2303】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>rel_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリブロックの返却〔T〕【NGKI2304】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = rel_mpf(ID mpfid, void *blk)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象固定長メモリプールのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返却する固定長メモリブロックの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2305】<br>
・CPUロック状態からの呼出し【NGKI2306】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mpfidが有効範囲外【NGKI2307】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象固定長メモリプールが未登録〔D〕【NGKI2308】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象固定長メモリプールに対する通常操作2が許可されていない〔P〕【NGKI2309】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）に，blkで指定した固定長メモリブロックを返却する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの待ち行列にタスクが存在する場合には，待ち行列の先頭のタスクが，blkで指定した固定長メモリブロックを獲得し，待ち解除される【NGKI2310】．待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る【NGKI2311】．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクが存在しない場合には，blkで指定した固定長メモリブロックは，対象固定長メモリプールのメモリプール領域に返却される【NGKI2312】．</p>
</div>
<div class="paragraph">
<p>blkが，対象固定長メモリプールから獲得した固定長メモリブロックの先頭番地でない場合には，E_PARエラーとなる【NGKI2313】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ini_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリプールの再初期化〔T〕【NGKI2314】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ini_mpf(ID mpfid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象固定長メモリプールのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2315】<br>
・CPUロック状態からの呼出し【NGKI2316】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mpfidが有効範囲外【NGKI2317】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象固定長メモリプールが未登録〔D〕【NGKI2318】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象固定長メモリプールに対する管理操作が許可されていない〔P〕【NGKI2319】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）を再初期化する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールのメモリプール領域全体が未割当ての状態に初期化される【NGKI2320】．また，対象固定長メモリプールの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI2321】．待ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI2322】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>固定長メモリプールを再初期化した場合に，アプリケーションとの整合性を保つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_mpf</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>固定長メモリプールの状態参照〔T〕【NGKI2323】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_mpf(ID mpfid, T_RMPF *pk_rmpf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpfid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象固定長メモリプールのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RMPF *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rmpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプールの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊固定長メモリプールの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wtskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプールの待ち行列の先頭のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fblkcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプール領域の空きメモリ領域に割り付けることができる固定長メモリブロックの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2324】<br>
・CPUロック状態からの呼出し【NGKI2325】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・mpfidが有効範囲外【NGKI2326】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象固定長メモリプールが未登録〔D〕【NGKI2327】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象固定長メモリプールに対する参照操作が許可されていない〔P〕【NGKI2328】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rmpfが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2329】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）の現在状態を参照する．参照した現在状態は，pk_rmpfで指定したパケットに返される【NGKI2330】．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの待ち行列にタスクが存在しない場合，wtskidにはTSK_NONE（＝0）が返る【NGKI2331】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_mpfはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_mpfを呼び出し，対象固定長メモリプールの現在状態を参照した直後に割込みが発生した場合，ref_mpfから戻ってきた時には対象固定長メモリプールの状態が変化している可能性があるためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_4_6_時間管理機能"><a class="anchor" href="#_4_6_時間管理機能"></a><a class="link" href="#_4_6_時間管理機能">4.6 時間管理機能</a></h3>
<div class="paragraph">
<p>時間管理機能は，タイマを制御して時間を管理し，タイムイベントの処理を行うための機能である．</p>
</div>
<div class="paragraph">
<p>周期通知とアラーム通知は，タイムイベントをアプリケーションに通知するための機能（タイムイベント通知）である．タイムイベントが発生すると，それらの生成時に指定された通知処理を行う【NGKI3688】．</p>
</div>
<div class="paragraph">
<div class="title">〔タイムイベントの通知処理〕</div>
<p>タイムイベントの通知は，次のいずれかの方法で行うことができる【NGKI3689】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>タイムイベントハンドラの呼出し</p>
</li>
<li>
<p>変数の設定</p>
</li>
<li>
<p>変数のインクリメント</p>
</li>
<li>
<p>タスクの起動（act_tsk）</p>
</li>
<li>
<p>タスクの起床（wup_tsk）</p>
</li>
<li>
<p>セマフォの資源の返却（sig_sem）</p>
</li>
<li>
<p>イベントフラグのセット（set_flg）</p>
</li>
<li>
<p>データキューへの送信（psnd_dtq）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これらの通知方法の中で，タイムイベントハンドラの呼出し，変数の設定，変数のインクリメント以外の方法では，通知のためのサービスコールがエラーを返し，タイムイベントの通知に失敗する場合がある．タイムイベントの通知に失敗した場合には，次のいずれかの方法で，エラーを通知することができる【NGKI3690】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>変数の設定</p>
</li>
<li>
<p>変数のインクリメント</p>
</li>
<li>
<p>タスクの起動（act_tsk）</p>
</li>
<li>
<p>タスクの起床（wup_tsk）</p>
</li>
<li>
<p>セマフォの資源の返却（sig_sem）</p>
</li>
<li>
<p>イベントフラグのセット（set_flg）</p>
</li>
<li>
<p>データキューへの送信（psnd_dtq）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ただし，これらのエラーの通知方法の中で，エラーコードを伝えることができるのは，変数の設定とデータキューへの送信のみである．</p>
</div>
<div class="paragraph">
<p>変数の設定と変数のインクリメント以外の方法では，通知のためのサービスコールがエラーを返し，エラーの通知に失敗する場合があるが，エラーの通知に失敗しても何も行われない【NGKI3691】．</p>
</div>
<div class="paragraph">
<div class="title">〔タイムイベントハンドラの呼出しによる通知〕</div>
<p>タイムイベントハンドラの呼出しによるタイムイベントの通知では，アプリケーションが用意したプログラムを呼び出すことにより通知を行う【NGKI3692】．この通知処理を登録する場合には，付随情報として，タイムイベントハンドラの拡張情報と先頭番地を指定する．タイムイベントハンドラの先頭番地がプログラムの先頭番地として正しくない場合には，E_PARエラーとなる【NGKI3693】．</p>
</div>
<div class="paragraph">
<p>周期通知によって呼び出されるタイムイベントハンドラを周期ハンドラ，アラーム通知によって呼び出されるタイムイベントハンドラをアラームハンドラと呼ぶ．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，カーネルドメインに属する周期通知またはアラーム通知のみが，タイムイベントハンドラの呼出しによる通知を用いることができる【NGKI3694】．すなわち，周期ハンドラとアラームハンドラは，カーネルドメインに属する．ユーザドメインに属する周期通知またはアラーム通知の生成時や，タイムウィンドウの登録時に，タイムイベントハンドラの呼出しによる通知を指定した場合は，E_OACVエラーとなる【NGKI3695】．</p>
</div>
<div class="paragraph">
<p>C言語によるタイムイベントハンドラの記述形式は次の通り【NGKI3696】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void time_event_handler(intptr_t exinf)
	{
		タイムイベントハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，タイムイベントハンドラの拡張情報が渡される【NGKI3697】．</p>
</div>
<div class="paragraph">
<div class="title">〔変数の設定による通知〕</div>
<p>変数の設定によるタイムイベントの通知では，アプリケーションが用意したintptr_t型の変数に，指定した値を設定することにより通知を行う【NGKI3698】．この通知処理を登録する場合には，付随情報として，変数の番地と設定する値を指定する．変数の番地がintptr_t型の変数の番地として正しくない場合には，E_PARエラーとなる【NGKI3699】．</p>
</div>
<div class="paragraph">
<p>また，変数の設定によるエラーの通知では，アプリケーションが用意したintptr_t型の変数に，エラーコードを設定することにより通知を行う【NGKI3700】．この通知処理を登録する場合には，付随情報として，変数の番地を指定する．変数の番地がintptr_t型の変数の番地として正しくない場合には，E_PARエラーとなる【NGKI3701】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，周期通知またはアラーム通知の生成時に，それが属する保護ドメインに対して，指定した変数に対する書込みアクセスが許可されていなければならない．そうでない場合には，E_MACVエラーとなる【NGKI3702】．</p>
</div>
<div class="paragraph">
<div class="title">〔変数のインクリメントによる通知〕</div>
<p>変数のインクリメントによるタイムイベントまたはエラーの通知では，アプリケーションが用意したintptr_t型の変数を，CPUロック状態でインクリメントすることにより通知を行う【NGKI3896】．この通知処理を登録する場合には，付随情報として，変数の番地を指定する．変数の番地がintptr_t型の変数の番地として正しくない場合には，E_PARエラーとなる【NGKI3897】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，周期通知またはアラーム通知の生成時に，それが属する保護ドメインに対して，指定した変数に対する書込みアクセスおよび読出しアクセスが許可されていなければならない．そうでない場合には，E_MACVエラーとなる【NGKI3898】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>変数のインクリメントはCPUロック状態で行うため，カーネル管理外の割込みハンドラや，マルチプロセッサ対応カーネルにおいて他のプロセッサで実行される処理単位から変数を書き換えると，一貫性が保証されなくなる．</p>
</div>
<div class="paragraph">
<div class="title">〔タスクの起動／起床による通知〕</div>
<p>タスクの起動／起床によるタイムイベントまたはエラーの通知では，指定したタスク（対象タスク）を起動／起床することにより通知を行う【NGKI3703】．この通知処理を登録する場合には，付随情報として，対象タスクのタスクIDを指定する．タスクIDが有効範囲外の場合は，E_IDエラーとなる【NGKI3704】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，周期通知またはアラーム通知の生成時に，それが属する保護ドメインに対して，対象タスクに対する通常操作1が許可されていなければならない．そうでない場合には，E_OACVエラーとなる【NGKI3705】．</p>
</div>
<div class="paragraph">
<div class="title">〔セマフォの資源の返却による通知〕</div>
<p>セマフォの資源の返却によるタイムイベントまたはエラーの通知では，指定したセマフォ（対象セマフォ）に資源を返却することにより通知を行う【NGKI3706】．この通知処理を登録する場合には，付随情報として，対象セマフォのセマフォIDを指定する．セマフォIDが有効範囲外の場合は，E_IDエラーとなる【NGKI3707】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，周期通知またはアラーム通知の生成時に，それが属する保護ドメインに対して，対象セマフォに対する通常操作1が許可されていなければならない．そうでない場合には，E_OACVエラーとなる【NGKI3708】．</p>
</div>
<div class="paragraph">
<div class="title">〔イベントフラグのセットによる通知〕</div>
<p>イベントフラグのセットによるタイムイベントまたはエラーの通知では，指定したイベントフラグ（対象イベントフラグ）の指定したビットパターンをセットすることにより通知を行う【NGKI3709】．この通知処理を登録する場合には，付随情報として，対象イベントフラグのイベントフラグIDとセットするビットパターンを指定する．イベントフラグIDが有効範囲外の場合は，E_IDエラーとなる【NGKI3710】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，周期通知またはアラーム通知の生成時に，それが属する保護ドメインに対して，対象イベントフラグに対する通常操作1が許可されていなければならない．そうでない場合には，E_OACVエラーとなる【NGKI3711】．</p>
</div>
<div class="paragraph">
<div class="title">〔データキューへの送信による通知〕</div>
<p>データキューへの送信によるタイムイベントの通知では，指定したデータキュー（対象データキュー）に，指定した値を送信することにより通知を行う【NGKI3712】．この通知処理を登録する場合には，付随情報として，対象データキューのデータキューIDと送信する値を指定する．データキューIDが有効範囲外の場合は，E_IDエラーとなる【NGKI3713】．</p>
</div>
<div class="paragraph">
<p>また，データキューへの送信によるエラーの通知では，指定したデータキュー（対象データキュー）に，エラーコードを送信することにより通知を行う【NGKI3714】．この通知処理を登録する場合には，付随情報として，対象データキューのデータキューIDを指定する．データキューIDが有効範囲外の場合は，E_IDエラーとなる【NGKI3715】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，周期通知またはアラーム通知の生成時に，それが属する保護ドメインに対して，対象データキューに対する通常操作1が許可されていなければならない．そうでない場合には，E_OACVエラーとなる【NGKI3716】．</p>
</div>
<div class="paragraph">
<div class="title">〔通知方法の指定〕</div>
<p>タイムイベントとエラーの通知方法は，通知処理モードと，タイムイベントとエラーの通知に関する付随情報で指定する．</p>
</div>
<div class="paragraph">
<p>通知処理モードは，タイムイベントの通知の種類を表す定数と，エラーの通知の種類を表す定数のビット毎論理和で表す【NGKI3717】．エラーの通知を行わない場合には，タイムイベントの通知の種類を表す定数で表す【NGKI3718】．通知処理モードにそれ以外の値を指定した場合には，E_PARエラーとなる【NGKI3730】．</p>
</div>
<div class="paragraph">
<p>タイムイベントの通知の種類を表す定数は次の通り【NGKI3719】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_HANDLER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムイベントハンドラの呼出しによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SETVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数の設定による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_INCVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数のインクリメントによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_ACTTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_WUPTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起床による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SIGSEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの返却による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SETFLG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x06U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのセットによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SNDDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x07U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューへの送信による通知</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>エラーの通知の種類を表す定数は次の通り【NGKI3720】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SETVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数の設定による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_INCVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数のインクリメントによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_ACTTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_WUPTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起床による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SIGSEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x50U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの返却による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SETFLG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x60U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのセットによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SNDDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x70U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューへの送信による通知</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TNFY_HANDLER，TNFY_SETVAR，TNFY_INCVARを指定した場合には，エラーの通知の方法を指定してはならない．指定した場合には，E_PARエラーとなる【NGKI3721】．</p>
</div>
<div class="paragraph">
<p>周期通知とアラーム通知をサービスコールにより生成する場合には，通知処理モードと付随情報を，次のように定義されるパケット（T_NFYINFO）に入れて渡す【NGKI3722】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct {
		intptr_t	exinf;		/* タイムイベントハンドラの拡張情報 */
		TMEHDR		tmehdr;		/* タイムイベントハンドラの先頭番地 */
	} T_NFY_HDR;

	typedef struct {
		intptr_t	*p_var;		/* 変数の番地 */
		intptr_t	value;		/* 設定する値 */
	} T_NFY_VAR;

	typedef struct {
		intptr_t	*p_var;		/* 変数の番地 */
	} T_NFY_IVAR;

	typedef struct {
		ID			tskid;		/* タスクID */
	} T_NFY_TSK;

	typedef struct {
		ID			semid;		/* セマフォID */
	} T_NFY_SEM;

	typedef struct {
		ID			flgid;		/* イベントフラグID */
		FLGPTN		flgptn;		/* セットするビットパターン */
	} T_NFY_FLG;

	typedef struct {
		ID			dtqid;		/* データキューID */
		intptr_t	data;		/* 送信する値 */
	} T_NFY_DTQ;

	typedef struct {
		intptr_t	*p_var;		/* 変数の番地 */
	} T_ENFY_VAR;

	typedef struct {
		ID			dtqid;		/* データキューID */
	} T_ENFY_DTQ;

	typedef struct {
		MODE	nfymode;		/* 通知処理モード */
		union {					/* タイムイベントの通知に関する付随情報 */
			T_NFY_HDR	handler;	/* タイムイベントハンドラの呼出しの場合 */
			T_NFY_VAR	setvar;		/* 変数の設定の場合 */
			T_NFY_IVAR	incvar;		/* 変数のインクリメントの場合 */
			T_NFY_TSK	acttsk;		/* タスクの起動の場合 */
			T_NFY_TSK	wuptsk;		/* タスクの起床の場合 */
			T_NFY_SEM	sigsem;		/* セマフォの資源の返却の場合 */
			T_NFY_FLG	setflg;		/* イベントフラグのセットの場合 */
			T_NFY_DTQ	snddtq;		/* データキューへの送信の場合 */
		} nfy;
		union {					/* エラーの通知に関する付随情報 */
			T_ENFY_VAR	setvar;		/* 変数の設定の場合 */
			T_NFY_IVAR	incvar;		/* 変数のインクリメントの場合 */
			T_NFY_TSK	acttsk;		/* タスクの起動の場合 */
			T_NFY_TSK	wuptsk;		/* タスクの起床の場合 */
			T_NFY_SEM	sigsem;		/* セマフォの資源の返却の場合 */
			T_NFY_FLG	setflg;		/* イベントフラグのセットの場合 */
			T_ENFY_DTQ	snddtq;		/* データキューへの送信の場合 */
		} enfy;
	} T_NFYINFO;</code></pre>
</div>
</div>
<div class="paragraph">
<p>周期通知とアラーム通知を静的APIにより生成する場合には，通知処理モードと必要な付随情報を","で区切って列挙したものを"{"と"}"で囲んだ形で記述する【NGKI3723】．各静的APIのインタフェース記述においては，この"{"と"}"で囲んだ形を，＜通知方法の指定＞と記述する．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>静的APIのインタフェース記述における＜通知方法の指定＞の記述例を示す．</p>
</div>
<div class="paragraph">
<p>例1）タイムイベントハンドラの呼出しによる通知{ TNFY_HANDLER, 0, tmevt_handler }</p>
</div>
<div class="paragraph">
<p>例2）変数の設定によるタイムイベントの通知{ TNFY_SETVAR, &amp;event_variable, true }</p>
</div>
<div class="paragraph">
<p>例3）タスクの起動によるタイムイベントの通知（エラーの通知はなし）{ TNFY_ACTTSK, TASK_1 }</p>
</div>
<div class="paragraph">
<p>例4）タスクの起床によるタイムイベントの通知とイベントフラグのセットによるエラーの通知{ TNFY_WUPTSK|TENFY_SETFLG, TASK_1, FLG_1, 0x0001U }</p>
</div>
<div class="paragraph">
<p>例5）セマフォの資源の返却によるタイムイベントの通知と変数の設定によるエラーの通知{ TNFY_SIGSEM|TENFY_SETVAR, SEM_1, &amp;error_variable }</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>周期ハンドラとアラームハンドラの機能を拡張し，機能の名称をそれぞれ周期通知とアラーム通知に変更した．</p>
</div>
<div class="sect3">
<h4 id="_4_6_1_システム時刻管理"><a class="anchor" href="#_4_6_1_システム時刻管理"></a><a class="link" href="#_4_6_1_システム時刻管理">4.6.1 システム時刻管理</a></h4>
<div class="paragraph">
<p>システム時刻は，カーネルによって管理され，タイムアウト処理，タスクの遅延，周期通知の通知，アラーム通知の通知，システム周期の切換えに使用される時刻を管理するカーネルオブジェクトで，システムに1つのみ存在する【NGKI3603】．システム時刻は，64ビット（ただし，64ビットの整数型がサポートされていないターゲットでは，32ビット）の符号無しの整数型であるSYSTIM型で表され，単位はマイクロ秒である［NGKI0548］．</p>
</div>
<div class="paragraph">
<p>システム時刻は，カーネルの初期化時に0に初期化される【NGKI2333】．高分解能タイマを用いてカーネルにより管理・更新され，SYSTIM型で表せる最大値を超えると0に戻される【NGKI3559】．システム時刻の精度はターゲットに依存する【NGKI2336】．</p>
</div>
<div class="paragraph">
<p>システム時刻をきっかけに発生するタイムイベントの処理は，高分解能タイマ割込みによって実行される．そのため，高分解能タイマ割込みのマスクや，高分解能タイマ割込みより優先される処理によって，高分解能タイマ割込みの処理が遅れると，タイムイベントの処理は遅れることになる．また，同じシステム時刻または短い時間間隔で複数のタイムイベントが発生した場合にも，タイムイベントの処理は遅れることになる．高分解能タイマ割込みの処理が大幅に遅れたり，プロセッサが処理できる以上の頻度でタイムイベントが発生すると，タイムイベントの処理が大幅に遅れ，カーネルの正しい動作が保証できなくなる．タイムイベントの処理が大幅に遅れる原因はアプリケーションによって作られるものであり，このような状況が起こらないことを保証するか，起こった場合に適切に対処するのは，アプリケーションの責任である．具体的には，タイムイベントの処理が2秒以上遅れる状況では，カーネルの動作は保証されない【NGKI3608】．</p>
</div>
<div class="paragraph">
<p>同じシステム時刻に複数のイベントを処理すべき状況では，それらの処理の間の処理順序は規定されない【NGKI3560】．</p>
</div>
<div class="paragraph">
<div class="title">〔ドリフトの調整機能〕</div>
<p>ドリフトの調整機能は，システム時刻を外部時刻に徐々に合わせることと，高分解能タイマを駆動するクロックの発振周波数の誤差を補正することを目的にした機能である．</p>
</div>
<div class="paragraph">
<p>ドリフト量は，高分解能タイマの進みに対して，システム時刻をどの程度早く（負の値の場合には，遅く）進めるかを指定するパラメータで，ppm単位でカーネルに設定する【NGKI3593】．例えば，ドリフト量を10ppmに設定すると，高分解能タイマが1,000,000カウントアップする間に，システム時刻は1,000,010マイクロ秒進む．逆に，ドリフト量を-10ppmに設定すると，高分解能タイマが1,000,000カウントアップする間に，システム時刻は999,990マイクロ秒進む．カーネルに設定できるドリフト量は，±10％以内の範囲に制限する【NGKI3594】．</p>
</div>
<div class="paragraph">
<div class="title">〔高分解能タイマの参照〕</div>
<p>性能評価に用いることを目的に，高分解能タイマの状態を参照し，抽象化されたカウント値に変換して返す機能を用意している．具体的には，高分解能タイマのカウント値は，0から，1マイクロ秒に1のペースでカウントアップし（1ずつ連続してカウントアップするとは限らない），高分解能タイマのタイマ周期に達したら0に戻るものと抽象化される【NGKI3580】．高分解能タイマのタイマ周期とカウントアップ毎の進み幅はターゲット定義である【NGKI3574】．高分解能タイマのカウント値は，32ビットまたは64ビット（いずであるかはターゲット定義）の符号無しの整数型であるHRTCNT型で表される【NGKI3573】．高分解能タイマの時間精度は，ターゲットに依存する【NGKI3575】．</p>
</div>
<div class="paragraph">
<div class="title">〔カーネル構成マクロ〕</div>
<p>システム時刻管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_ADJTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻の調整時間の最小値（＝-1,000,000）【NGKI3561】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_ADJTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻の調整時間の最大値（＝1,000,000）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_DRIFT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドリフト量の最小値（＝-100,000）【NGKI3562】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_DRIFT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドリフト量の最大値（＝100,000）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCYC_HRTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高分解能タイマのタイマ周期【NGKI3578】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSTEP_HRTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高分解能タイマのカウント値の進み幅【NGKI3579】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TCYC_HRTCNTは，HRTCNT型が32ビット符号無しの整数型であり，高分解能タイマのタイマ周期が2^32でない場合にのみマクロ定義される【NGKI5187】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ドリフトの調整機能はサポートしない【ASPS0224】．ただし，ドリフト調整機能拡張パッケージを用いると，ドリフトの調整機能を追加することができる【ASPS0225】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ドリフトの調整機能はサポートしない【FMPS0171】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ドリフトの調整機能はサポートしない【HRPS0228】．ただし，ドリフト調整機能拡張パッケージを用いると，ドリフトの調整機能を追加することができる【HRPS0229】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ドリフトの調整機能はサポートしない【HRMPS0112】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，時間管理機能をサポートしない【SSPS0129】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>システム時刻の更新はカーネル内で実現することとし，タイムティックを供給するサービスコール（isig_tim）は廃止した．システム時刻を設定するサービスコール（set_tim）のパラメータを変更した．</p>
</div>
<div class="paragraph">
<p>システム時刻を調整するサービスコール（adj_tim）を追加した．また，ドリフトの調整機能と，ドリフト量を設定するサービスコール（set_dft）を追加した．</p>
</div>
<div class="paragraph">
<p>性能評価に用いるために，高分解能タイマを参照するサービスコール（fch_hrt）を追加した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>システム時刻のアクセス許可ベクタは廃止し，システム状態のアクセス許可ベクタで代替することとした．そのため，システム時刻のアクセス許可ベクタを設定する静的API（SAC_TIM）とサービスコール（sac_tim）は廃止した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS新世代カーネル統合仕様で廃止していたシステム時刻を設定するサービスコール（set_tim）を復活させた．</p>
</div>
<div class="paragraph">
<p>システム時刻を調整するサービスコール（adj_tim）を追加した．また，ドリフトの調整機能と，ドリフト量を設定するサービスコール（set_dft）を追加した．</p>
</div>
<div class="paragraph">
<p>システム時刻がマイクロ秒単位となったことから，性能評価用システム時刻の概念を廃止し，それを参照するサービスコール（get_utm）を廃止した．性能評価に用いるために，高分解能タイマを参照するサービスコール（fch_hrt）を追加した．</p>
</div>
<div class="paragraph">
<p>ローカルタイマ方式を廃止したことに伴い，ローカルタイマ方式の場合の規定を削除した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>set_tim</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム時刻の設定〔T〕【NGKI3563】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = set_tim(SYSTIM systim)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SYSTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">systim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3564】<br>
・CPUロック状態からの呼出し【NGKI3565】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する管理操作が許可されていない〔P〕【NGKI3566】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>システム時刻の現在値を，systimで指定した時刻に設定する【NGKI3567】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>set_timによってシステム時刻を変更しても，タイムイベントが発生する実時刻は変化しない．例えば，タイムイベントを5ミリ秒後に発生するように設定した後に，set_timによりシステム時刻を1ミリ秒進めても，タイムイベントは最初に設定した時刻の5ミリ秒後に発生する．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>設定するシステム時刻を，そのままパラメータとして渡すように変更した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_tim</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム時刻の参照〔T〕【NGKI2349】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_tim(SYSTIM *p_systim)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SYSTIM *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_systim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻を入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SYSTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">systim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻の現在値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2350】<br>
・CPUロック状態からの呼出し【NGKI2351】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する参照操作が許可されていない〔P〕【NGKI2352】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_systimが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2353】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>システム時刻の現在値を参照する．参照したシステム時刻は，p_systimが指すメモリ領域に返される【NGKI2354】．</p>
</div>
<div class="paragraph">
<p>システム時刻を調整するサービスコール（adj_tim）によってシステム時刻を戻した場合でも，get_timで参照するシステム時刻が戻ることはない．具体的には，adj_timによってシステム時刻を戻した場合，get_timは，システム時刻が最も進んでいた時のシステム時刻を返す【NGKI3591】．すなわち，get_timで参照するシステム時刻は，システム時刻を戻した時間の間，進みが止まることになる．get_timで参照するシステム時刻の進みが止まっている間に，set_timによりシステム時刻を設定した場合でも，get_timで参照するシステム時刻の進みが止まっている時間は変化しない【NGKI3592】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>システム時刻を設定するサービスコール（set_tim）によってシステム時刻を設定した場合には，get_timで参照するシステム時刻が戻る可能性がある．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>adj_tim</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム時刻の調整〔TI〕【NGKI3581】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = adj_tim(int32_t adjtim)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adjtim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻の調整量</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI3583】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・adjtimが有効範囲（TMIN_ADJTIM以上，TMAX_ADJTIM以下）外【NGKI3584】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する管理操作が許可されていない〔P〕【NGKI3585】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>システム時刻を，adjtimで指定した時間だけ調整する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>まず，システム時刻の現在値に，adjtimで指定した時間を加える【NGKI3586】．すなわち，adjtimが正の値の時はシステム時刻は進み，adjtimが負の時はシステム時刻は戻ることになる．</p>
</div>
<div class="paragraph">
<p>システム時刻の調整に伴って，システム時刻の経過をきっかけに発生するタイムイベントが発生するまでの相対時間も調整する【NGKI3587】．例えば，タイムイベントを5ミリ秒後に発生するように設定した後に，adj_timによりシステム時刻を1ミリ秒進めると，タイムイベントは最初に設定した時刻の4ミリ秒後に発生する．</p>
</div>
<div class="paragraph">
<p>adj_timの1回の呼出しで調整できる時間範囲には，adjtimの有効範囲により±1秒以内という制限が設けられているが，adj_timを連続して呼び出した場合，未処理の調整時間の累積値に対しても，次の制限が設けられている．adj_timで時間を進める場合（adjtimが正の場合）には，1秒以上過去の発生時刻を持つタイムイベントが処理されずに残っている場合に，E_OBJエラーとなる【NGKI3588】．時間を戻す場合（adjtimが負の場合）には，現在のシステム時刻が，システム時刻が最も進んでいた時のシステム時刻より1秒以上戻っている場合に，E_OBJエラーとなる【NGKI3589】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>adj_timによりシステム時刻を進めた場合，多くのタイムイベントが一斉に発生する可能性がある．例えば，1ミリ秒周期の周期ハンドラが動作している時に，adj_timによりシステム時刻を100ミリ秒進めると，周期ハンドラが連続して100回呼び出される．これにより発生する負荷が問題にならないように，注意が必要である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様およびTOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>adj_timの1回の呼出しで調整できる時間範囲と未処理の調整時間の累積値に対して制限を設けているのは，タイムイベントを発生させる時刻を，カーネル内部でそれを表現するデータ型の範囲を超えないようにするためである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>set_dft</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ドリフト量の設定〔TI〕【NGKI3596】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = set_dft(int32_t drift)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">drift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドリフト量（単位はppm）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI3598】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・driftが有効範囲（TMIN_DRIFT以上，TMAX_DRIFT以下）外【NGKI3599】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する管理操作が許可されていない〔P〕【NGKI3600】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>ドリフト量を，driftで指定した値に設定する【NGKI3601】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>set_dftによって設定したドリフト量は，次にドリフト量を設定するまで有効である．そのため，ドリフトの調整機能を用いて，システム時刻を指定した時間だけ進めたい（または遅らせたい）場合，どれだけの時間をかけてシステム時刻を調整するかを決め，必要なドリフト量を算出してset_dftにより設定した後，調整が終わるタイミングで再度set_dftを呼び出し，ドリフト量を0（または元の値）に戻すことが必要である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，set_dftをサポートしない【ASPS0226】．ただし，ドリフト調整機能拡張パッケージでは，set_dftをサポートする【ASPS0227】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，set_dftをサポートしない【FMPS0172】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，set_dftをサポートしない【HRPS0230】．ただし，ドリフト調整機能拡張パッケージでは，set_dftをサポートする【HRPS0231】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，set_dftをサポートしない【HRMPS0113】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様およびTOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>fch_hrt</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>高分解能タイマの参照〔TI〕【NGKI3569】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	HRTCNT hrtcnt = fch_hrt()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hrtcnt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高分解能タイマの現在のカウント値</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>高分解能タイマを現在のカウント値を読み出す．具体的には，高分解能タイマの現在の状態を参照し，抽象化されたカウント値に変換して，返値として返す【NGKI3571】．</p>
</div>
<div class="paragraph">
<p>fch_hrtは，任意の状態から呼び出すことができる【NGKI3572】．タスクコンテキストからも非タスクコンテキストからも呼び出すことができるし，CPUロック状態であっても呼び出すことができる．</p>
</div>
<div class="paragraph">
<div class="title">【使用方法】</div>
<p>fch_hrtを使用してプログラムの処理時間を計測する場合には，次の手順を取る．処理時間を計測したいプログラムの実行直前と実行直後に，fch_hrtを用いて高分解能タイマの現在のカウント値を読み出す．高分解能タイマの周期を考慮してその差を求めることで，対象プログラムの処理時間に，fch_hrt自身の処理時間を加えたものが得られる．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>fch_hrtは性能評価のための機能であり，その他の目的に使用することは推奨しない．</p>
</div>
<div class="paragraph">
<p>fch_hrtは，任意の状態から呼び出すことができるように，全割込みロック状態を用いて実装されている．そのため，fch_hrtを用いると，カーネル管理外の割込みの応答性が低下する．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様およびTOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_6_2_周期通知"><a class="anchor" href="#_4_6_2_周期通知"></a><a class="link" href="#_4_6_2_周期通知">4.6.2 周期通知</a></h4>
<div class="paragraph">
<p>周期通知は，指定した周期で通知処理を行うタイムイベント通知である．周期通知は，周期通知IDと呼ぶID番号によって識別する【NGKI3724】．</p>
</div>
<div class="paragraph">
<p>各周期通知が持つ情報は次の通り【NGKI3725】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>周期通知属性</p>
</li>
<li>
<p>周期通知の動作状態</p>
</li>
<li>
<p>次回通知時刻</p>
</li>
<li>
<p>通知方法</p>
</li>
<li>
<p>通知周期</p>
</li>
<li>
<p>通知位相</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>周期通知の通知時刻は，後述する基準時刻から，以下の式で求められる相対時間後である【NGKI2365】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通知位相＋通知周期×(n−1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n＝1,2,…</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>周期通知の動作状態は，動作している状態と動作していない状態のいずれかをとる【NGKI2366】．周期通知を動作している状態にすることを動作開始，動作していない状態にすることを動作停止という．</p>
</div>
<div class="paragraph">
<p>周期通知が動作している状態の場合には，周期通知の通知時刻になると，周期通知の通知処理が行われる【NGKI3726】．</p>
</div>
<div class="paragraph">
<p>周期通知属性には，次の属性を指定することができる【NGKI2370】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の生成時に周期通知を動作開始する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_PHS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知を生成した時刻を基準時刻とする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_STAを指定しない場合，周期通知の生成直後には，周期通知は動作していない状態となる【NGKI2371】．</p>
</div>
<div class="paragraph">
<p>TA_PHSを指定しない場合には，周期通知を動作開始した時刻が，周期通知を起動する時刻の基準時刻となる【NGKI2372】．TA_PHSを指定した場合には，周期通知を生成した時刻（静的APIで生成した場合にはカーネルの起動時刻）が，基準時刻となる【NGKI2373】．</p>
</div>
<div class="paragraph">
<p>次回通知時刻は，周期通知が動作している状態でのみ有効で，必要に応じて，カーネルの起動時，周期通知の動作開始時，周期通知の通知処理時に設定される【NGKI2374】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，周期通知は，割付け可能プロセッサがすべてタイムイベント処理プロセッサであるクラスにのみ属することができる【NGKI5088】．</p>
</div>
<div class="paragraph">
<p>周期通知機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_CYCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できる周期通知の数（動的生成対応でないカーネルでは，静的APIによって登録された周期通知の数に一致）【NGKI2378】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，TA_PHS属性の周期通知をサポートしない【ASPS0172】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，TA_PHS属性の周期通知をサポートしない【FMPS0147】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，TA_PHS属性の周期通知をサポートしない【HRPS0141】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，TA_PHS属性の周期通知をサポートしない【HRMPS0114】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>周期ハンドラ機能を拡張し，周期通知機能とした．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，周期通知が属することができるクラスの条件を変更した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>周期ハンドラ機能を拡張し，周期通知機能とした．TNUM_CYCIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_CYC</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知の生成〔S〕【NGKI3727】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_cyc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知の生成〔TD〕【NGKI3728】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_CYC(ID cycid, { ATR cycatr, ＜通知方法の指定＞,
										RELTIM cyctim, RELTIM cycphs })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID cycid = acre_cyc(const T_CCYC *pk_ccyc)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成する周期通知のID番号（CRE_CYCの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CCYC *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_ccyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊周期通知の生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_NFYINFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nfyinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の通知方法</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cyctim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の通知周期</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycphs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の通知位相</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成された周期通知のID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2381】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2382】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・cycatrが無効【NGKI2383】<br>
・属する保護ドメインの指定が有効範囲外または無所属〔sP〕【NGKI3729】<br>
・保護ドメインの囲みの中に記述されていない〔SP〕【NGKI3741】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI2387】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI2386】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・通知方法中のオブジェクトIDが有効範囲外［NGKI3704］［NGKI3707］［NGKI3710］［NGKI3713］［NGKI3715］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・通知方法中の通知処理モードの値が正しくない［NGKI3730］［NGKI3721］<br>
・通知方法中のタイムイベントハンドラの先頭番地または変数の番地が正しくない［NGKI3693］［NGKI3699］［NGKI3701］［NGKI3897］<br>
・cyctimが有効範囲（0より大きく，TMAX_RELTIM以下）外【NGKI2397】<br>
・cycphsが有効範囲（0以上，TMAX_RELTIM以下）外【NGKI2399】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメインに対する通常操作1が許可されていない〔sP〕【NGKI3975】<br>
・通知方法中のオブジェクトに対する操作が，属する保護ドメインに許可されていない〔P〕［NGKI3705］［NGKI3708］［NGKI3711］［NGKI3716］<br>
・属する保護ドメインがユーザドメインで，通知方法にタイムイベントハンドラの呼出しを指定〔P〕［NGKI3695］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_ccycが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI2390】<br>
・通知方法中の変数に対する操作が，属する保護ドメインに許可されていない〔P〕［NGKI3702］［NGKI3898］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられる周期通知IDがない〔sD〕【NGKI2391】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・cycidで指定した周期通知が登録済み〔S〕【NGKI2392】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した周期通知の生成情報に従って，周期通知を生成する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>cycatrにTA_STAを指定した場合，対象周期通知は動作している状態となる【NGKI2393】．次回通知時刻は，サービスコールを呼び出した時刻（静的APIの場合はカーネルの起動時刻）から，cycphsで指定した相対時間後に設定される【NGKI2394】．cycphsにcyctimより大きい値を指定してもよい【NGKI2400】．</p>
</div>
<div class="paragraph">
<p>cycatrにTA_STAを指定しない場合，対象周期通知は動作していない状態に初期化される【NGKI2395】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，cycidはオブジェクト識別名，cycatr，通知方法中の通知処理モード，cyctim，cycphsは整数定数式パラメータ，通知方法中の付随情報は一般定数式パラメータである【NGKI3731】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，生成する周期通知の属するクラスの割付け可能プロセッサが，タイムイベント処理プロセッサでないものを含む場合には，E_RSATRエラーとなる【NGKI5089】．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサの両方に対応するカーネルでは，生成する周期通知がユーザドメインに属する場合に，［NGKI0628］の制約が課される．具体的には，生成する周期通知が属するユーザドメインが，アイドルドメインにまとめられておらず，属するクラスの初期割付けプロセッサでタイムウィンドウを割り当てられていない場合，E_PARエラーとなる【NGKI5130】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>通知方法中のオブジェクトに対する操作が，属する保護ドメインに許可されていないエラーのチェックは，周期通知の生成時に行われる．そのため，周期通知の生成後に操作対象のオブジェクトのアクセス許可ベクタを変更しても，生成済みの周期通知がエラーになることはない. 通知方法中の変数に対する操作が，属する保護ドメインに許可されていないエラーのチェックについても，同様である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，TA_PHS属性の周期通知はサポートしない［ASPS0172］．ASP3カーネルの動的生成機能拡張パッケージでは，acre_cycをサポートする【ASPS0175】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，TA_PHS属性の周期通知はサポートしない［FMPS0147］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，TA_PHS属性の周期通知はサポートしない［HRPS0141］．HRP3カーネルの動的生成機能拡張パッケージでは，acre_cycをサポートする【HRPS0202】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，TA_PHS属性の周期通知はサポートしない［HRMPS0114］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>通知方法が指定できるようにパラメータを変更した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>通知方法が指定できるようにパラメータを変更した．また，cycphsにcyctimより大きい値を指定した場合の振舞いを規定した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_CYC</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能な周期通知IDの数の指定〔SD〕【NGKI2402】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_CYC(uint_t nocyc)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nocyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能な周期通知IDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・保護ドメインの囲みの中に記述されていない〔P〕【NGKI3980】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI2404】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5120】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>nocycで指定した数の周期通知IDを，周期通知を生成するサービスコールによって割付け可能な周期通知IDとして確保する【NGKI2405】．</p>
</div>
<div class="paragraph">
<p>nocycは整数定数式パラメータである【NGKI2406】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，AID_CYCが属するクラスの割付け可能プロセッサが，タイムイベント処理プロセッサでないものを含む場合には，E_RSATRエラーとなる【NGKI5090】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_CYCをサポートする【ASPS0217】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_CYCをサポートする【HRPS0218】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_CYC</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知のアクセス許可ベクタの設定〔SP〕【NGKI2408】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_cyc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知のアクセス許可ベクタの設定〔TPD〕【NGKI2409】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_CYC(ID cycid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_cyc(ID cycid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象周期通知のID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2410】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2411】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・cycidが有効範囲外〔s〕【NGKI2412】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象周期通知が属する保護ドメインの囲みの中に記述されていない〔S〕【NGKI3732】<br>
・対象周期通知が属するクラスの囲みの中に記述されていない〔SM〕【NGKI2414】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象周期通知が未登録【NGKI2415】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象周期通知に対する管理操作が許可されていない〔s〕【NGKI2416】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI2417】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象周期通知は静的APIで生成された〔s〕【NGKI2418】<br>
・対象周期通知に対してアクセス許可ベクタが設定済み〔S〕【NGKI2419】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>cycidで指定した周期通知（対象周期通知）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI2420】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，cycidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI2421】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_cycもサポートする【HRPS0203】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_cyc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知の削除〔TD〕【NGKI2422】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_cyc(ID cycid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象周期通知のID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2423】<br>
・CPUロック状態からの呼出し【NGKI2424】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・cycidが有効範囲外【NGKI2425】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象周期通知が未登録【NGKI2426】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象周期通知に対する管理操作が許可されていない〔P〕【NGKI2427】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象周期通知は静的APIで生成された【NGKI2428】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>cycidで指定した周期通知（対象周期通知）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期通知の登録が解除され，その周期通知IDが未使用の状態に戻される【NGKI2429】．対象周期通知が動作している状態であった場合には，動作していない状態にされた後に，登録が解除される【NGKI2430】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_cycをサポートする【ASPS0178】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_cycをサポートする【HRPS0204】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sta_cyc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知の動作開始〔T〕【NGKI2431】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sta_cyc(ID cycid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象周期通知のID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2432】<br>
・CPUロック状態からの呼出し【NGKI2433】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・cycidが有効範囲外【NGKI2434】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象周期通知が未登録〔D〕【NGKI2435】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象周期通知に対する通常操作1が許可されていない〔P〕【NGKI2436】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>cycidで指定した周期通知（対象周期通知）を動作開始する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期通知が動作していない状態であれば，対象周期通知は動作している状態となる【NGKI2437】．次回通知時刻は，sta_cycを呼び出して以降の最初の通知時刻に設定される【NGKI2438】．</p>
</div>
<div class="paragraph">
<p>対象周期通知が動作している状態であれば，次回通知時刻の再設定のみが行われる【NGKI2439】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>TA_PHS属性でない周期通知の場合，次回通知時刻は，sta_cycを呼び出してから，対象周期通知の通知位相で指定した相対時間後に設定される．</p>
</div>
<div class="paragraph">
<p>対象周期通知がTA_PHS属性で，動作している状態であれば，次回通知時刻は変化しない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TA_PHS属性でない周期通知において，sta_cycを呼び出した後，最初に周期通知が通知される時刻を変更した．μITRON4.0仕様では，sta_cycを呼び出してから周期ハンドラの起動周期で指定した相対時間後となっているが，この仕様では，通知位相で指定した相対時間後とした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>msta_cyc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付けプロセッサ指定での周期通知の動作開始〔TM〕【NGKI2440】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = msta_cyc(ID cycid, ID prcid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象周期通知のID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の割付け対象のプロセッサのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2441】<br>
・CPUロック状態からの呼出し【NGKI2442】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・cycidが有効範囲外【NGKI2443】<br>
・prcidが有効範囲外【NGKI2444】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象周期通知が未登録〔D〕【NGKI2445】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象周期通知に対する通常操作1が許可されていない〔P〕【NGKI2446】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>prcidで指定したプロセッサを割付けプロセッサとして，cycidで指定した周期通知（対象周期通知）を動作開始する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期通知が動作していない状態であれば，対象周期通知の割付けプロセッサがprcidで指定したプロセッサに変更された後，対象周期通知は動作している状態となる【NGKI2447】．次回通知時刻は，msta_cycを呼び出して以降の最初の通知時刻に設定される【NGKI2448】．</p>
</div>
<div class="paragraph">
<p>対象周期通知が動作している状態であれば，対象周期通知の割付けプロセッサがprcidで指定したプロセッサに変更された後，次回通知時刻の再設定が行われる【NGKI2449】．</p>
</div>
<div class="paragraph">
<p>対象周期通知が実行中である場合には，割付けプロセッサを変更しても，実行中の周期通知を実行するプロセッサは変更されない【NGKI2450】．対象周期通知が変更後の割付けプロセッサで実行されるのは，次に通知される時からである【NGKI2451】．</p>
</div>
<div class="paragraph">
<p>対象周期通知の属するクラスの割付け可能プロセッサが，prcidで指定したプロセッサを含んでいない場合には，E_PARエラーとなる【NGKI2452】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，対象周期通知がユーザドメインに属する場合に，［NGKI0628］の制約が課される．具体的には，対象周期通知が属するユーザドメインが，アイドルドメインにまとめられておらず，prcidで指定したプロセッサでタイムウィンドウを割り当てられていない場合，E_PARエラーとなる【NGKI5131】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象周期通知の割付けプロセッサを，それが属するクラスの初期割付けプロセッサとする【NGKI2453】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>TA_PHS属性でない周期通知の場合，次回通知時刻は，msta_cycを呼び出してから，対象周期通知の通知位相で指定した相対時間後に設定される．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>msta_cycで実行中の周期通知の割付けプロセッサを変更した場合，同じ周期通知が異なるプロセッサで同時に実行される可能性がある．特に，対象周期通知の通知位相が0の場合に，注意が必要である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>msta_cycがE_NOSPTエラーとなることがなくなった．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>stp_cyc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知の動作停止〔T〕【NGKI2455】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = stp_cyc(ID cycid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象周期通知のID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2456】<br>
・CPUロック状態からの呼出し【NGKI2457】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・cycidが有効範囲外【NGKI2458】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象周期通知が未登録〔D〕【NGKI2459】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象周期通知に対する通常操作2が許可されていない〔P〕【NGKI2460】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>cycidで指定した周期通知（対象周期通知）を動作停止する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期通知が動作している状態であれば，動作していない状態になる【NGKI2461】．対象周期通知が動作していない状態であれば，何も行われずに正常終了する【NGKI2462】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_cyc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>周期通知の状態参照〔T〕【NGKI2463】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_cyc(ID cycid, T_RCYC *pk_rcyc)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象周期通知のID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RCYC *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rcyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊周期通知の現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cycstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の動作状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lefttim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">次回通知時刻までの相対時間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の割付けプロセッサのID（マルチプロセッサ対応カーネルの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2464】<br>
・CPUロック状態からの呼出し【NGKI2465】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・cycidが有効範囲外【NGKI2466】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象周期通知が未登録〔D〕【NGKI2467】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象周期通知に対する参照操作が許可されていない〔P〕【NGKI2468】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rcycが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2469】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>cycidで指定した周期通知（対象周期通知）の現在状態を参照する．参照した現在状態は，pk_rcycで指定したパケットに返される【NGKI2470】．</p>
</div>
<div class="paragraph">
<p>cycstatには，対象周期通知の現在の動作状態を表す次のいずれかの値が返される【NGKI2471】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCYC_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知が動作していない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCYC_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知が動作している状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>対象周期通知が動作している状態である場合には，lefttimに，次回通知時刻までの相対時間が返される【NGKI2472】．対象周期通知が動作していない状態である場合には，lefttimの値は保証されない【NGKI2473】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，prcidに，対象周期通知の割付けプロセッサのID番号が返される【NGKI2474】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_cycはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_cycを呼び出し，対象周期通知の現在状態を参照した直後に割込みが発生した場合，ref_cycから戻ってきた時には対象周期通知の状態が変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TCYC_STPとTCYC_STAを値を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_6_3_アラーム通知"><a class="anchor" href="#_4_6_3_アラーム通知"></a><a class="link" href="#_4_6_3_アラーム通知">4.6.3 アラーム通知</a></h4>
<div class="paragraph">
<p>アラーム通知は，指定した相対時間後に通知処理を行うタイムイベント通知である．アラーム通知は，アラーム通知IDと呼ぶID番号によって識別する【NGKI3733】．</p>
</div>
<div class="paragraph">
<p>各アラーム通知が持つ情報は次の通り【NGKI3734】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アラーム通知属性</p>
</li>
<li>
<p>アラーム通知の動作状態</p>
</li>
<li>
<p>通知時刻</p>
</li>
<li>
<p>通知方法</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>アラーム通知の動作状態は，動作している状態と動作していない状態のいずれかをとる【NGKI2477】．アラーム通知を動作している状態にすることを動作開始，動作していない状態にすることを動作停止という．</p>
</div>
<div class="paragraph">
<p>通知時刻は，アラーム通知が動作している状態でのみ有効で，アラーム通知を動作開始する時に設定される【NGKI2478】．</p>
</div>
<div class="paragraph">
<p>アラーム通知が動作している状態の場合には，通知時刻になると，アラーム通知が動作していない状態にされた後，アラーム通知の通知処理が行われる【NGKI3735】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，アラーム通知は，割付け可能プロセッサがすべてタイムイベント処理プロセッサであるクラスにのみ属することができる【NGKI5091】．</p>
</div>
<div class="paragraph">
<p>アラーム通知属性に指定できる属性はない【NGKI3423】．そのためアラーム通知属性には，TA_NULLを指定しなければならない【NGKI3424】．</p>
</div>
<div class="paragraph">
<p>アラーム通知機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_ALMID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるアラーム通知の数（動的生成対応でないカーネルでは，静的APIによって登録されたアラーム通知の数に一致）【NGKI2486】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>アラームハンドラ機能を拡張し，アラーム通知機能とした．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，アラーム通知が属することができるクラスの条件を変更した．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>アラームハンドラ機能を拡張し，アラーム通知機能とした．TNUM_ALMIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_ALM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知の生成〔S〕【NGKI3736】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_alm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知の生成〔TD〕【NGKI3737】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_ALM(ID almid, { ATR almatr, ＜通知方法の指定＞ })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID almid = acre_alm(const T_CALM *pk_calm)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するアラーム通知のID番号（CRE_ALMの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CALM *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_calm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アラーム通知の生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_NFYINFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nfyinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の通知方法</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成されたアラーム通知のID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2489】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2490】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・almatrが無効【NGKI2491】<br>
・属する保護ドメインの指定が有効範囲外または無所属〔sP〕【NGKI3738】<br>
・保護ドメインの囲みの中に記述されていない〔SP〕【NGKI3742】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI2495】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI2494】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・通知方法中のオブジェクトIDが有効範囲外［NGKI3704］［NGKI3707］［NGKI3710］［NGKI3713］［NGKI3715］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・通知方法中の通知処理モードの値が正しくない［NGKI3730］［NGKI3721］<br>
・通知方法中のタイムイベントハンドラの先頭番地または変数の番地が正しくない［NGKI3693］［NGKI3699］［NGKI3701］［NGKI3897］<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメインに対する通常操作1が許可されていない〔sP〕【NGKI3976】<br>
・通知方法中のオブジェクトに対する操作が，属する保護ドメインに許可されていない〔P〕［NGKI3705］［NGKI3708］［NGKI3711］［NGKI3716］<br>
・属する保護ドメインがユーザドメインで，通知方法にタイムイベントハンドラの呼出しを指定〔P〕［NGKI3695］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_calmが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI2498】<br>
・通知方法中の変数に対する操作が，属する保護ドメインに許可されていない〔P〕［NGKI3702］［NGKI3898］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられるアラーム通知IDがない〔sD〕【NGKI2499】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・almidで指定したアラーム通知が登録済み〔S〕【NGKI2500】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したアラーム通知の生成情報に従って，アラーム通知を生成する．対象アラーム通知は，動作していない状態に初期化される【NGKI2501】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，almidはオブジェクト識別名，almatrと通知方法中の通知処理モードは整数定数式パラメータ，通知方法中の付随情報は一般定数式パラメータである【NGKI3739】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，生成するアラーム通知の属するクラスの割付け可能プロセッサが，タイムイベント処理プロセッサでないものを含む場合には，E_RSATRエラーとなる【NGKI5092】．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサの両方に対応するカーネルでは，生成するアラーム通知がユーザドメインに属する場合に，［NGKI0628］の制約が課される．具体的には，生成するアラーム通知が属するユーザドメインが，アイドルドメインにまとめられておらず，属するクラスの初期割付けプロセッサでタイムウィンドウを割り当てられていない場合，E_PARエラーとなる【NGKI5132】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>通知方法中のオブジェクトに対する操作が，属する保護ドメインに許可されていないエラーのチェックは，アラーム通知の生成時に行われる．そのため，アラーム通知の生成後に操作対象のオブジェクトのアクセス許可ベクタを変更しても，生成済みのアラーム通知がエラーになることはない. 通知方法中の変数に対する操作が，属する保護ドメインに許可されていないエラーのチェックについても，同様である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_almをサポートする【ASPS0180】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_almをサポートする【HRPS0205】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>通知方法が指定できるようにパラメータを変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_ALM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能なアラーム通知IDの数の指定〔SD〕【NGKI2504】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_ALM(uint_t noalm)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">noalm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能なアラーム通知IDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・保護ドメインの囲みの中に記述されていない〔P〕【NGKI3981】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI2506】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5121】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>noalmで指定した数のアラーム通知IDを，アラーム通知を生成するサービスコールによって割付け可能なアラーム通知IDとして確保する【NGKI2507】．</p>
</div>
<div class="paragraph">
<p>noalmは整数定数式パラメータである【NGKI2508】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，AID_ALMが属するクラスの割付け可能プロセッサが，タイムイベント処理プロセッサでないものを含む場合には，E_RSATRエラーとなる【NGKI5093】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_ALMをサポートする【ASPS0218】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_ALMをサポートする【HRPS0219】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_ALM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知のアクセス許可ベクタの設定〔SP〕【NGKI2510】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_alm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知のアクセス許可ベクタの設定〔TPD〕【NGKI2511】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_ALM(ID almid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_alm(ID almid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象アラーム通知のID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2512】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2513】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・almidが有効範囲外〔s〕【NGKI2514】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・対象アラーム通知が属する保護ドメインの囲みの中に記述されていない〔S〕【NGKI3740】<br>
・対象アラーム通知が属するクラスの囲みの中に記述されていない〔SM〕【NGKI2516】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象アラーム通知が未登録【NGKI2517】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象アラーム通知に対する管理操作が許可されていない〔s〕【NGKI2518】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI2519】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象アラーム通知は静的APIで生成された〔s〕【NGKI2520】<br>
・対象アラーム通知に対してアクセス許可ベクタが設定済み〔S〕【NGKI2521】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>almidで指定したアラーム通知（対象アラーム通知）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI2522】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，almidはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI2523】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，sac_almをサポートする【HRPS0206】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_alm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知の削除〔TD〕【NGKI2524】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_alm(ID almid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象アラーム通知のID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2525】<br>
・CPUロック状態からの呼出し【NGKI2526】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・almidが有効範囲外【NGKI2527】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象アラーム通知が未登録【NGKI2528】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象アラーム通知に対する管理操作が許可されていない〔P〕【NGKI2529】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象アラーム通知は静的APIで生成された【NGKI2530】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>almidで指定したアラーム通知（対象アラーム通知）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知の登録が解除され，そのアラーム通知IDが未使用の状態に戻される【NGKI2531】．対象アラーム通知が動作している状態であった場合には，登録解除の前に，アラーム通知が動作していない状態となる【NGKI2532】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_almをサポートする【ASPS0183】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_almをサポートする【HRPS0207】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sta_alm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知の動作開始〔TI〕【NGKI3543】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sta_alm(ID almid, RELTIM almtim)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象アラーム通知のID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almtim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の通知時刻（相対時間）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI3899】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・almidが有効範囲外【NGKI2537】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・almtimがTMAX_RELTIMより大きい【NGKI2538】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象アラーム通知が未登録〔D〕【NGKI2539】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象アラーム通知に対する通常操作1が許可されていない〔P〕【NGKI2540】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>almidで指定したアラーム通知（対象アラーム通知）を動作開始する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知が動作していない状態であれば，対象アラーム通知は動作している状態となる【NGKI2541】．通知時刻は，sta_almを呼び出してから，almtimで指定した相対時間後に設定される【NGKI2542】．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知が動作している状態であれば，通知時刻の再設定のみが行われる【NGKI2543】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>msta_alm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付けプロセッサ指定でのアラーム通知の動作開始〔TIM〕【NGKI3544】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = msta_alm(ID almid, RELTIM almtim, ID prcid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象アラーム通知のID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almtim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の通知時刻（相対時間）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の割付け対象のプロセッサのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2548】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・almidが有効範囲外【NGKI2549】<br>
・prcidが有効範囲外【NGKI2550】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・almtimがTMAX_RELTIMより大きい【NGKI2551】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象アラーム通知が未登録〔D〕【NGKI2552】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象アラーム通知に対する通常操作1が許可されていない〔P〕【NGKI2553】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>prcidで指定したプロセッサを割付けプロセッサとして，almidで指定したアラーム通知（対象アラーム通知）を動作開始する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知が動作していない状態であれば，対象アラーム通知の割付けプロセッサがprcidで指定したプロセッサに変更された後，対象アラーム通知は動作している状態となる【NGKI2554】．通知時刻は，msta_almを呼び出してから，almtimで指定した相対時間後に設定される【NGKI2555】．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知が動作している状態であれば，対象アラーム通知の割付けプロセッサがprcidで指定したプロセッサに変更された後，通知時刻の再設定が行われる【NGKI2556】．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知が実行中である場合には，割付けプロセッサを変更しても，実行中のアラーム通知を実行するプロセッサは変更されない【NGKI2557】．対象アラーム通知が変更後の割付けプロセッサで実行されるのは，次に通知される時からである【NGKI2558】．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知の属するクラスの割付け可能プロセッサが，prcidで指定したプロセッサを含んでいない場合には，E_PARエラーとなる【NGKI2559】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象アラーム通知の割付けプロセッサを，それが属するクラスの初期割付けプロセッサとする【NGKI2560】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，対象アラーム通知がユーザドメインに属する場合に，［NGKI0628］の制約が課される．具体的には，対象アラーム通知が属するユーザドメインが，アイドルドメインにまとめられておらず，prcidで指定したプロセッサでタイムウィンドウを割り当てられていない場合，E_PARエラーとなる【NGKI5133】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>msta_almで実行中のアラーム通知の割付けプロセッサを変更した場合，同じアラーム通知が異なるプロセッサで同時に実行される可能性がある．特に，almtimに0を指定する場合に，注意が必要である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>msta_almがE_NOSPTエラーとなることがなくなった．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>stp_alm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知の動作停止〔TI〕【NGKI3545】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = stp_alm(ID almid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象アラーム通知のID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2566】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・almidが有効範囲外【NGKI2567】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象アラーム通知が未登録〔D〕【NGKI2568】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象アラーム通知に対する通常操作2が許可されていない〔P〕【NGKI2569】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>almidで指定したアラーム通知（対象アラーム通知）を動作停止する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象アラーム通知が動作している状態であれば，動作していない状態となる【NGKI2570】．対象アラーム通知が動作していない状態であれば，何も行われずに正常終了する【NGKI2571】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_alm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>アラーム通知の状態参照〔T〕【NGKI2572】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_alm(ID almid, T_RALM *pk_ralm)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象アラーム通知のID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RALM *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_ralm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アラーム通知の現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">almstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の動作状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lefttim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通知時刻までの相対時間</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知の割付けプロセッサのID（マルチプロセッサ対応カーネルの場合）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2573】<br>
・CPUロック状態からの呼出し【NGKI2574】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・almidが有効範囲外【NGKI2575】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象アラーム通知が未登録〔D〕【NGKI2576】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象アラーム通知に対する参照操作が許可されていない〔P〕【NGKI2577】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_ralmが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2578】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>almidで指定したアラーム通知（対象アラーム通知）の現在状態を参照する．参照した現在状態は，pk_ralmで指定したパケットに返される【NGKI2579】．</p>
</div>
<div class="paragraph">
<p>almstatには，対象アラーム通知の現在の動作状態を表す次のいずれかの値が返される【NGKI2580】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TALM_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知が動作していない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TALM_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知が動作している状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>対象アラーム通知が動作している状態である場合には，lefttimに，通知時刻までの相対時間が返される【NGKI2581】．対象アラーム通知が動作していない状態である場合には，lefttimの値は保証されない【NGKI2582】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，prcidに，対象アラーム通知の割付けプロセッサのID番号が返される【NGKI2583】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_almはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_almを呼び出し，対象アラーム通知の現在状態を参照した直後に割込みが発生した場合，ref_almから戻ってきた時には対象アラーム通知の状態が変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TALM_STPとTALM_STAを値を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_4_6_4_オーバランハンドラ"><a class="anchor" href="#_4_6_4_オーバランハンドラ"></a><a class="link" href="#_4_6_4_オーバランハンドラ">4.6.4 オーバランハンドラ</a></h4>
<div class="paragraph">
<p>オーバランハンドラは，タスクが使用したプロセッサ時間が，指定した時間を超えた場合に起動されるタイムイベントハンドラである．オーバランハンドラは，システムで1つのみ登録することができる【NGKI2584】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラの呼出し処理は，オーバランタイマ割込みによって実行される．そのため，オーバランタイマ割込みのマスクや，オーバランタイマ割込みより優先される処理によって，オーバランタイマ割込みの処理が遅れると，オーバランハンドラの呼出し処理は遅れることになる．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラ機能に関連して，各タスクが持つ情報は次の通り【NGKI2585】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>オーバランハンドラの動作状態</p>
</li>
<li>
<p>残りプロセッサ時間</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>オーバランハンドラの動作状態は，タスク毎に，動作している状態と動作していない状態のいずれかをとる【NGKI2586】．残りプロセッサ時間は，オーバランハンドラが動作している状態の時に，タスクが使用できる残りのプロセッサ時間を表す．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラの動作状態は，タスクの生成時と，タスクが休止状態に遷移する時に，動作していない状態に初期化される【NGKI2587】．</p>
</div>
<div class="paragraph">
<p>残りプロセッサ時間は，オーバランハンドラの動作開始時に，指定した値に初期化される【NGKI3771】．この時，PRCTIM型に格納できる任意の値を指定できるとは限らず，指定できる値にターゲット定義の上限がある場合がある【NGKI2594】．残りプロセッサ時間に指定できる最大値は，カーネル構成マクロTMAX_OVRTIMに定義されている【NGKI2595】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラが動作している状態でタスクが実行している間，残りプロセッサ時間は，タスクが使用したプロセッサ時間の分だけ減少する【NGKI2588】．残りプロセッサ時間が0になると（これをオーバランと呼ぶ），オーバランハンドラが起動される【NGKI2589】．この時，オーバランしたタスクのオーバランハンドラの動作状態は，動作していない状態になる【NGKI3993】．</p>
</div>
<div class="paragraph">
<p>タスクが使用したプロセッサ時間には，そのタスク自身とそこから呼び出したサービルコール（拡張サービスコールを含む）の実行時間を含む【NGKI2590】．一方，タスクの実行中に起動されたカーネル管理の割込みハンドラ（割込みサービスルーチン，周期通知，アラーム通知，オーバランハンドラの実行時間を含む）とカーネル管理のCPU例外ハンドラの実行時間は含まないが，割込みハンドラおよびCPU例外ハンドラの呼出し／復帰にかかる時間と，それらの入口処理と出口処理の一部の実行時間は含んでしまう【NGKI2591】．また，タスクの実行中に起動されたカーネル管理外の割込みハンドラとカーネル管理外のCPU例外ハンドラの実行時間も含む【NGKI2592】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，オーバランハンドラは，カーネルドメインに属する【NGKI2597】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，オーバランハンドラ機能がサポートされていない場合がある【NGKI2598】．オーバランハンドラ機能がサポートされている場合には，TOPPERS_SUPPORT_OVRHDRがマクロ定義される【NGKI2599】．サポートされていない場合にオーバランハンドラ機能のサービスコールを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI2600】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラ属性に指定できる属性はない【NGKI2602】．そのためオーバランハンドラ属性には，TA_NULLを指定しなければならない【NGKI2603】．</p>
</div>
<div class="paragraph">
<p>C言語によるオーバランハンドラの記述形式は次の通り【NGKI2604】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void overrun_handler(ID tskid, intptr_t exinf)
	{
		オーバランハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>tskidにはオーバランを起こしたタスクのID番号が，exinfにはそのタスクの拡張情報が，それぞれ渡される【NGKI2605】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_OVRTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラの残りプロセッサ時間に指定できる最大値［NGKI2595］</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_OVRHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラ機能がサポートされている［NGKI2599］</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>マルチプロセッサ対応カーネルでは，オーバランハンドラが異なるプロセッサで同時に実行される可能性があるので，注意が必要である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，オーバランハンドラをサポートしない［ASPS0003］．ただし，オーバランハンドラ機能拡張パッケージを用いると，オーバランハンドラ機能を追加することができる［ASPS0004］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，オーバランハンドラをサポートしない［FMPS0002］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，オーバランハンドラをサポートしない［HRPS0013］．ただし，オーバランハンドラ機能拡張パッケージを用いると，オーバランハンドラ機能を追加することができる［HRPS0014］．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，オーバランハンドラをサポートしない［HRMPS0003］．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>残りプロセッサ時間の単位は，μITRON4.0仕様では実装定義としていたが，この仕様ではマイクロ秒と規定した．</p>
</div>
<div class="paragraph">
<p>TMAX_OVRTIMは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>残りプロセッサ時間のデータ型を，OVRIM型からPRCTIM型に変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_OVR</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>オーバランハンドラの定義〔S〕【NGKI2608】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_OVR({ ATR ovratr, OVRHDR ovrhdr })</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊オーバランハンドラの定義情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovratr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラ属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OVRHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovrhdr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・ovratrが無効【NGKI2612】<br>
・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI2621】<br>
・クラスの囲みの中に記述されている〔M〕【NGKI2625】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・ovrhdrがプログラムの先頭番地として正しくない【NGKI2613】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・オーバランハンドラが定義済み【NGKI2619】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したオーバランハンドラの定義情報に従って，オーバランハンドラを定義する【NGKI2616】．</p>
</div>
<div class="paragraph">
<p>ovratrは整数定数式パラメータ，ovrhdrは一般定数式パラメータである【NGKI2618】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>ovrhdrのデータ型をOVRHDRに変更した．オーバランハンドラを定義するサービスコール（def_ovr）を廃止した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>オーバランハンドラを定義するサービスコール（def_ovr）を廃止した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sta_ovr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>オーバランハンドラの動作開始〔TI〕【NGKI3546】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sta_ovr(ID tskid, PRCTIM ovrtim)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRCTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovrtim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクの残りプロセッサ時間</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2634】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI2635】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI2636】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI2637】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・ovrtimが0，またはTMAX_OVRTIMより大きい【NGKI2643】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・オーバランハンドラが定義されていない【NGKI2638】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）に対して，オーバランハンドラの動作を開始する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクに対するオーバランハンドラの動作状態は，動作している状態となり，残りプロセッサ時間は，ovrtimに指定した時間に設定される【NGKI2639】．対象タスクに対してオーバランハンドラが動作している状態であれば，残りプロセッサ時間の設定のみが行われる【NGKI2640】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられている場合に，オーバランハンドラの動作を開始できるかは，ターゲット定義である【NGKI5145】．ターゲット定義で開始できない場合には，E_OBJエラーとなる【NGKI5146】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストから呼び出した場合，tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI2641】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ovrtimのデータ型をPRCTIMに変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>stp_ovr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>オーバランハンドラの動作停止〔TI〕【NGKI3547】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = stp_ovr(ID tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2648】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI2649】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI2650】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する通常操作2が許可されていない〔P〕【NGKI2651】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・オーバランハンドラが定義されていない【NGKI2652】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）に対して，オーバランハンドラの動作を停止する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクに対するオーバランハンドラの動作状態は，動作していない状態となる【NGKI2653】．対象タスクに対してオーバランハンドラが動作していない状態であれば，何も行われずに正常終了する【NGKI2654】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられている場合に，オーバランハンドラの動作を停止できるかは，ターゲット定義である【NGKI5147】．ターゲット定義で停止できない場合には，E_OBJエラーとなる【NGKI5148】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストから呼び出した場合，tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI2655】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_ovr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>オーバランハンドラの状態参照〔T〕【NGKI2656】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_ovr(ID tskid, T_ROVR *pk_rovr)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象タスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_ROVR *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊タスクの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovrstat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラの動作状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRCTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">leftotm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">残りプロセッサ時間</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2657】<br>
・CPUロック状態からの呼出し【NGKI2658】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI2659】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象タスクが未登録〔D〕【NGKI2660】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象タスクに対する参照操作が許可されていない〔P〕【NGKI2661】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rovrが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2662】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・オーバランハンドラが定義されていない【NGKI2663】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスク（対象タスク）に対するオーバランハンドラの現在状態を参照する．参照した現在状態は，pk_rovrで指定したメモリ領域に返される【NGKI2664】．</p>
</div>
<div class="paragraph">
<p>ovrstatには，対象タスクに対するオーバランハンドラの動作状態を表す次のいずれかの値が返される【NGKI2665】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOVR_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラが動作していない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOVR_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラが動作している状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>対象タスクに対してオーバランハンドラが動作している状態の場合には，leftotmに，オーバランハンドラが起動されるまでの残りプロセッサ時間が返される【NGKI2666】．オーバランハンドラが起動される直前には，leftotmに0が返される可能性がある【NGKI2667】．オーバランハンドラが動作していない状態の場合には，leftotmの値は保証されない【NGKI2668】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられている場合に，leftotmを参照できるかは，ターゲット定義である【NGKI5139】．ターゲット定義で参照できない場合には，leftotmの値は保証されない【NGKI5140】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる【NGKI2669】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ref_ovrはデバッグ時向けの機能であり，その他の目的に使用することは推奨しない．これは，ref_ovrを呼び出し，対象タスクに対するオーバランハンドラの現在状態を参照した直後に割込みが発生した場合，ref_ovrから戻ってきた時には対象タスクに対するオーバランハンドラの状態が変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>TOVR_STPとTOVR_STAを値を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_4_7_システム状態管理機能"><a class="anchor" href="#_4_7_システム状態管理機能"></a><a class="link" href="#_4_7_システム状態管理機能">4.7 システム状態管理機能</a></h3>
<div class="paragraph">
<p>システム状態管理機能は，特定のオブジェクトに関連しないシステムの状態を変更／参照するための機能である．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_SYS</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム状態のアクセス許可ベクタの設定〔SP〕【NGKI2670】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_sys</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム状態のアクセス許可ベクタの設定〔TPD〕【NGKI2671】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_SYS({ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_sys(const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2672】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2673】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・カーネルドメインの囲みの中に記述されていない〔S〕【NGKI2674】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・カーネルドメイン以外からの呼出し〔s〕【NGKI2676】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・システム状態のアクセス許可ベクタが設定済み〔S〕【NGKI2677】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>システム状態のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI2678】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，acptn1〜acptn4は整数定数式パラメータである【NGKI2679】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，SAC_SYSをクラスの囲みの中に記述しても，クラスの情報は使用されない．SAC_SYSをクラスの囲みの中に記述した場合，コンフィギュレータは警告メッセージを出力する【NGKI2675】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>rot_rdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タスクの優先順位の回転〔TI〕【NGKI3548】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = rot_rdq(PRI tskpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 8.8888%;">
<col style="width: 6.6666%;">
<col style="width: 4.4444%;">
<col style="width: 13.3333%;">
<col style="width: 66.6669%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">　</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">回転対象の優先度（対象優先度）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2684】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI2685】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・呼び出した処理単位が属する保護ドメインに対する通常操作1が許可されていない〔P〕【NGKI3766】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskpriで指定した優先度（対象優先度）を持つ実行できる状態のタスクの中で，優先順位が最も高いタスクを，同じ優先度のタスクの中で優先順位を最も低くする【NGKI2687】．対象優先度を持つ実行できる状態のタスクが無いか1つのみの場合には，何も行わずに正常終了する【NGKI2688】．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサのいずれかまたは両方に対応するカーネルでは，呼び出した処理単位と同じスケジューリング単位に属するタスクのみを操作対象とする【NGKI5125】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストから呼び出した場合，tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベース優先度が対象優先度となる【NGKI2689】．</p>
</div>
<div class="paragraph">
<p>対象優先度を持つ実行できる状態のタスクの中で，最も優先順位が高いタスクが制約タスクの場合には，E_NOSPTエラーとなる【NGKI2690】．</p>
</div>
<div class="paragraph">
<p>サブ優先度機能をサポートするカーネルで，対象優先度がサブ優先度を使用すると設定されている場合には，E_ILUSEエラーとなる【NGKI3663】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，rot_rdqをサポートしない【SSPS0131】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>mrot_rdq</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>対象指定でのタスクの優先順位の回転〔TIP｜TIM〕【NGKI3549】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = mrot_rdq(ID schedno, PRI tskpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">schedno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先順位の回転対象とするスケジューリング単位番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">回転対象の優先度（対象優先度）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2695】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・schednoが有効範囲外【NGKI2696】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI2697】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・schednoで指定した保護ドメインに対する通常操作1が許可されていない〔P〕【NGKI3778】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>schednoで指定したスケジューリング単位に属し，tskpriで指定した優先度（対象優先度）を持つ実行できる状態のタスクの中で，優先順位が最も高いタスクを，同じ優先度のタスクの中で優先順位を最も低くする【NGKI2699】．対象優先度を持つ実行できる状態のタスクが無いか1つのみの場合には，何も行わずに正常終了する【NGKI2700】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストから呼び出した場合，tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベース優先度が対象優先度となる【NGKI2701】．</p>
</div>
<div class="paragraph">
<p>schednoで指定したスケジューリング単位に属し，対象優先度を持つ実行できる状態のタスクの中で，最も優先順位が高いタスクが制約タスクの場合には，E_NOSPTエラーとなる【NGKI2702】．</p>
</div>
<div class="paragraph">
<p>サブ優先度機能をサポートするカーネルで，対象優先度がサブ優先度を使用すると設定されている場合には，E_ILUSEエラーとなる【NGKI3664】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>mrot_rdqは，TOPPERS新世代カーネル統合仕様ではマルチプロセッサ対応カーネルのみでサポートされるサービスコールであったが，この仕様では保護機能対応カーネルでもサポートされるものとした．それに伴い，優先度の回転対象を指定するパラメータを，プロセッサID（prcid）からスケジューリング単位番号（schedno）に変更した．また，パラメータの順序を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_tid</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>実行状態のタスクIDの参照〔TI〕【NGKI3550】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_tid(ID *p_tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクIDを入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクID</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2707】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_tskidが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2708】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>実行状態のタスク（タスクコンテキストから呼び出した場合には自タスク）のID番号を参照する．参照したタスクIDは，p_tskidが指すメモリ領域に返される【NGKI2709】．</p>
</div>
<div class="paragraph">
<p>get_tidを非タスクコンテキストから呼び出した場合で，実行状態のタスクがない場合には，TSK_NONE（＝0）が返される【NGKI2710】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，サービスコールを呼び出した処理単位を実行しているプロセッサにおいて実行状態のタスクのID番号を参照する【NGKI2711】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_did</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>実行状態のタスクが属する保護ドメインIDの参照〔TIP〕【NGKI3553】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_did(ID *p_domid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_domid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保護ドメインIDを入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保護ドメインID</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2714】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_domidが指すメモリ領域への書込みアクセスが許可されていない【NGKI2715】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>実行状態のタスク（タスクコンテキストから呼び出した場合には自タスク）が属する保護ドメインのID番号を参照する．参照した保護ドメインIDは，p_domidが指すメモリ領域に返される【NGKI2716】．</p>
</div>
<div class="paragraph">
<p>get_didを非タスクコンテキストから呼び出した場合で，実行状態のタスクがない場合には，TDOM_NONE（＝-2）が返される【NGKI3554】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，サービスコールを呼び出した処理単位を実行しているプロセッサにおいて実行状態のタスクが属する保護ドメインのID番号を参照する【NGKI2717】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>get_didは，非タスクコンテキストからも呼び出せるものとした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_pid</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付けプロセッサのID番号の参照〔TIM〕【NGKI3551】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_pid(ID *p_prcid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロセッサIDを入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロセッサID</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・CPUロック状態からの呼出し【NGKI2722】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_prcidが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI2723】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>サービスコールを呼び出した処理単位の割付けプロセッサのID番号を参照する．参照したプロセッサIDは，p_prcidが指すメモリ領域に返される【NGKI2724】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>タスクは，get_pidを用いて，自タスクの割付けプロセッサを正しく参照できるとは限らない．これは，get_pidを呼び出し，自タスクの割付けプロセッサのID番号を参照した直後に割込みが発生した場合，get_pidから戻ってきた時には割付けプロセッサが変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_lod</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>実行できるタスクの数の参照〔T〕【NGKI3623】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_lod(PRI tskpri, uint_t *p_load)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象の優先度（対象優先度）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの数を入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3624】<br>
・CPUロック状態からの呼出し【NGKI3625】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI3626】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_loadが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3627】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・自タスクが属する保護ドメインに対する参照操作が許可されていない〔P〕【NGKI3767】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskpriで指定した優先度（対象優先度）を持つ実行できる状態のタスクの数を参照する．参照したタスクの数は，p_loadが指すメモリ領域に返される【NGKI3629】．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサのいずれかまたは両方に対応するカーネルでは，自タスクと同じスケジューリング単位に属するタスクのみを操作対象とする【NGKI5126】．</p>
</div>
<div class="paragraph">
<p>tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベース優先度が対象優先度となる【NGKI3631】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，get_lodをサポートしない【SSPS0157】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>mget_lod</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>対象指定での実行できるタスクの数の参照〔TP｜TM〕【NGKI3632】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = mget_lod(ID schedno, PRI tskpri, uint_t *p_load)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">schedno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象とするスケジューリング単位番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象の優先度（対象優先度）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの数を入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3633】<br>
・CPUロック状態からの呼出し【NGKI3634】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・schednoが有効範囲外【NGKI3635】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI3636】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_loadが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3637】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・schednoで指定した保護ドメインに対する参照操作が許可されていない〔P〕【NGKI3881】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>schednoで指定したスケジューリング単位に属し，tskpriで指定した優先度（対象優先度）を持つ実行できる状態のタスクの数を参照する．参照したタスクの数は，p_loadが指すメモリ領域に返される【NGKI3639】．</p>
</div>
<div class="paragraph">
<p>tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベース優先度が対象優先度となる【NGKI3640】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_nth</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>指定した優先順位のタスクIDの参照〔T〕【NGKI3641】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_nth(PRI tskpri, uint_t nth, ID *p_tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象の優先度（対象優先度）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象の優先順位</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクIDを入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクID</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3642】<br>
・CPUロック状態からの呼出し【NGKI3643】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI3644】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_tskidが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3645】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・自タスクが属する保護ドメインに対する参照操作が許可されていない〔P〕【NGKI3768】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskpriで指定した優先度（対象優先度）を持つ実行できる状態のタスクの中で，nthで指定した優先順位のタスクのID番号を参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度を持つ実行できる状態のタスクの中で，優先順位が(nth＋1)番目に高いタスクのID番号が，p_tskidが指すメモリ領域に返される【NGKI3647】．優先順位が(nth＋1)番目に高いタスクがない，言い換えると，対象優先度を持つ実行できる状態のタスクの数がnth以下の場合には，TSK_NONE（＝0）が返される【NGKI3648】．</p>
</div>
<div class="paragraph">
<p>保護機能とマルチプロセッサのいずれかまたは両方に対応するカーネルでは，自タスクと同じスケジューリング単位に属するタスクのみを操作対象とする【NGKI5127】．</p>
</div>
<div class="paragraph">
<p>tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベース優先度が対象優先度となる【NGKI3650】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，get_nthをサポートしない【SSPS0159】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>mget_nth</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>対象指定での指定した優先順位のタスクIDの参照〔TP｜TM〕【NGKI3651】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = mget_nth(ID schedno, PRI tskpri, uint_t nth, ID *p_tskid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">schedno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象とするスケジューリング単位番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象の優先度（対象優先度）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照対象の優先順位</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのIDを入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクID</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3652】<br>
・CPUロック状態からの呼出し【NGKI3653】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・schednoが有効範囲外【NGKI3654】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI3655】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_tskidが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3656】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・schednoで指定した保護ドメインに対する通常操作1が許可されていない〔P〕【NGKI3884】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>schednoで指定したスケジューリング単位に属し，tskpriで指定した優先度（対象優先度）を持つ実行できる状態のタスクの中で，nthで指定した優先順位のタスクのID番号を参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>schednoで指定したスケジューリング単位に属し，対象優先度を持つ実行できる状態のタスクの中で，優先順位が(nth＋1)番目に高いタスクのID番号が，p_tskidが指すメモリ領域に返される【NGKI3658】．優先順位が(nth＋1)番目に高いタスクがない，言い換えると，対象優先度を持つ実行できる状態のタスクの数がnth以下の場合には，TSK_NONE（＝0）が返される【NGKI3659】．</p>
</div>
<div class="paragraph">
<p>tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベース優先度が対象優先度となる【NGKI3660】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ENA_SPR</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>サブ優先度を使用するタスク優先度の設定〔S〕【NGKI3675】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ENA_SPR(tskpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サブ優先度を使うタスク優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・ドメインの囲みの中に記述されている〔P〕【NGKI3676】<br>
・クラスの囲みの中に記述されている〔M〕【NGKI3677】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・tskpriが有効範囲外【NGKI3678】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskpriで指定したタスク優先度を，サブ優先度を使用して優先順位を決定するように設定する【NGKI3679】．</p>
</div>
<div class="paragraph">
<p>tskpriは整数定数式パラメータである【NGKI3680】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ENA_SPRをサポートしない【ASPS0233】．ただし，サブ優先度機能拡張パッケージでは，ENA_SPRをサポートする【ASPS0234】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ENA_SPRをサポートする【FMPS0170】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ENA_SPRをサポートしない【HRPS0225】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ENA_SPRをサポートしない【HRMPS0117】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ENA_SPRをサポートしない【SSPS0162】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様およびTOPPERS新世代カーネル統合仕様に定義されていない静的APIである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>loc_cpu</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>CPUロック状態への遷移〔TI〕【NGKI3538】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = loc_cpu()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作2が許可されていない〔P〕【NGKI2729】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>CPUロックフラグをセットし，CPUロック状態へ遷移する【NGKI2730】．CPUロック状態で呼び出した場合には，何も行われずに正常終了する【NGKI2731】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>unl_cpu</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>CPUロック状態の解除〔TI〕【NGKI3539】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = unl_cpu()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作2が許可されていない〔P〕【NGKI2736】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>CPUロックフラグをクリアし，CPUロック解除状態へ遷移する【NGKI2737】．CPUロック解除状態で呼び出した場合には，何も行われずに正常終了する【NGKI2738】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，unl_cpuを呼び出したプロセッサによって取得されている状態となっているスピンロックがある場合には，unl_cpuによってCPUロック解除状態に遷移しない（何も行われずに正常終了する）【NGKI2739】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応カーネルでは，CPUロック解除状態へ遷移した結果，ディスパッチ保留状態が解除され，ディスパッチが起こる可能性がある．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>dis_dsp</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ディスパッチの禁止〔T〕【NGKI2740】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = dis_dsp()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2741】<br>
・CPUロック状態からの呼出し【NGKI2742】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作1が許可されていない〔P〕【NGKI2743】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>ディスパッチ禁止フラグをセットし，ディスパッチ禁止状態へ遷移する【NGKI2744】．ディスパッチ禁止状態で呼び出した場合には，何も行われずに正常終了する【NGKI2745】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>呼出し権を制御するためのアクセスの種別を，システム状態に対する通常操作2に変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ena_dsp</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ディスパッチの許可〔T〕【NGKI2746】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ena_dsp()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2747】<br>
・CPUロック状態からの呼出し【NGKI2748】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作1が許可されていない〔P〕【NGKI2749】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>ディスパッチ禁止フラグをクリアし，ディスパッチ許可状態へ遷移する【NGKI2750】．ディスパッチ許可状態で呼び出した場合には，何も行われずに正常終了する【NGKI2751】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>ディスパッチ許可状態へ遷移した結果，ディスパッチ保留状態が解除され，ディスパッチが起こる可能性がある．また，自タスクのタスク終了処理要求フラグがセットされていた場合には，自タスクが終了する可能性がある．この場合，ena_dspからはリターンしない．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，ディスパッチ許可状態へ遷移した結果，システム周期の切換えとタイムウィンドウの切換えの保留が解除され，システム周期の切換えとタイムウィンドウの切換えが起こる可能性がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>呼出し権を制御するためのアクセスの種別を，システム状態に対する通常操作2に変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sns_ctx</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>コンテキストの参照〔TI〕【NGKI2752】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = sns_ctx()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキスト</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>実行中のコンテキストを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_ctxを非タスクコンテキストから呼び出した場合にはtrue，タスクコンテキストから呼び出した場合にはfalseが返る【NGKI2753】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sns_loc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>CPUロック状態の参照〔TI〕【NGKI2754】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = sns_loc()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPUロックフラグ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>CPUロックフラグを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_locをCPUロック状態で呼び出した場合にはtrue，CPUロック解除状態で呼び出した場合にはfalseが返る【NGKI2755】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sns_dsp</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ディスパッチ禁止状態の参照〔TI〕【NGKI2756】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = sns_dsp()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディスパッチ禁止フラグ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>ディスパッチ禁止フラグを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_dspをディスパッチ禁止状態で呼び出した場合にはtrue，ディスパッチ許可状態で呼び出した場合にはfalseが返る【NGKI2757】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sns_dpn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>ディスパッチ保留状態の参照〔TI〕【NGKI2758】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = sns_dpn()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディスパッチ保留状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>ディスパッチ保留状態であるか否かを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_dpnをディスパッチ保留状態で呼び出した場合にはtrue，ディスパッチ保留状態でない状態で呼び出した場合にはfalseが返る【NGKI2759】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sns_ker</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>カーネル非動作状態の参照〔TI〕【NGKI2760】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = sns_ker()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネル非動作状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>カーネルが動作中であるか否かを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_kerをカーネルの初期化完了前（初期化ルーチン実行中を含む）または終了処理開始後（終了処理ルーチン実行中を含む）に呼び出した場合にはtrue，カーネルの動作中に呼び出した場合にはfalseが返る【NGKI2761】．</p>
</div>
<div class="paragraph">
<div class="title">【使用方法】</div>
<p>sns_kerは，カーネルが動作している時とそうでない時で，処理内容を変えたい場合に使用する．sns_kerがtrueを返した場合，他のサービスコールを呼び出すことはできない．sns_kerがtrueを返す時に他のサービスコールを呼び出した場合の動作は保証されない．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>どちらの条件でtrueが返るか間違いやすいので注意すること．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ext_ker</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>カーネルの終了〔TI〕【NGKI2762】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ext_ker()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_SYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムエラー<br>
・カーネルの誤動作【NGKI2763】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・カーネルドメイン以外からの呼出し〔P〕【NGKI2764】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>カーネルを終了する．具体的な振舞いについては，「<a href="#_2_9_2_システム終了手順">2.9.2 システム終了手順</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>ext_kerが正常に処理された場合，ext_kerからはリターンしない【NGKI2765】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_sys</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システムの状態参照〔T〕</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_sys(T_RSYS *pk_rsys)</code></pre>
</div>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ref_sysをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ref_sysをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ref_sysをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ref_sysをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ref_sysをサポートしない．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_8_メモリオブジェクト管理機能"><a class="anchor" href="#_4_8_メモリオブジェクト管理機能"></a><a class="link" href="#_4_8_メモリオブジェクト管理機能">4.8 メモリオブジェクト管理機能</a></h3>
<div class="paragraph">
<p>メモリオブジェクト管理機能は，保護機能対応カーネルでのみサポートされる機能である．保護機能対応でないカーネルでは，メモリオブジェクト管理機能をサポートしない【NGKI3888】．</p>
</div>
<div class="paragraph">
<div class="title">〔メモリリージョン〕</div>
<p>メモリリージョンは，オブジェクトモジュールに含まれるセクションの配置対象となる同じ性質を持った連続したメモリ領域である．メモリリージョンは，メモリリージョン名によって識別する【NGKI2766】．</p>
</div>
<div class="paragraph">
<p>各メモリリージョンが持つ情報は次の通り【NGKI2767】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>先頭番地</p>
</li>
<li>
<p>サイズ</p>
</li>
<li>
<p>メモリリージョン属性</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メモリリージョンの先頭番地とサイズには，ターゲット定義の制約が課せられる場合がある【NGKI2768】．</p>
</div>
<div class="paragraph">
<p>メモリリージョン属性には，次の属性を指定することができる【NGKI3256】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOWRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">書込みアクセス禁止</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ターゲットによっては，ターゲット定義のメモリリージョン属性を指定できる場合がある【NGKI2771】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>メモリリージョンは，μITRON4.0/PX仕様にはない概念である．</p>
</div>
<div class="paragraph">
<div class="title">〔標準メモリリージョン〕</div>
<p>標準メモリリージョンとは，ATT_MODによって登録するオブジェクトモジュールに含まれる標準のセクションや，ATT_SECによって配置先のメモリリージョン名を指定せずに登録するセクション，オブジェクト生成に必要なメモリ領域でコンフィギュレータが確保するものなどが配置されるメモリリージョンである．</p>
</div>
<div class="paragraph">
<p>標準メモリリージョンは，標準のセクションの中で書込みアクセスを行わないセクションが配置される標準ROMリージョン，書込みアクセスを行うセクションが配置される標準RAMリージョン，書込みアクセスを行わないショートデータセクションが配置される標準ショートROMリージョン，書込みアクセスを行うショートデータセクションが配置される標準ショートRAMリージョンで構成される．</p>
</div>
<div class="paragraph">
<p>特定の保護ドメインに属さないセクションが配置される標準メモリリージョンを，保護ドメイン共通の標準メモリリージョンと呼ぶ．保護ドメイン共通の標準メモリリージョンに加えて，各保護ドメイン向けの標準メモリリージョンを定義することができる【NGKI3891】．</p>
</div>
<div class="paragraph">
<p>自動メモリ配置の場合，保護ドメイン共通の標準メモリリージョンは，必ず定義しなければならない．定義しない場合には，コンフィギュレータがエラーを報告する【NGKI3259】．ある保護ドメイン向けの標準メモリリージョンが定義されていない場合には，それに代えて，保護ドメイン共通の標準メモリリージョンが使われる【NGKI3894】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，標準メモリリージョンの扱いは，以下のように拡張される．</p>
</div>
<div class="paragraph">
<p>特定のクラスに属さないセクションが配置される標準メモリリージョンを，クラス共通の標準メモリリージョンと呼ぶ．クラス共通の標準メモリリージョンに加えて，各クラス向けの標準メモリリージョンを定義することができる【NGKI3257】．すなわち，［NGKI3891］との組み合わせにより，次の4種類の標準メモリリージョンを定義することができる．</p>
</div>
<div class="paragraph">
<p>(A) 保護ドメイン共通・クラス共通の標準メモリリージョン<br>
(B) ある保護ドメイン向け・クラス共通の標準メモリリージョン<br>
(C) 保護ドメイン共通・あるクラス向けの標準メモリリージョン<br>
(D) ある保護ドメイン向け・あるクラス向けの標準メモリリージョン</p>
</div>
<div class="paragraph">
<p>自動メモリ配置の場合，(A)は必ず定義しなければならない．定義しない場合には，コンフィギュレータがエラーを報告する【NGKI5098】．(B)が定義されていない場合には，それに代えて(A)が使われる【NGKI5099】．(C)が定義されていない場合には，それに代えて(A)が使われる【NGKI2854】．(D)が定義されていない場合には，それに代えて，(C)が定義されていれば(C)が，(C)が定義されておらず(B)が定義されていれば(B)が，(C)も(B)も定義されていない場合は(A)が使われる【NGKI3895】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>標準メモリリージョンは，μITRON4.0/PX仕様にはない概念である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>標準メモリリージョンの構成要素に，標準ショートROMリージョンと標準ショートRAMリージョンを追加した．また，各保護ドメイン向けの標準メモリリージョンを定義できることにした．</p>
</div>
<div class="paragraph">
<div class="title">〔メモリオブジェクト〕</div>
<p>メモリオブジェクトは，保護機能対応カーネルにおいてアクセス保護の対象とする連続したメモリ領域である．メモリオブジェクトは，その先頭番地によって識別する【NGKI2772】．</p>
</div>
<div class="paragraph">
<p>各メモリオブジェクトが持つ情報は次の通り【NGKI2773】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>先頭番地</p>
</li>
<li>
<p>サイズ</p>
</li>
<li>
<p>メモリオブジェクト属性</p>
</li>
<li>
<p>アクセス許可ベクタ</p>
</li>
<li>
<p>属する保護ドメイン</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メモリオブジェクトの先頭番地とサイズには，ターゲット定義の制約が課せられる【NGKI2774】．</p>
</div>
<div class="paragraph">
<div class="title">〔メモリオブジェクト属性〕</div>
<p>メモリオブジェクト属性には，次の属性を指定することができる【NGKI2775】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOWRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">書込みアクセス禁止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOREAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">読出しアクセス禁止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_EXEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行アクセス許可</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_MEMINI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x08U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリの初期化を行う</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_MEMZERO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリのクリアを行う</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_SDATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ショートデータ領域に配置</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_UNCACHE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キャッシュ禁止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_IODEV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺デバイスの領域</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>メモリオブジェクトに対して書込みアクセスできるのは，メモリオブジェクト属性に書込みアクセス禁止（TA_NOWRITE属性）が指定されておらず，アクセス許可ベクタにより書込みアクセスが許可されている場合である【NGKI2776】．また，読出しアクセスできるのは，メモリオブジェクト属性に読出しアクセス禁止（TA_NOREAD属性）が指定されておらず，アクセス許可ベクタにより読出し・実行アクセスが許可されている場合である【NGKI2777】．実行アクセスできるのは，メモリオブジェクト属性に実行アクセス許可（TA_EXEC属性）が指定されており，アクセス許可ベクタにより読出し・実行アクセスが許可されている場合である【NGKI2778】．</p>
</div>
<div class="paragraph">
<p>ただし，ターゲットハードウェアの制約によってこれらの属性を実現できない場合には，次のように扱われる．書込みアクセス禁止が実現できない場合には，TA_NOWRITEを指定しても無視される【NGKI2779】．また，読出しアクセス禁止が実現できない場合には，TA_NOREADを指定しても無視される【NGKI2780】．実行アクセス禁止が実現できない場合には，TA_EXECを指定しなくても実行アクセス許可となり，TA_EXECは無視される【NGKI2781】．どのような場合にどの属性の指定が無視されるかは，ターゲット定義である【NGKI2782】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクト属性にTA_NOWRITE属性とTA_NOREAD属性が指定されており，TA_EXEC属性が指定されていない場合，そのメモリ領域は，メモリオブジェクトとしてカーネルに登録されない【NGKI3962】．</p>
</div>
<div class="paragraph">
<p>TA_MEMINI属性は，システム初期化時に指定された値に初期化するメモリオブジェクトであることを，TA_MEMZERO属性は，システム初期化時にクリア（言い換えると，0に初期化）するメモリオブジェクトであることを示す【NGKI5054】．いずれの属性も指定しない場合，そのメモリオブジェクトは，システム初期化時に初期化を行わない【NGKI5055】．</p>
</div>
<div class="paragraph">
<p>TA_MEMINI属性のメモリオブジェクトの初期化に用いる初期化データは，保護ドメイン共通の標準ROMリージョン（マルチプロセッサ対応カーネルでは，クラス共通で保護ドメイン共通の標準ROMリージョン．以下同じ）に配置され，メモリオブジェクトとしては登録されない【NGKI2787】．ただし，保護ドメイン共通の標準ROMリージョンがTA_NOWRITE属性でない場合には，初期化データは配置されず，メモリオブジェクトの初期化は行われない【NGKI3984】．</p>
</div>
<div class="paragraph">
<p>また，TA_NOWRITE属性のメモリオブジェクトが，TA_NOWRITE属性でないメモリリージョンに登録された場合，そのメモリオブジェクトは，TA_MEMINI属性を設定した場合と同様に扱われる【NGKI3985】．</p>
</div>
<div class="paragraph">
<p>TA_SDATA属性は，メモリオブジェクトをショートデータ領域に配置することを示す【NGKI2788】．具体的な扱いはターゲット定義であるが，ショートデータ領域がサポートされていないターゲットでは，この属性は無視される【NGKI2789】．</p>
</div>
<div class="paragraph">
<p>TA_UNCACHE属性は，メモリオブジェクトをキャッシュ禁止に設定することを，TA_IODEV属性は，メモリオブジェクトを周辺デバイスの領域として扱うことを示す【NGKI2791】．具体的な扱いはターゲット定義であるが，これらの属性を指定しても意味がないターゲット（例えば，キャッシュを持たないターゲットプロセッサでのTA_UNCACHE）では，これらの属性は無視される【NGKI2792】．逆に，キャッシュ禁止にできないメモリオブジェクトに対してTA_UNCACHEを指定した場合や，周辺デバイスの領域として扱うことができないメモリオブジェクトに対してTA_IODEVを指定した場合には，E_RSATRエラーとなる【NGKI2793】．</p>
</div>
<div class="paragraph">
<p>ターゲットによっては，ターゲット定義のメモリオブジェクト属性を指定できる場合がある【NGKI2794】．ターゲット定義のメモリオブジェクト属性として，次の属性を予約している【NGKI2795】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_WTHROUGH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライトスルーキャッシュを用いる</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>メモリオブジェクト属性を全面的に見直した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ATT_SECにより，メモリオブジェクト属性にTA_NOWRITE属性とTA_NOREAD属性を指定し，TA_EXEC属性を指定せずにセクションを登録することで，メモリオブジェクトとして登録されないセクションを配置できるようにした．これにより，セクションの配置のみを行う静的API（LNK_SEC）は廃止した．</p>
</div>
<div class="paragraph">
<p>初期化データの配置先のメモリリージョンがTA_NOWRITE属性でない場合には，メモリオブジェクトの初期化は行わないこととした．また，TA_NOWRITE属性のメモリオブジェクトが，TA_NOWRITE属性でないメモリリージョンに登録された場合に，メモリオブジェクトの初期化を行うこととした．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>TA_NOWRITE属性のメモリオブジェクトが，TA_NOWRITE属性でないメモリリージョンに登録された場合に，メモリオブジェクトの初期化を行うこととしたのは，リードオンリーショートデータセクションを標準RAMリージョンに配置した時に，データが初期化されるようにするためである．</p>
</div>
<div class="paragraph">
<p>TA_IODEV属性を導入したのは，ターゲットプロセッサによっては，周辺デバイスの領域として扱うためには，キャッシュ禁止に加えて，メモリのアクセス順序を変更しないことを指定しなければならないためである．メモリのアクセス順序を変更しないことを指定するメモリオブジェクト属性を，ターゲット定義で用意してもよいが，それを使うとアプリケーションのポータビリティが下がるため，TA_IODEV属性を用意することにした．</p>
</div>
<div class="paragraph">
<div class="title">〔標準のメモリオブジェクト属性〕</div>
<p>標準のセクションに対して，標準的に設定すべきメモリオブジェクト属性の組み合わせ（これを，標準のメモリオブジェクト属性と呼ぶ）が，以下のシンボルに定義されている【NGKI3963】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TEXTSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テキストセクション（textセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_RODATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リードオンリーデータセクション（rodataセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期化データセクション（dataセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_BSSSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ゼロ初期化データセクション（bssセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOINITSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非初期化データセクションに設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_LOSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置のみを行うセクションに設定する標準的なメモリオブジェクト属性</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらの標準のメモリオブジェクト属性は，ターゲット定義で別に規定がない限りは，次の通りに定義される【NGKI3964】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TEXTSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NOWRITE|TA_EXEC)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_RODATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NOWRITE)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_MEMINI)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_BSSSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_MEMZERO)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOINITSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NULL)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_LOSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NOWRITE|TA_NOREAD)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>標準のメモリオブジェクト属性を定義するシンボルを導入した．</p>
</div>
<div class="paragraph">
<div class="title">〔メモリオブジェクトアクセス属性〕</div>
<p>メモリオブジェクト属性の中で，メモリのアクセスや保護の方法を指定するものを総称して，メモリオブジェクトアクセス属性と呼ぶ．</p>
</div>
<div class="paragraph">
<p>具体的には，ターゲット非依存のメモリオブジェクト属性の中で，メモリ領域の配置を指定するTA_SDATA属性，メモリの初期化方法を指定するTA_MEMINI属性とTA_MEMZERO属性以外のものが，メモリオブジェクトアクセス属性である【NGKI3986】．ターゲット定義のメモリオブジェクト属性が，メモリオブジェクトアクセス属性であるかは，ターゲット定義である【NGKI3987】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>メモリオブジェクトアクセス属性の概念を導入した．</p>
</div>
<div class="paragraph">
<div class="title">〔カーネル構成マクロ〕</div>
<p>メモリオブジェクト管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_ATT_MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATT_MODがサポートされている［NGKI2860］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_ATT_PMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATT_PMA／att_pmaがサポートされている［NGKI2904］</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ただし，att_pmaは，動的生成対応カーネルのみでサポートされるAPIであるため，サポートされているかを判定するには，TOPPERS_SUPPORT_DYNAMIC_CREとTOPPERS_SUPPORT_ATT_PMAの両方が定義されていることをチェックする必要がある【NGKI2798】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_REG</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メモリリージョンの登録〔SP〕【NGKI2799】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_REG(char *regname, { ATR regatr, void *base, size_t size })</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊メモリリージョンの登録情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリリージョン名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリリージョン属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリリージョンの先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリリージョンのサイズ（バイト数）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・regatrが無効【NGKI2800】<br>
・保護ドメインの囲みの中に記述されている【NGKI2814】<br>
・クラスの囲みの中に記述されている〔M〕【NGKI3260】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・sizeが0【NGKI2816】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・登録済みのメモリリージョンの再登録【NGKI2801】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したメモリリージョンの登録情報に従って，指定したメモリリージョンを登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>baseとsizeで指定したメモリ領域が，メモリリージョンとして登録される【NGKI2802】．登録されるメモリリージョンには，regatrで指定したメモリリージョン属性が設定される【NGKI2803】．</p>
</div>
<div class="paragraph">
<p>regnameは文字列パラメータ，regatr，base，sizeは整数定数式パラメータである【NGKI2804】．</p>
</div>
<div class="paragraph">
<p>baseやsizeに，ターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI2815】．登録しようとしたメモリリージョンが，登録済みのメモリリージョンとメモリ領域が重なる場合には，E_OBJエラーとなる【NGKI2817】．</p>
</div>
<div class="paragraph">
<p>手動メモリ配置の場合には，メモリリージョンの情報は使用されない．ATT_REGを使用した場合，コンフィギュレータは警告メッセージを出力する【NGKI3909】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>baseは整数定数式パラメータである．すなわち，プログラムが配置される番地に依存せずに値の決まる整数定数式でなければならない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_SRG</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>標準メモリリージョンの定義〔SP〕【NGKI3261】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_SRG(char *stdrom, char *stdram, char *stdsrom, char *stdsram)</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ stdsrom，stdsramの記述は省略することができる【NGKI3991】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdrom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準ROMリージョンとするメモリリージョン名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdram</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準RAMリージョンとするメモリリージョン名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdsrom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準ショートROMリージョンとするメモリリージョン名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stdsram</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準ショートRAMリージョンとするメモリリージョン名</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5103】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・標準メモリリージョンが定義済み【NGKI3263】<br>
・stdrom，stdram，stdsrom，stdsramに指定したメモリリージョンが未登録【NGKI3264】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータに従って，標準メモリリージョンを定義する【NGKI3265】．</p>
</div>
<div class="paragraph">
<p>DEF_SRGを保護ドメインの囲みの外に記述すると，保護ドメイン共通の標準メモリリージョンを定義し，保護ドメインの囲みの中に記述すると，その保護ドメイン向けの標準メモリリージョンを定義する【NGKI3892】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，DEF_SRGをクラスの囲みの外に記述すると，クラス共通の標準メモリリージョンを定義し，クラスの囲みの中に記述すると，そのクラス向けの標準メモリリージョンを定義する【NGKI3266】．</p>
</div>
<div class="paragraph">
<p>stdsromの記述を省略した場合，標準ショートROMリージョンは標準ROMリージョンと同じメモリリージョンに定義される【NGKI3988】．また，stdsramの記述を省略した場合，標準ショートRAMリージョンは標準RAMリージョンと同じメモリリージョンに定義される【NGKI3989】．</p>
</div>
<div class="paragraph">
<p>stdrom，stdram，stdsrom，stdsramは文字列パラメータである【NGKI5149】．</p>
</div>
<div class="paragraph">
<p>標準RAMリージョンと標準ショートRAMリージョンは，TA_NOWRITE属性でないメモリリージョンでなければならない．標準RAMリージョンまたは標準ショートRAMリージョンとして指定したメモリリージョンが，TA_NOWRITE属性である場合には，E_OBJエラーとなる【NGKI3270】．</p>
</div>
<div class="paragraph">
<p>手動メモリ配置の場合には，メモリリージョンの情報は使用されない．DEF_SRGを使用した場合，コンフィギュレータは警告メッセージを出力する【NGKI3910】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>標準ショートROMリージョン名と標準ショートRAMリージョン名の2つのパラメータを追加した．</p>
</div>
<div class="paragraph">
<p>標準ROMリージョンはTA_NOWRITE属性でなければならないという制約を外した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_SEC</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>セクションの登録〔SP〕【NGKI2818】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_SEC(char *secname, { ATR mematr, char *regname },
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ regname，アクセス許可ベクタの記述は省略することができる【NGKI5151】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するセクション名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mematr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セクションを配置するメモリリージョン名</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）（省略可）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・mematrが無効【NGKI2820】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5104】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・登録済みのセクションの再登録【NGKI2821】<br>
・指定したメモリリージョンが未登録【NGKI2822】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した情報に従って，指定したセクションをカーネルに登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>各オブジェクトモジュールに含まれるセクション名で指定したセクションが，メモリリージョン名で指定したメモリリージョンに配置され，メモリオブジェクトとして登録される【NGKI2823】．登録されるメモリオブジェクトには，mematrで指定したメモリオブジェクト属性が設定される【NGKI2824】．ATT_SECにアクセス許可ベクタを記述した場合には，登録されるメモリオブジェクトのアクセス許可ベクタ（4つのアクセス許可パターンの組）が，acptn1〜acptn4で指定した値に設定される【NGKI2825】．</p>
</div>
<div class="paragraph">
<p>指定したメモリリージョンがTA_NOWRITE属性である場合には，mematrにTA_NOWRITEを指定しなければならない．指定しなかった場合には，E_RSATRエラーとなる【NGKI5058】．またこの場合，TA_MEMINIとTA_MEMZEROは指定することができない．これらを指定した場合には，E_RSATRエラーとなる【NGKI5059】．</p>
</div>
<div class="paragraph">
<p>mematrに，TA_MEMINIとTA_MEMZEROを同時に指定することはできない．指定した場合には，E_RSATRエラーとなる【NGKI2828】．</p>
</div>
<div class="paragraph">
<p>登録されるメモリオブジェクトと同じメモリリージョンに配置され，メモリオブジェクトアクセス属性とアクセス許可ベクタがすべて一致するメモリオブジェクトがある場合には，1つのメモリオブジェクトにまとめて登録される場合がある【NGKI2829】．</p>
</div>
<div class="paragraph">
<p>secnameとregnameは文字列パラメータ，mematr，acptn1〜acptn4は整数定数式パラメータである【NGKI2830】．</p>
</div>
<div class="paragraph">
<p>regnameの記述を省略した場合，mematrにTA_NOWRITEが指定されTA_SDATAが指定されない時は標準ROMリージョンに，TA_NOWRITEとTA_SDATAのいずれも指定されない時は標準RAMリージョンに，TA_NOWRITEが指定されずTA_SDATAが指定された時は標準ショートROMリージョンに，TA_NOWRITEとTA_SDATAの両方が指定された時は標準ショートRAMリージョンに配置される【NGKI5150】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_SECにより登録できるセクションが属する保護ドメインや登録できる数に制限がある場合がある【NGKI2831】．この制限に違反した場合には，E_NOSPTエラーとなる【NGKI2832】．</p>
</div>
<div class="paragraph">
<p>セクション名として，ターゲット定義の予約セクションを指定することはできない．指定した場合には，E_PARエラーとなる【NGKI5129】．</p>
</div>
<div class="paragraph">
<p>ATT_MODがサポートされているターゲットでは，セクション名として，標準のセクションを指定することはできない．指定した場合には，E_PARエラーとなる【NGKI2834】．</p>
</div>
<div class="paragraph">
<p>手動メモリ配置の場合には，ATT_SECはサポートされない．ATT_SECを使用すると，コンフィギュレータがE_NOSPTエラーを報告する【NGKI3911】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ATT_SECによってアクセス許可ベクタを設定できるようにし，そのための静的API（ATA_SEC）は廃止した．</p>
</div>
<div class="paragraph">
<p>regnameの記述を省略できることとした．</p>
</div>
<div class="paragraph">
<p>1つのメモリオブジェクトにまとめて登録する条件を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_MOD</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>オブジェクトモジュールの登録〔SP〕【NGKI2845】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_MOD(char *modname,
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ アクセス許可ベクタの記述は省略することができる【NGKI5152】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">modname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するオブジェクトモジュール名</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）（省略可）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5105】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・登録済みのオブジェクトモジュールの再登録【NGKI2848】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した情報に従って，指定したオブジェクトモジュールをカーネルに登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>オブジェクトモジュール名で指定したオブジェクトモジュールに含まれる標準のセクションの内，書込みアクセスを行わないセクションは標準ROMリージョンに，書込みアクセスを行うセクションは標準RAMリージョンに，書込みアクセスを行わないショートデータセクションは標準ショートROMリージョンに，書込みアクセスを行うショートデータセクションは標準ショートRAMリージョンに配置され，メモリオブジェクトとして登録される【NGKI2849】．</p>
</div>
<div class="paragraph">
<p>登録されるメモリオブジェクトには，セクション毎に標準のメモリオブジェクト属性が設定される【NGKI2850】．ATT_MODにアクセス許可ベクタを記述した場合には，登録されるメモリオブジェクトのアクセス許可ベクタ（4つのアクセス許可パターンの組）が，acptn1〜acptn4で指定した値に設定される【NGKI2851】．</p>
</div>
<div class="paragraph">
<p>ATT_MODを保護ドメインの囲みの外に記述すると，オブジェクトモジュールに含まれる標準のセクションは，保護ドメイン共通の標準メモリリージョンに配置され，保護ドメインの囲みの中に記述すると，その保護ドメイン向けの標準メモリリージョンに配置される【NGKI3893】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，ATT_MODをクラスの囲みの外に記述すると，オブジェクトモジュールに含まれる標準のセクションは，クラス共通の標準メモリリージョンに配置され，クラスの囲みの中に記述すると，そのクラス向けの標準メモリリージョンに配置される【NGKI2853】．</p>
</div>
<div class="paragraph">
<p>登録されるメモリオブジェクトと同じメモリリージョンに配置され，メモリオブジェクトアクセス属性とアクセス許可ベクタがすべて一致するメモリオブジェクトがある場合には，1つのメモリオブジェクトにまとめて登録される場合がある【NGKI2855】．</p>
</div>
<div class="paragraph">
<p>modnameは文字列パラメータ，acptn1〜acptn4は整数定数式パラメータである【NGKI2856】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_MODにより登録できるオブジェクトモジュールが属する保護ドメインや登録できる数に制限がある場合がある【NGKI2857】．この制限に違反した場合には，E_NOSPTエラーとなる【NGKI2858】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_MODがサポートされていない場合がある【NGKI2859】．また，手動メモリ配置の場合には，ATT_MODがサポートされない【NGKI3913】．ATT_MODがサポートされている場合には，TOPPERS_SUPPORT_ATT_MODがマクロ定義される【NGKI2860】．サポートされていない場合にATT_MODを使用すると，コンフィギュレータがE_NOSPTエラーを報告する【NGKI2861】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>ATT_MODでは，標準のセクション以外は配置・登録されない．標準のセクション以外のセクションを配置・登録するためには，ATT_SECを用いる必要がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>オブジェクトモジュールに含まれるセクションの配置場所を明確化した．</p>
</div>
<div class="paragraph">
<p>1つのメモリオブジェクトにまとめて登録できる条件を変更した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>標準ショートROMリージョンと標準ショートRAMリージョンの追加に対応した．</p>
</div>
<div class="paragraph">
<p>ATT_MODを保護ドメインの囲みの中に記述した場合，定義されていれば，その保護ドメインの標準メモリリージョンに配置するようにした．</p>
</div>
<div class="paragraph">
<p>ATT_MODによってアクセス許可ベクタを設定できるようにし，そのための静的API（ATA_MOD）は廃止した．</p>
</div>
<div class="paragraph">
<p>1つのメモリオブジェクトにまとめて登録できる条件を変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_MEM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メモリオブジェクトの登録〔SP〕【NGKI2862】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>att_mem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メモリオブジェクトの登録〔TPD〕【NGKI2864】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_MEM({ ATR accatr, void *base, size_t size },
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ アクセス許可ベクタの記述は省略することができる【NGKI5153】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = att_mem(const T_AMEM *pk_amem)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_AMEM *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_amem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトの登録情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊メモリオブジェクトの登録情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">accatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトアクセス属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリ領域の先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリ領域のサイズ（バイト数）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）（静的APIのみ，省略可）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2865】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2866】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・accatrが無効【NGKI2867】<br>
・属する保護ドメインの指定が有効範囲外〔s〕【NGKI2868】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI2869】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・sizeが0【NGKI2881】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する管理操作が許可されていない〔s〕【NGKI2870】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_amemが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI2871】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したメモリオブジェクトの登録情報に従って，メモリオブジェクトを登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>baseとsizeで指定したメモリ領域が，メモリオブジェクトとして登録される【NGKI2872】．登録されるメモリオブジェクトには，accatrで指定したメモリオブジェクトアクセス属性が設定される【NGKI2873】．ATT_MEMにアクセス許可ベクタを記述した場合には，登録されるメモリオブジェクトのアクセス許可ベクタ（4つのアクセス許可パターンの組）が，acptn1〜acptn4で指定した値に設定される【NGKI2874】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，accatr，size，acptn1〜acptn4は整数定数式パラメータ，baseは一般定数式パラメータである【NGKI2877】．ただし，手動メモリ配置の場合には，baseは整数定数式パラメータである【NGKI3914】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_MEM／att_memにより登録できるメモリオブジェクトが属する保護ドメインや登録できる数に制限がある場合がある【NGKI2878】．この制限に違反した場合には，E_NOSPTエラーとなる【NGKI2879】．</p>
</div>
<div class="paragraph">
<p>baseやsizeに，ターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI2880】．登録しようとしたメモリオブジェクトが，登録済みのメモリオブジェクトとメモリ領域が重なる場合には，E_OBJエラーとなる【NGKI2882】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>ATT_MEMは，メモリ空間にマッピングされたI/O領域にアクセスできるようにするために使用することを想定した静的APIである．メモリ領域に対しては，ATT_SECかATT_MODを使用することを推奨する．</p>
</div>
<div class="paragraph">
<p>ATT_MEM／att_memで登録するメモリオブジェクトのメモリ領域が，ATT_REGで登録したメモリリージョンと重なっても，直ちにエラーとはならない．ただし，メモリリージョン内に配置されたメモリオブジェクトと，ATT_MEM／att_memで登録するメモリオブジェクトのメモリ領域が重なった場合には，E_OBJエラーとなる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>アクセス許可ベクタを指定してメモリオブジェクトを登録する静的API（ATA_MEM）とサービスコール（ata_mem）は廃止した．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに関する属性を，メモリオブジェクト属性（mematr）から，メモリオブジェクトアクセス属性（accatr）に変更した．</p>
</div>
<div class="paragraph">
<p>baseやsizeがターゲット定義の制約に合致しない場合，μITRON4.0/PX仕様ではターゲット定義の制約に合致するようにメモり領域を広げることとしていたが，この仕様ではE_PARエラーとなることとした．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ATT_MEMによってアクセス許可ベクタを設定できるようにし，そのための静的API（ATA_MEM）は廃止した．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに関する属性を，メモリオブジェクト属性（mematr）から，メモリオブジェクトアクセス属性（accatr）に変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_PMA</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>物理メモリ領域の登録〔SP〕【NGKI2883】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>att_pma</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>物理メモリ領域の登録〔TPD〕【NGKI2885】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_PMA({ ATR accatr, void *base, size_t size, void *paddr  },
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ アクセス許可ベクタの記述は省略することができる【NGKI5154】．</p>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = att_pma(const T_APMA *pk_apma)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_APMA *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_apma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">物理メモリ領域の登録情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊物理メモリ領域の登録情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">accatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトアクセス属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリ領域の先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリ領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">paddr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録するメモリ領域の物理アドレス空間における先頭番地</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）（静的APIのみ，省略可）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2886】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2887】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・accatrが無効【NGKI3889】<br>
・属する保護ドメインの指定が有効範囲外〔s〕【NGKI2888】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI2889】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・sizeが0【NGKI2901】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する管理操作が許可されていない〔s〕【NGKI2890】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_apmaが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI2891】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した物理メモリ領域の登録情報に従って，メモリオブジェクトを登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>物理アドレス空間において先頭番地がpaddr，サイズがsizeのメモリ領域が，論理アドレス空間においてbaseで指定した番地からアクセスできるように，メモリオブジェクトとして登録される【NGKI2892】．登録されるメモリオブジェクトには，accatrで指定したメモリオブジェクトアクセス属性が設定される【NGKI2893】．ATT_PMAにアクセス許可ベクタを記述した場合には，登録されるメモリオブジェクトのアクセス許可ベクタ（4つのアクセス許可パターンの組）が，acptn1〜acptn4で指定した値に設定される【NGKI2894】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，accatr，size，paddr，acptn1〜acptn4は整数定数式パラメータ，baseは一般定数式パラメータである【NGKI2897】．ただし，手動メモリ配置の場合には，baseは整数定数式パラメータである【NGKI3961】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_PMA／att_pmaにより登録できるメモリオブジェクトが属する保護ドメインや登録できる数に制限がある場合がある【NGKI2898】．この制限に違反した場合には，E_NOSPTエラーとなる【NGKI2899】．</p>
</div>
<div class="paragraph">
<p>base，size，paddrに，ターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI2900】．登録しようとしたメモリオブジェクトが，登録済みのメモリオブジェクトと論理アドレス空間においてメモリ領域が重なる場合には，E_OBJエラーとなる【NGKI2902】．</p>
</div>
<div class="paragraph">
<p>ATT_PMA／att_pmaは，MMU（Memory Management Unit）を持つターゲットシステムにおいて，ターゲット定義でサポートされる機能である【NGKI2903】．ATT_PMA／att_pmaがサポートされている場合には，TOPPERS_SUPPORT_ATT_PMAがマクロ定義される【NGKI2904】．ATT_PMAがサポートされていない場合にこの静的APIを使用すると，コンフィギュレータがE_NOSPTエラーを報告する【NGKI2905】．また，att_pmaがサポートされていない場合にatt_pmaを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI2906】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ターゲット定義で，ATT_PMAをサポートする【HRPS0156】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ターゲット定義で，ATT_PMAをサポートする【HRMPS0118】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>paddrは整数定数式パラメータである．すなわち，プログラムが配置される番地に依存せずに値の決まる整数定数式でなければならない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様に定義されていない静的APIおよびサービスコールである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ATT_PMAによってアクセス許可ベクタを設定できるようにし，そのための静的API（ATA_PMA）は廃止した．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに関する属性を，メモリオブジェクト属性（mematr）から，メモリオブジェクトアクセス属性（accatr）に変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_mem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メモリオブジェクトのアクセス許可ベクタの設定〔TPD〕【NGKI2907】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_mem(const void *base, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトの先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2908】<br>
・CPUロック状態からの呼出し【NGKI2909】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・baseがメモリオブジェクトの先頭番地でない【NGKI2910】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・baseで指定した番地を含むメモリオブジェクトが登録されていない【NGKI2911】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メモリオブジェクトに対する管理操作が許可されていない【NGKI2912】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない【NGKI2913】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象メモリオブジェクトは静的APIで登録された【NGKI2914】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>baseで指定したメモリオブジェクト（対象メモリオブジェクト）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI2915】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>静的APIによって登録したメモリオブジェクトは，アクセス許可ベクタを設定することができないこととした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様では，baseはメモリオブジェクトに含まれる番地を指定するものとしていたが，この仕様では，メモリオブジェクトの先頭番地でなければならないものとした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>det_mem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メモリオブジェクトの登録解除〔TPD〕【NGKI2916】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = det_mem(const void *base)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2917】<br>
・CPUロック状態からの呼出し【NGKI2918】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・baseがメモリオブジェクトの先頭番地でない【NGKI2919】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・baseで指定した番地を含むメモリオブジェクトが登録されていない【NGKI2920】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メモリオブジェクトに対する管理操作が許可されていない【NGKI2921】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象メモリオブジェクトは静的APIで登録された【NGKI2922】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>baseで指定したメモリオブジェクト（対象メモリオブジェクト）を登録解除する【NGKI2923】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>静的APIによって登録したメモリオブジェクトは，登録を解除することができないこととした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様では，baseはメモリオブジェクトに含まれる番地を指定するものとしていたが，この仕様では，メモリオブジェクトの先頭番地でなければならないものとした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>prb_mem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メモリ領域に対するアクセス権のチェック〔TP〕【NGKI2924】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = prb_mem(const void *base, size_t size, ID tskid, MODE pmmode)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ領域の先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tskid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス元のタスクのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pmmode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセスモード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI2925】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・tskidが有効範囲外【NGKI2927】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・sizeが0【NGKI2929】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・baseで指定した番地を含むメモリオブジェクトが登録されていない【NGKI2930】<br>
・tskidで指定したタスクが未登録〔D〕【NGKI3425】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メモリ領域を含むメモリオブジェクトに対する参照操作が許可されていない【NGKI2931】<br>
・tskidで指定したタスクに対する参照操作が許可されていない【NGKI3426】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象メモリ領域がメモリオブジェクトの境界を越えている【NGKI2932】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>tskidで指定したタスクから，baseとsizeで指定したメモリ領域（対象メモリ領域）に対して，pmmodeで指定した種別のアクセスが許可されているかをチェックする．アクセスが許可されている場合にE_OK，そうでない場合にE_MACVが返る【NGKI2933】．tskidで指定したタスクがカーネルドメインに属する場合，E_MACVが返ることはない【NGKI2934】．</p>
</div>
<div class="paragraph">
<p>pmmodeには，TPM_WRITE（＝0x01U），TPM_READ（＝0x02U），TPM_EXEC（＝0x04U）のいずれか，またはそれらの内のいくつかのビット毎論理和（C言語の"|"）を指定することができる【NGKI2935】．TPM_WRITE，TPM_READ，TPM_EXECを指定した場合には，それぞれ，書込みアクセス，読出しアクセス，実行アクセスが許可されているかをチェックする【NGKI2936】．また，いくつかのビット毎論理和を指定した場合には，それらに対応した種別のアクセスがすべて許可されているかをチェックする【NGKI2937】．pmmodeにそれ以外の値を指定した場合には，E_PARエラーとなる【NGKI2938】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクから対象メモリ領域に対してアクセスが許可されているかをチェックする【NGKI2939】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_tskで生成したユーザタスクのユーザスタック領域に対して，他のタスクからアクセスが許可されているかをprb_memによりチェックした場合に，ターゲット定義でE_NOEXSエラーとなる場合がある【HRPS0244】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>アクセスする主体の指定方法を，保護ドメインによる指定（domid）から，タスクによる指定（tskid）に変更した．また，pmmodeに指定できるアクセス種別にTPM_EXECを追加し，TPM_WRITEとTPM_READの値を入れ換えた．CPUロック状態からも呼び出せるものとした．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>prb_memを，CPUロック状態からも呼び出せるものとしたのは，次の理由による．prb_memは，拡張サービスコールの中で，タスクから渡されたポインタが，そのタスクからアクセスできる領域であるかを調べるために用いることを想定している．拡張サービスコールの中には，CPUロック状態でも呼び出せるものがあり，そのような拡張サービスコールを実現するには，prb_memがCPUロック状態から呼び出せることが必要である．</p>
</div>
<div class="paragraph">
<p>なお，prb_memを非タスクコンテキストから呼び出すことはできないが，非タスクコンテキストで実行される処理単位は必ずカーネルドメインに属するために，prb_memを使ってアクセス権を調べる必要がないことから，支障がない．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_mem</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>メモリオブジェクトの状態参照〔TP〕【NGKI3954】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_mem(const void *addr, T_RMEM *pk_rmem)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">状態参照するメモリ番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_RMEM *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_rmem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトの現在状態を入れるパケットへのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊メモリオブジェクトの現在状態（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">accatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトアクセス属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトの先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクトのサイズ（バイト数）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3955】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・addrで指定した番地を含むメモリオブジェクトが登録されていない【NGKI3956】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象メモリオブジェクトに対する参照操作が許可されていない【NGKI3957】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_rmemが指すメモリ領域への書込みアクセスが許可されていない【NGKI3958】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>addrで指定したメモリ番地を含むメモリオブジェクト（対象メモリオブジェクト）の現在状態を参照する．参照した現在状態は，pk_rmemで指定したパケットに返される【NGKI3959】．</p>
</div>
<div class="paragraph">
<p>accatrには，対象メモリオブジェクトの登録時に指定したメモリオブジェクトアクセス属性と，対象メモリオブジェクトが次のいずれかに該当する場合には，それを表す属性値とビット毎論理和をとったものが返される【NGKI3960】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_ATTMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATT_MEM／att_mem／ATT_PMA／att_pmaで登録されたメモリオブジェクト</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_USTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2000U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザスタック領域</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>参照できる現在状態を変更／決定した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>ref_memを，非タスクコンテキストからは呼び出すことができず，CPUロック状態からは呼び出すことができるとした理由は，prb_memと同様である．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_9_割込み管理機能"><a class="anchor" href="#_4_9_割込み管理機能"></a><a class="link" href="#_4_9_割込み管理機能">4.9 割込み管理機能</a></h3>
<div class="paragraph">
<p>割込み処理のプログラムは，割込みサービスルーチン（ISR）として実現することを推奨する．割込みサービスルーチンをカーネルに登録する場合には，まず，割込みサービスルーチンの登録対象となる割込み要求ラインの属性を設定しておく必要がある【NGKI2940】．割込みサービスルーチンは，カーネル内の割込みハンドラを経由して呼び出される【NGKI2941】．</p>
</div>
<div class="paragraph">
<p>ただし，カーネルが用意する割込みハンドラで対応できないケースに対応するために，アプリケーションで割込みハンドラを用意することも可能である【NGKI2942】．この場合にも，割込みハンドラをカーネルに登録する前に，割込みハンドラの登録対象となる割込みハンドラ番号に対応する割込み要求ラインの属性を設定しておく必要がある【NGKI2943】．</p>
</div>
<div class="paragraph">
<div class="title">〔割込み要求ライン属性〕</div>
<p>割込み要求ラインの属性を設定する際に指定する割込み要求ライン属性には，次の属性を指定することができる【NGKI2944】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_ENAINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み要求禁止フラグをクリア</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_EDGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エッジトリガ</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ターゲットによっては，ターゲット定義の割込み要求ライン属性を指定できる場合がある【NGKI2945】．ターゲット定義の割込み要求ライン属性として，次の属性を予約している【NGKI2946】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_POSEDGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポジティブエッジトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NEGEDGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ネガティブエッジトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_BOTHEDGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">両エッジトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_LOWLEVEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローレベルトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_HIGHLEVEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ハイレベルトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_BROADCAST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべてのプロセッサで割込みを処理（マルチプロセッサ対応カーネルの場合）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">〔割込みサービスルーチン〕</div>
<p>割込みサービスルーチンは，カーネルが実行を制御する処理単位である．割込みサービスルーチンは，割込みサービスルーチンIDと呼ぶID番号によって識別する【NGKI2947】．</p>
</div>
<div class="paragraph">
<p>1つの割込み要求ラインに対して複数の割込みサービスルーチンを登録した場合，それらの割込みサービスルーチンは，割込みサービスルーチン優先度の高い順にすべて呼び出される【NGKI2948】．割込みサービスルーチン優先度が同じ場合には，登録した順（静的APIにより登録した場合には，割込みサービスルーチンを生成するAPIをコンフィギュレーションファイル中に記述した順）で呼び出される【NGKI2949】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，割込みサービスルーチンが属することのできる保護ドメインは，カーネルドメインに限られる【NGKI2950】．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチン属性に標準で指定できる属性はないが，ターゲットによっては，ターゲット定義の割込みサービスルーチン属性を指定できる場合がある【NGKI5176】．ターゲット定義の割込みサービスルーチン属性がない場合，割込みサービスルーチン属性には，TA_NULLを指定しなければならない【NGKI2952】．</p>
</div>
<div class="paragraph">
<p>C言語による割込みサービスルーチンの記述形式は次の通り【NGKI2953】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void interrupt_service_routine(intptr_t exinf)
	{
		割込みサービスルーチン本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，割込みサービスルーチンの拡張情報が渡される【NGKI2954】．</p>
</div>
<div class="paragraph">
<div class="title">〔割込みハンドラ〕</div>
<p>割込みハンドラは，カーネルが実行を制御する処理単位である．割込みハンドラは，割込みハンドラ番号と呼ぶオブジェクト番号によって識別する【NGKI2955】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，割込みハンドラは，カーネルドメインに属する【NGKI2956】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラを登録する際に指定する割込みハンドラ属性には，ターゲット定義で，次の属性を指定することができる【NGKI2957】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NONKERNEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネル管理外の割込み</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_NONKERNELを指定しない場合，カーネル管理の割込みとなる【NGKI2958】．また，ターゲットによっては，その他のターゲット定義の割込みハンドラ属性を指定できる場合がある【NGKI2959】．</p>
</div>
<div class="paragraph">
<p>C言語による割込みハンドラの記述形式は次の通り【NGKI2960】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void interrupt_handler(void)
	{
		割込みハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">〔カーネル構成マクロ〕</div>
<p>割込み管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 7.0175%;">
<col style="width: 19.2982%;">
<col style="width: 52.6315%;">
<col style="width: 21.0528%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_INTPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度の最小値（最高値）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">【NGKI2961】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_INTPRI</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">割込み優先度の最大値（最低値，＝-1）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_ISRPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン優先度の最小値（＝1）【NGKI2962】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_ISRPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン優先度の最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_ISRID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できる割込みサービスルーチンの数（動的生成対応でないカーネルでは，静的APIによって登録された割込みサービスルーチンの数に一致）【NGKI3612】</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_DIS_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_intがサポートされている［NGKI3092］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_ENA_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_intがサポートされている［NGKI3105］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_CLR_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clr_intがサポートされている［NGKI3926］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_RAS_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ras_intがサポートされている［NGKI3938］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_PRB_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb_intがサポートされている［NGKI3950］</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>1つの割込み要求ラインに複数のデバイスからの割込み要求が接続されている場合に対応するために，割込みサービスルーチンは，それが処理する割込み要求が発生しているかをチェックし，割込み要求が発生していない場合には何もせずにリターンするように実装すべきである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）は16に固定されている【ASPS0192】．ただし，タスク優先度拡張パッケージでは，TMAX_ISRPRIを256に拡張する【ASPS0193】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）は16に固定されている【FMPS0159】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）は16に固定されている【HRPS0159】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）は16に固定されている【HRMPS0119】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）は16に固定されている【SSPS0137】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>割込み要求ラインの属性，割込み優先度，割込みサービスルーチン優先度は，μITRON4.0仕様にない概念であり，TMIN_INTPRI，TMAX_INTPRI，TMIN_ISRPRI，TMAX_ISRPRI，TNUM_ISRIDは，μITRON4.0仕様に定義のないカーネル構成マクロである．また，TA_NONKERNELは，μITRON4.0仕様に定義のない割込みハンドラ属性である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TNUM_ISRIDは，TOPPERS新世代カーネル統合仕様に定義のないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CFG_INT</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込み要求ラインの属性の設定〔S〕【NGKI2965】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>cfg_int</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込み要求ラインの属性の設定〔TD〕【NGKI2966】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CFG_INT(INTNO intno, { ATR intatr, PRI intpri })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = cfg_int(INTNO intno, const T_CINT *pk_cint)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CINT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み要求ラインの属性の設定情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊割込み要求ラインの属性の設定情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み要求ライン属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2967】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2968】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・intatrが無効【NGKI2969】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI2971】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI2970】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・intnoが有効範囲外【NGKI2972】<br>
・intpriが有効範囲外【NGKI2973】<br>
・カーネルドメインの囲みの中に記述されていない〔SP〕【NGKI2989】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する管理操作が許可されていない〔sP〕【NGKI2974】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cintが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI2975】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込み要求ラインに対して属性が設定済み〔S〕【NGKI2976】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）の属性を，各パラメータで指定した属性の設定情報に従って設定する【NGKI2977】．マルチプロセッサ対応カーネルでは，割込み要求ラインが属するクラスも設定する【NGKI5143】．</p>
</div>
<div class="paragraph">
<p>対象割込み要求ラインの割込み要求禁止フラグは，intatrにTA_ENAINTを指定した場合にクリアされ，指定しない場合にセットされる【NGKI2978】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，intno，intatr，intpriは整数定数式パラメータである【NGKI2979】．</p>
</div>
<div class="paragraph">
<p>cfg_intにおいて，ターゲット定義で，複数の割込み要求ラインの割込み優先度が連動して設定される場合がある【NGKI2980】．</p>
</div>
<div class="paragraph">
<p>intpriに指定できる値は，基本的には，TMIN_INTPRI以上，TMAX_INTPRI以下の値である【NGKI2981】．ターゲット定義の拡張で，カーネル管理外の割込み要求ラインに対しても属性を設定できる場合には，TMIN_INTPRIよりも小さい値を指定することができる【NGKI2982】．このように拡張されている場合，カーネル管理外の割込み要求ラインを対象として，intpriにTMIN_INTPRI以上の値を指定した場合には，E_OBJエラーとなる【NGKI2983】．逆に，カーネル管理の割込み要求ラインを対象として，intpriがTMIN_INTPRIよりも小さい値である場合にも，E_OBJエラーとなる【NGKI2984】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義の制限で，対象割込み要求ラインに対して，設定できない割込み要求ライン属性をintatrに指定した場合にはE_RSATRエラー，設定できない割込み優先度をintpriに指定した場合にはE_PARエラーとなる【NGKI2985】．また，マルチプロセッサ対応カーネルにおいて，ターゲット定義の制限により，対象割込み要求ラインが属することができないクラスに属させようとした場合には，E_RSATRエラーとなる【NGKI5184】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，cfg_intを呼び出したタスクが割り付けられているプロセッサから，対象割込み要求ラインの属性を設定できない場合には，E_PARエラーとなる【NGKI2987】．どのプロセッサからどの割込み要求ラインの属性を設定できないかは，ターゲット定義である【NGKI5177】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，cfg_intはカーネルオブジェクトを登録するサービスコールではないため，割込み要求ライン属性にTA_DOM(domid)を指定した場合にはE_RSATRエラーとなる【NGKI2990】．ただし，TA_DOM(TDOM_SELF)を指定した場合には，指定が無視され，E_RSATRエラーは検出されない【NGKI2991】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>ターゲット定義の制限で設定できない割込み要求ライン属性／割込み優先度は，主にターゲットハードウェアの制限から来るものである．例えば，対象割込み要求ラインに対して，トリガモードや割込み優先度が固定されていて，変更できないケースが考えられる．</p>
</div>
<div class="paragraph">
<p>cfg_intにおいて，ターゲット定義で，複数の割込み要求ラインの割込み優先度が連動して設定されるのは，ターゲットハードウェアの制限により，異なる割込み要求ラインに対して，同一の割込み優先度しか設定できないケースに対応するための仕様である．この場合，CFG_INTにおいては，同一の割込み優先度しか設定できない割込み要求ラインに対して異なる割込み優先度を設定した場合には，E_PARエラーとなる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていない静的APIおよびサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_ISR</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みサービスルーチンの生成〔S〕【NGKI2993】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>acre_isr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みサービスルーチンの生成〔TD〕【NGKI2995】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_ISR(ID isrid, { ATR isratr, intptr_t exinf,
										INTNO intno, ISR isr, PRI isrpri })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_ID isrid = acre_isr(const T_CISR *pk_cisr)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isrid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象割込みサービスルーチンのID番号（CRE_ISRの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_CISR *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_cisr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチンの生成情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊割込みサービスルーチンの生成情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isratr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exinf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチンの拡張情報</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチンを登録する割込み番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチンの先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isrpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン優先度</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isrid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成された割込みサービスルーチンのID番号（正の値）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI2996】<br>
・CPUロック状態からの呼出し〔s〕【NGKI2997】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・isratrが無効【NGKI2998】<br>
・属する保護ドメインの指定がカーネルドメイン以外〔sP〕【NGKI2999】<br>
・カーネルドメインの囲みの中に記述されていない〔SP〕【NGKI3000】<br>
・クラスの囲みの中に記述されていない〔SM〕【NGKI3002】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI3001】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・intnoが有効範囲外【NGKI3003】<br>
・isrがプログラムの先頭番地として正しくない【NGKI3004】<br>
・isrpriが有効範囲外【NGKI3005】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・属する保護ドメインに対する通常操作1が許可されていない〔sP〕【NGKI3977】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_cisrが指すメモリ領域への読出しアクセスが許可されていない〔sP〕【NGKI3007】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足<br>
・割り付けられる割込みサービスルーチンIDがない〔sD〕【NGKI3008】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・isridで指定した割込みサービスルーチンが登録済み〔S〕【NGKI3009】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した割込みサービスルーチンの生成情報に従って，割込みサービスルーチンを生成する【NGKI3010】．</p>
</div>
<div class="paragraph">
<p>intnoで指定した割込み要求ラインの属性が設定されていない場合には，E_OBJエラーとなる【NGKI3012】．また，intnoで指定した割込み番号に対応する割込みハンドラ番号に対して，割込みハンドラを定義する機能（DEF_INH）によって割込みハンドラが定義されている場合にも，E_OBJエラーとなる【NGKI3013】．さらに，intnoでカーネル管理外の割込みを指定した場合にも，E_OBJエラーとなる【NGKI3014】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，isridはオブジェクト識別名，isratr，intno，isrpriは整数定数式パラメータ，exinfとisrは一般定数式パラメータである【NGKI3015】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，生成する割込みサービスルーチンの属するクラスの割付け可能プロセッサが，intnoで指定した割込み要求ラインが接続されたプロセッサの集合に含まれていない場合には，E_RSATRエラーとなる【NGKI3016】．また，intnoで指定した割込み要求ラインが，生成する割込みサービスルーチンと異なるクラスに属する場合にも，E_RSATRエラーとなる【NGKI5142】．さらに，生成する割込みサービスルーチンの属するクラスが，ターゲット定義の制限に合致しない場合にも，E_RSATRエラーとなる【NGKI3019】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいて，isrが不正である場合にE_PARエラーが検出されるか否かは，ターゲット定義である【NGKI3020】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，acre_isrをサポートする【ASPS0195】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，acre_isrをサポートする【HRPS0208】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>割込みサービスルーチンの生成情報に，isrpri（割込みサービスルーチン優先度）を追加した．割込みサービスルーチンの追加する静的API（ATT_ISR）を廃止し，生成する静的API（CRE_ISR）を新設した．CRE_ISRは，μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>割込みサービスルーチンを追加する静的API（ATT_ISR）を廃止した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>AID_ISR</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割付け可能な割込みサービスルーチンIDの数の指定〔SD〕【NGKI3021】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	AID_ISR(uint_t noisr)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">noisr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付け可能な割込みサービスルーチンIDの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3982】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI3022】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5122】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>noisrで指定した数の割込みサービスルーチンIDを，割込みサービスルーチンを生成するサービスコールによって割付け可能な割込みサービスルーチンIDとして確保する【NGKI3024】．</p>
</div>
<div class="paragraph">
<p>noisrは整数定数式パラメータである【NGKI3025】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，AID_ISRをサポートする【ASPS0219】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，AID_ISRをサポートする【HRPS0220】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>SAC_ISR</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みサービスルーチンのアクセス許可ベクタの設定〔SP〕【NGKI3026】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_isr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みサービスルーチンのアクセス許可ベクタの設定〔TPD〕【NGKI3027】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	SAC_ISR(ID isrid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_isr(ID isrid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isrid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象割込みサービスルーチンのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI3028】<br>
・CPUロック状態からの呼出し〔s〕【NGKI3029】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・isridが有効範囲外〔s〕【NGKI3030】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・カーネルドメインの囲みの中に記述されていない〔S〕【NGKI3031】<br>
・対象割込みサービスルーチンが属するクラスの囲みの中に記述されていない〔SM〕【NGKI3032】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象割込みサービスルーチンが未登録【NGKI3033】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象割込みサービスルーチンに対する管理操作が許可されていない〔s〕【NGKI3034】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI3035】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込みサービスルーチンは静的APIで生成された〔s〕【NGKI3036】<br>
・対象割込みサービスルーチンに対してアクセス許可ベクタが設定済み〔S〕【NGKI3037】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>isridで指定した割込みサービスルーチン（対象割込みサービスルーチン）のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI3038】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，isridはオブジェクト識別名，acptn1〜acptn4は整数定数式パラメータである【NGKI3039】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，SAC_ISRをサポートしない【HRPS0162】．HRP3カーネルの動的生成機能拡張パッケージでは，SAC_ISRとsac_isrをサポートする【HRPS0209】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，SAC_ISRをサポートしない【HRMPS0120】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>del_isr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みサービスルーチンの削除〔TD〕【NGKI3040】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = del_isr(ID isrid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isrid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象割込みサービスルーチンのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3041】<br>
・CPUロック状態からの呼出し【NGKI3042】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・isridが有効範囲外【NGKI3043】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録<br>
・対象割込みサービスルーチンが未登録【NGKI3044】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象割込みサービスルーチンに対する管理操作が許可されていない〔P〕【NGKI3045】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込みサービスルーチンは静的APIで生成された【NGKI3046】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>isridで指定した割込みサービスルーチン（対象割込みサービスルーチン）を削除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象割込みサービスルーチンの登録が解除され，その割込みサービスルーチンIDが未使用の状態に戻される【NGKI3047】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルの動的生成機能拡張パッケージでは，del_isrをサポートする【ASPS0198】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルの動的生成機能拡張パッケージでは，del_isrをサポートする【HRPS0210】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_isr</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みサービスルーチンの状態参照〔T〕</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_isr(ID isrid, T_RISR *pk_risr)</code></pre>
</div>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ref_isrをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ref_isrをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ref_isrをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ref_isrをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ref_isrをサポートしない．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_INH</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みハンドラの定義〔S〕【NGKI3048】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_INH(INHNO inhno, { ATR inhatr, INTHDR inthdr })</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INHNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inhno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みハンドラ番号</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊割込みハンドラの定義情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inhatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みハンドラ属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inthdr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みハンドラの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・inhatrが無効【NGKI3052】<br>
・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3070】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI3054】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI3053】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・inhnoが有効範囲外【NGKI3055】<br>
・inthdrがプログラムの先頭番地として正しくない【NGKI3056】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>inhnoで指定した割込みハンドラ番号（対象割込みハンドラ番号）に対して，各パラメータで指定した割込みハンドラの定義情報に従って，割込みハンドラを定義する【NGKI3059】．</p>
</div>
<div class="paragraph">
<p>inhnoとinhatrは整数定数式パラメータ，inthdrは一般定数式パラメータである【NGKI3061】．</p>
</div>
<div class="paragraph">
<p>対象割込みハンドラ番号に対応する割込み要求ラインの属性が設定されていない場合には，E_OBJエラーとなる【NGKI3062】．また，対象割込みハンドラ番号に対してすでに割込みハンドラが定義されている場合と，対象割込みハンドラ番号に対応する割込み番号を対象に割込みサービスルーチンが登録されている場合にも，E_OBJエラーとなる【NGKI3063】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義の拡張で，カーネル管理外の割込みに対しても割込みハンドラを定義できる場合には，次のエラーが検出される【NGKI3064】．カーネル管理外の割込みハンドラを対象として，inhatrにTA_NONKERNELを指定しない場合には，E_OBJエラーとなる【NGKI3065】．逆に，カーネル管理の割込みハンドラを対象として，inhatrにTA_NONKERNELを指定した場合にも，E_OBJエラーとなる【NGKI3066】．また，ターゲット定義でカーネル管理外に固定されている割込みハンドラがある場合には，それを対象割込みハンドラに指定して，inhatrにTA_NONKERNELを指定しない場合には，E_RSATRエラーとなる【NGKI3067】．逆に，ターゲット定義でカーネル管理に固定されている割込みハンドラがある場合には，それを対象割込みハンドラに指定して，inhatrにTA_NONKERNELを指定した場合には，E_RSATRエラーとなる【NGKI3068】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，登録する割込みハンドラの属するクラスの初期割付けプロセッサが，その割込みが要求されるプロセッサでない場合には，E_RSATRエラーとなる【NGKI3073】．また，対象割込みハンドラ番号に対応する割込み要求ラインが，登録する割込みハンドラと異なるクラスに属する場合にも，E_RSATRエラーとなる【NGKI5141】．さらに，登録する割込みハンドラの属するクラスが，ターゲット定義の制限に合致しない場合にも，E_RSATRエラーとなる【NGKI3075】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込みハンドラを定義できない場合には，E_PARエラーとなる【NGKI3078】．</p>
</div>
<div class="paragraph">
<p>inthdrが不正である場合にE_PARエラーが検出されるか否かは，ターゲット定義である【NGKI3080】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>inthdrのデータ型をINTHDRに変更した．割込みハンドラを定義するサービスコール（def_inh）を廃止した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>割込みハンドラを定義するサービスコール（def_inh）を廃止した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>dis_int</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みの禁止〔TI〕【NGKI3555】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = dis_int(INTNO intno)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポートエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・intnoが有効範囲外【NGKI3083】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作2が許可されていない〔P〕【NGKI3084】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込み要求ラインに対して割込み要求ライン属性が設定されていない【NGKI3085】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）の割込み要求禁止フラグをセットする【NGKI3086】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，dis_intがサポートされていない場合がある【NGKI3091】．dis_intがサポートされている場合には，TOPPERS_SUPPORT_DIS_INTがマクロ定義される【NGKI3092】．サポートされていない場合にdis_intを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI3093】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込み要求ラインの割込み要求禁止フラグをセットできない場合には，E_PARエラーとなる【NGKI3087】．具体的には，対象割込み要求ラインに対して割込み要求禁止フラグがサポートされていない場合や，マルチプロセッサ対応カーネルにおいて，dis_intを呼び出した処理単位が割り付けられているプロセッサから，対象割込み要求ラインの割込み要求禁止フラグが操作できない場合などが，これに該当する．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，割込み要求禁止フラグの振舞いが，この仕様の規定と異なる場合がある【NGKI3089】．特にマルチプロセッサ対応カーネルでは，あるプロセッサに割り付けられた処理単位からdis_intを呼び出して割込み要求禁止フラグをセットしても，他のプロセッサに対しては割込みがマスクされない場合がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様で実装定義としていたintnoの意味を標準化した．</p>
</div>
<div class="paragraph">
<p>dis_intは，CPUロック状態でも呼び出せるものとした．また，非タスクコンテキストからも呼び出せるものとした．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>dis_intは，非タスクコンテキストからも呼び出せるものとした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ena_int</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みの許可〔TI〕【NGKI3556】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ena_int(INTNO intno)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポートエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・intnoが有効範囲外【NGKI3096】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作2が許可されていない〔P〕【NGKI3097】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込み要求ラインに対して割込み要求ライン属性が設定されていない【NGKI3098】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）の割込み要求禁止フラグをクリアする【NGKI3099】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ena_intがサポートされていない場合がある【NGKI3104】．ena_intがサポートされている場合には，TOPPERS_SUPPORT_ENA_INTがマクロ定義される【NGKI3105】．サポートされていない場合にena_intを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI3106】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込み要求ラインの割込み要求禁止フラグをクリアできない場合には，E_PARエラーとなる【NGKI3100】．具体的には，対象割込み要求ラインに対して割込み要求禁止フラグがサポートされていない場合や，マルチプロセッサ対応カーネルにおいて，ena_intを呼び出した処理単位が割り付けられているプロセッサから，対象割込み要求ラインの割込み要求禁止フラグが操作できない場合などが，これに該当する．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，割込み要求禁止フラグの振舞いが，この仕様の規定と異なる場合がある【NGKI3102】．特にマルチプロセッサ対応カーネルでは，あるプロセッサに割り付けられた処理単位からena_intを呼び出して割込み要求禁止フラグをクリアしても，他のプロセッサに対しては割込みがマスク解除されない場合がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様で実装定義としていたintnoの意味を標準化した．</p>
</div>
<div class="paragraph">
<p>ena_intは，CPUロック状態でも呼び出せるものとした．また，非タスクコンテキストからも呼び出せるものとした．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>ena_intは，非タスクコンテキストからも呼び出せるものとした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>clr_int</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込み要求のクリア〔TI〕【NGKI3920】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = clr_int(INTNO intno)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポートエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・intnoが有効範囲外【NGKI3921】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作2が許可されていない〔P〕【NGKI3922】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込み要求ラインに対して割込み要求ライン属性が設定されていない【NGKI3923】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）に対する割込み要求をクリアする【NGKI3924】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，clr_intがサポートされていない場合がある【NGKI3925】．clr_intがサポートされている場合には，TOPPERS_SUPPORT_CLR_INTがマクロ定義される【NGKI3926】．サポートされていない場合にclr_intを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI3927】．</p>
</div>
<div class="paragraph">
<p>対象割込み要求ラインがレベルトリガである場合のclr_intの振舞いはターゲット定義である【NGKI3928】．ターゲット定義でエラーとなる場合には，E_OBJエラーとなる【NGKI3929】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込み要求ラインに対する割込み要求をクリアできない場合には，E_PARエラーとなる【NGKI3930】．具体的には，マルチプロセッサ対応カーネルにおいて，clr_intを呼び出した処理単位が割り付けられているプロセッサから，対象割込み要求ラインに対する割込み要求がクリアできない場合などが，これに該当する．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，割込み要求のクリアの振舞いが，この仕様の規定と異なる場合がある【NGKI3931】．特にマルチプロセッサ対応カーネルでは，あるプロセッサに割り付けられた処理単位からclr_intを呼び出して割込み要求をクリアしても，他のプロセッサに対する割込み要求はクリアされない場合がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ras_int</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込みの要求〔TI〕【NGKI3932】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ras_int(INTNO intno)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポートエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・intnoが有効範囲外【NGKI3933】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作2が許可されていない〔P〕【NGKI3934】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込み要求ラインに対して割込み要求ライン属性が設定されていない【NGKI3935】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）に対して割込みを要求する【NGKI3936】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ras_intがサポートされていない場合がある【NGKI3937】．ras_intがサポートされている場合には，TOPPERS_SUPPORT_RAS_INTがマクロ定義される【NGKI3938】．サポートされていない場合にras_intを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI3939】．</p>
</div>
<div class="paragraph">
<p>対象割込み要求ラインがレベルトリガである場合のras_intの振舞いはターゲット定義である【NGKI3940】．ターゲット定義でエラーとなる場合には，E_OBJエラーとなる【NGKI3941】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込み要求ラインに対して割込みを要求できない場合には，E_PARエラーとなる【NGKI3942】．具体的には，マルチプロセッサ対応カーネルにおいて，ras_intを呼び出した処理単位が割り付けられているプロセッサから，対象割込み要求ラインに対して割込みを要求できない場合などが，これに該当する．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，割込みの要求の振舞いが，この仕様の規定と異なる場合がある【NGKI3943】．特にマルチプロセッサ対応カーネルでは，あるプロセッサに割り付けられた処理単位からras_intを呼び出して，複数のプロセッサに接続された割込み要求ラインに対して割込みを要求しても，他のプロセッサに対しては割込みが要求されない場合がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>prb_int</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込み要求のチェック〔TI〕【NGKI3944】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_BOOL state = prb_int(INTNO intno)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_BOOL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み要求状態（TRUEまたはFALSE）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポートエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・intnoが有効範囲外【NGKI3945】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する参照操作が許可されていない〔P〕【NGKI3946】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象割込み要求ラインに対して割込み要求ライン属性が設定されていない【NGKI3947】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）に対する割込み要求をチェックする．割込み要求がある場合にはTRUE，そうでない場合にはFALSEが返る【NGKI3948】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，prb_intがサポートされていない場合がある【NGKI3949】．prb_intがサポートされている場合には，TOPPERS_SUPPORT_PRB_INTがマクロ定義される【NGKI3950】．サポートされていない場合にprb_intを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI3951】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込み要求ラインに対する割込み要求をチェックできない場合には，E_PARエラーとなる【NGKI3952】．具体的には，マルチプロセッサ対応カーネルにおいて，prb_intを呼び出した処理単位が割り付けられているプロセッサから，対象割込み要求ラインに対する割込み要求がチェックできない場合などが，これに該当する．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，割込み要求のチェックの振舞いが，この仕様の規定と異なる場合がある【NGKI3953】．特にマルチプロセッサ対応カーネルでは，割込み要求がプロセッサ毎に管理されており，あるプロセッサに割り付けられた処理単位からprb_intを呼び出して割込み要求をチェックしても，他のプロセッサに対する割込み要求がそれと一致していない場合がある．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_int</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込み要求ラインの参照〔T〕</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_int(INTNO intno, T_RINT *pk_rint)</code></pre>
</div>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>chg_ipm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込み優先度マスクの変更〔T〕【NGKI3107】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = chg_ipm(PRI intpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度マスク</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3108】<br>
・CPUロック状態からの呼出し【NGKI3109】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作2が許可されていない〔P〕【NGKI3110】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>割込み優先度マスクを，intpriで指定した値に変更する【NGKI3111】．</p>
</div>
<div class="paragraph">
<p>intpriは，TMIN_INTPRI以上，TIPM_ENAALL以下でなければならない．そうでない場合には，E_PARエラーとなる【NGKI3113】．ただし，ターゲット定義の拡張として，TMIN_INTPRIよりも小さい値を指定できる場合がある【NGKI3114】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>割込み優先度マスクをTIPM_ENAALLに変更した場合，ディスパッチ保留状態が解除され，ディスパッチが起こる可能性がある．また，自タスクのタスク終了処理要求フラグがセットされていた場合には，自タスクが終了する可能性がある．この場合，chg_ipmからはリターンしない．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，割込み優先度マスクをTIPM_ENAALLに変更した場合，システム周期の切換えとタイムウィンドウの切換えの保留が解除され，システム周期の切換えとタイムウィンドウの切換えが起こる可能性がある．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，chg_ipmをサポートしない【SSPS0143】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，サービスコールの名称およびパラメータの名称が実装定義となっているサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_ipm</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>割込み優先度マスクの参照〔T〕【NGKI3115】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_ipm(PRI *p_intpri)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_intpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度マスクを入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intpri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度マスク</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI3116】<br>
・CPUロック状態からの呼出し【NGKI3117】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する参照操作が許可されていない〔P〕【NGKI3118】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_intpriが指すメモリ領域への書込みアクセスが許可されていない〔P〕【NGKI3119】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>割込み優先度マスクの現在値を参照する．参照した割込み優先度マスクは，p_intpriが指すメモリ領域に返される【NGKI3120】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，get_ipmをサポートしない【SSPS0144】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，サービスコールの名称およびパラメータの名称が実装定義となっているサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_10_cpu例外管理機能"><a class="anchor" href="#_4_10_cpu例外管理機能"></a><a class="link" href="#_4_10_cpu例外管理機能">4.10 CPU例外管理機能</a></h3>
<div class="paragraph">
<p>CPU例外ハンドラは，カーネルが実行を制御する処理単位である．CPU例外ハンドラは，CPU例外ハンドラ番号と呼ぶオブジェクト番号によって識別する【NGKI3121】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，CPU例外ハンドラは，カーネルドメインに属する【NGKI3122】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラ属性に標準で指定できる属性はないが，ターゲットによっては，ターゲット定義のCPU例外ハンドラ属性を指定できる場合がある【NGKI3123】．ターゲット定義のCPU例外ハンドラ属性がない場合，CPU例外ハンドラ属性には，TA_NULLを指定しなければならない【NGKI5178】．ターゲット定義のCPU例外ハンドラ属性として，次の属性を予約している【NGKI3124】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DIRECT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラを直接呼び出す</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>C言語によるCPU例外ハンドラの記述形式は次の通り【NGKI3125】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void cpu_exception_handler(void *p_excinf)
	{
		CPU例外ハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>p_excinfには，CPU例外の情報を記憶しているメモリ領域の先頭番地が渡される【NGKI3126】．これは，CPU例外ハンドラ内で，CPU例外発生時の状態を参照する際に必要となる．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>CPU例外発生時のタスク例外処理保留状態を参照するサービスコール（xsns_xpn）を廃止した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_EXC</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>CPU例外ハンドラの定義〔S〕【NGKI3127】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_EXC(EXCNO excno, { ATR excatr, EXCHDR exchdr })</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXCNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">excno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラ番号</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊CPU例外ハンドラの定義情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">excatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラ属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXCHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exchdr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・excatrが無効【NGKI3131】<br>
・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3143】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI3133】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI3132】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・excnoが有効範囲外【NGKI3134】<br>
・exchdrがプログラムの先頭番地として正しくない【NGKI3135】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・対象CPU例外ハンドラ番号に対してCPU例外ハンドラが定義済み【NGKI3141】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>excnoで指定したCPU例外ハンドラ番号（対象CPU例外ハンドラ番号）に対して，各パラメータで指定したCPU例外ハンドラの定義情報に従って，CPU例外ハンドラを定義する【NGKI3138】．</p>
</div>
<div class="paragraph">
<p>excnoとexcatrは整数定数式パラメータ，exchdrは一般定数式パラメータである【NGKI3140】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，登録するCPU例外ハンドラの属するクラスの初期割付けプロセッサが，そのCPU例外が発生するプロセッサでない場合には，E_RSATRエラーとなる【NGKI3146】．</p>
</div>
<div class="paragraph">
<p>exchdrが不正である場合にE_PARエラーが検出されるか否かは，ターゲット定義である【NGKI3149】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>CPU例外ハンドラを定義するサービスコール（def_exc）を廃止した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>xsns_dpn</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>CPU例外発生時のディスパッチ保留状態の参照〔TI〕【NGKI3150】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = xsns_dpn(void *p_excinf)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 17.1428%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_excinf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外の情報を記憶しているメモリ領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ディスパッチ保留状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>CPU例外発生時のディスパッチ保留状態を参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>実行中のCPU例外ハンドラの起動原因となったCPU例外が，カーネル管理外のCPU例外でなく，タスクコンテキストで発生し，CPU例外が発生した時の状態がディスパッチ保留状態でなかった場合にfalse，そうでない場合にtrueが返る【NGKI3151】．</p>
</div>
<div class="paragraph">
<p>保護機能対応のカーネルにおいて，xsns_dpnをタスクコンテキストから呼び出した場合には，trueが返る【NGKI3152】．</p>
</div>
<div class="paragraph">
<p>p_excinfには，CPU例外ハンドラに渡されるp_excinfパラメータをそのまま渡す【NGKI3153】．それ以外の値を渡した場合の動作は保証されない【NGKI3552】．</p>
</div>
<div class="paragraph">
<div class="title">【使用方法】</div>
<p>xsns_dpnは，CPU例外ハンドラの中で，どのようなリカバリ処理が可能かを判別したい場合に使用する．詳しくは，「<a href="#_2_8_2_cpu例外ハンドラから呼び出せるサービスコール">2.8.2 CPU例外ハンドラから呼び出せるサービスコール</a>」の節を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>xsns_dpnは，E_CTXエラーを返すことがないために〔TI〕となっているが，CPU例外ハンドラから呼び出すためのものである．CPU例外ハンドラ以外から呼び出した場合や，p_excinfに正しい値を渡さなかった場合，xsns_dpnが返す値は意味を持たない．</p>
</div>
<div class="paragraph">
<p>どちらの条件でtrueが返るか間違いやすいので注意すること．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，xsns_dpnをサポートしない【SSPS0146】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>保護機能対応のカーネルにおいては，xsns_dpnをユーザドメインから呼び出すことは禁止すべきである．ユーザドメインの実行中は，必ずタスクコンテキストであるため，xsns_dpnをタスクコンテキストから呼び出した場合に必ずtrueを返す仕様とすることで，xsns_dpnをユーザドメインから呼び出すことを実質的に禁止している．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_11_拡張サービスコール管理機能"><a class="anchor" href="#_4_11_拡張サービスコール管理機能"></a><a class="link" href="#_4_11_拡張サービスコール管理機能">4.11 拡張サービスコール管理機能</a></h3>
<div class="paragraph">
<p>拡張サービスコールは，非特権モードで実行される処理単位から，特権モードで実行すべきルーチンを呼び出すための機能である【NGKI3159】．特権モードで実行するルーチンを，拡張サービスコールと呼ぶ．拡張サービスコールは，特権モードで実行される処理単位からも呼び出すことができる【NGKI3160】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，拡張サービスコールは，カーネルドメインに属する【NGKI3161】．拡張サービスコールは，それを呼び出す処理単位とは別の処理単位であり，拡張サービスコールからカーネルオブジェクトをアクセスする場合には，拡張サービスコールがアクセスの主体となる【NGKI3162】．そのため，拡張サービスコールからは，すべてのカーネルオブジェクトに対して，すべての種別のアクセスを行うことが許可される．</p>
</div>
<div class="paragraph">
<p>保護機能対応でないカーネルでは，非特権モードと特権モードの区別がないため，拡張サービスコール管理機能をサポートしない【NGKI3163】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコール属性に指定できる属性はない【NGKI3686】．そのため拡張サービスコール属性には，TA_NULLを指定しなければならない【NGKI3687】．</p>
</div>
<div class="paragraph">
<p>C言語による拡張サービスコールの記述形式は次の通り【NGKI3164】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_UINT extended_svc(intptr_t par1, intptr_t par2, intptr_t par3,
								intptr_t par4, intptr_t par5, ID cdmid)
	{
		拡張サービスコール本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>cdmidには，拡張サービスコールを呼び出した処理単位が属する保護ドメインのID番号が渡される【NGKI3165】．すなわち，拡張サービスコールから呼び出した場合にはTDOM_KERNEL（＝-1）が，タスク本体（拡張サービスコールを除く）から呼び出した場合にはそのタスク（自タスク）の属する保護ドメインIDが渡される．</p>
</div>
<div class="paragraph">
<p>par1〜par5には，拡張サービスコールに対するパラメータが渡される【NGKI3166】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコール管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_FNCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールの機能番号の最大値（動的生成対応カーネルでは，登録できる拡張サービスコールの数に一致）【NGKI3167】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【未決定事項】</div>
<p>動的生成対応カーネルにおいてTMAX_FNCDを設定する方法については，現時点では未決定である．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>この仕様では，拡張サービスコールに対するパラメータを，intptr_t型のパラメータ5個に固定した．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールに，それを呼び出した処理単位が属する保護ドメインのID番号を渡す機能を追加した．</p>
</div>
<div class="paragraph">
<p>TMAX_FNCDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_SVC</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>拡張サービスコールの定義〔SP〕【NGKI3168】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>def_svc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>拡張サービスコールの定義〔TPD〕【NGKI3169】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_SVC(FN fncd, { ATR svcatr, EXTSVC extsvc, size_t stksz })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = def_svc(FN fncd, const T_DSVC *pk_dsvc)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fncd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールの機能コード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_DSVC *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pk_dsvc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールの定義情報を入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊拡張サービスコールの定義情報（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">svcatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコール属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTSVC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extsvc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールの先頭番地</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stksz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールで使用するスタックサイズ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI3170】<br>
・CPUロック状態からの呼出し〔s〕【NGKI3171】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・svcatrが無効【NGKI3172】<br>
・カーネルドメインの囲みの中に記述されていない〔S〕【NGKI3183】<br>
・クラスの囲みの中に記述されている〔SM〕【NGKI3187】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・fncdが0以下【NGKI3173】<br>
・fncdがTMAX_FNCDよりも大きい〔s〕【NGKI3174】<br>
・extsvcがプログラムの先頭番地として正しくない【NGKI3175】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する管理操作が許可されていない〔s〕【NGKI3176】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・pk_dsvcが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI3177】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>fncdで指定した機能コード（対象機能コード）に対して，各パラメータで指定した拡張サービスコールの定義情報に従って，拡張サービスコールを定義する【NGKI3178】．ただし，def_svcにおいてpk_dsvcをNULLにした場合には，対象機能コードに対する拡張サービスコールの定義を解除する【NGKI3179】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，fncd，svcatr，stkszは整数定数式パラメータ，svchdrは一般定数式パラメータである【NGKI3180】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールを定義する場合（DEF_SVCの場合およびdef_svcにおいてpk_dsvcをNULL以外にした場合）で，対象機能コードに対してすでに拡張サービスコールが定義されている場合には，E_OBJエラーとなる【NGKI3181】．</p>
</div>
<div class="paragraph">
<p>def_svcで拡張サービスコールを定義する場合には，拡張サービスコールの属する保護ドメインを設定する必要はなく，拡張サービスコール属性にTA_DOM(domid)を指定した場合にはE_RSATRエラーとなる【NGKI3184】．ただし，TA_DOM(TDOM_SELF)を指定した場合には，指定が無視され，E_RSATRエラーは検出されない【NGKI3185】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，def_svcで拡張サービスコールを定義する場合には，拡張サービスコールの属するクラスを設定する必要はなく，拡張サービスコール属性にTA_CLS(clsid)を指定した場合にはE_RSATRエラーとなる【NGKI3188】．ただし，TA_CLS(TCLS_SELF)を指定した場合には，指定が無視され，E_RSATRエラーは検出されない【NGKI3189】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールの定義を解除する場合（def_svcにおいてpk_dsvcをNULLにした場合）で，対象機能コードに対して拡張サービスコールが定義されていない場合には，E_OBJエラーとなる【NGKI3190】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>拡張サービスコールの定義情報に，stksz（拡張サービスコールで使用するスタックサイズ）を追加した．</p>
</div>
<div class="paragraph">
<p>extsvcのデータ型を，EXTSVCに変更した．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>cal_svc</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>拡張サービスコールの呼出し〔TIP〕【NGKI3191】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER_UINT ercd = cal_svc(FN fncd, intptr_t par1, intptr_t par2,
						intptr_t par3, intptr_t par4, intptr_t par5)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fncd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">呼び出す拡張サービスコールの機能コード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">par1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールへの第1パラメータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">par2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールへの第2パラメータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">par3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールへの第3パラメータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">par4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールへの第4パラメータ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">par5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールへの第5パラメータ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_UINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（正の値または0）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_SYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSFN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約機能コード<br>
・fncdが0以下【NGKI3192】<br>
・fncdがTMAX_FNCDよりも大きい【NGKI3193】<br>
・fncdで指定した機能コードに対して拡張サービスコールが定義されていない【NGKI3194】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">§その他，拡張サービスコールが返すエラーコードがそのまま返る．</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>fncdで指定した機能コードの拡張サービスコールを，par1，par2，…，par5をパラメータとして呼び出し，拡張サービスコールの返値を返す【NGKI3195】．</p>
</div>
<div class="paragraph">
<p>また，タスクコンテキストから呼び出した場合には，次のエラーが検出される【NGKI3196】．スタック（ユーザタスクの場合はシステムスタック）の残り領域が，拡張サービスコールで使用するスタックサイズよりも小さい場合には，E_NOMEMエラーとなる【NGKI3197】．また，拡張サービスコールのネストレベルが上限（＝255）を超える場合には，E_SYSエラーが返る【NGKI3198】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様では，cal_svcでカーネルのサービスコールを呼び出せるかどうかは実装定義としているが，この仕様では，カーネルのサービスコールを呼び出せないこととした．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールが呼び出される時に，スタックの残り領域のサイズをチェックする機能を追加した．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールに対するパラメータを，intptr_t型のパラメータ5個に固定し，cal_svcから返るエラー（E_SYS，E_RSFN，E_NOMEM）について規定した．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>パラメータの型と数を固定したのは，型チェックを厳密にできるようにし，パラメータをコンパイラやコーリングコンベンションによらずに正しく渡せるようにするためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_12_保護ドメイン管理機能"><a class="anchor" href="#_4_12_保護ドメイン管理機能"></a><a class="link" href="#_4_12_保護ドメイン管理機能">4.12 保護ドメイン管理機能</a></h3>
<div class="paragraph">
<p>保護ドメイン管理機能は，保護機能対応カーネルにおいて，保護ドメイン，システム周期，システム動作モード，タイムウィンドウに関する設定を行うための機能である．保護機能対応でないカーネルでは，保護ドメイン管理機能をサポートしない【NGKI5001】．</p>
</div>
<div class="paragraph">
<p>各保護ドメインが持つ情報は次の通り【NGKI5086】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>割り当てられているタイムウィンドウのリスト（ユーザドメインのみ）</p>
</li>
<li>
<p>アクセス許可ベクタ</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>カーネルは，無所属に対して，アクセス許可ベクタの情報を持つ【NGKI5087】．</p>
</div>
<div class="paragraph">
<div class="title">〔システム動作モード〕</div>
<p>システム動作モードは，システムの動作状態に応じてタイムウィンドウの設定を変更できるようにするために，システムの動作状態を識別するためのカーネルオブジェクトである．システム動作モードは，システム動作モードIDと呼ぶID番号によって識別する【NGKI5002】．</p>
</div>
<div class="paragraph">
<p>各システム動作モードが持つ情報は次の通り【NGKI5003】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システム動作モード属性</p>
</li>
<li>
<p>遷移先システム動作モード</p>
</li>
<li>
<p>登録されているタイムウィンドウのリスト</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>システム動作モード属性には，次の属性を指定することができる【NGKI5004】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_INISOM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期システム動作モード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>TA_INISOMを指定したシステム動作モードを，初期システム動作モードと呼ぶ．TA_INISOMを指定したシステム動作モードがない場合，システム周期停止モードが，初期システム動作モードとなる【NGKI5005】．TA_INISOMを指定したシステム動作モードが複数ある場合，コンフィギュレータがE_OBJエラーを報告する【NGKI5006】．</p>
</div>
<div class="paragraph">
<p>遷移先システム動作モードは，次のシステム周期でどのシステム動作モードに遷移すべきであるかを示す【NGKI5007】．</p>
</div>
<div class="paragraph">
<p>また，システム動作モードに関連して，カーネルが持つ情報は次の通り【NGKI5008】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>現在のシステム動作モード</p>
</li>
<li>
<p>次のシステム周期での遷移先システム動作モード</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>現在のシステム動作モードは，カーネルの起動時に，初期システム周期動作モードに初期化される【NGKI5009】．</p>
</div>
<div class="paragraph">
<p>次のシステム周期での遷移先システム動作モードは，各システム周期の開始時に，現在のシステム動作モードに対して設定された遷移先システム動作モードに初期化される【NGKI5010】．なお，システム周期停止モードにおいては，次のシステム周期での遷移先システム動作モードは意味を持たない．</p>
</div>
<div class="paragraph">
<div class="title">〔タイムウィンドウ〕</div>
<p>タイムウィンドウは，システム周期内の連続した時間区間である．タイムウィンドウは，それを識別するための番号を持たない【NGKI5094】．</p>
</div>
<div class="paragraph">
<p>タイムウィンドウが持つ情報は次の通り【NGKI5095】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>割当て対象のユーザドメイン</p>
</li>
<li>
<p>登録対象のシステム動作モード</p>
</li>
<li>
<p>システム周期内での順序</p>
</li>
<li>
<p>タイムウィンドウの長さ</p>
</li>
<li>
<p>タイムウィンドウ通知の通知方法</p>
</li>
<li>
<p>登録対象のプロセッサ（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>タイムウィンドウ通知（time window notification）は，タイムウィンドウの実行開始をアプリケーションに通知するための機能である．タイムウィンドウ通知が登録されているタイムウィンドウの実行が開始されると，タイムウィンドウの登録時に指定された通知処理を行う【NGKI5096】．</p>
</div>
<div class="paragraph">
<div class="title">〔カーネル構成マクロ〕</div>
<p>保護ドメイン管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_TWDTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムウィンドウの長さに指定できる最大値【NGKI5051】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>μITRON4.0/PX仕様に規定されていない機能である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>保護ドメインに対する制限の設定以外は，TOPPERS新世代カーネル統合仕様に規定されていない機能である．</p>
</div>
<div class="paragraph">
<p>保護ドメインに対する制限の考え方を，操作する側に対する制限から，操作される側に対する制限に変更した．これに伴い，カーネルドメインに対しても制限を設定できることとした．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ACV_DOM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>保護ドメインのアクセス許可ベクタの設定〔SP〕【NGKI3752】</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>sac_dom</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>保護ドメインのアクセス許可ベクタの設定〔TPD〕【NGKI3753】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ACV_DOM({ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_dom(ID domid, const ACVCT *p_acvct)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">対象保護ドメインのID番号（sac_domの場合）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACVCT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_acvct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可ベクタを入れたパケットへのポインタ（静的APIを除く）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊アクセス許可ベクタ（パケットの内容）</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作のアクセス許可パターン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acptn4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作のアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し〔s〕【NGKI3754】<br>
・CPUロック状態からの呼出し〔s〕【NGKI3755】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・domidが有効範囲外〔s〕【NGKI3756】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・対象保護ドメインに対する管理操作が許可されていない〔s〕【NGKI3759】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_acvctが指すメモリ領域への読出しアクセスが許可されていない〔s〕【NGKI3760】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・保護ドメインのアクセス許可ベクタが設定済み〔S〕【NGKI3761】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>ACV_DOMにおいてはそれを囲む保護ドメイン，sac_domにおいてはdomidで指定した保護ドメイン（対象保護ドメイン）のアクセス許可ベクタ（4つのアクアクセス許可パターンの組）を，各パラメータで指定した値に設定する【NGKI3762】．ACV_DOMを保護ドメインの囲みの外に記述した場合には，無所属に対するアクセス許可ベクタを設定する【NGKI3978】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，acptn1〜acptn4は整数定数式パラメータである【NGKI3763】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，ACV_DOMをクラスの囲みの中に記述しても，クラスの情報は使用されない．ACV_DOMをクラスの囲みの中に記述した場合，コンフィギュレータは警告メッセージを出力する【NGKI3758】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS新世代カーネル統合仕様に定義されていない静的APIおよびサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_SCY</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム周期の設定〔SP〕【NGKI5012】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_SCY({ RELTIM scyctim })</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scyctim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム周期</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・保護ドメインの囲みの中に記述されている【NGKI5013】<br>
・クラスの囲みの中に記述されている〔M〕【NGKI5014】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・scyctimが有効範囲（0より大きく，TMAX_RELTIM以下）外【NGKI5015】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・システム周期が設定済み【NGKI5016】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>パラメータに従って，システム周期を設定する【NGKI5017】．</p>
</div>
<div class="paragraph">
<p>scyctimは整数定数式パラメータである【NGKI5018】．</p>
</div>
<div class="paragraph">
<p>システム周期を設定しない場合，時間パーティショニングを行わない【NGKI5019】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>TOPPERS新世代カーネル統合仕様に定義されていない静的APIである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>CRE_SOM</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム動作モードの生成〔SP〕【NGKI5020】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	CRE_SOM(ID somid, { ATR somatr, ID nxtsom })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ nxtsomの指定は省略することができる【NGKI5028】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">somid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するシステム動作モードのID番号</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>＊システム動作モードの生成情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">somatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム動作モード属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nxtsom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">遷移先システム動作モード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・somatrが無効【NGKI5021】<br>
・保護ドメインの囲みの中に記述されている【NGKI5022】<br>
・クラスの囲みの中に記述されている〔M〕【NGKI5023】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・nxtsomが不正【NGKI5024】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・TA_INISOM属性のシステム動作モードが設定済み【NGKI5025】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したシステム動作モードの生成情報に従って，システム動作モードを生成する【NGKI5026】．</p>
</div>
<div class="paragraph">
<p>somidはオブジェクト識別名，somatrは整数定数式パラメータ，nxtsomは一般定数式パラメータである【NGKI5027】．nxtsomの指定を省略した場合，遷移先システム動作モードは，生成したシステム動作モード自身に設定される【NGKI5029】．</p>
</div>
<div class="paragraph">
<p>システム周期が設定されていない場合，この静的APIは無視される【NGKI5039】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>chg_som</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム動作モードの変更〔TP〕【NGKI5030】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = chg_som(ID somid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">somid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更先のシステム動作モードのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI5031】<br>
・CPUロック状態からの呼出し【NGKI5032】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・somidが有効範囲外【NGKI5033】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作1が許可されていない【NGKI5034】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・システム周期が設定されていない【NGKI5035】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>somidで指定したシステム動作モードに切り換える．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>次のシステム周期での遷移先システム動作モードを，somidで指定したシステム動作モードに設定する【NGKI5036】．すなわち，再度chg_somを呼び出さない限りは，現在のシステム周期の終了後に，somidで指定したシステム動作モードに切り換わる．</p>
</div>
<div class="paragraph">
<p>ただし，現在のシステム動作モードがシステム周期停止モード（TSOM_STP）の場合には，somidで指定したシステム動作モードに即座に切り換わる【NGKI5037】．</p>
</div>
<div class="paragraph">
<p>somidにTSOM_STP（＝-1）を指定することもできる【NGKI5038】．指定した場合，現在のシステム周期の終了後（現在のシステム動作モードがシステム周期停止モードの場合は，即座）に，システム周期停止モードに切り換わる．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，chg_somを実行しているプロセッサが，一時的に切換え前のシステム動作モードで実行している状況［NGKI0636］では，somidで指定したシステム動作モードに切り換わるのは，切換え後のシステム周期の終了後になる【NGKI5134】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>get_som</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>システム動作モードの参照〔TP〕【NGKI5060】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = get_som(ID *p_somid)</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【パラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p_somid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のシステム動作モードのID番号を入れるメモリ領域へのポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【リターンパラメータ】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ercd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了（E_OK）またはエラーコード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">somid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">現在のシステム動作モードのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー<br>
・非タスクコンテキストからの呼出し【NGKI5061】<br>
・CPUロック状態からの呼出し【NGKI5062】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・システム状態に対する通常操作4が許可されていない【NGKI5063】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・p_somidが指すメモリ領域への書込みアクセスが許可されていない【NGKI5064】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・システム周期が設定されていない【NGKI5065】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>現在のシステム動作モードを参照する．具体的には，現在のシステム動作モードがシステム周期停止モードである場合にはTSOM_STP（＝-1）が，そうでない場合には現在のシステム動作モードのID番号が，p_somidが指すメモリ領域に返される【NGKI5066】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，get_somを実行しているプロセッサが，一時的に切換え前のシステム動作モードで実行している状況［NGKI0636］では，p_somidで指すメモリ領域に返されるのは，切換え後のシステム動作モードになる【NGKI5135】．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_TWD</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>タイムウィンドウの登録〔SP〕【NGKI5040】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_TWD({ ID domid, ID somid, int_t twdord, PRCTIM twdlen,
												＜通知方法の指定＞ })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ 通知方法の指定の記述は省略することができる【NGKI5155】．</p>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊タイムウィンドウの登録情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割り当てるユーザドメインのID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">somid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録対象のシステム動作モードの名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twdord</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム周期内での順序</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRCTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twdlen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムウィンドウの長さ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T_NFYINFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nfyinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムウィンドウ通知の通知方法</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・保護ドメインの囲みの中に記述されている【NGKI5041】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI5042】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5107】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号<br>
・domidが有効範囲外【NGKI5043】<br>
・somidが不正【NGKI5044】<br>
・通知方法中のオブジェクトIDが有効範囲外［NGKI3704］［NGKI3707］［NGKI3710］［NGKI3713］［NGKI3715］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・twdlenが0，またはTMAX_TWDTIMより大きい【NGKI5045】<br>
・通知方法中の通知処理モードの値が正しくない［NGKI3730］［NGKI3721］<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反<br>
・通知方法中のオブジェクトに対する操作が，割り当てるユーザドメインに許可されていない［NGKI3705］［NGKI3708］［NGKI3711］［NGKI3716］<br>
・通知方法にタイムイベントハンドラの呼出しを指定［NGKI3695］</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反<br>
・通知方法中の変数に対する操作が，割り当てるユーザドメインに許可されていない［NGKI3702］［NGKI3898］</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したタイムウィンドウの登録情報に従って，タイムウィンドウを登録する【NGKI5046】．</p>
</div>
<div class="paragraph">
<p>domid，twdodr，twdlen，通知方法中の通知処理モードは整数定数式パラメータ，somidはオブジェクト識別名，通知方法中の付随情報は一般定数式パラメータである【NGKI5047】．</p>
</div>
<div class="paragraph">
<p>twdordは，somidで指定したシステム動作モードにおいて，登録するタイムウィンドウのシステム周期内での順序を示す．同じシステム動作モードに対して登録されたタイムウィンドウは，twdordが小さい順に配置される【NGKI5048】．twdordの値が同じタイムウィンドウが複数ある場合，その間の順序関係は，この仕様では規定しない．</p>
</div>
<div class="paragraph">
<p>somidで指定したシステム動作モードに対して，登録したタイムウィンドウの合計の長さが，システム周期と同じかそれより長い場合には，E_PARエラーとなる【NGKI5049】．</p>
</div>
<div class="paragraph">
<p>twdlenには，PRCTIM型に格納できる任意の値を指定できるとは限らず，指定できる値にターゲット定義の上限がある場合がある【NGKI5050】．</p>
</div>
<div class="paragraph">
<p>通知方法の指定の記述を省略した場合，タイムウィンドウ通知は登録されない【NGKI5097】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，タイムウィンドウは，プロセッサ毎に登録することができる［NGKI0624］．ATT_TWDにより登録するタイムウィンドウは，ATT_TWDの記述を囲みの中に含むクラスのすべての割付け可能プロセッサに対して登録される【NGKI5100】．ただし，タイムウィンドウ通知は，そのクラスの初期割付けプロセッサに対してのみ登録される【NGKI5106】．</p>
</div>
<div class="paragraph">
<p>システム周期が設定されていない場合，この静的APIは無視される【NGKI5052】．</p>
</div>
<div class="paragraph">
<div class="title">【使用上の注意】</div>
<p>somidには，タイムウィンドウの登録対象となるシステム動作モード名を記述しなければならない．システム動作モードのID番号を表す式を記述することはできない．</p>
</div>
<div class="paragraph">
<div class="title">【仕様決定の理由】</div>
<p>ATT_TWDのパラメータに割り当てるユーザドメインのID番号を持たせ，保護ドメインの囲みの外に記述する仕様としたのは，タイムウィンドウを登録する静的APIを連続して記述した方が，システムコンフィギュレーションファイルが読みやすいためである．</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_4_13_システム構成管理機能"><a class="anchor" href="#_4_13_システム構成管理機能"></a><a class="link" href="#_4_13_システム構成管理機能">4.13 システム構成管理機能</a></h3>
<div class="paragraph">
<p>システム構成管理機能には，非タスクコンテキスト用スタック領域や共有スタック領域を設定する機能，カーネルメモリプール領域を設定する機能，初期化ルーチンと終了処理ルーチンを登録する機能，カーネルのコンフィギュレーション情報やバージョン情報を参照する機能が含まれる．</p>
</div>
<div class="paragraph">
<div class="title">〔非タスクコンテキスト用スタック領域〕</div>
<p>非タスクコンテキスト用スタック領域は，非タスクコンテキストで実行される処理単位が用いるスタック領域である．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，非タスクコンテキスト用のスタック領域は，カーネルの管理領域として扱われる【NGKI3199】．</p>
</div>
<div class="paragraph">
<div class="title">〔カーネルメモリプール領域〕</div>
<p>カーネルメモリプール領域は，動的生成対応カーネルにおいて，カーネルオブジェクトを生成するサービスコールに対して，オブジェクト生成に必要なメモリ領域の先頭番地のパラメータにNULLが渡された場合に，必要なメモリ領域を獲得するためのメモリ領域である【NGKI5067】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，各保護ドメイン向けおよび無所属向けのカーネルメモリプール領域を設定することができる【NGKI5156】．ある保護ドメインに属するカーネルオブジェクトの生成には，その保護ドメイン向けのカーネルメモリプール領域が使用され，無所属のカーネルオブジェクトの生成には，無所属向けのカーネルメモリプール領域が使用される【NGKI5157】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，各クラス向けのカーネルメモリプール領域を設定することができる【NGKI5158】．また，クラス共通のカーネルメモリプール領域を設定することができる【NGKI5159】．あるクラスに属するカーネルオブジェクトの生成には，そのクラス向けのカーネルメモリプール領域が設定されていればその領域が，設定されていなければ，クラス共通のカーネルメモリプール領域が使用される【NGKI5160】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，各カーネルメモリプール領域は，カーネルの管理領域として扱われる【NGKI5068】．</p>
</div>
<div class="paragraph">
<div class="title">〔初期化ルーチン〕</div>
<p>初期化ルーチンは，カーネルが実行を制御する処理単位で，カーネルの動作開始の直前に，カーネル非動作状態で実行される【NGKI3200】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，初期化ルーチンは，カーネルドメインに属する【NGKI3201】．</p>
</div>
<div class="paragraph">
<p>初期化ルーチン属性に指定できる属性はない【NGKI3202】．そのため初期化ルーチン属性には，TA_NULLを指定しなければならない【NGKI3203】．</p>
</div>
<div class="paragraph">
<p>C言語による初期化ルーチンの記述形式は次の通り【NGKI3204】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void initialization_routine(intptr_t exinf)
	{
		初期化ルーチン本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，初期化ルーチンの拡張情報が渡される【NGKI3205】．</p>
</div>
<div class="paragraph">
<div class="title">〔終了処理ルーチン〕</div>
<p>終了処理ルーチンは，カーネルが実行を制御する処理単位で，カーネルの動作終了の直後に，カーネル非動作状態で実行される【NGKI3206】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，終了処理ルーチンは，カーネルドメインに属する【NGKI3207】．</p>
</div>
<div class="paragraph">
<p>終了処理ルーチン属性に指定できる属性はない【NGKI3208】．そのため終了処理ルーチン属性には，TA_NULLを指定しなければならない【NGKI3209】．</p>
</div>
<div class="paragraph">
<p>C言語による終了処理ルーチンの記述形式は次の通り【NGKI3210】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void termination_routine(intptr_t exinf)
	{
		終了処理ルーチン本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，終了処理ルーチンの拡張情報が渡される【NGKI3211】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>非タスクコンテキスト用スタック領域の設定，共有スタック領域の設定，カーネルメモリプール領域の設定，終了処理ルーチンは，μITRON4.0仕様に規定されていない機能である．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>カーネルメモリプール領域の設定は，TOPPERS新世代カーネル統合仕様に規定されていない機能である．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_ICS</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>非タスクコンテキスト用スタック領域の設定〔S〕【NGKI3212】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_ICS({ size_t istksz, STK_T *istk })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ istkの記述は省略することができる【NGKI3905】．</p>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊非タスクコンテキスト用スタック領域の設定情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">istksz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非タスクコンテキスト用スタック領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STK_T *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">istk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非タスクコンテキスト用スタック領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3213】<br>
・クラスの囲みの中に記述されていない〔M〕【NGKI3214】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5128】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・非タスクコンテキスト用スタック領域が確保できない【NGKI3215】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・非タスクコンテキスト用スタック領域が設定済み【NGKI3216】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した非タスクコンテキスト用スタック領域の設定情報に従って，非タスクコンテキスト用スタック領域を設定する【NGKI3217】．istkszに0を指定した時や，ターゲット定義の最小値よりも小さい値を指定した時には，E_PARエラーとなる【NGKI3254】．</p>
</div>
<div class="paragraph">
<p>istkszは整数定数式パラメータ，istkは一般定数式パラメータである【NGKI3916】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI3218】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，非タスクコンテキスト用スタック領域はプロセッサ毎に確保する必要がある【NGKI3225】．DEF_ICSにより設定する非タスクコンテキスト用スタック領域は，DEF_ICSの記述をその囲みの中に含むクラスの初期割付けプロセッサが使用する【NGKI3226】．そのプロセッサに対してすでに非タスクコンテキスト用スタック領域が設定されている場合には，E_OBJエラーとなる【NGKI3227】．</p>
</div>
<div class="paragraph">
<div class="title">〔istkにNULLを指定した場合〕</div>
<p>istkをNULLとするか，istkの記述を省略した場合，istkszで指定したサイズのスタック領域が，コンフィギュレータにより確保される【NGKI3219】．istkszにターゲット定義の制約に合致しないサイズを指定した時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで確保される【NGKI3220】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，コンフィギュレータにより確保されるスタック領域は，カーネルドメイン向け（マルチプロセッサ対応カーネルの場合には，さらに，DEF_ICSの記述をその囲みの中に含むクラス向け）の標準メモリリージョン内に確保される【NGKI5137】．</p>
</div>
<div class="paragraph">
<div class="title">〔istkにNULL以外を指定した場合〕</div>
<p>istkにNULL以外を指定した場合，istkとistkszで指定したスタック領域は，アプリケーションで確保しておく必要がある【NGKI3221】．スタック領域をアプリケーションで確保する方法については，「<a href="#_2_15_3_カーネル共通マクロ">2.15.3 カーネル共通マクロ</a>」の節を参照すること．その方法に従わず，istkやistkszにターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI3222】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，istkとistkszで指定した非タスクコンテキスト用のスタック領域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI3223】．</p>
</div>
<div class="paragraph">
<div class="title">〔DEF_ICSにより非タスクコンテキスト用スタック領域を設定しない場合〕</div>
<p>DEF_ICSにより非タスクコンテキスト用スタック領域を設定しない場合，ターゲット定義のデフォルトのサイズのスタック領域が，コンフィギュレータにより確保される【NGKI3224】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，コンフィギュレータにより確保されるスタック領域は，カーネルドメイン向け（マルチプロセッサ対応カーネルの場合には，さらに，ターゲット定義のクラス向け）の標準メモリリージョン内に確保される【NGKI5138】．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，istkにはNULLを指定しなくてはならず，その場合でも，コンフィギュレータは非タスクコンテキスト用のスタック領域を確保しない【SSPS0149】．これは，SSP3カーネルでは，すべての処理単位が共有スタック領域を使用し，非タスクコンテキストのみが用いるスタック領域を持たないためである．そのため，DEF_ICSの役割は，非タスクコンテキストが用いるスタック領域のサイズを指定することのみとなる．istkにNULL以外を指定した場合には，E_PARエラーとなる【SSPS0150】．</p>
</div>
<div class="paragraph">
<p>共有スタック領域の設定方法については，DEF_STKの項を参照すること．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_STK</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>共有スタック領域の設定〔S〕【NGKI3228】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_STK({ size_t stksz, STK_T *stk })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ stkの記述は省略することができる【NGKI3965】．</p>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊共有スタック領域の設定情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stksz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">共有スタック領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STK_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">共有スタック領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・共有スタック領域が確保できない【NGKI3229】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・共有スタック領域が設定済み【NGKI3992】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【サポートするカーネル】</div>
<p>DEF_STKは，TOPPERS/SSP3カーネルのみがサポートする静的APIである．他のカーネルは，DEF_STKをサポートしない【NGKI3230】．</p>
</div>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した共有スタック領域の設定情報に従って，共有スタック領域を設定する【NGKI3231】．stkszに0を指定した時や，ターゲット定義の最小値よりも小さい値を指定した時には，E_PARエラーとなる【NGKI3255】．</p>
</div>
<div class="paragraph">
<p>stkszは整数定数式パラメータ，stkは一般定数式パラメータである．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI3232】．</p>
</div>
<div class="paragraph">
<p>stkをNULLとするか，静的APIにおいてstkの記述を省略した場合，stkszで指定したサイズのスタック領域が，コンフィギュレータにより確保される【NGKI3233】．stkszにターゲット定義の制約に合致しないサイズを指定した時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで確保される【NGKI3234】．</p>
</div>
<div class="paragraph">
<p>stkにNULL以外を指定した場合，stkとstkszで指定したスタック領域は，アプリケーションで確保しておく必要がある【NGKI3235】．スタック領域をアプリケーションで確保する方法については，「<a href="#_2_15_3_カーネル共通マクロ">2.15.3 カーネル共通マクロ</a>」の節を参照すること．その方法に従わず，stkやstkszにターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI3236】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，各タスクのスタック領域のサイズと，非タスクコンテキスト用のスタック領域のサイズから，共有スタック領域に必要なサイズを計算する【NGKI3237】．DEF_STKにより共有スタック領域を設定しない場合，必要なサイズの共有スタック領域が，コンフィギュレータにより確保される【NGKI3238】．</p>
</div>
<div class="paragraph">
<p>stkszに指定したスタック領域のサイズが，共有スタック領域に必要なサイズよりも小さい場合，コンフィギュレータは警告メッセージを出力する【NGKI3239】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>DEF_MPK</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>カーネルメモリプール領域の設定〔SD〕【NGKI5069】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	DEF_MPK({ size_t mpksz, MB_T *mpk })</code></pre>
</div>
</div>
<div class="paragraph">
<p>§ mpkの記述は省略することができる【NGKI5070】．</p>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊カーネルメモリプール領域の設定情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpksz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルメモリプール領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MB_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルメモリプール領域の先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5161】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・mpkszが0【NGKI5071】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足<br>
・カーネルメモリプール領域が確保できない【NGKI5072】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー<br>
・カーネルメモリプール領域が設定済み【NGKI5073】<br>
・その他の条件については機能の項を参照</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定したカーネルメモリプール領域の設定情報に従って，カーネルメモリプール領域を設定する【NGKI5074】．</p>
</div>
<div class="paragraph">
<p>mpkszは整数定数式パラメータ，mpkは一般定数式パラメータである【NGKI5075】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない【NGKI5076】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，DEF_MPKを保護ドメインの囲みの中に記述すると，その保護ドメイン向けのカーネルメモリプール領域を設定し，保護ドメインの囲みの外に記述すると，無所属向けのカーネルメモリプール領域を設定する【NGKI5162】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，DEF_MPKをクラスの囲みの中に記述すると，そのクラス向けのカーネルメモリプール領域を設定し，クラスの囲みの外に記述すると，クラス共通のカーネルメモリプール領域を設定する【NGKI5163】．</p>
</div>
<div class="paragraph">
<p>mpkをNULLとするか，静的APIにおいてmpkの記述を省略した場合，mpkszで指定したサイズのメモリ領域が，コンフィギュレータにより確保される【NGKI5077】．mpkszにターゲット定義の制約に合致しないサイズを指定した時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで確保される【NGKI5078】．</p>
</div>
<div class="paragraph">
<div class="title">〔mpkにNULL以外を指定した場合〕</div>
<p>mpkにNULL以外を指定した場合，mpkとmpkszで指定したカーネルメモリプール領域は，アプリケーションで確保しておく必要がある【NGKI5079】．カーネルメモリプール領域をアプリケーションで確保するために，次のマクロを用意している【NGKI5080】．</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT_MB_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズszのカーネルメモリプール領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROUND_MB_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要素数COUNT_MB_T(sz)のMB_T型の配列のサイズ（szを，MB_T型のサイズの倍数になるように大きい方に丸めた値）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>これらを用いて，サイズszのカーネルメモリプール領域を確保する方法は次の通り【NGKI5081】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	MB_T	&lt;カーネルメモリプール領域の変数名&gt;[COUNT_MB_T(sz)];</code></pre>
</div>
</div>
<div class="paragraph">
<p>この時，mpkszにはROUND_MB_T(sz)，mpkには&lt;カーネルメモリプール領域の変数名&gt;を指定する【NGKI5082】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，mpkやmpkszにターゲット定義の制約に合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI5083】．また，保護機能対応カーネルでは，mpkとmpkszで指定したカーネルメモリプール領域が，カーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI5084】．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様，TOPPERS新世代カーネル統合仕様との関係】</div>
<p>μITRON4.0仕様，TOPPERS新世代カーネル統合仕様に定義されていないサービスコールである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_INI</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>初期化ルーチンの登録〔S〕【NGKI3240】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_INI({ ATR iniatr, intptr_t exinf, INIRTN inirtn })</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊初期化ルーチンの登録情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iniatr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期化ルーチン属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exinf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期化ルーチンの拡張情報</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INIRTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inirtn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期化ルーチンの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・iniatrが無効【NGKI3241】<br>
・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3242】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5164】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・inirtnがプログラムの先頭番地として正しくない【NGKI3243】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した初期化ルーチンの登録情報に従って，初期化ルーチンを登録する【NGKI3244】．</p>
</div>
<div class="paragraph">
<p>iniatrは整数定数式パラメータ，exinfとinirtnは一般定数式パラメータである【NGKI3245】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応カーネルでは，クラスに属さないグローバル初期化ルーチンはマスタプロセッサで実行され，クラスに属するローカル初期化ルーチンはそのクラスの初期割付けプロセッサにより実行される．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ATT_TER</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>終了処理ルーチンの登録〔S〕【NGKI3247】</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【静的API】</div>
<div class="content">
<pre class="highlight"><code>	ATT_TER({ ATR teratr, intptr_t exinf, TERRTN terrtn })</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">【パラメータ】</div>
<p>＊終了処理ルーチンの登録情報</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">teratr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了処理ルーチン属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exinf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了処理ルーチンの拡張情報</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TERRTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">terrtn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了処理ルーチンの先頭番地</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">【エラーコード】</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性<br>
・teratrが無効【NGKI3248】<br>
・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3249】<br>
・属するクラスの指定が有効範囲外〔M〕【NGKI5165】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー<br>
・terrtnがプログラムの先頭番地として正しくない【NGKI3250】</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【機能】</div>
<p>各パラメータで指定した終了処理ルーチンの登録情報に従って，終了処理ルーチンを登録する【NGKI3251】．</p>
</div>
<div class="paragraph">
<p>teratrは整数定数式パラメータ，exinfとterrtnは一般定数式パラメータである【NGKI3252】．</p>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>マルチプロセッサ対応カーネルでは，クラスに属さないグローバル終了処理ルーチンはマスタプロセッサで実行され，クラスに属するローカル終了処理ルーチンはそのクラスの初期割付けプロセッサにより実行される．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_cfg</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>コンフィギュレーション情報の参照〔T〕</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_cfg(T_RCFG *pk_rcfg)</code></pre>
</div>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ref_cfgをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ref_cfgをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ref_cfgをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ref_cfgをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ref_cfgをサポートしない．</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 17.1428%;">
<col style="width: 82.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p><strong>ref_ver</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph lead">
<p>バージョン情報の参照〔T〕</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="title">【C言語API】</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_ver(T_RVER *pk_rver)</code></pre>
</div>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/ASP3カーネルにおける規定】</div>
<p>ASP3カーネルでは，ref_verをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/FMP3カーネルにおける規定】</div>
<p>FMP3カーネルでは，ref_verをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRP3カーネルにおける規定】</div>
<p>HRP3カーネルでは，ref_verをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/HRMP3カーネルにおける規定】</div>
<p>HRMP3カーネルでは，ref_verをサポートしない．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS/SSP3カーネルにおける規定】</div>
<p>SSP3カーネルでは，ref_verをサポートしない．</p>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_第５章_リファレンス"><a class="anchor" href="#_第５章_リファレンス"></a><a class="link" href="#_第５章_リファレンス">第５章 リファレンス</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_5_1_サービスコール一覧"><a class="anchor" href="#_5_1_サービスコール一覧"></a><a class="link" href="#_5_1_サービスコール一覧">5.1 サービスコール一覧</a></h3>
<div class="listingblock c">
<div class="title">(1) タスク管理機能</div>
<div class="content">
<pre class="highlight"><code>	ER_ID tskid = acre_tsk(const T_CTSK *pk_ctsk)					〔TD〕
	ER ercd = sac_tsk(ID tskid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_tsk(ID tskid)										〔TD〕
	ER ercd = act_tsk(ID tskid)										〔TI〕
	ER ercd = mact_tsk(ID tskid, ID prcid)							〔TIM〕
	ER_UINT	actcnt = can_act(ID tskid)								〔T〕
	ER ercd = mig_tsk(ID tskid, ID prcid)							〔TM〕
	ER ercd = get_tst(ID tskid, STAT *p_tskstat)					〔T〕
	ER ercd = chg_pri(ID tskid, PRI tskpri)							〔T〕
	ER ercd = get_pri(ID tskid, PRI *p_tskpri)						〔T〕
	ER ercd = chg_spr(ID tskid, uint_t subpri)						〔T〕
	ER ercd = get_inf(intptr_t *p_exinf)							〔T〕
	ER ercd = ref_tsk(ID tskid, T_RTSK *pk_rtsk)					〔T〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(2) タスク付属同期機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = slp_tsk()												〔T〕
	ER ercd = tslp_tsk(TMO tmout)									〔T〕
	ER ercd = wup_tsk(ID tskid)										〔TI〕
	ER_UINT wupcnt = can_wup(ID tskid)								〔T〕
	ER ercd = rel_wai(ID tskid)										〔TI〕
	ER ercd = sus_tsk(ID tskid)										〔T〕
	ER ercd = rsm_tsk(ID tskid)										〔T〕
	ER ercd = dly_tsk(RELTIM dlytim)								〔T〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(3) タスク終了機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ext_tsk()												〔T〕
	ER ercd = ras_ter(ID tskid)										〔T〕
	ER ercd = dis_ter()												〔T〕
	ER ercd = ena_ter()												〔T〕
	bool_t state = sns_ter()										〔TI〕
	ER ercd = ter_tsk(ID tskid)										〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(4) 同期・通信機能</div>
<p>セマフォ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID semid = acre_sem(const T_CSEM *pk_csem)					〔TD〕
	ER ercd = sac_sem(ID semid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_sem(ID semid)										〔TD〕
	ER ercd = sig_sem(ID semid)										〔TI〕
	ER ercd = wai_sem(ID semid)										〔T〕
	ER ercd = pol_sem(ID semid)										〔T〕
	ER ercd = twai_sem(ID semid, TMO tmout)							〔T〕
	ER ercd = ini_sem(ID semid)										〔T〕
	ER ercd = ref_sem(ID semid, T_RSEM *pk_rsem)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID flgid = acre_flg(const T_CFLG *pk_cflg)					〔TD〕
	ER ercd = sac_flg(ID flgid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_flg(ID flgid)										〔TD〕
	ER ercd = set_flg(ID flgid, FLGPTN setptn)						〔TI〕
	ER ercd = clr_flg(ID flgid, FLGPTN clrptn)						〔T〕
	ER ercd = wai_flg(ID flgid, FLGPTN waiptn,						〔T〕
									MODE wfmode, FLGPTN *p_flgptn)
	ER ercd = pol_flg(ID flgid, FLGPTN waiptn,						〔T〕
									MODE wfmode, FLGPTN *p_flgptn)
	ER ercd = twai_flg(ID flgid, FLGPTN waiptn,						〔T〕
						MODE wfmode, FLGPTN *p_flgptn, TMO tmout)
	ER ercd = ini_flg(ID flgid)										〔T〕
	ER ercd = ref_flg(ID flgid, T_RFLG *pk_rflg)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>データキュー</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID dtqid = acre_dtq(const T_CDTQ *pk_cdtq)					〔TD〕
	ER ercd = sac_dtq(ID dtqid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_dtq(ID dtqid)										〔TD〕
	ER ercd = snd_dtq(ID dtqid, intptr_t data)						〔T〕
	ER ercd = psnd_dtq(ID dtqid, intptr_t data)						〔TI〕
	ER ercd = tsnd_dtq(ID dtqid, intptr_t data, TMO tmout)			〔T〕
	ER ercd = fsnd_dtq(ID dtqid, intptr_t data)						〔TI〕
	ER ercd = rcv_dtq(ID dtqid, intptr_t *p_data)					〔T〕
	ER ercd = prcv_dtq(ID dtqid, intptr_t *p_data)					〔T〕
	ER ercd = trcv_dtq(ID dtqid, intptr_t *p_data, TMO tmout)		〔T〕
	ER ercd = ini_dtq(ID dtqid)										〔T〕
	ER ercd = ref_dtq(ID dtqid, T_RDTQ *pk_rdtq)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>優先度データキュー</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID pdqid = acre_pdq(const T_CPDQ *pk_cpdq)					〔TD〕
	ER ercd = sac_pdq(ID pdqid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_pdq(ID pdqid)										〔TD〕
	ER ercd = snd_pdq(ID pdqid, intptr_t data, PRI datapri)			〔T〕
	ER ercd = psnd_pdq(ID pdqid, intptr_t data, PRI datapri)		〔TI〕
	ER ercd = tsnd_pdq(ID pdqid, intptr_t data,						〔T〕
											PRI datapri, TMO tmout)
	ER ercd = rcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri)	〔T〕
	ER ercd = prcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri)	〔T〕
	ER ercd = trcv_pdq(ID pdqid, intptr_t *p_data,					〔T〕
										PRI *p_datapri, TMO tmout)
	ER ercd = ini_pdq(ID pdqid)										〔T〕
	ER ercd = ref_pdq(ID pdqid, T_RPDQ *pk_rpdq)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>ミューテックス</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID mtxid = acre_mtx(const T_CMTX *pk_cmtx)					〔TD〕
	ER ercd = sac_mtx(ID mtxid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_mtx(ID mtxid)										〔TD〕
	ER ercd = loc_mtx(ID mtxid)										〔T〕
	ER ercd = ploc_mtx(ID mtxid)									〔T〕
	ER ercd = tloc_mtx(ID mtxid, TMO tmout)							〔T〕
	ER ercd = unl_mtx(ID mtxid)										〔T〕
	ER ercd = ini_mtx(ID mtxid)										〔T〕
	ER ercd = ref_mtx(ID mtxid, T_RMTX *pk_rmtx)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>メッセージバッファ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID mbfid = acre_mbf(const T_CMBF *pk_cmbf)					〔TD〕
	ER ercd = sac_mbf(ID mbfid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_mbf(ID mbfid)										〔TD〕
	ER ercd = snd_mbf(ID mbfid, const void *msg, uint_t msgsz)		〔T〕
	ER ercd = psnd_mbf(ID mbfid, const void *msg, uint_t msgsz)		〔T〕
	ER ercd = tsnd_mbf(ID mbfid, const void *msg,					〔T〕
										uint_t msgsz, TMO tmout)
	ER_UINT msgsz = rcv_mbf(ID mbfid, void *msg)					〔T〕
	ER_UINT msgsz = prcv_mbf(ID mbfid, void *msg)					〔T〕
	ER_UINT msgsz = trcv_mbf(ID mbfid, void *msg, TMO tmout)		〔T〕
	ER ercd = ini_mbf(ID mbfid)										〔T〕
	ER ercd = ref_mbf(ID mbfid, T_RMBF *pk_rmbf)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>スピンロック</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID spnid = acre_spn(const T_CSPN *pk_cspn)					〔TMD〕
	ER ercd = sac_spn(ID spnid, const ACVCT *p_acvct)				〔TPMD〕
	ER ercd = del_spn(ID spnid)										〔TMD〕
	ER ercd = loc_spn(ID spnid)										〔TIM〕
	ER ercd = try_spn(ID spnid)										〔TIM〕
	ER ercd = unl_spn(ID spnid)										〔TIM〕
	ER ercd = ref_spn(ID spnid, T_RSPN *pk_rspn)					〔TM〕</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(5) メモリプール管理機能</div>
<p>固定長メモリプール</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID mpfid = acre_mpf(const T_CMPF *pk_cmpf)					〔TD〕
	ER ercd = sac_mpf(ID mpfid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_mpf(ID mpfid)										〔TD〕
	ER ercd = get_mpf(ID mpfid, void **p_blk)						〔T〕
	ER ercd = pget_mpf(ID mpfid, void **p_blk)						〔T〕
	ER ercd = tget_mpf(ID mpfid, void **p_blk, TMO tmout)			〔T〕
	ER ercd = rel_mpf(ID mpfid, void *blk)							〔T〕
	ER ercd = ini_mpf(ID mpfid)										〔T〕
	ER ercd = ref_mpf(ID mpfid, T_RMPF *pk_rmpf)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(6) 時間管理機能</div>
<p>システム時刻管理</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER ercd = set_tim(SYSTIM systim)								〔T〕
	ER ercd = get_tim(SYSTIM *p_systim)								〔T〕
	ER ercd = adj_tim(int32_t adjtim)								〔T〕
	ER ercd = set_dft(int32_t drift)								〔T〕
	HRTCNT hrtcnt = fch_hrt()										〔TI〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>周期通知</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID cycid = acre_cyc(const T_CCYC *pk_ccyc)					〔TD〕
	ER ercd = sac_cyc(ID cycid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_cyc(ID cycid)										〔TD〕
	ER ercd = sta_cyc(ID cycid)										〔T〕
	ER ercd = msta_cyc(ID cycid, ID prcid)							〔TM〕
	ER ercd = stp_cyc(ID cycid)										〔T〕
	ER ercd = ref_cyc(ID cycid, T_RCYC *pk_rcyc)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>アラーム通知</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER_ID almid = acre_alm(const T_CALM *pk_calm)					〔TD〕
	ER ercd = sac_alm(ID almid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_alm(ID almid)										〔TD〕
	ER ercd = sta_alm(ID almid, RELTIM almtim)						〔TI〕
	ER ercd = msta_alm(ID almid, RELTIM almtim, ID prcid)			〔TIM〕
	ER ercd = stp_alm(ID almid)										〔TI〕
	ER ercd = ref_alm(ID almid, T_RALM *pk_ralm)					〔T〕</code></pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	ER ercd = sta_ovr(ID tskid, PRCTIM ovrtim)						〔TI〕
	ER ercd = stp_ovr(ID tskid)										〔TI〕
	ER ercd = ref_ovr(ID tskid, T_ROVR *pk_rovr)					〔T〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(7) システム状態管理機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_sys(const ACVCT *p_acvct)							〔TPD〕
	ER ercd = rot_rdq(PRI tskpri)									〔TI〕
	ER ercd = mrot_rdq(ID schedno, PRI tskpri)						〔TIP｜TIM〕
	ER ercd = get_tid(ID *p_tskid)									〔TI〕
	ER ercd = get_did(ID *p_domid)									〔TP〕
	ER ercd = get_pid(ID *p_prcid)									〔TIM〕
	ER ercd = get_lod(PRI tskpri, uint_t *p_load)					〔T〕
	ER ercd = mget_lod(ID schedno, PRI tskpri, uint_t *p_load)		〔TP｜TM〕
	ER ercd = get_nth(PRI tskpri, uint_t nth, ID *p_tskid)			〔T〕
	ER ercd = mget_nth(ID schedno, PRI tskpri, uint_t nth, ID *p_tskid)
																	〔TP｜TM〕
	ER ercd = loc_cpu()												〔TI〕
	ER ercd = unl_cpu()												〔TI〕
	ER ercd = dis_dsp()												〔T〕
	ER ercd = ena_dsp()												〔T〕
	bool_t state = sns_ctx()										〔TI〕
	bool_t state = sns_loc()										〔TI〕
	bool_t state = sns_dsp()										〔TI〕
	bool_t state = sns_dpn()										〔TI〕
	bool_t state = sns_ker()										〔TI〕
	ER ercd = ext_ker()												〔TI〕
	ER ercd = ref_sys(T_RSYS *pk_rsys)								〔T〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(8) メモリオブジェクト管理機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = att_mem(const T_AMEM *pk_amem)						〔TPD〕
	ER ercd = att_pma(const T_AMEM *pk_apma)						〔TPD〕
	ER ercd = sac_mem(const void *base, const ACVCT *p_acvct)		〔TPD〕
	ER ercd = det_mem(const void *base)								〔TPD〕
	ER ercd = prb_mem(const void *base, size_t size,				〔TP〕
										ID tskid, MODE pmmode)
	ER ercd = ref_mem(const void *addr, T_RMEM *pk_rmem)			〔TP〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(9) 割込み管理機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = cfg_int(INTNO intno, const T_CINT *pk_cint)			〔TD〕
	ER_ID isrid = acre_isr(const T_CISR *pk_cisr)					〔TD〕
	ER ercd = sac_isr(ID isrid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = del_isr(ID isrid)										〔TD〕
	ER ercd = ref_isr(ID isrid, T_RISR *pk_risr)					〔T〕
	ER ercd = dis_int(INTNO intno)									〔TI〕
	ER ercd = ena_int(INTNO intno)									〔TI〕
	ER ercd = clr_int(INTNO intno)									〔TI〕
	ER ercd = ras_int(INTNO intno)									〔TI〕
	ER_BOOL state = prb_int(INTNO intno)							〔TI〕
	ER ercd = ref_int(INTNO intno, T_RINT *pk_rint)					〔T〕
	ER ercd = chg_ipm(PRI intpri)									〔T〕
	ER ercd = get_ipm(PRI *p_intpri)								〔T〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(10) CPU例外管理機能</div>
<div class="content">
<pre class="highlight"><code>	bool_t state = xsns_dpn(void *p_excinf)							〔TI〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(11) 拡張サービスコール管理機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = def_svc(FN fncd, const T_DSVC *pk_dsvc)				〔TPD〕
	ER_UINT ercd = cal_svc(FN fncd, intptr_t par1, intptr_t par2,	〔TIP〕
						intptr_t par3, intptr_t par4, intptr_t par5)</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(12) 保護ドメイン管理機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = sac_dom(ID domid, const ACVCT *p_acvct)				〔TPD〕
	ER ercd = chg_som(ID somid)										〔TP〕
	ER ercd = get_som(ID *p_somid)									〔TP〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(13) システム構成管理機能</div>
<div class="content">
<pre class="highlight"><code>	ER ercd = ref_cfg(T_RCFG *pk_rcfg)								〔T〕
	ER ercd = ref_ver(T_RVER *pk_rver)								〔T〕</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_静的api一覧"><a class="anchor" href="#_5_2_静的api一覧"></a><a class="link" href="#_5_2_静的api一覧">5.2 静的API一覧</a></h3>
<div class="paragraph">
<div class="title">(1) タスク管理機能</div>
<p>＊保護機能対応でないカーネルの場合</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_TSK(ID tskid, { ATR tskatr, intptr_t exinf, TASK task,		〔S〕
							PRI itskpri, size_t stksz, STK_T *stk })</code></pre>
</div>
</div>
<div class="paragraph">
<p>＊保護機能対応カーネルの場合</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_TSK(ID tskid, { ATR tskatr, intptr_t exinf, TASK task,		〔SP〕
							PRI itskpri, size_t stksz, STK_T *stk,
							size_t sstksz, STK_T *sstk })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	AID_TSK(uint_t notsk)											〔SD〕
	SAC_TSK(ID tskid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })
	DEF_EPR(ID tskid, { PRI exepri })								〔S〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(2) タスク付属同期機能</div>
<div class="content">
<pre class="highlight"><code>	なし</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(3) タスク終了機能</div>
<div class="content">
<pre class="highlight"><code>	なし</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(4) 同期・通信機能</div>
<p>セマフォ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_SEM(ID semid, { ATR sematr, uint_t isemcnt, uint_t maxsem })〔S〕
	AID_SEM(uint_t nosem)											〔SD〕
	SAC_SEM(ID semid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_FLG(ID flgid, { ATR flgatr, FLGPTN iflgptn })				〔S〕
	AID_FLG(uint_t noflg)											〔SD〕
	SAC_FLG(ID flgid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>データキュー</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_DTQ(ID dtqid, { ATR dtqatr, uint_t dtqcnt, void *dtqmb })	〔S〕
	AID_DTQ(uint_t nodtq)											〔SD〕
	SAC_DTQ(ID dtqid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>優先度データキュー</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_PDQ(ID pdqid, { ATR pdqatr, uint_t pdqcnt,					〔S〕
										PRI maxdpri, void *pdqmb })
	AID_PDQ(uint_t nopdq)											〔SD〕
	SAC_PDQ(ID pdqid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>ミューテックス</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_MTX(ID mtxid, { ATR mtxatr, PRI ceilpri })					〔S〕
	AID_MTX(uint_t nomtx)											〔SD〕
	SAC_MTX(ID mtxid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>メッセージバッファ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_MBF(ID mbfid, { ATR mbfatr, uint_t maxmsz,
									size_t mbfsz, void *mbfmb })	〔S〕
	AID_MBF(uint_t nombf)											〔SD〕
	SAC_MBF(ID mbfid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>スピンロック</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_SPN(ID spnid, { ATR spnatr })								〔SM〕
	AID_SPN(uint_t nospn)											〔SMD〕
	SAC_SPN(ID spnid, { ACPTN acptn1, ACPTN acptn2,					〔SPM〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(5) メモリプール管理機能</div>
<p>固定長メモリプール</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_MPF(ID mpfid, { ATR mpfatr, uint_t blkcnt, uint_t blksz,	〔S〕
										MPF_T *mpf, void *mpfmb })
	AID_MPF(uint_t nompf)											〔SD〕
	SAC_MPF(ID mpfid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(6) 時間管理機能</div>
<p>周期通知</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_CYC(ID cycid, { ATR cycatr, ＜通知方法の指定＞,				〔S〕
									RELTIM cyctim, RELTIM cycphs })
	AID_CYC(uint_t nocyc)											〔SD〕
	SAC_CYC(ID cycid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>アラーム通知</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	CRE_ALM(ID almid, { ATR almatr, ＜通知方法の指定＞ })			〔S〕
	AID_ALM(uint_t noalm)											〔SD〕
	SAC_ALM(ID almid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	DEF_OVR({ ATR ovratr, OVRHDR ovrhdr })							〔S〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(7) システム状態管理機能</div>
<div class="content">
<pre class="highlight"><code>	SAC_SYS({ ACPTN acptn1, ACPTN acptn2,							〔SP〕
									ACPTN acptn3, ACPTN acptn4 })
	ENA_SPR(PRI tskpri)												〔S〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(8) メモリオブジェクト管理機能</div>
<div class="content">
<pre class="highlight"><code>	ATT_REG(char *regname, { ATR regatr, void *base, size_t size })	〔SP〕
	DEF_SRG(char *stdrom, char *stdram,								〔SP〕
									char *stdsrom, char *stdsram)
	ATT_SEC(char *secname, { ATR mematr, char *regname },			〔SP〕
		{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })
	ATT_MOD(char *modname,	  										〔SP〕
		{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })
	ATT_MEM({ ATR accatr, void *base, size_t size },				〔SP〕
		{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })
	ATT_PMA({ ATR accatr, void *base, size_t size, void *paddr },	〔SP〕
		{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(9) 割込み管理機能</div>
<div class="content">
<pre class="highlight"><code>	CFG_INT(INTNO intno, { ATR intatr, PRI intpri })				〔S〕
	CRE_ISR(ID isrid, { ATR isratr, intptr_t exinf,					〔S〕
								INTNO intno, ISR isr, PRI isrpri })
	AID_ISR(uint_t noisr)											〔SD〕
	SAC_ISR(ID isrid, { ACPTN acptn1, ACPTN acptn2,					〔SP〕
									ACPTN acptn3, ACPTN acptn4 })
	DEF_INH(INHNO inhno, { ATR inhatr, INTHDR inthdr })				〔S〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(10) CPU例外管理機能</div>
<div class="content">
<pre class="highlight"><code>	DEF_EXC(EXCNO excno, { ATR excatr, EXCHDR exchdr })				〔S〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(11) 拡張サービスコール管理機能</div>
<div class="content">
<pre class="highlight"><code>	DEF_SVC(FN fncd, { ATR svcatr, EXTSVC extsvc, size_t stksz })	〔SP〕</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(12) 保護ドメイン管理機能</div>
<div class="content">
<pre class="highlight"><code>	ACV_DOM({ ACPTN acptn1, ACPTN acptn2,							〔SP〕
									ACPTN acptn3, ACPTN acptn4 })
	DEF_SCY({ RELTIM scyctim })										〔SP〕
	CRE_SOM(ID somid, { ATR somatr, ID nxtsom })					〔SP〕
	ATT_TWD({ ID domid, ID somid, int_t twdord, PRCTIM twdlen,		〔SP〕
											＜通知方法の指定＞ })</code></pre>
</div>
</div>
<div class="listingblock c">
<div class="title">(13) システム構成管理機能</div>
<div class="content">
<pre class="highlight"><code>	DEF_ICS({ size_t istksz, STK_T *istk })							〔S〕
	DEF_STK({ size_t stksz, STK_T *stk })							〔S〕
	DEF_MPK({ size_t mpksz, MB_T *mpk })							〔SD〕
	ATT_INI({ ATR iniatr, intptr_t exinf, INIRTN inirtn })			〔S〕
	ATT_TER({ ATR teratr, intptr_t exinf, TERRTN terrtn })			〔S〕</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_3_データ型"><a class="anchor" href="#_5_3_データ型"></a><a class="link" href="#_5_3_データ型">5.3 データ型</a></h3>
<div class="sect3">
<h4 id="_5_3_1_toppers共通データ型"><a class="anchor" href="#_5_3_1_toppers共通データ型"></a><a class="link" href="#_5_3_1_toppers共通データ型">5.3.1 TOPPERS共通データ型</a></h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き8ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し8ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き16ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し16ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き32ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し32ビット整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き64ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し64ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号付き128ビット整数（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint128_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">符号無し128ビット整数（オプション，C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8ビット以上の符号付き整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_least8_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_t型と同じサイズの符号無し整数（C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float32_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE754準拠の32ビット単精度浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double64_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE754準拠の64ビット倍精度浮動小数点数（オプション）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">真偽値（trueまたはfalse）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16ビット以上の符号付き整数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_t型と同じサイズの符号無し整数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32ビット以上かつint_t型以上のサイズの符号付き整数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_t型と同じサイズの符号無し整数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ領域のサイズ（符号無し整数）（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポインタを格納できるサイズの符号付き整数（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uintptr_t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">intptr_t型と同じサイズの符号無し整数（C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">機能コード（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコード（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトのID番号（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト属性（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトの状態（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MODE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコールの動作モード（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムアウト指定（符号無し32ビット整数，単位はマイクロ秒，uint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">相対時間（符号無し32ビット整数，単位はマイクロ秒，uint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SYSTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻（符号無し整数，単位はマイクロ秒，uint64_tまたはuint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRCTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロセッサ時間（符号無し整数，単位はマイクロ秒，uint32_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高分解能タイマのカウント値（符号無し32ビット整数，uint32_tに定義）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プログラムの起動番地（型の定まらない関数ポインタ）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_BOOL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードまたは真偽値（符号付き整数，int_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードまたはID番号（符号付き整数，int_tに定義，負のID番号は格納できない）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ER_UINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードまたは符号無し整数（符号付き整数，int_tに定義，符号無し整数を格納する場合の有効ビット数はuint_tより1ビット短い）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MB_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト管理領域を確保するためのデータ型</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アクセス許可パターン（符号無し32ビット整数，uint32_tに定義）</p></td>
</tr>
</tbody>
</table>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct acvct {		/* アクセス許可ベクタ */
		ACPTN	acptn1;			/* 通常操作1のアクセス許可パターン */
		ACPTN	acptn2;			/* 通常操作2のアクセス許可パターン */
		ACPTN	acptn3;			/* 管理操作のアクセス許可パターン */
		ACPTN	acptn4;			/* 参照操作のアクセス許可パターン */
	} ACVCT;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_3_2_カーネルの使用するデータ型"><a class="anchor" href="#_5_3_2_カーネルの使用するデータ型"></a><a class="link" href="#_5_3_2_カーネルの使用するデータ型">5.3.2 カーネルの使用するデータ型</a></h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのビットパターン（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み番号（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INHNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みハンドラ番号（符号無し整数，uint_tに定義）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXCNO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラ番号（符号無し整数，uint_tに定義）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクのメインルーチン（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMEHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムイベントハンドラ（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OVRHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラ（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みハンドラ（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXCHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラ（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXTSVC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコール（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INIRTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期化ルーチン（関数ポインタ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TERRTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了処理ルーチン（関数ポインタ）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STK_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">スタック領域を確保するためのデータ型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPF_T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプール領域を確保するためのデータ型</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_3_3_カーネルの使用するパケット形式"><a class="anchor" href="#_5_3_3_カーネルの使用するパケット形式"></a><a class="link" href="#_5_3_3_カーネルの使用するパケット形式">5.3.3 カーネルの使用するパケット形式</a></h4>
<div class="paragraph">
<div class="title">(1) タスク管理機能</div>
<p>タスクの生成情報のパケット形式【NGKI4003】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_ctsk {
		ATR			tskatr;		/* タスク属性 */
		intptr_t	exinf;		/* タスクの拡張情報 */
		TASK		task;		/* タスクのメインルーチンの先頭番地 */
		PRI			itskpri;	/* タスクの起動時優先度 */
		size_t		stksz;		/* タスクのスタック領域のサイズ */
		STK_T *		stk;		/* タスクのスタック領域の先頭番地 */
		/* 以下は，保護機能対応カーネルの場合 */
		size_t		sstksz;		/* タスクのシステムスタック領域のサイズ */
		STK_T *		sstk;		/* タスクのシステムスタック領域の先頭番地 */
	} T_CTSK;</code></pre>
</div>
</div>
<div class="paragraph">
<p>タスクの現在状態のパケット形式【NGKI4039】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rtsk {
		STAT		tskstat;	/* タスク状態 */
		PRI			tskpri;		/* タスクの現在優先度 */
		PRI			tskbpri;	/* タスクのベース優先度 */
		/* 次は，サブ優先度機能をサポートするカーネルの場合 */
		uint_t		subpri;		/* タスクのサブ優先度 */
		STAT		tskwait;	/* 待ち要因 */
		ID			wobjid;		/* 待ち対象のオブジェクトのID */
		TMO			lefttmo;	/* タイムアウトするまでの時間 */
		uint_t		actcnt;		/* 起動要求キューイング数 */
		uint_t		wupcnt;		/* 起床要求キューイング数 */
		bool_t		raster;		/* タスク終了要求状態 */
		bool_t		dister;		/* タスク終了禁止状態 */
		/* 次は，保護機能対応カーネルの場合 */
		uint_t		svclevel;	/* 拡張サービスコールのネストレベル */
		/* 以下は，マルチプロセッサ対応カーネルの場合 */
		ID			prcid;		/* 割付けプロセッサのID */
		ID			actprc		/* 次回起動時の割付けプロセッサのID */
	} T_RTSK;</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) タスク付属同期機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) タスク終了機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(4) 同期・通信機能</div>
<p>セマフォの生成情報のパケット形式【NGKI4007】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_csem {
		ATR			sematr;		/* セマフォ属性 */
		uint_t		isemcnt;	/* セマフォの初期資源数 */
		uint_t		maxsem;		/* セマフォの最大資源数 */
	} T_CSEM;</code></pre>
</div>
</div>
<div class="paragraph">
<p>セマフォの現在状態のパケット形式【NGKI4008】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rsem {
		ID			wtskid;		/* セマフォの待ち行列の先頭のタスクのID番号 */
		uint_t		semcnt;		/* セマフォの資源数 */
	} T_RSEM;</code></pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグの生成情報のパケット形式【NGKI4009】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cflg {
		ATR			flgatr;		/* イベントフラグ属性 */
		FLGPTN		iflgptn;	/* イベントフラグの初期ビットパターン */
	} T_CFLG;</code></pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグの現在状態のパケット形式【NGKI4010】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rflg {
		ID			wtskid;		/* イベントフラグの待ち行列の先頭のタス
								   クのID番号 */
		FLGPTN		flgptn;		/* イベントフラグのビットパターン */
	} T_RFLG;</code></pre>
</div>
</div>
<div class="paragraph">
<p>データキューの生成情報のパケット形式【NGKI4011】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cdtq {
		ATR			dtqatr;		/* データキュー属性 */
		uint_t		dtqcnt;		/* データキュー管理領域に格納できるデータ数 */
		void *		dtqmb;		/* データキュー管理領域の先頭番地 */
	} T_CDTQ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>データキューの現在状態のパケット形式【NGKI4012】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rdtq {
		ID			stskid;		/* データキューの送信待ち行列の先頭のタ
								   スクのID番号 */
		ID			rtskid;		/* データキューの受信待ち行列の先頭のタ
								   スクのID番号 */
		uint_t		sdtqcnt;	/* データキュー管理領域に格納されている
								   データの数 */
	} T_RDTQ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>優先度データキューの生成情報のパケット形式【NGKI4013】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cpdq {
		ATR			pdqatr;		/* 優先度データキュー属性 */
		uint_t		pdqcnt;		/* 優先度データキュー管理領域に格納でき
								   るデータ数 */
		PRI			maxdpri;	/* 優先度データキューに送信できるデータ
								   優先度の最大値 */
		void *		pdqmb;		/* 優先度データキュー管理領域の先頭番地 */
	} T_CPDQ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>優先度データキューの現在状態のパケット形式【NGKI4014】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rpdq {
		ID			stskid;		/* 優先度データキューの送信待ち行列の先
								   頭のタスクのID番号 */
		ID			rtskid;		/* 優先度データキューの受信待ち行列の先
								   頭のタスクのID番号 */
		uint_t		spdqcnt;	/* 優先度データキュー管理領域に格納され
								   ているデータの数 */
	} T_RPDQ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ミューテックスの生成情報のパケット形式【NGKI4017】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cmtx {
		ATR			mtxatr;		/* ミューテックス属性 */
		PRI			ceilpri;	/* ミューテックスの上限優先度 */
	} T_CMTX;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ミューテックスの現在状態のパケット形式【NGKI4018】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rmtx {
		ID			htskid;		/* ミューテックスをロックしているタス
								   クのID番号 */
		ID			wtskid;		/* ミューテックスの待ち行列の先頭のタ
								   スクのID番号 */
	} T_RMTX;</code></pre>
</div>
</div>
<div class="paragraph">
<p>メッセージバッファの生成情報のパケット形式【NGKI4037】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cmbf {
		ATR			mbfatr;		/* メッセージバッファ属性 */
		uint_t		maxmsz;		/* メッセージバッファの最大メッセージ
								   サイズ（バイト数）*/
		size_t		mbfsz;		/* メッセージバッファ管理領域のサイズ
								   （バイト数）*/
		void *		mbfmb;		/* メッセージバッファ管理領域の先頭番地 */
	} T_CMBF;</code></pre>
</div>
</div>
<div class="paragraph">
<p>メッセージバッファの現在状態のパケット形式【NGKI4038】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rmbf {
		ID		stskid;			/* メッセージバッファの送信待ち行列の
								   先頭のタスクのID番号 */
		ID		rtskid;			/* メッセージバッファの受信待ち行列の
								   先頭のタスクのID番号 */
		uint_t	smbfcnt;		/* メッセージバッファ管理領域に格納さ
								   れているメッセージの数 */
		size_t	fmbfsz;			/* メッセージバッファ管理領域中の空き
								   領域のサイズ */
	} T_RMBF;</code></pre>
</div>
</div>
<div class="paragraph">
<p>スピンロックの生成情報のパケット形式【NGKI4019】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cspn {
		ATR			spnatr;		/* スピンロック属性 */
	} T_CSPN;</code></pre>
</div>
</div>
<div class="paragraph">
<p>スピンロックの現在状態のパケット形式【NGKI4020】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rspn {
		STAT		spnstat		/* スピンロックのロック状態 */
	} T_RSPN;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(5) メモリプール管理機能</div>
<p>固定長メモリプールの生成情報のパケット形式【NGKI4021】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cmpf {
		ATR			mpfatr;		/* 固定長メモリプール属性 */
		uint_t		blkcnt;		/* 獲得できる固定長メモリブロックの数 */
		uint_t		blksz;		/* 固定長メモリブロックのサイズ */
		MPF_T *		mpf;		/* 固定長メモリプール領域の先頭番地 */
		void *		mpfmb;		/* 固定長メモリプール管理領域の先頭番地 */
	} T_CMPF;</code></pre>
</div>
</div>
<div class="paragraph">
<p>固定長メモリプールの現在状態のパケット形式【NGKI4022】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rmpf {
		ID			wtskid;		/* 固定長メモリプールの待ち行列の先頭の
								   タスクのID番号 */
		uint_t		fblkcnt;	/* 固定長メモリプール領域の空きメモリ領
								   域に割り付けることができる固定長メモ
								   リブロックの数 */
	} T_RMPF;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(6) 時間管理機能</div>
<p>タイムイベントの通知方法のパケット形式［NGKI3722］</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct {
		intptr_t	exinf;		/* タイムイベントハンドラの拡張情報 */
		TMEHDR		tmehdr;		/* タイムイベントハンドラの先頭番地 */
	} T_NFY_HDR;

	typedef struct {
		intptr_t	*p_var;		/* 変数の番地 */
		intptr_t	value;		/* 設定する値 */
	} T_NFY_VAR;

	typedef struct {
		intptr_t	*p_var;		/* 変数の番地 */
	} T_NFY_IVAR;

	typedef struct {
		ID			tskid;		/* タスクID */
	} T_NFY_TSK;

	typedef struct {
		ID			semid;		/* セマフォID */
	} T_NFY_SEM;

	typedef struct {
		ID			flgid;		/* イベントフラグID */
		FLGPTN		flgptn;		/* セットするビットパターン */
	} T_NFY_FLG;

	typedef struct {
		ID			dtqid;		/* データキューID */
		intptr_t	data;		/* 送信する値 */
	} T_NFY_DTQ;

	typedef struct {
		intptr_t	*p_var;		/* 変数の番地 */
	} T_ENFY_VAR;

	typedef struct {
		ID			dtqid;		/* データキューID */
	} T_ENFY_DTQ;

	typedef struct {
		MODE	nfymode;		/* 通知処理モード */
		union {					/* タイムイベントの通知に関する付随情報 */
			T_NFY_HDR	handler;	/* タイムイベントハンドラの呼出しの場合 */
			T_NFY_VAR	setvar;		/* 変数の設定の場合 */
			T_NFY_IVAR	incvar;		/* 変数のインクリメントの場合 */
			T_NFY_TSK	acttsk;		/* タスクの起動の場合 */
			T_NFY_TSK	wuptsk;		/* タスクの起床の場合 */
			T_NFY_SEM	sigsem;		/* セマフォの資源の返却の場合 */
			T_NFY_FLG	setflg;		/* イベントフラグのセットの場合 */
			T_NFY_DTQ	snddtq;		/* データキューへの送信の場合 */
		} nfy;
		union {					/* エラーの通知に関する付随情報 */
			T_ENFY_VAR	setvar;		/* 変数の設定の場合 */
			T_NFY_IVAR	incvar;		/* 変数のインクリメントの場合 */
			T_NFY_TSK	acttsk;		/* タスクの起動の場合 */
			T_NFY_TSK	wuptsk;		/* タスクの起床の場合 */
			T_NFY_SEM	sigsem;		/* セマフォの資源の返却の場合 */
			T_NFY_FLG	setflg;		/* イベントフラグのセットの場合 */
			T_ENFY_DTQ	snddtq;		/* データキューへの送信の場合 */
		} enfy;
	} T_NFYINFO;</code></pre>
</div>
</div>
<div class="paragraph">
<p>周期通知の生成情報のパケット形式【NGKI4041】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_ccyc {
		ATR			cycatr;		/* 周期通知属性 */
		T_NFYINFO	nfyinfo;	/* 周期通知の通知方法 */
		RELTIM		cyctim;		/* 周期通知の通知周期 */
		RELTIM		cycphs;		/* 周期通知の通知位相 */
	} T_CCYC;</code></pre>
</div>
</div>
<div class="paragraph">
<p>周期通知の現在状態のパケット形式【NGKI4024】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rcyc {
		STAT		cycstat;	/* 周期通知の動作状態 */
		RELTIM		lefttim;	/* 次回通知時刻までの相対時間 */
		/* 以下は，マルチプロセッサ対応カーネルの場合 */
		ID			prcid;		/* 割付けプロセッサのID */
	} T_RCYC;</code></pre>
</div>
</div>
<div class="paragraph">
<p>アラーム通知の生成情報のパケット形式【NGKI4042】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_calm {
		ATR			almatr;		/* アラーム通知属性 */
		T_NFYINFO	nfyinfo;	/* アラーム通知の通知方法 */
	} T_CALM;</code></pre>
</div>
</div>
<div class="paragraph">
<p>アラーム通知の現在状態のパケット形式【NGKI4026】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_ralm {
		STAT		almstat;	/* アラーム通知の動作状態 */
		RELTIM		lefttim;	/* 通知時刻までの相対時間 */
		/* 以下は，マルチプロセッサ対応カーネルの場合 */
		ID			prcid;		/* 割付けプロセッサのID */
	} T_RALM;</code></pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラの現在状態のパケット形式【NGKI4028】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rovr {
		STAT	ovrstat;		/* オーバランハンドラの動作状態 */
		PRCTIM	leftotm;		/* 残りプロセッサ時間 */
	} T_ROVR;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(7) システム状態管理機能</div>
<p>システムの現在状態のパケット形式</p>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<div class="title">(8) メモリオブジェクト管理機能</div>
<p>メモリオブジェクトの登録情報のパケット形式【NGKI4029】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_amem {
		ATR			accatr;		/* メモリオブジェクトアクセス属性 */
		void *		base;		/* 登録するメモリ領域の先頭番地 */
		size_t		size;		/* 登録するメモリ領域のサイズ（バイト数）*/
	} T_AMEM;</code></pre>
</div>
</div>
<div class="paragraph">
<p>物理メモリ領域の登録情報のパケット形式【NGKI4030】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_apma {
		ATR			accatr;		/* メモリオブジェクトアクセス属性 */
		void *		base;		/* 登録するメモリ領域の先頭番地 */
		size_t		size;		/* 登録するメモリ領域のサイズ（バイト数）*/
		void *		paddr;		/* 登録するメモリ領域の物理アドレスの先頭
								   番地 */
	} T_APMA;</code></pre>
</div>
</div>
<div class="paragraph">
<p>メモリオブジェクトの現在状態のパケット形式【NGKI4044】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_rmem {
		ATR			accatr;		/* メモリオブジェクトアクセス属性 */
		void *		base;		/* メモリオブジェクトの先頭番地 */
		size_t		size;		/* メモリオブジェクトのサイズ（バイト数） */
	} T_RMEM;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">(9) 割込み管理機能</div>
<p>割込み要求ラインの属性の設定情報のパケット形式【NGKI4031】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cint {
		ATR			intatr;		/* 割込み要求ライン属性 */
		PRI			intpri;		/* 割込み優先度 */
	} T_CINT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>割込みサービスルーチンの生成情報のパケット形式【NGKI4032】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_cisr {
		ATR			isratr;		/* 割込みサービスルーチン属性 */
		intptr_t	exinf;		/* 割込みサービスルーチンの拡張情報 */
		INTNO		intno;		/* 割込みサービスルーチンを登録する割込
								   み番号 */
		ISR			isr;		/* 割込みサービスルーチンの先頭番地 */
		PRI			isrpri;		/* 割込みサービスルーチン優先度 */
	} T_CISR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>割込みサービスルーチンの現在状態のパケット形式</p>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<p>割込み要求ラインの現在状態のパケット形式</p>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(10) CPU例外管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(11) 拡張サービスコール管理機能</div>
<p>拡張サービスコールの定義情報のパケット形式【NGKI4035】</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	typedef struct t_dsvc {
		ATR			svcatr;		/* 拡張サービスコール属性 */
		EXTSVC		extsvc;		/* 拡張サービスコールの先頭番地 */
		size_t		stksz;		/* 拡張サービスコールで使用するスタック
								   サイズ */
	} T_DSVC;</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(12) 保護ドメイン管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(13) システム構成管理機能</div>
<p>コンフィギュレーション情報のパケット形式</p>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
<div class="paragraph">
<p>バージョン情報のパケット形式</p>
</div>
<div class="paragraph">
<p>§未完成</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_4_定数とマクロ"><a class="anchor" href="#_5_4_定数とマクロ"></a><a class="link" href="#_5_4_定数とマクロ">5.4 定数とマクロ</a></h3>
<div class="sect3">
<h4 id="_5_4_1_toppers共通定数"><a class="anchor" href="#_5_4_1_toppers共通定数"></a><a class="link" href="#_5_4_1_toppers共通定数">5.4.1 TOPPERS共通定数</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) 一般定数</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無効ポインタ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">真</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">偽</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正常終了</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 整数型と浮動小数点型に格納できる最大値と最小値</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT8_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8_tに格納できる最小値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint8_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT16_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT16_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_tに格納できる最小値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT16_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT32_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_tに格納できる最小値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT64_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT64_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_tに格納できる最小値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT64_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT128_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT128_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_tに格納できる最小値（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT128_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint128_tに格納できる最大値（オプション，C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_LEAST8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_LEAST8_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_tに格納できる最小値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT_LEAST8_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_least8_tに格納できる最大値（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_tに格納できる最小値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONG_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONG_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long_tに格納できる最小値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ULONG_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong_tに格納できる最大値（C90準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIZE_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_tに格納できる最大値（C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOAT32_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float32_tに格納できる最小の正規化された正の浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOAT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float32_tに格納できる表現可能な最大の有限浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE64_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double64_tに格納できる最小の正規化された正の浮動小数点数（オプション）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE64_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double64_tに格納できる表現可能な最大の有限浮動小数点数（オプション）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) 整数型のビット数</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char型のビット数（C90準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(4) オブジェクト属性</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト属性を指定しない</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(5) タイムアウト指定</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 22.8571%;">
<col style="width: 54.2859%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO_POL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO_FEVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">永久待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMO_NBLK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_MAX-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ノンブロッキング</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) アクセス許可パターン</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TACP_KERNEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルドメインのみにアクセスを許可</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TACP_SHARED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~0U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">すべての保護ドメインにアクセスを許可</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_4_2_toppers共通マクロ"><a class="anchor" href="#_5_4_2_toppers共通マクロ"></a><a class="link" href="#_5_4_2_toppers共通マクロ">5.4.2 TOPPERS共通マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) 整数定数を作るマクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT8_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int_least8_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT8_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_least8_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT16_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT16_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT32_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT32_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32_t型の定数を作るマクロ（C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT64_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT64_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT128_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int128_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT128_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint128_t型の定数を作るマクロ（オプション，C99準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UINT_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint_t型の定数を作るマクロ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ULONG_C(val)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ulong_t型の定数を作るマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 型に関する情報を取り出すためのマクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offsetof(structure, field)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">構造体structure中のフィールドfieldのバイト位置を返すマクロ（C90準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alignof(type)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">型typeのアラインメント単位を返すマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALIGN_TYPE(addr, type)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">番地addrが型typeに対してアラインしているかどうかを返すマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) assertマクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assert(exp)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">expが成立しているかを検査するマクロ（C90準拠）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(4) コンパイラの拡張機能のためのマクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インライン関数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ファイルローカルなインライン関数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インラインアセンブラ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">インラインアセンブラ（最適化抑止）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">throw()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">例外を発生しない関数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NoReturn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターンしない関数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(5) エラーコード生成・分解マクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERCD(mercd, sercd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メインエラーコードmercdとサブエラーコードsercdから，エラーコードを生成するためのマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MERCD(ercd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードercdからメインエラーコードを抽出するためのマクロ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERCD(ercd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エラーコードercdからサブエラーコードを抽出するためのマクロ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) アクセス許可パターン生成マクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TACP(domid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domidで指定される保護ドメインに属する処理単位のみにアクセスを許可するアクセス許可パターン</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_4_3_カーネル共通定数"><a class="anchor" href="#_5_4_3_カーネル共通定数"></a><a class="link" href="#_5_4_3_カーネル共通定数">5.4.3 カーネル共通定数</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) オブジェクト属性</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの待ち行列をタスクの優先度順に</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 保護ドメインID</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDOM_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">呼び出した処理単位が属する保護ドメイン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDOM_KERNEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルドメイン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDOM_NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">無所属（保護ドメインに属さない）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) その他のカーネル共通定数</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSOM_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム周期の停止</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCLS_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自タスクの属するクラス</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRC_NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割付けプロセッサの指定がない</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRC_INI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期割付けプロセッサ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSK_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自タスク指定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSK_NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">該当するタスクがない</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRI_SELF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自タスクのベース優先度の指定</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPRI_INI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動時優先度の指定</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIPM_ENAALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度マスク全解除</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_4_4_カーネル共通マクロ"><a class="anchor" href="#_5_4_4_カーネル共通マクロ"></a><a class="link" href="#_5_4_4_カーネル共通マクロ">5.4.4 カーネル共通マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) オブジェクト属性を作るマクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DOM(domid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domidで指定される保護ドメインに属する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_CLS(clsid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clsidで指定されるクラスに属する</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) サービスコールの呼出し方法を指定するマクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVC_CALL(svc)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">svcで指定されるサービスコールを関数呼出しによって呼び出すための名称</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) スケジューリング単位番号を構成するマクロ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCHEDNO(prcid, domid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マルチプロセッサ対応カーネルにおけるスケジューリング単位番号prcidと，保護機能対応カーネルにおけるスケジューリング単位番号domidから，保護機能とマルチプロセッサの両方に対応するカーネルにおけるスケジューリング単位番号を構成するためのマクロ</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_4_5_カーネルの機能毎の定数"><a class="anchor" href="#_5_4_5_カーネルの機能毎の定数"></a><a class="link" href="#_5_4_5_カーネルの機能毎の定数">5.4.5 カーネルの機能毎の定数</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) タスク管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_ACT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの生成時にタスクを起動する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOACTQUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクに対する起動要求をキューイングしない</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_RSTR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成するタスクを制約タスクとする</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_FPU</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPUレジスタをコンテキストに含める</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_RUN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_RDY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行可能状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_WAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_SUS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x08U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">強制待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_WAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0cU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">二重待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTS_DMT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">休止状態</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SLP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0001U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">起床待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_DLY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0002U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">時間経過待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0004U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの資源獲得待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_FLG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0008U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグ待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0010U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューへの送信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_RDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0020U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューからの受信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SPDQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0100U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューへの送信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_RPDQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0200U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキューからの受信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_MTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0080U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックスのロック待ち状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_SMBF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0400U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファへの送信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_RMBF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0800U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファからの受信待ち</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TTW_MPF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2000U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリブロックの獲得待ち</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_FPUの値は，ターゲット定義とする．</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) タスク付属同期機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) タスク終了機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(4) 同期・通信機能</div>
<p>イベントフラグ</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_WMUL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">複数のタスクが待つのを許す</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_CLR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの待ち解除時にイベントフラグをクリアする</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWF_ORW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのOR待ちモード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWF_ANDW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのAND待ちモード</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ミューテックス</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_CEILING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度上限ミューテックスとする．待ち行列をタスクの優先度順にする</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>スピンロック</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NATIVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エミュレーションによって実現してはならない</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSPN_UNL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取得されていない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSPN_LOC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取得されている状態</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(5) メモリプール管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) 時間管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_HANDLER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムイベントハンドラの呼出しによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SETVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数の設定による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_INCVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数のインクリメントによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_ACTTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_WUPTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起床による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SIGSEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x05U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの返却による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SETFLG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x06U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのセットによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNFY_SNDDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x07U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューへの送信による通知</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SETVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数の設定による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_INCVAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変数のインクリメントによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_ACTTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_WUPTSK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起床による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SIGSEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x50U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの返却による通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SETFLG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x60U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのセットによる通知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TENFY_SNDDTQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x70U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキューへの送信による通知</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>周期通知</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知の生成時に周期通知を動作開始する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_PHS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知を生成した時刻を基準時刻とする</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCYC_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知が動作していない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCYC_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知が動作している状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>アラーム通知</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TALM_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知が動作していない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TALM_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知が動作している状態</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOVR_STP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラが動作していない状態</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOVR_STA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラが動作している状態</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(7) システム状態管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(8) メモリオブジェクト管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOWRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">書込みアクセス禁止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOREAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">読出しアクセス禁止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_EXEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行アクセス許可</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_MEMINI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x08U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリの初期化を行う</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_MEMZERO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリのクリアを行う</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_SDATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ショートデータ領域に配置</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_UNCACHE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キャッシュ禁止</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_IODEV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x80U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">周辺デバイスの領域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_WTHROUGH</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ライトスルーキャッシュを用いる</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_ATTMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1000U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATT_MEM／att_mem／ATT_PMA／att_pmaで登録されたメモリオブジェクト</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_USTACK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x2000U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ユーザスタック領域</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPM_WRITE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">書込みアクセス権のチェック</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPM_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">読出しアクセス権のチェック</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TPM_EXEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行アクセス権のチェック</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_WTHROUGHの値は，ターゲット定義とする．</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>標準のメモリオブジェクト属性</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TEXTSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">テキストセクション（textセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_RODATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">リードオンリーデータセクション（rodataセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">初期化データセクション（dataセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_BSSSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ゼロ初期化データセクション（bssセクション）に設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOINITSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非初期化データセクションに設定する標準的なメモリオブジェクト属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_LOSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置のみを行うセクションに設定する標準的なメモリオブジェクト属性</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">標準のメモリオブジェクト属性は，ターゲット定義で別に規定がない限り</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">は，次の通りに定義される．</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_TEXTSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NOWRITE|TA_EXEC)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_RODATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NOWRITE)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DATASEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_MEMINI)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_BSSSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_MEMZERO)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NOINITSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NULL)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_LOSEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(TA_NOWRITE|TA_NOREAD)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(9) 割込み管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_ENAINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み要求禁止フラグをクリア</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_EDGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">エッジトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_POSEDGE</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポジティブエッジトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NEGEDGE</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ネガティブエッジトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_BOTHEDGE</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">両エッジトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_LOWLEVEL</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローレベルトリガ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_HIGHLEVEL</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ハイレベルトリガ</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 11.4285%;">
<col style="width: 60.0002%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_NONKERNEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネル管理外の割込み</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_POSEDGE，TA_NEGEDGE，TA_BOTHEDGE，TA_LOWLEVEL，TA_HIGHLEVELの値</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">は，ターゲット定義とする．</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(10) CPU例外管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DIRECT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラを直接呼び出す</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TA_DIRECTの値は，ターゲット定義とする．</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(11) 拡張サービスコール管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(12) 保護ドメイン管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(13) システム構成管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_4_6_カーネルの機能毎のマクロ"><a class="anchor" href="#_5_4_6_カーネルの機能毎のマクロ"></a><a class="link" href="#_5_4_6_カーネルの機能毎のマクロ">5.4.6 カーネルの機能毎のマクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) タスク管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT_STK_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズszのスタック領域を確保するために必要なSTK_T型の配列の要素数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROUND_STK_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要素数COUNT_STK_T(sz)のSTK_T型の配列のサイズ（szを，STK_T型のサイズの倍数になるように大きい方に丸めた値）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) タスク付属同期機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) タスク終了機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(4) 同期・通信機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_DTQMB(dtqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqcntで指定した数のデータを格納できるデータキュー管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_DTQMB(dtqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtqcntで指定した数のデータを格納できるデータキュー管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_PDQMB(pdqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqcntで指定した数のデータを格納できる優先度データキュー管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_PDQMB(pdqcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdqcntで指定した数のデータを格納できる優先度データキュー管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_MBFMB(msgcnt, msgsz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msgszで指定したサイズのメッセージを，msgcntで指定した数だけ格納できるメッセージバッファ管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_MBFMB(msgcnt, msgsz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msgszで指定したサイズのメッセージを，msgcntで指定した数だけ格納できるメッセージバッファ管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(5) メモリプール管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT_MPF_T(blksz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリブロックのサイズがblkszの固定長メモリプール領域を確保するために，固定長メモリブロック1つあたりに必要なMPF_T型の配列の要素数を求めるマクロ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROUND_MPF_T(blksz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要素数COUNT_MPF_T(blksz)のMPF_T型の配列のサイズ（blkszを，MPF_T型のサイズの倍数になるように大きい方に丸めた値）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSZ_MPFMB(blkcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blkcntで指定した数の固定長メモリブロックを管理することができる固定長メモリプール管理領域のサイズ（バイト数）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCNT_MPFMB(blkcnt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blkcntで指定した数の固定長メモリブロックを管理することができる固定長メモリプール管理領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) 時間管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(7) システム状態管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(8) メモリオブジェクト管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(9) 割込み管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(10) CPU例外管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(11) 拡張サービスコール管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(12) 保護ドメイン管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(13) システム構成管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT_MB_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サイズszのカーネルメモリプール領域を確保するために必要なMB_T型の配列の要素数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROUND_MB_T(sz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要素数COUNT_MB_T(sz)のMB_T型の配列のサイズ（szを，MB_T型のサイズの倍数になるように大きい方に丸めた値）</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_5_5_構成マクロ"><a class="anchor" href="#_5_5_構成マクロ"></a><a class="link" href="#_5_5_構成マクロ">5.5 構成マクロ</a></h3>
<div class="sect3">
<h4 id="_5_5_1_toppers共通構成マクロ"><a class="anchor" href="#_5_5_1_toppers共通構成マクロ"></a><a class="link" href="#_5_5_1_toppers共通構成マクロ">5.5.1 TOPPERS共通構成マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) 相対時間の範囲</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_RELTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">相対時間に指定できる最大値</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_5_2_カーネル共通構成マクロ"><a class="anchor" href="#_5_5_2_カーネル共通構成マクロ"></a><a class="link" href="#_5_5_2_カーネル共通構成マクロ">5.5.2 カーネル共通構成マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) サポートする機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 45.7142%;">
<col style="width: 48.5716%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_PROTECT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保護機能対応のカーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_MULTI_PRC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マルチプロセッサ対応のカーネル</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_DYNAMIC_CRE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">動的生成対応のカーネル</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) 優先度の範囲</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク優先度の最小値（＝1）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_TPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク優先度の最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) プロセッサの数</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_PRCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">プロセッサの数</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(4) 特殊な役割を持ったプロセッサ</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_MASTER_PRCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">マスタプロセッサのID番号</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(5) メモリ配置の方法</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_ML_AUTO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自動メモリ配置の場合にマクロ定義</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_ML_MANUAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">手動メモリ配置の場合にマクロ定義</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(6) バージョン情報</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_MAKER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルのメーカコード（＝0x0118）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_PRID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルの識別番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_SPVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネル仕様のバージョン番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKERNEL_PRVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">カーネルのバージョン番号</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_5_3_カーネルの機能毎の構成マクロ"><a class="anchor" href="#_5_5_3_カーネルの機能毎の構成マクロ"></a><a class="link" href="#_5_5_3_カーネルの機能毎の構成マクロ">5.5.3 カーネルの機能毎の構成マクロ</a></h4>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) タスク管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_ACTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起動要求キューイング数の最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_TSKID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるタスクの数（動的生成対応でないカーネルでは，静的APIによって登録されたタスクの数に一致）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(2) タスク付属同期機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_WUPCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの起床要求キューイング数の最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(3) タスク終了機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(4) 同期・通信機能</div>
<p>セマフォ</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_MAXSEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォの最大資源数の最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_SEMID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるセマフォの数（動的生成対応でないカーネルでは，静的APIによって登録されたセマフォの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>イベントフラグ</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TBIT_FLGPTN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグのビット数（FLGPTNの有効ビット数）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_FLGID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるイベントフラグの数（動的生成対応でないカーネルでは，静的APIによって登録されたイベントフラグの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>データキュー</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_DTQID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるデータキューの数（動的生成対応でないカーネルでは，静的APIによって登録されたデータキューの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>優先度データキュー</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_DPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データ優先度の最小値（＝1）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_DPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">データ優先度の最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_PDQID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できる優先度データキューの数（動的生成対応でないカーネルでは，静的APIによって登録された優先度データキューの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ミューテックス</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_MTXID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるミューテックスの数（動的生成対応でないカーネルでは，静的APIによって登録されたミューテックスの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>メッセージバッファ</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_MBFID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるメッセージバッファの数（動的生成対応でないカーネルでは，静的APIによって登録されたメッセージバッファの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>スピンロック</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_SPNID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるスピンロックの数（動的生成対応でないカーネルでは，静的APIによって登録されたミューテックスの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(5) メモリプール管理機能</div>
<p>固定長メモリプール</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_MPFID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できる固定長メモリプールの数（動的生成対応でないカーネルでは，静的APIによって登録された固定長メモリプールの数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">(6) 時間管理機能</div>
<p>システム時刻管理</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_ADJTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻の調整時間の最小値（＝-1,000,000）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_ADJTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム時刻の調整時間の最大値（＝1,000,000）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_DRIFT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドリフト量の最小値（＝-100,000）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_DRIFT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ドリフト量の最大値（＝100,000）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCYC_HRTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高分解能タイマのタイマ周期</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSTEP_HRTCNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">高分解能タイマのカウント値の進み幅</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>周期通知</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_CYCID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できる周期通知の数（動的生成対応でないカーネルでは，静的APIによって登録された周期通知の数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>アラーム通知</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TNUM_ALMID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登録できるアラーム通知の数（動的生成対応でないカーネルでは，静的APIによって登録されたアラーム通知の数に一致）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_OVRTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラの残りプロセッサ時間に指定できる最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 34.2857%;">
<col style="width: 60.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_OVRHDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オーバランハンドラ機能がサポートされている</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(7) システム状態管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(8) メモリオブジェクト管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_ATT_MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATT_MODがサポートされている</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_ATT_PMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATT_PMA／att_pmaがサポートされている</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(9) 割込み管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_INTPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度の最小値（最高値）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_INTPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込み優先度の最大値（最低値，＝-1）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMIN_ISRPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン優先度の最小値（＝1）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_ISRPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン優先度の最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 40%;">
<col style="width: 54.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_DIS_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_intがサポートされている</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_ENA_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_intがサポートされている</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_CLR_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clr_intがサポートされている</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_RAS_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ras_intがサポートされている</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOPPERS_SUPPORT_PRB_INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb_intがサポートされている</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(10) CPU例外管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(11) 拡張サービスコール管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_FNCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拡張サービスコールの機能番号の最大値（動的生成対応カーネルでは，登録できる拡張サービスコールの数に一致）</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(12) 保護ドメイン管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMAX_TWDTIM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タイムウィンドウの長さに指定できる最大値</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(13) システム構成管理機能</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 94.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">なし</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_5_6_エラーコード一覧"><a class="anchor" href="#_5_6_エラーコード一覧"></a><a class="link" href="#_5_6_エラーコード一覧">5.6 エラーコード一覧</a></h3>
<table class="tableblock frame-none grid-none stretch">
<caption class="title">(1) メインエラーコード</caption>
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 11.4285%;">
<col style="width: 65.7145%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_SYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">システムエラー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOSPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未サポート機能</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSFN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約機能コード</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RSATR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_PAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">パラメータエラー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不正ID番号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CTX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コンテキストエラー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_MACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリアクセス違反</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトアクセス違反</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_ILUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">サービスコール不正使用</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-33</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリ不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-34</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID番号不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NORES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">資源不足</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_OBJ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト状態エラー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_NOEXS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-42</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクト未登録</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_QOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">キューイングオーバフロー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RLWAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-49</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ち状態の強制解除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_TMOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ポーリング失敗またはタイムアウト</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_DLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-51</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの削除または再初期化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_CLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-52</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">待ちオブジェクトの状態変化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_RASTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスクの終了要求</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_WBLK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-57</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ノンブロッキング受付け</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_BOVR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-58</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">バッファオーバフロー</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E_COMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通信エラー</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_5_7_機能コード一覧ngki4040"><a class="anchor" href="#_5_7_機能コード一覧ngki4040"></a><a class="link" href="#_5_7_機能コード一覧ngki4040">5.7 機能コード一覧【NGKI4040】</a></h3>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 23.8095%;">
<col style="width: 19.0476%;">
<col style="width: 19.0476%;">
<col style="width: 19.0476%;">
<col style="width: 19.0477%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">機能コード</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">act_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tst</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can_act</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ext_tsk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ter_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_pri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_pri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_inf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x0d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slp_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tslp_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wup_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can_wup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel_wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sus_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rsm_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dly_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x1d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ras_ter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_ter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_ter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_ter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sig_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pol_sem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twai_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x2d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clr_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_flg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pol_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twai_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x39</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fsnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x3d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_pdq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x49</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_tim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adj_tim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_dft</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x4d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ploc_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tloc_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_mtx</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x51</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x59</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pget_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tget_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel_mpf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x5d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fch_hrt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_ovr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x6d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_sys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_sys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_lod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x71</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_did</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_nth</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x79</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_ctx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_loc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x7d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_dpn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_ker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ext_ker</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">att_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">det_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb_mem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x85</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">att_pma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cfg_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x8d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_ipm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_ipm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x91</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xsns_dpn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clr_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ras_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb_int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x95</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_cfg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_ver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_dom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x9d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_som</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_som</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xa1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xa5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xa9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xb1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xb5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xb9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xc1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xc5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xc9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xd1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xd5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xd9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xdd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xe1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xe5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xe9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xf1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xf5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_svc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xf9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xfd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mact_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mig_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_spr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msta_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msta_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x109</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mrot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mget_lod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_pid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mget_nth</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x10d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x115</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x119</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x11d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">【μITRON4.0仕様との関係】</div>
<p>サービスコールの機能コードを割り当てなおした．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>サービスコールの増減に対応した．一部，サービスコールの機能コードを割り当てなおした．</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_8_カーネルオブジェクトに対するアクセスの種別"><a class="anchor" href="#_5_8_カーネルオブジェクトに対するアクセスの種別"></a><a class="link" href="#_5_8_カーネルオブジェクトに対するアクセスの種別">5.8 カーネルオブジェクトに対するアクセスの種別</a></h3>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 39.2857%;">
<col style="width: 16.0714%;">
<col style="width: 16.0714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">オブジェクトの種類</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通常操作2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">管理操作</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参照操作</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メモリオブジェクト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">書込み</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">読出し<br>
実行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">det_mem<br>
sac_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mem<br>
prb_mem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">act_tsk<br>
mact_tsk<br>
can_act<br>
mig_tsk<br>
wup_tsk<br>
can_wup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_pri<br>
chg_spr<br>
rel_wai<br>
sus_tsk<br>
rsm_tsk<br>
ras_ter<br>
sta_ovr<br>
stp_ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_tsk<br>
sac_tsk<br>
ter_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tst<br>
get_pri<br>
ref_tsk<br>
ref_ovr<br>
prb_mem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">セマフォ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sig_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_sem<br>
pol_sem<br>
twai_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_sem<br>
ini_sem<br>
sac_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_sem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">イベントフラグ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_flg<br>
clr_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_flg<br>
pol_flg<br>
twai_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_flg<br>
ini_flg<br>
sac_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_flg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">データキュー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_dtq<br>
psnd_dtq<br>
tsnd_dtq<br>
fsnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_dtq<br>
prcv_dtq<br>
trcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_dtq<br>
ini_dtq<br>
sac_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">優先度データキュー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_pdq<br>
psnd_pdq<br>
tsnd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_pdq<br>
prcv_pdq<br>
trcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_pdq<br>
ini_pdq<br>
sac_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_pdq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ミューテックス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_mtx<br>
ploc_mtx<br>
tloc_mtx<br>
unl_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mtx<br>
ini_mtx<br>
sac_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mtx</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">メッセージバッファ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_mbf<br>
psnd_mbf<br>
tsnd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_mbf<br>
prcv_mbf<br>
trcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mbf<br>
ini_mbf<br>
sac_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">スピンロック</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_spn<br>
try_spn<br>
unl_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_spn<br>
sac_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_spn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">固定長メモリプール</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_mpf<br>
pget_mpf<br>
tget_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mpf<br>
ini_mpf<br>
sac_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mpf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期通知</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_cyc<br>
msta_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_cyc<br>
sac_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_cyc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラーム通知</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_alm<br>
msta_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_alm<br>
sac_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_alm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_isr<br>
sac_isr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">保護ドメイン</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_yyy<br>
rot_rdq<br>
mrot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_ter<br>
ena_ter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_dom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_lod<br>
mget_lod<br>
get_nth<br>
mget_nth</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">システム状態</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_dsp<br>
ena_dsp<br>
chg_som</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_cpu<br>
unl_cpu<br>
dis_int<br>
ena_int<br>
clr_int<br>
ras_int<br>
chg_ipm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_tim<br>
adj_tim<br>
set_dft<br>
att_mem<br>
att_pma<br>
cfg_int<br>
def_svc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tim<br>
get_ipm<br>
prb_int<br>
ref_int<br>
ref_sys<br>
get_som<br>
ref_cfg<br>
ref_ver</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>すべての保護ドメインから呼び出すことができるサービスコール：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自タスクへの操作（ext_tsk，get_inf，slp_tsk，tslp_tsk，dly_tsk，sns_ter）</p>
</li>
<li>
<p>高分解能タイマの参照（fch_hrt）</p>
</li>
<li>
<p>システム状態参照（get_tid，get_did，get_pid，sns_ctx，sns_loc，sns_dsp，sns_dpn，sns_ker）</p>
</li>
<li>
<p>CPU例外発生時の状態参照（xsns_dpn）</p>
</li>
<li>
<p>拡張サービスコールの呼出し（cal_svc）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>カーネルドメインのみから呼び出すことができるサービスコール：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システム状態のアクセス許可ベクタの設定（sac_sys）</p>
</li>
<li>
<p>カーネルの終了（ext_ker）</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">【補足説明】</div>
<p>xsns_dpnは，エラーコードを返さないために，すべての保護ドメインから呼び出すことができるサービスコールとしているが，タスクコンテキストから呼び出した場合には必ずtrueが返ることとしており，実質的にはカーネルドメインのみから呼び出すことができる．</p>
</div>
<div class="paragraph">
<div class="title">【μITRON4.0/PX仕様との関係】</div>
<p>システム時刻に対するアクセス許可ベクタは廃止し，システム時刻に対する操作は，システム状態に対する管理操作と参照操作で保護するように変更した．また，保護ドメインに対するアクセス許可ベクタを新設し，システム状態に対するアクセス許可ベクタで保護していたサービスコールの中で，スケジューリングに関するものを，保護ドメインに対するアクセス許可ベクタで保護するように変更した．</p>
</div>
<div class="paragraph">
<p>get_yyyは，対象オブジェクトに対する通常操作1としていたのを，参照操作に変更した．ter_tskは，タスクに対する通常操作2としていたのを，タスクに対する管理操作に変更した．unl_mtxを，アクセス許可ベクタによる保護を行うように変更した．sac_sysを，システム状態に対する管理操作から，カーネルドメインのみから呼び出すことができるサービスコールに変更した．</p>
</div>
<div class="paragraph">
<div class="title">【TOPPERS新世代カーネル統合仕様との関係】</div>
<p>保護ドメインに対するアクセス許可ベクタを新設し，システム状態に対するアクセス許可ベクタで保護していたサービスコールの中で，スケジューリングに関するものとオブジェクトを生成するサービスコールを，保護ドメインに対するアクセス許可ベクタで保護するように変更した．</p>
</div>
<div class="paragraph">
<p>ter_tskは，タスクに対する通常操作2としていたのを，タスクに対する管理操作に変更した．</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_9_ターゲット定義事項一覧"><a class="anchor" href="#_5_9_ターゲット定義事項一覧"></a><a class="link" href="#_5_9_ターゲット定義事項一覧">5.9 ターゲット定義事項一覧</a></h3>
<div class="ulist">
<ul>
<li>
<p>メモリオブジェクトの先頭番地とサイズに対する制約〔P〕［NGKI0070］［NGKI2774］</p>
</li>
<li>
<p>サポートするクラスとそのID番号〔M〕［NGKI0644］</p>
</li>
<li>
<p>サポートするプロセッサの数と各プロセッサの識別名〔M〕［NGKI0642］</p>
</li>
<li>
<p>どのプロセッサをマスタプロセッサとするか〔M〕［NGKI0101］</p>
</li>
<li>
<p>クラスの属性〔M〕［NGKI0107］</p>
</li>
<li>
<p>どのプロセッサをタイムイベント処理プロセッサとするか〔M〕［NGKI0622］</p>
</li>
<li>
<p>コンパイラが出力しないセクションの中で，どれを標準のセクションと扱うか〔P〕［NGKI0113］</p>
</li>
<li>
<p>手動メモリ配置をサポートするか〔P〕［NGKI0608］</p>
</li>
<li>
<p>システム周期オーバラン例外の例外ハンドラ番号〔P〕［NGKI0603］</p>
</li>
<li>
<p>受け付けた割込み要求に対して，割込みサービスルーチンも割込みハンドラも登録していない場合の振舞い［NGKI0249］</p>
</li>
<li>
<p>割込み優先度の段階数［NGKI0256］</p>
</li>
<li>
<p>割込み要求禁止フラグがサポートされているか［NGKI0260］［NGKI0261］</p>
</li>
<li>
<p>割込み要求禁止フラグの振舞いを仕様と異なるものとするか［NGKI0261］</p>
</li>
<li>
<p>割込み要求ラインをエッジトリガに設定する場合に，ポジティブエッジトリガかネガティブエッジトリガか両エッジトリガかを設定できるか［NGKI0265］</p>
</li>
<li>
<p>割込み要求ラインをレベルトリガに設定する場合に，ローレベルトリガかハイレベルトリガかを設定できるか［NGKI0266］</p>
</li>
<li>
<p>割込み要求ラインのトリガモードの設定がサポートされているか［NGKI0267］</p>
</li>
<li>
<p>割込み番号の付与方法［NGKI0272］</p>
</li>
<li>
<p>割込みハンドラ番号の付与方法［NGKI0273］</p>
</li>
<li>
<p>割込み番号に対応しない割込みハンドラ番号や，割込みハンドラ番号に対応しない割込み番号を設けるか［NGKI0276］</p>
</li>
<li>
<p>あるプロセッサで割込み要求禁止フラグを動的にセット／クリアしても，他のプロセッサに対しては割込みがマスク／マスク解除されないものとするか〔M〕［NGKI0281］</p>
</li>
<li>
<p>TMIN_INTPRIを固定するか設定できるようにするかと，設定できるようにする場合の設定方法［NGKI0288］</p>
</li>
<li>
<p>NMI以外にカーネル管理外の割込みを設けるか（設けられるようにするか）［NGKI0289］</p>
</li>
<li>
<p>カーネル管理外の割込みハンドラが実行開始される時のシステム状態とコンテキスト，割込みハンドラの終了時に行われる処理，割込みハンドラの記述方法［NGKI0292］</p>
</li>
<li>
<p>カーネル管理外の割込みの設定方法として，3つの方法のいずれを採用するか［NGKI0295］</p>
</li>
<li>
<p>カーネル管理外とされた割込みに対して，カーネルのAPIにより割込みハンドラを登録できるかと，割込み要求ラインの属性を設定できるか［NGKI0297］</p>
</li>
<li>
<p>CPU例外ハンドラ番号の付与方法［NGKI0306］</p>
</li>
<li>
<p>発生したCPU例外に対して，CPU例外ハンドラを登録していない場合の振舞い［NGKI0314］</p>
</li>
<li>
<p>メモリオブジェクトに対して，通常のメモリアクセスにより，許可されていない書込みアクセスまたは読出しアクセス（実行アクセスを含む）を行おうとした場合に，どのCPU例外ハンドラが起動されるか〔P〕［NGKI0411］</p>
</li>
<li>
<p>メモリオブジェクトに対して，サービスコールを通じて，許可されていない書込みアクセスまたは読出しアクセスを行おうとした場合に，サービスコールからE_MACVエラーが返るか，メモリアクセス違反ハンドラが起動されるか〔P〕［NGKI0413］</p>
</li>
<li>
<p>メモリアクセス違反ハンドラで，アクセス違反を発生させたアクセスに関する情報（アクセスした番地，アクセスの種別，アクセスした命令の番地など）を参照する方法〔P〕［NGKI0414］</p>
</li>
<li>
<p>メモリオブジェクトの書込みアクセスと読出しアクセス（実行アクセスを含む）に対して設定できるアクセス許可パターンに対する制限〔P〕［NGKI0417］</p>
</li>
<li>
<p>1つの保護ドメインに登録できるメモリオブジェクトの数に対する制限〔P〕［NGKI0423］</p>
</li>
<li>
<p>ユーザスタック領域に対して実行アクセスを行えるか〔P〕［NGKI0440］</p>
</li>
<li>
<p>タスクのユーザスタック領域を，そのタスクが属する保護ドメイン全体からアクセスできるものとするか〔P〕［NGKI0441］</p>
</li>
<li>
<p>int8_t，uint8_t，int64_t，uint64_t，int128_t，uint128_t，float32_t，double64_tが使用できるか［NGKI0488］［NGKI0490］</p>
</li>
<li>
<p>ターゲット定義のタスク属性［NGKI1016］</p>
</li>
<li>
<p>タスクが用いるスタック領域のサイズの最小値［NGKI1042］</p>
</li>
<li>
<p>タスクのシステムスタック領域のサイズの最小値〔P〕［NGKI1044］</p>
</li>
<li>
<p>タスクが用いるスタック領域の先頭番地とサイズに対する制約［NGKI1050］［NGKI1056］</p>
</li>
<li>
<p>ユーザタスクのスタック領域（ユーザスタック領域）をアプリケーションで確保する方法〔P〕［NGKI1059］</p>
</li>
<li>
<p>タスクのシステムスタック領域の先頭番地とサイズに対する制約〔P〕［NGKI1062］［NGKI1065］［NGKI1070］</p>
</li>
<li>
<p>HRP3カーネルの動的生成機能拡張パッケージにおいて，acre_tskでユーザタスクを生成する場合に，ユーザスタック領域をアプリケーションで確保する方法とユーザスタック領域に対する制約［HRPS0240］［HRPS0241］</p>
</li>
<li>
<p>データキュー管理領域の先頭番地に対する制約［NGKI1687］</p>
</li>
<li>
<p>優先度データキュー管理領域の先頭番地に対する制約［NGKI1824］</p>
</li>
<li>
<p>メッセージバッファ管理領域の先頭番地とサイズに対する制約［NGKI3319］［NGKI3324］</p>
</li>
<li>
<p>ターゲット定義のスピンロック属性〔M〕［NGKI5175］</p>
</li>
<li>
<p>ハードウェアが持つ機構で実現できるスピンロックの数〔M〕［NGKI5169］</p>
</li>
<li>
<p>スピンロックに対して，複数のプロセッサがロックの取得を待っている時に，どのプロセッサが最初にロックを取得できるか〔M〕［NGKI2183］</p>
</li>
<li>
<p>固定長メモリプール領域の先頭番地に対する制約［NGKI2249］</p>
</li>
<li>
<p>固定長メモリプール管理領域の先頭番地に対する制約［NGKI2256］</p>
</li>
<li>
<p>高分解能タイマの周期とカウントアップの進み幅［NGKI3574］</p>
</li>
<li>
<p>HRTCNT型が32ビットと64ビットのいずれであるか［NGKI3573］</p>
</li>
<li>
<p>オーバランハンドラ機能がサポートされているか［NGKI2598］</p>
</li>
<li>
<p>オーバランハンドラの残りプロセッサ時間に指定できる値の上限［NGKI2594］</p>
</li>
<li>
<p>対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられている場合に，オーバランハンドラの動作を開始できるか〔M〕［NGKI5145］</p>
</li>
<li>
<p>対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられている場合に，オーバランハンドラの動作を停止できるか〔M〕［NGKI5147］</p>
</li>
<li>
<p>対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられている場合に，オーバランハンドラの残りプロセッサ時間を参照できるか〔M〕［NGKI5139］</p>
</li>
<li>
<p>ターゲット定義のメモリリージョン属性〔P〕［NGKI2771］</p>
</li>
<li>
<p>メモリリージョンの先頭番地とサイズに対する制約〔P〕［NGKI2768］</p>
</li>
<li>
<p>メモリオブジェクトに対するTA_NOWRITE属性，TA_NOREAD属性，TA_EXEC属性の内，どのような場合にどの属性の指定が無視されるか〔P〕［NGKI2782］</p>
</li>
<li>
<p>ショートデータ領域がサポートされておらず，TA_SDATA属性が無視されるか〔P〕［NGKI2789］</p>
</li>
<li>
<p>TA_UNCACHE属性やTA_IODEV属性を指定しても意味がなく，これらの属性が無視されるか〔P〕［NGKI2792］</p>
</li>
<li>
<p>キャッシュ禁止にできないメモリオブジェクトと周辺デバイスの領域として扱うことができないメモリオブジェクト〔P〕［NGKI2793］</p>
</li>
<li>
<p>ターゲット定義のメモリオブジェクト属性〔P〕［NGKI2794］</p>
</li>
<li>
<p>標準のメモリオブジェクト属性の定義を，標準的なものから変更するか〔P〕［NGKI3964］</p>
</li>
<li>
<p>ターゲット定義のメモリオブジェクト属性が，メモリオブジェクトアクセス属性であるか〔P〕［NGKI3987］</p>
</li>
<li>
<p>ATT_SECにより登録できるセクションが属する保護ドメインや登録できる数に対する制限〔P〕［NGKI2831］</p>
</li>
<li>
<p>ターゲット定義の予約セクション〔P〕［NGKI5129］</p>
</li>
<li>
<p>ATT_MODがサポートされているか〔P〕［NGKI2859］</p>
</li>
<li>
<p>ATT_MODにより登録できるオブジェクトモジュールが属する保護ドメインや登録できる数に対する制限〔P〕［NGKI2857］</p>
</li>
<li>
<p>ATT_MEMにより登録できるメモリオブジェクトが属する保護ドメインや登録できる数に対する制限〔P〕［NGKI2878］</p>
</li>
<li>
<p>ATT_MEM／att_memにより登録するメモリ領域の先頭番地とサイズに対する制約〔P〕［NGKI2880］</p>
</li>
<li>
<p>ATT_PMA／att_pmaがサポートされているか〔P〕［NGKI2903］［HRPS0156］［HRMPS0118］</p>
</li>
<li>
<p>ATT_PMAにより登録できるメモリオブジェクトが属する保護ドメインや登録できる数に対する制限〔P〕［NGKI2898］</p>
</li>
<li>
<p>ATT_PMA／att_pmaにより登録するメモリ領域の先頭番地とサイズ，物理アドレス空間における先頭番地に対する制約〔P〕［NGKI2900］</p>
</li>
<li>
<p>HRP3カーネルの動的生成機能拡張パッケージにおいて，acre_tskで生成したユーザタスクのユーザスタック領域に対して，他のタスクからアクセスが許可されているかをprb_memによりチェックした場合に，E_NOEXSエラーとなるか［HRPS0244］</p>
</li>
<li>
<p>ターゲット定義の割込み要求ライン属性［NGKI2945］</p>
</li>
<li>
<p>ターゲット定義の割込みサービスルーチン属性［NGKI5176］</p>
</li>
<li>
<p>割込みハンドラ属性にTA_NONKERNELを指定できるか［NGKI2957］</p>
</li>
<li>
<p>その他のターゲット定義の割込みハンドラ属性［NGKI2959］</p>
</li>
<li>
<p>cfg_intにおいて，複数の割込み要求ラインの割込み優先度が連動して設定されるか〔D〕［NGKI2980］</p>
</li>
<li>
<p>CFG_INT／cfg_intで，カーネル管理外の割込み要求ラインに対しても属性を設定できるか［NGKI2982］</p>
</li>
<li>
<p>CFG_INT／cfg_intで，各割込み要求ラインに対して設定できる割込み要求ライン属性／割込み優先度に対する制限［NGKI2985］</p>
</li>
<li>
<p>CFG_INT／cfg_intで，各割込み要求ラインが属することができるクラスに対する制限〔M〕［NGKI5184］</p>
</li>
<li>
<p>どのプロセッサからどの割込み要求ラインの属性を設定できないか〔MD〕［NGKI5177］</p>
</li>
<li>
<p>割込みサービスルーチンが属することができるクラスに対する制限〔M〕［NGKI3019］</p>
</li>
<li>
<p>CRE_ISRにおいて，isrが不正である場合にE_PARエラーが検出されるか［NGKI3020］</p>
</li>
<li>
<p>DEF_INHで，カーネル管理外の割込みに対しても割込みハンドラを定義できるか［NGKI3064］</p>
</li>
<li>
<p>カーネル管理外に固定されている割込みハンドラがあるか［NGKI3067］</p>
</li>
<li>
<p>カーネル管理に固定されている割込みハンドラがあるか［NGKI3068］</p>
</li>
<li>
<p>割込みハンドラが属することができるクラスに対する制限〔M〕［NGKI3075］</p>
</li>
<li>
<p>DEF_INHで割込みハンドラを定義できない割込みハンドラ番号［NGKI3078］</p>
</li>
<li>
<p>DEF_INHにおいて，inthdrが不正である場合にE_PARエラーが検出されるか［NGKI3080］</p>
</li>
<li>
<p>dis_intがサポートされているか［NGKI3091］</p>
</li>
<li>
<p>dis_intにより，どのような場合に割込み要求ラインの割込み要求禁止フラグをセットできないか［NGKI3087］</p>
</li>
<li>
<p>dis_intにおいて，割込み要求禁止フラグの振舞いが，この仕様の規定と異なるか［NGKI3089］</p>
</li>
<li>
<p>ena_intがサポートされているか［NGKI3104］</p>
</li>
<li>
<p>ena_intにより，どのような場合に割込み要求ラインの割込み要求禁止フラグをクリアできないか［NGKI3100］</p>
</li>
<li>
<p>ena_intにおいて，割込み要求禁止フラグの振舞いが，この仕様の規定と異なるか［NGKI3102］</p>
</li>
<li>
<p>clr_intがサポートされているか［NGKI3925］</p>
</li>
<li>
<p>割込み要求ラインがレベルトリガである場合のclr_intの振舞い［NGKI3928］</p>
</li>
<li>
<p>clr_intにより，どのような場合に割込み要求ラインに対する割込み要求をクリアできないか［NGKI3930］</p>
</li>
<li>
<p>clr_intにおいて，割込み要求のクリアの振舞いが，この仕様の規定と異なるか［NGKI3931］</p>
</li>
<li>
<p>ras_intがサポートされているか［NGKI3937］</p>
</li>
<li>
<p>割込み要求ラインがレベルトリガである場合のras_intの振舞い［NGKI3940］</p>
</li>
<li>
<p>ras_intにより，どのような場合に割込み要求ラインに対して割込みを要求できないか［NGKI3942］</p>
</li>
<li>
<p>ras_intにおいて，割込みの要求の振舞いが，この仕様の規定と異なるか［NGKI3943］</p>
</li>
<li>
<p>prb_intがサポートされているか［NGKI3949］</p>
</li>
<li>
<p>prb_intにより，どのような場合に割込み要求ラインに対する割込み要求をチェックできないか［NGKI3952］</p>
</li>
<li>
<p>prb_intにおいて，割込み要求のチェックの振舞いが，この仕様の規定と異なるか［NGKI3953］</p>
</li>
<li>
<p>chg_ipmにより，割込み優先度マスクをTMIN_INTPRIよりも小さい値に変更できるか［NGKI3114］</p>
</li>
<li>
<p>ターゲット定義のCPU例外ハンドラ属性［NGKI3123］</p>
</li>
<li>
<p>DEF_EXCにおいて，exchdrが不正である場合にE_PARエラーが検出されるか［NGKI3149］</p>
</li>
<li>
<p>タイムウィンドウの長さに指定できる値の上限〔P〕［NGKI5050］</p>
</li>
<li>
<p>非タスクコンテキスト用スタック領域のサイズの最小値［NGKI3254］</p>
</li>
<li>
<p>非タスクコンテキスト用スタック領域の先頭番地とサイズに対する制約［NGKI3220］［NGKI3222］</p>
</li>
<li>
<p>DEF_ICSにより非タスクコンテキスト用スタック領域を設定しない場合に，コンフィギュレータにより確保されるスタック領域は，どのクラス向けの標準メモリリージョン内に確保されるか〔PM〕［NGKI5138］</p>
</li>
<li>
<p>DEF_ICSにより非タスクコンテキスト用スタック領域を設定しない場合の，非タスクコンテキスト用スタック領域のデフォルトのサイズ［NGKI3224］</p>
</li>
<li>
<p>共有スタック領域のサイズの最小値［NGKI3255］</p>
</li>
<li>
<p>共有スタック領域の先頭番地とサイズに対する制約［NGKI3234］［NGKI3236］</p>
</li>
<li>
<p>カーネルメモリプール領域の先頭番地とサイズに対する制約［NGKI5078］［NGKI5083］</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_5_10_省略名の元になった英語"><a class="anchor" href="#_5_10_省略名の元になった英語"></a><a class="link" href="#_5_10_省略名の元になった英語">5.10 省略名の元になった英語</a></h3>
<div class="sect3">
<h4 id="_5_10_1_サービスコールと静的apiの名称の中のxxxの元になった英語"><a class="anchor" href="#_5_10_1_サービスコールと静的apiの名称の中のxxxの元になった英語"></a><a class="link" href="#_5_10_1_サービスコールと静的apiの名称の中のxxxの元になった英語">5.10.1 サービスコールと静的APIの名称の中のxxxの元になった英語</a></h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元になった英語</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">act</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access permission vector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adj</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adjust</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">automatically assigned ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">att</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">attach</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cancel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cfg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clear</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cre</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">define</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">det</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">detach</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialize</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lnk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">migrate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">poll</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">probe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ras</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raise</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">release</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rotate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rsm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set access permission vector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">signal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sleep</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">send</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sense</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspend</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">terminate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unlock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wake up</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_10_2_サービスコールと静的apiの名称の中のyyyの元になった英語"><a class="anchor" href="#_5_10_2_サービスコールと静的apiの名称の中のyyyの元になった英語"></a><a class="link" href="#_5_10_2_サービスコールと静的apiの名称の中のyyyの元になった英語">5.10.2 サービスコールと静的APIの名称の中のyyyの元になった英語</a></h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元になった英語</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">act</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">alarm notification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cfg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ctx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">context</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cyclic notification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dritf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">did</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dpn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dispatch pending</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dispatch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">epr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">execution priority</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exception</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fetch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventflag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hrt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-resolution timer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt context stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt handler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialization</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt priority mask</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt service routine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kernel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">message buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fixed-sized memory pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mpk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kernel memory pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mutex</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrun handler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">priority data queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processor ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">physical memory area</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">priority</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ready queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">region</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">section</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">semaphore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">som</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system operating mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">standard memory region</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spin lock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub-priority</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">svc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service call</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">termination</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">task</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time window</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">utm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time in micro second</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wake up</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_5_10_3_サービスコールの名称の中のzの元になった英語"><a class="anchor" href="#_5_10_3_サービスコールの名称の中のzの元になった英語"></a><a class="link" href="#_5_10_3_サービスコールの名称の中のzの元になった英語">5.10.3 サービスコールの名称の中のzの元になった英語</a></h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元になった英語</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">automatic ID assignment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">force</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiprocessor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">p</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">poll</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronized</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exception</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_5_11_バージョン履歴"><a class="anchor" href="#_5_11_バージョン履歴"></a><a class="link" href="#_5_11_バージョン履歴">5.11 バージョン履歴</a></h3>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 22.8571%;">
<col style="width: 48.5716%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014年11月24日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release 3.A.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最初の早期リリース（α版）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016年2月8日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release 3.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最初の一般公開</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2017年7月21日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release 3.1.0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018年4月19日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release 3.2.0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018年4月26日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release 3.2.1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019年3月20日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release 3.3.0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019年10月5日</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release 3.4.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">長期サポートバージョンの起点</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_付録Ａ_バージョン間の差分"><a class="anchor" href="#_付録Ａ_バージョン間の差分"></a><a class="link" href="#_付録Ａ_バージョン間の差分">付録Ａ バージョン間の差分</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>この付録では，この仕様のバージョンアップにより，仕様の内容に変更があったものをリストアップしている．仕様の内容に影響のない記述の変更や，仕様を補足説明する説明文などの変更はリストアップしていない．また，単純な誤記の修正もリストアップしていない．</p>
</div>
<div class="sect2">
<h3 id="_a_1_release_3_2_0とrelease_3_2_1の差分"><a class="anchor" href="#_a_1_release_3_2_0とrelease_3_2_1の差分"></a><a class="link" href="#_a_1_release_3_2_0とrelease_3_2_1の差分">A.1 Release 3.2.0とRelease 3.2.1の差分</a></h3>
<div class="ulist">
<ul>
<li>
<p>タグ番号の付与漏れの修正</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3991〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグ番号を付与</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_a_2_release_3_2_1とrelease_3_3_0の差分"><a class="anchor" href="#_a_2_release_3_2_1とrelease_3_3_0の差分"></a><a class="link" href="#_a_2_release_3_2_1とrelease_3_3_0の差分">A.2 Release 3.2.1とRelease 3.3.0の差分</a></h3>
<div class="sect3">
<h4 id="_a_2_1_マルチプロセッサ対応に関する仕様変更"><a class="anchor" href="#_a_2_1_マルチプロセッサ対応に関する仕様変更"></a><a class="link" href="#_a_2_1_マルチプロセッサ対応に関する仕様変更">A.2.1 マルチプロセッサ対応に関する仕様変更</a></h4>
<div class="ulist">
<ul>
<li>
<p>プロセッサ間の排他制御を実現するための機構が必要であることを記述</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0639〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0640〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>ローカルタイマ方式とグローバルタイマ方式の考え方を廃止し，タイムイベント処理プロセッサの概念を導入</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0563〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0621〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0108〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0109〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0110〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0111〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0622〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0526〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0527〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3603</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2337</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3603に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2338〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2339〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2340〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2341〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2342〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3595〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3576〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3568〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2355〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3590〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3602〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3577〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2375〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5088〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2401〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5089〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2407〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5090〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2454〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2483〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5091〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2503〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5092〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2509〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5093〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2561〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>クラスとプロセッサの扱いに関して漏れていた規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0644〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0645〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0642〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0643〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>構成マクロTOPPERS_TEPP_PRCに関する規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0526〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>CPUロック状態でext_tskが呼ばれた場合に，CPUロック状態の解除と自タスクの終了の間に，割込みとタスク切換えが発生する場合があることを規定．また，これに関連して，CPUロック状態で強制待ち状態［実行継続中］のタスクがext_tskを発行した場合には，強制待ち状態に遷移する場合もあることを規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0648〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5183〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>スピンロックがカーネルによって返却される状況を厳密に規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2121〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5167に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2122〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5167に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5167〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>エミュレーションによりスピンロックが実現される場合を規定し，スピンロック属性を規定．あわせて，E_NORESエラーの発生状況を変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2125〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5168に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2126〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5168〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5175〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5169〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5170〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5171〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5172〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5173〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2142〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5169に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2143〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5174に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5174〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>マルチプロセッサ対応カーネルにおいて，自タスクが割付けられたプロセッサと異なるプロセッサに割り付けられているタスクに対してオーバランハンドラの操作をした場合の振る舞いを，ターゲット定義と規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5145〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5146〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5147〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5148〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5139〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5140〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>CRE_ISR／DEF_INHと対応するCFG_INTが異なるクラスの囲み中にある場合のエラーの扱いを整理</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5143〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2992〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5141，NGKI5142に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3017〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5142に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5141〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5142〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>属するクラスの指定が有効範囲外のエラーは，静的APIでも発生することを規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1031〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5111〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1458〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5112〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1564〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5113〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1671〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5114〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1806〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5115〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2027〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5116〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3305〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5117〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2134〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5118〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2227〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5119〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2386〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5120〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2494〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5121〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5103〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5104〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5105〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2869〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2889〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2970〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3001〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5122〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3053〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3132〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5107〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5128〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5164〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5165〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_2_2_保護機能対応に関する仕様変更"><a class="anchor" href="#_a_2_2_保護機能対応に関する仕様変更"></a><a class="link" href="#_a_2_2_保護機能対応に関する仕様変更">A.2.2 保護機能対応に関する仕様変更</a></h4>
<div class="ulist">
<ul>
<li>
<p>特権モードと非特権モード，MMUまたはMPUが必要であることを記述</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0646〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0647〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>スケジューリング単位番号とSCHEDNOマクロについて規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0630〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0631〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0632〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0633〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0634〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>スケジューリング単位番号の概念を用いて仕様を記述</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3772〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5125に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3773〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5125に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3622〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5125に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5125〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2699〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3779〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0630,NGKI0631に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3880〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0632に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2702〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3774〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5126に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3775〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5126に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3630〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5126に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5126〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3639〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3882〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0630,NGKI0631に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3883〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0632に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3776〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5127に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3777〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5127に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3649〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5127に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5127〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3658〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3885〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0630,NGKI0631に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3886〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0632に統合</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>スケジューリング単位番号のパラメータ名を変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 28.5714%;">
<col style="width: 65.7144%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3549〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2696〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3632〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3635〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3651〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3654〔P｜M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>標準メモリリージョンの扱いを変更・明確化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3259〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3894〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5098〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5099〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2854〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3895〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3893〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2853〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3271〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>DEF_SRGのパラメータ種別に関する規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5149〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>スタック領域や固定長メモリプール領域がどのメモリリージョン内に配置されるかを規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5136〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1051〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1061〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2242〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5137〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5138〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>保護ドメイン毎の標準セクションを廃止</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0114〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0115〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0116〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2836〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>ATT_SECのregnameの記述を省略可能に</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5150〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5151〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>ターゲット定義の予約セクションに関して規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5129〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>保護ドメインに対して設定できる最高のタスク優先度の適用範囲を広げた</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5123〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5124〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>slt_domではE_RSATRエラーが返らないことを規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3747〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>タイムウィンドウに関する規定を追加・明確化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5003〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5094〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5095〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5100〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>タイムウィンドウ通知の機能を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5096〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5040〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5155〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5047〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5097〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5106〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>システム周期オーバラン例外からリターンした場合の振る舞いを規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0635〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>ユーザスタック領域の特殊扱いに関する規定（acre_tskを対象に追加したもの）を，HRP3カーネルの個別の規定に変更し，規定を厳密化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3990〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0240</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0241</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0242</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0243</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0244</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_2_3_保護機能とマルチプロセッサの両方に対応するための仕様の追加と変更"><a class="anchor" href="#_a_2_3_保護機能とマルチプロセッサの両方に対応するための仕様の追加と変更"></a><a class="link" href="#_a_2_3_保護機能とマルチプロセッサの両方に対応するための仕様の追加と変更">A.2.3 保護機能とマルチプロセッサの両方に対応するための仕様の追加と変更</a></h4>
<div class="ulist">
<ul>
<li>
<p>マルチプロセッサ対応カーネルにおける時間パーティショニング使用時のスケジューリング規則（タイムウィンドウの扱いを含む）と制限事項を規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0624〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0627〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0625〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0626〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0636〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0637〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>アイドルドメインにまとめられていないユーザドメインに属するタスク等を，そのユーザドメインに対してタイムウィンドウを割り当てられていないプロセッサに割り付けることはできないことを規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0628〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5108〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5109〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5110〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5130〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5131〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5132〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5133〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>SAC_SYS，ACV_DOM，LMT_DOMをクラスの囲みの中に記述した場合を，エラーから警告に変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2675〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3758〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3443〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>プロセッサ間でシステム動作モードの切換えが同期しない状況に関する規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5134〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5135〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>DEF_SCYとCRE_SOMはクラスの囲みの外に記述することに変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5014〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5053〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除（タグ番号の付与ミスだった）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5023〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>TOPPRES/HRMPカーネルのカーネル識別番号を規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0528</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>HRMP3カーネルにおける規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0012</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0013</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0106</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0107</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0108</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0109</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0113</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0114</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0117</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0118</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0119</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_2_4_その他の仕様変更"><a class="anchor" href="#_a_2_4_その他の仕様変更"></a><a class="link" href="#_a_2_4_その他の仕様変更">A.2.4 その他の仕様変更</a></h4>
<div class="ulist">
<ul>
<li>
<p>カーネルメモリプール領域に関する仕様の整理とマルチプロセッサ対応カーネル向けの拡張</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5085〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5157とNGKI5162に分割</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5156〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5157〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5158〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5159〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5160〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5161〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5162〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5163〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>ターゲット定義の割込みサービスルーチン属性に関する規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2951</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI5176に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2952</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5176</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>コンフィギュレータに対するINCLUDEディレクティブの文法の制限</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0619に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0619</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>コンフィギュレータに対する条件ディレクティブの振る舞いの変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0446</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0620に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0620</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>SILの微少時間待ちの機能は，非特権モードから呼び出した場合に保証されないものと変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0802</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>SILのメモリ空間同期書込み関数群とI/O空間同期書込み関数群を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0845</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0846</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0847</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0848</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0849</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0850</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0851</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0843</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>初期化ルーチンと終了処理ルーチンの先頭番地のエラーチェックをターゲット定義とする規定を廃止</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3246</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3253</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_2_5_個別のカーネル仕様の変更"><a class="anchor" href="#_a_2_5_個別のカーネル仕様の変更"></a><a class="link" href="#_a_2_5_個別のカーネル仕様の変更">A.2.5 個別のカーネル仕様の変更</a></h4>
<div class="ulist">
<ul>
<li>
<p>HRP3カーネルにおけるオーバランハンドラ機能に関する規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0013</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0014</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0238</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0239</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>SSP3カーネルで，act_tskのtskidにTSK_SELFを指定する機能をサポートしないことを規定</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSPS0163</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>SSP3カーネルで，get_tstとget_tidをサポートするように変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSPS0156</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSPS0133</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_2_6_仕様の明確化と整理"><a class="anchor" href="#_a_2_6_仕様の明確化と整理"></a><a class="link" href="#_a_2_6_仕様の明確化と整理">A.2.6 仕様の明確化と整理</a></h4>
<div class="ulist">
<ul>
<li>
<p>静的APIの一般定数式パラメータにNULLと記述することの明確化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0638</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>タスクの次回起動時の割付けプロセッサの扱いを明確化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1007〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1008〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記載場所の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1009〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>カーネルドメインに属する処理単位は常に実行できることを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0623〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>強制待ち状態［実行継続中］から休止状態への状態遷移があることを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0629</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>制約タスクのサブ優先度をサービスコールで変更できないことを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0236</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>コンフィギュレータが仕様に規定されている以外の警告メッセージを出力する場合があることを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0641</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>割込み要求ラインの属性の設定に関するターゲット定義のエラーの扱いを整理</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2985</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2986</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI2985に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2987〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5177〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5184〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>ターゲット定義のCPU例外ハンドラ属性がない場合，CPU例外ハンドラ属性にはTA_NULLを指定しなければならないことを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5178</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>タイムウィンドウの登録時に，タイムイベントハンドラの呼出しによる通知を指定した場合は，E_OACVエラーとなることを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3695〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>オーバランハンドラが起動されると，オーバランハンドラは動作していない状態になることを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3993</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>TDOM_SELFの意味の変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0513〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>TSOM_STPの追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>ATT_TWDによる割り当て対象が，ユーザドメインのみであることを明確化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5040〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>DEF_ICSのistkパラメータの型を修正（STK_T → STK_T *）</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3212</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>T_DSVC型のフィールド名を修正（svcrtn → extsvc）</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI4035〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>タスクのスタック領域に，他のタスクからアクセスできるとは限らないことを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5166</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>yyymbにNULL以外を指定できないカーネルでは，TSZ_YYYMB，TCNT_YYYMBを用意しないことを明記（TSZ_MBFMBは例外）</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5179</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5181</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5182</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>記述の明確化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0599〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の明確化</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0600〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の明確化</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>不要な記述の削除</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0186</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0207</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0239</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>保護機能対応カーネルのみでサポートされている静的APIのエラー記述から，〔P〕の記号を削除</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2868〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2870〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2871〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2888〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2890〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2891〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_2_7_用語の変更"><a class="anchor" href="#_a_2_7_用語の変更"></a><a class="link" href="#_a_2_7_用語の変更">A.2.7 用語の変更</a></h4>
<div class="ulist">
<ul>
<li>
<p>「保護ドメインの標準メモリリージョン」を「保護ドメイン向けの標準メモリリージョン」に，「クラスの標準メモリリージョン」を「クラス向けの標準メモリリージョン」に改称</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3891〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3257〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3892〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3266〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>「指定できる最高のタスク優先度」を「設定できる最高のタスク優先度」に改称</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3751〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5086〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3441〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3743〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_a_2_8_タグの付与に関する変更"><a class="anchor" href="#_a_2_8_タグの付与に関する変更"></a><a class="link" href="#_a_2_8_タグの付与に関する変更">A.2.8 タグの付与に関する変更</a></h4>
<div class="ulist">
<ul>
<li>
<p>タグの付与漏れの修正</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5151〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグの追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5152〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグの追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5153〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグの追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5154〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグの追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5155〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグの追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3992</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">タグの追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>タグの番号の誤りの修正</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0537〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0426に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0426〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>タグの統合</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2606</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI2595に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2607</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI2599に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2796〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI2860に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2797〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI2904に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2963</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3092に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2964</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3105に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3917</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3926に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3918</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3938に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3919</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3950に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3018〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3019に統合</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3074〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI3075に統合</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>同じ記述に対する重複したタグの削除</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．ASPS0009と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．ASPS0010と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0174</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．ASPS0172と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0184</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．ASPS0003と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASPS0185</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．ASPS0004と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMPS0102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．FMPS0006と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMPS0149</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．FMPS0147と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FMPS0155</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．FMPS0002と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．HRPS0005と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0143</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．HRPS0141と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0149</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．HRPS0013と重複</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0238</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．HRPS0014と重複</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_a_3_release_3_3_0とrelease_3_4_0の差分"><a class="anchor" href="#_a_3_release_3_3_0とrelease_3_4_0の差分"></a><a class="link" href="#_a_3_release_3_3_0とrelease_3_4_0の差分">A.3 Release 3.3.0とRelease 3.4.0の差分</a></h3>
<div class="ulist">
<ul>
<li>
<p>SILスピンロックのネストを許すように変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0823</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0824</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0852に変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0852</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>HRTCNT型をターゲット定義で64ビット整数型にできるように変更</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0542</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3573</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>設定できる最高のタスク優先度の機能を廃止．LMT_DOM／slt_domを廃止</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5086〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0572〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3441〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3743〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3744〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3745〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3746〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3747〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3748〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3749〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3444〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3445〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3750〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3447〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3448〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3443〔PM〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5123〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3751〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5124〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI4043〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI4040</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>def_ovr，def_inh，def_excを廃止</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2609〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2610〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2611〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2614〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2615〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2617〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2622〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2623〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2626〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2627〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2628〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2629〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3049〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3050〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3051〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3057〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3058〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3060〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3071〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3072〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3076〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3077〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3078</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3079〔MD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3128〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3129〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3130〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3136〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3137〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3139〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3144〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3145〔PD〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3147〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3148〔D〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI4027</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI4033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI4034</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI4040</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>時間パーティショニング使用時に，システム周期の切換えとタイムウィンドウの切換えが遅れた場合の規定を追加</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0650</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0651</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0652</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0653</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>時間パーティショニング使用時のスケジューリングにおいて，ユーザタスクから呼び出された拡張サービスコールは，カーネルドメインに属する処理単位とは扱われないことを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0623〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0593〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0599〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>TCYC_HRTCNTがマクロ定義される条件を明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5187</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>クラスの属性に関する規定の訂正・明確化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0106〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>保護機能対応カーネルにおけるオブジェクト生成に必要なメモリ領域の確保方法を一般的に規定し，記述を厳密化</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0649〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">追加</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0618</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5136〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1061〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>保護機能対応カーネルにおいて，acre_tskでtskにNULLを指定してユーザタスクを生成する場合のユーザスタック領域と，acre_mpfでmpfにNULLを指定して固定長メモリプールを生成する場合の固定長メモリプール領域の確保方法を，未決定事項に</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI1051〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI2242〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>SSP3カーネルで，act_tskのtskidにTSK_SELFを指定する機能をサポートしない規定を削除</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSPS0163</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>システム周期の切換えが，システム時刻によって行われることを明記</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI3603</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>DEF_ICSでistkにNULLを指定した場合に，コンフィギュレータにより確保されるスタック領域が，どのクラス向けの標準メモリリージョン内に確保されるかの規定を訂正</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI5137〔P〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>カーネルが返すエラーコードの訂正</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRPS0011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HRMPS0008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>CPU例外からのリカバリ処理の方法(b)に関する説明を厳密化．また，同じ記述に対する重複したタグの削除</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 17.1428%;">
<col style="width: 77.143%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0311</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0318</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">削除．NGKI0311と重複</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>クラスのID番号に関する規定の記述を整理</p>
</li>
</ul>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.7142%;">
<col style="width: 22.8571%;">
<col style="width: 71.4287%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0644〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NGKI0107〔M〕</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">記述の変更</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api索引"><a class="anchor" href="#_api索引"></a><a class="link" href="#_api索引">API索引</a></h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
 Release 3.4.0<br>
Last updated 2020-09-06 16:24:35 +0900
</div>
</div>
</body>
</html>